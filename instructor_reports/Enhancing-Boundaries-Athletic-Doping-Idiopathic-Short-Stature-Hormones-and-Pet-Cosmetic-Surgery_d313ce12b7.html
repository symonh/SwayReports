<!doctype html>
<html lang="en" class="dark-mode">
<head>
  <script>
    // Set the correct Bootswatch theme based on theme_mode immediately
    window.themeMode = 'dark-mode';
    if (window.themeMode === 'light-mode') {
      document.write('<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/flatly/bootstrap.min.css" id="theme-css">');
    } else {
      document.write('<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/darkly/bootstrap.min.css" id="theme-css">');
    }
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Enhancing Boundaries: Athletic Doping, Idiopathic Short Stature Hormones, and Pet Cosmetic Surgery</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  
<style>
    :root {
      /* Darkened dark mode theme */
      --bg-color: #050505;          /* Near-black background */
      --card-bg: #0e0e1a;           /* Deeper navy card */
      --card-header-bg: #141422;     /* Darker header */
      --text-color: #e4e6eb;
      --muted-text-color: #a9adc1;
      --border-color: #1f1f2d;
      --button-bg: #252538;
      --button-hover-bg: #3a3a59; 
      --primary-color: #8a8aff;
      --input-bg: #252538;
      --message-left-bg: #141422;
      --message-right-bg: #0e0e1a;
    }

    /* Light mode theme variables */
    html.light-mode {
      /* Base colors */
      --bg-color: #f5f7fa;
      --card-bg: #ffffff;
      --card-header-bg: #f0f5fc;
      --text-color: #2c3e50;
      --muted-text-color: #5a6a7e;
      --border-color: #d1d9e6;
      
      /* UI elements - using purple Sway theme colors */
      --button-bg: #eef2f7; /* keeping grey for basic buttons */
      --button-hover-bg: #d9e2ec; /* keeping grey hover for basic buttons */
      --primary-color: #23004D; /* new purple theme color */
      --input-bg: #ffffff;
      
      /* Message colors */
      --message-left-bg: #eef2f7;
      --message-right-bg: #e6f0ff;
    }

    /* Additional light mode specific overrides for purple theme */
    html.light-mode .card {
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    html.light-mode .card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    html.light-mode .card-header {
      border-bottom: 1px solid var(--border-color);
    }

    /* Purple theme for headings and section titles */
    html.light-mode .section-title {
      border-bottom: 1px solid #23004D;
      color: #23004D;
    }

    html.light-mode .section-title i {
      color: #23004D;
    }

    html.light-mode .markdown-content h1,
    html.light-mode .markdown-content h2,
    html.light-mode .markdown-content h3,
    html.light-mode .markdown-content h4,
    html.light-mode .markdown-content h5,
    html.light-mode .markdown-content h6 {
      color: #23004D;
    }

    /* Purple theme for icons */
    html.light-mode .fas,
    html.light-mode .far,
    html.light-mode .fab {
      color: #23004D;
    }

    /* Keep header buttons grey */
    html.light-mode .header-actions .back-btn i,
    html.light-mode .header-actions .nav-btn i {
      color: inherit;
    }

    /* Thread items */
    html.light-mode .thread-item {
      background-color: #ffffff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }

    html.light-mode .thread-item:hover {
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      border: 2px solid #23004D;
    }

    html.light-mode .thread-item a {
      color: #23004D;
    }

    /* Badges and info elements */
    html.light-mode .badge-info {
      background-color: #e6e0f0;
      color: #23004D;
    }

    html.light-mode .text-info {
      color: #23004D !important;
    }

    /* Buttons with purple theme */
    html.light-mode .btn-primary {
      background-color: #23004D;
      border-color: #23004D;
    }

    html.light-mode .btn-primary:hover {
      background-color: #380080;
      border-color: #380080;
    }

    /* Content elements */
    html.light-mode .markdown-content code,
    html.light-mode .markdown-content pre {
      background-color: #f0f3f8;
      border: 1px solid #e0e5ee;
    }

    html.light-mode .markdown-content blockquote {
      background-color: #f0f3f8;
      border-left: 4px solid #23004D;
    }

    html.light-mode .markdown-content a {
      color: #23004D;
    }

    /* Info boxes and containers */
    html.light-mode .info-box {
      background-color: #f8fafd;
      border: 1px solid var(--border-color);
    }

    /* Topic labels and special text */
    html.light-mode .text-info {
      color: #23004D !important;
    }

    html.light-mode .col-label {
      color: #23004D;
    }

    /* Thread summary section styling */
    html.light-mode .thread-summary strong {
      color: #23004D;
    }

    /* Keep the orange buttons distinct */
    html.light-mode .btn-orange {
      background-color: #ff7200;
      border-color: #ff7200;
    }

    html.light-mode .btn-orange:hover {
      background-color: #e66800;
      border-color: #e66800;
    }

    /* Theme toggle styling */
    html.light-mode .theme-toggle-slider {
      background-color: #d9e2ec;
    }

    html.light-mode .theme-toggle-slider:before {
      background-color: #ffffff;
    }

    html.light-mode input:checked + .theme-toggle-slider {
      background-color: #23004D;
    }

    /* Pagination with purple theme */
    html.light-mode .page-item.active .page-link {
      background-color: #23004D;
      border-color: #23004D;
    }

    html.light-mode .page-link:hover {
      color: #23004D;
    }

    /* Apply theme variables to elements */
    html {
      margin: 0;
      padding: 0;
      border: none;
      outline: none;
    }
    
    body { 
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      transition: background-color 0.3s ease;
      border: none; /* Remove any borders */
      outline: none; /* Remove any outlines */
    }
    .dashboard-container {
      padding: 10px;
      max-width: 100%;
      margin: 0 auto;
      border: none;
      outline: none;
    }
    @media (min-width: 576px) {
      .dashboard-container {
        padding: 15px;
      }
    }
    @media (min-width: 768px) {
      .dashboard-container {
        padding: 25px;
        margin-left: 0;
        margin-right: 0;
      }
    }
    @media (min-width: 1200px) {
      .dashboard-container {
        margin-left: 0;
        margin-right: 0;
      }
    }
    .card {
      background-color: var(--card-bg);
      border: none;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      margin-bottom: 25px;
      transition: background-color 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    /* No hover effect for section title cards */
    .card.no-hover:hover {
      transform: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .card-header {
      font-size: 1.2rem;
      font-weight: 500;
      background-color: var(--card-header-bg);
      border-bottom: 1px solid var(--border-color);
      border-radius: 10px 10px 0 0 !important;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      transition: background-color 0.3s ease;
    }
    @media (min-width: 576px) {
      .card-header {
        font-size: 1.4rem;
        padding: 15px 20px;
      }
    }
    .card-title {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 10px;
      width: 100%;
    }
    
    .card-title .title-text {
      display: flex;
      align-items: center;
    }
    
    .card-title .badge {
      margin-left: 10px;
    }
    
    .generated-title {
      font-size: 1.68rem;
      font-weight: 600;
      margin-top: 5px;
      font-style: italic;
      margin-bottom: 5px;
      color: var(--primary-color) !important;
    }
    
    @media (min-width: 768px) {
      .card-title {
        margin-bottom: 0;
        width: auto;
      }
    }
    .card-body {
      padding: 15px;
      transition: background-color 0.3s ease;
    }
    @media (min-width: 576px) {
      .card-body {
        padding: 20px 25px;
      }
    }
    .section-title {
      padding-left: 15px;
      margin-top: 20px;
      font-size: 1.2rem;
      font-weight: 500;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      flex-wrap: wrap;
      transition: border-color 0.3s ease, color 0.3s ease;
    }
    .section-title i {
      margin-right: 10px;
    }
    .section-title .title-text {
      display: flex;
      align-items: center;
    }
    .section-title .actions {
      margin-left: auto;
      margin-top: 10px;
      width: 100%;
      text-align: right;
    }
    @media (min-width: 768px) {
      .section-title .actions {
        margin-top: 0;
        width: auto;
      }
    }
    .detail-item {
      margin-bottom: 15px;
      padding: 10px 15px;
      background-color: var(--card-header-bg);
      border-radius: 6px;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      transition: background-color 0.3s ease;
    }
    .detail-item strong {
      min-width: 140px;
      color: var(--muted-text-color);
    }
    .list-group-item {
      background-color: var(--card-header-bg);
      color: var(--text-color);
      border: none;
      border-radius: 6px;
      margin-bottom: 8px;
      transition: background-color 0.2s, color 0.3s ease;
    }
    .list-group-item:hover {
      background-color: var(--button-hover-bg);
    }
    .badge {
      font-size: 0.7em;
      padding: 6px 8px;
      border-radius: 50px;
      font-weight: 500;
      margin-left: 10px;
    }
    .badge-available {
      background-color: #28a745;
      color: #fff;
    }
    .badge-active {
      background-color: #007bff;
      color: #fff;
    }
    .badge-completed {
      background-color: #6c757d;
      color: #fff;
    }
    .badge-cancelled {
      background-color: #dc3545;
      color: #fff;
    }
    .back-btn {
      background-color: var(--button-bg);
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      transition: background-color 0.2s, color 0.3s ease;
      color: var(--text-color);
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }
    @media (min-width: 768px) {
      .back-btn {
        margin-bottom: 0;
      }
    }
    .back-btn i {
      margin-right: 8px;
    }
    .back-btn:hover {
      background-color: var(--button-hover-bg);
      color: var(--text-color);
      text-decoration: none;
    }
    .header-actions {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
      width: 100%;
    }
    @media (min-width: 768px) {
      .header-actions {
        width: auto;
      }
    }
    .refresh-button {
      margin-right: 16px;
      display: flex;
      align-items: center;
    }
    .icon-btn {
      background: none;
      border: none;
      color: #8a8aff;
      font-size: 1.2rem;
      cursor: pointer;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
    }
    .icon-btn:hover {
      background-color: rgba(138, 138, 255, 0.1);
    }
    .icon-btn:focus {
      outline: none;
    }
    .icon-btn:active {
      transform: scale(0.9);
    }
    .info-box {
      padding: 15px;
      background-color: var(--card-header-bg);
      border-radius: 8px;
      margin-bottom: 20px;
      transition: background-color 0.3s ease;
    }
    .col-label {
      color: var(--muted-text-color);
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .col-value {
      font-weight: 400;
    }
    .utc-time {
      opacity: 0;
      transition: opacity 0.3s;
    }
    .local-time {
      opacity: 1;
    }
    /* New Chat Threads Section Styling */
    .thread-list {
      margin-top: 15px;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 15px;
    }
    @media (min-width: 768px) {
      .thread-list {
        flex-wrap: nowrap;
      }
      .thread-list-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: calc(50% - 8px);
      }
    }
    .thread-card {
      margin-bottom: 0 !important;
    }
    .thread-item {
      display: flex;
      flex-direction: column;
      width: 100%;
      opacity: 1; /* Ensure visibility */
      padding: 15px;
      background-color: var(--card-bg);
      border-radius: 12px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      border: 2px solid transparent;
    }
    .thread-item:hover {
      background-color: var(--card-bg);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      border: 2px solid transparent; /* Remove orange border */
    }
    .thread-item.visible {
      opacity: 1;
    }
    .thread-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .thread-header .thread-actions {
      display: flex;
      gap: 6px;
      white-space: nowrap;
    }
    .thread-item a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
      display: inline-block;
      margin-bottom: 5px;
      transition: color 0.3s ease;
    }
    .thread-item a:hover {
      text-decoration: underline;
    }
    .thread-summary {
      font-size: 0.9em;
      color: var(--muted-text-color);
      margin-top: 5px;
      margin-left: 10px;
      line-height: 1.5;
      transition: color 0.3s ease;
    }
    .thread-summary p {
      margin-bottom: 0.5em;
    }
    .thread-summary ul,
    .thread-summary ol {
      margin-top: 0.5em;
      margin-bottom: 0.5em;
      padding-left: 1.5em;
    }
    .thread-summary li {
      margin-bottom: 0.3em;
    }
    .thread-summary a {
      color: var(--primary-color);
    }
    .thread-summary code {
      background-color: var(--card-header-bg);
      border-radius: 3px;
      padding: 2px 5px;
      font-family: monospace;
      transition: background-color 0.3s ease;
    }
    .thread-status {
      font-size: 0.8em;
      margin-top: 3px;
      margin-left: 10px;
    }
    /* Markdown content styling */
    .markdown-content {
      line-height: 1.6;
      overflow-wrap: break-word;
      word-wrap: break-word;
    }
    .markdown-content h1,
    .markdown-content h2,
    .markdown-content h3,
    .markdown-content h4,
    .markdown-content h5,
    .markdown-content h6 {
      margin-top: 1.5em;
      margin-bottom: 0.75em;
      color: var(--primary-color);
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .markdown-content h1 {
      font-size: 1.7em;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 0.3em;
      transition: border-color 0.3s ease;
    }
    .markdown-content h2 {
      font-size: 1.5em;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 0.3em;
      transition: border-color 0.3s ease;
    }
    .markdown-content h3 {
      font-size: 1.3em;
    }
    .markdown-content h4 {
      font-size: 1.1em;
    }
    .markdown-content p {
      margin-bottom: 1em;
    }
    .markdown-content ul, 
    .markdown-content ol {
      margin-bottom: 1em;
      padding-left: 2em;
    }
    .markdown-content li {
      margin-bottom: 0.5em;
    }
    /* Proper nested list styling */
    .markdown-content ul ul,
    .markdown-content ul ol,
    .markdown-content ol ul,
    .markdown-content ol ol {
      margin-top: 0.5em;
      margin-bottom: 0.5em;
    }
    .markdown-content li > ul,
    .markdown-content li > ol {
      margin-left: 1em;
    }
    .markdown-content blockquote {
      padding: 0.5em 1em;
      margin-left: 0;
      margin-right: 0;
      background-color: var(--card-header-bg);
      border-left: 4px solid var(--primary-color);
      margin-bottom: 1em;
      transition: background-color 0.3s ease, border-left-color 0.3s ease;
    }
    .markdown-content code {
      background-color: var(--card-header-bg);
      border-radius: 3px;
      padding: 2px 5px;
      font-family: monospace;
      transition: background-color 0.3s ease;
    }
    .markdown-content pre {
      background-color: var(--card-header-bg);
      border-radius: 5px;
      padding: 1em;
      overflow-x: auto;
      margin-bottom: 1em;
      transition: background-color 0.3s ease;
    }
    .markdown-content table {
      border-collapse: collapse;
      margin-bottom: 1em;
      width: 100%;
    }
    .markdown-content table th,
    .markdown-content table td {
      border: 1px solid var(--border-color);
      padding: 0.5em;
      transition: border-color 0.3s ease;
    }
    .markdown-content table th {
      background-color: var(--card-header-bg);
      text-align: left;
      transition: background-color 0.3s ease;
    }
    .markdown-content strong {
      font-weight: 600;
      color: var(--text-color);
      transition: color 0.3s ease;
    }
    .markdown-content em {
      font-style: italic;
    }
    /* Mobile-specific styles */
    @media (max-width: 767.98px) {
      .row:not(.mb-3) {
        margin-right: -5px;
        margin-left: -5px;
      }
      .row:not(.mb-3) > .col, 
      .row:not(.mb-3) > [class*="col-"] {
        padding-right: 5px;
        padding-left: 5px;
      }
      .btn {
        padding: 0.375rem 0.5rem;
      }
      .btn-orange {
        width: 100%;
        margin-bottom: 10px;
      }
      #report-btn, #generate-btn, #cancel-btn {
        width: 100%;
      }
      /* Hide theme toggle and edit prompts in mobile */
      .theme-toggle {
        display: none !important;
      }
      a.back-btn[href*="edit_prompts"] {
        display: none !important;
      }
      #share-export-btn {
        margin-right: 0 !important;
      }
    }
    /* End markdown styling */

    /* Limit Topics container height to match the Info card */
    #topics-container {
      max-height: 420px;
      min-height: 420px;
      overflow-y: auto;
    }
    /* Smaller height for export mode */
    html.export-mode #topics-container {
      max-height: 345px;
      min-height: 345px;
    }

    /* New Opinion Histograms styling */
    .histogram-container {
      background-color: #090118 !important;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .histogram-container:hover {
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .histogram-container img {
      max-width: 100%;
      border-radius: 6px;
      display: block;
      margin: 0 auto;
    }
    
    .histogram-bar {
      background: linear-gradient(180deg, #a9a9ff 0%, #8a8aff 100%);
      border-radius: 4px 4px 6px 6px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      box-shadow: 0 2px 6px rgba(138,138,255,0.2);
    }
    .histogram-bar:hover {
      box-shadow: 0 4px 8px rgba(138,138,255,0.4);
    }
    .histogram-axis-line {
      background: rgba(169,173,193,0.4);
      width: 2px;
    }
    .histogram-grid-line {
      background: rgba(169,173,193,0.13);
      height: 1px;
    }
    .histogram-container .axis-label {
      color: #a9adc1;
      font-size: 0.95rem;
      opacity: 0.85;
    }
    .histogram-container .x-label {
      color: #a9adc1;
      font-size: 1.1rem;
      font-weight: 500;
      margin-top: 0.35rem;
    }
    .histogram-container .card-body {
      padding: 1.25rem;
    }
    
    @media (max-width: 767.98px) {
      .col-md-6.col-lg-4.mb-4 {
        padding-left: 10px;
        padding-right: 10px;
      }
      .histogram-container {
        padding: 10px;
      }
    }

    /* Theme toggle switch styling */
    .theme-toggle {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    .theme-toggle-switch {
      position: relative;
      display: inline-block;
      width: 52px;
      height: 26px;
    }
    
    .theme-toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .theme-toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #2d2d43;
      transition: .4s;
      border-radius: 34px;
    }
    
    .theme-toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .theme-toggle-slider {
      background-color: #4a4a69;
    }
    
    input:checked + .theme-toggle-slider:before {
      transform: translateX(26px);
    }
    
    .theme-toggle-icon {
      color: var(--text-color);
      font-size: 16px;
    }

    /* Add social sharing buttons styling */
    .social-share-container {
      background-color: var(--card-header-bg);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
    }
    .social-share-title {
      font-size: 1.1rem;
      margin-bottom: 12px;
      color: var(--primary-color);
    }
    .social-share-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
    }
    .social-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      border-radius: 5px;
      color: white;
      font-weight: 500;
      text-decoration: none;
      transition: opacity 0.2s;
      font-size: 0.9rem;
    }
    .social-btn:hover {
      opacity: 0.85;
      text-decoration: none;
      color: white;
    }
    .social-btn i {
      margin-right: 6px;
      font-size: 0.9rem;
    }
    .btn-twitter {
      background-color: #1DA1F2;
    }
    .btn-facebook {
      background-color: #4267B2;
    }
    .btn-linkedin {
      background-color: #0077B5;
    }
    .btn-instagram {
      background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
    }
    @media (max-width: 576px) {
      .social-btn {
        padding: 4px 9px;
        font-size: 0.8rem;
      }
      .social-btn i {
        margin-right: 4px;
      }
    }

    .full-width-page {
      width: 100%;
      max-width: 1420px;
      margin: 0 auto;
      padding-left: 24px;
      padding-right: 24px;
    }
    @media (min-width: 576px) {
      .full-width-page {
        padding-left: 50px;
        padding-right: 50px;
      }
    }
    @media (min-width: 992px) {
      .full-width-page {
        padding-left: 64px;
        padding-right: 64px;
      }
    }

    /* Histogram card styling - more aggressive fixes */
    .histogram-card {
      background-color: #070113 !important;
      border: none; 
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      margin-bottom: 0;
      overflow: hidden;
    }

    .histogram-card:hover {
      box-shadow: 0 7px 15px rgba(0,0,0,0.25);
    }

    .histogram-card .card-body {
      padding: 8px 0 !important;
    }

    /* Target histogram SVG elements directly */
    .histogram-card svg {
      max-width: 100% !important;
      margin-left: -20px !important; /* Pull SVG to the left */
      width: calc(100% + 20px) !important; /* Compensate for negative margin */
    }

    /* More aggressive targeting for histogram titles */
    .histogram-card h3,
    .histogram-card .x-label,
    .histogram-card text.title,
    .histogram-card [class*="title"],
    .histogram-card text[font-size="14px"],
    .histogram-card text[font-weight="bold"] {
      text-transform: capitalize !important;
      font-size: 1.15rem !important;
      font-weight: 600 !important;
      color: var(--primary-color) !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      max-width: 95% !important;
      display: block !important;
    }

    /* Add text truncation to histogram title element specifically */
    .histogram-card .histogram-content svg text[y="30"],
    .histogram-card .histogram-content svg text.title {
      text-overflow: ellipsis !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      max-width: 250px !important;
    }

    /* Target mean text specifically */
    .histogram-card .mean-text,
    .histogram-card text[y="300"],
    .histogram-card text:last-of-type,
    .histogram-card text[font-size="12px"] {
      font-size: 0.9rem !important;
    }

    /* Add italicized m= to mean values with several selectors to catch them */
    .histogram-card .mean-text::before,
    .histogram-card text[y="300"]::before,
    .histogram-card text:last-of-type::before {
      content: "m = ";
      font-style: italic;
    }

    @media (max-width: 767.98px) {
      .histogram-card .card-body {
        padding: 8px 0 !important;
      }
    }

    /* Card with no hover effects */
    .no-hover {
      transition: background-color 0.3s ease !important;
    }

    .no-hover:hover {
      transform: none !important;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2) !important;
    }

    .thread-heading {
      color: var(--primary-color) !important;
      font-weight: 600;
    }

    /* Truncate long histogram HTML titles with ellipsis */
    .histogram-title,
    .histogram-card [style*="font-size:1.25rem"] {
      font-size: 1rem !important;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: block;
      max-width: 95%;
    }

    /* Hide histogram cards that only contain "No data" text */
    .histogram-card .histogram-content:only-child:has(> div.text-muted:only-child:contains("No data")),
    .card-body .histogram-content:only-child:has(> div.text-muted:only-child:contains("No data")),
    .histogram-content:has(> div.text-muted:only-child:contains("No data")) {
      display: none !important;
    }
    
    /* Also hide the parent cards when they only contain "No data" content */
    .histogram-card:has(.histogram-content:only-child > div.text-muted:only-child:contains("No data")),
    .card-body:has(.histogram-content:only-child > div.text-muted:only-child:contains("No data")) {
      display: none !important;
    }
    
    /* Hide the entire column if it only contains a "No data" card */
    .col-md-6:has(.card.histogram-card:only-child:has(.histogram-content > div.text-muted:only-child:contains("No data"))),
    .col-lg-4:has(.card.histogram-card:only-child:has(.histogram-content > div.text-muted:only-child:contains("No data"))) {
      display: none !important;
    }

    /* Bootstrap Histogram Styles */
    .histogram-container {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        width: 100%;
        height: 100%;
        position: relative;
    }
    
    .histogram-bar-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100%;
        padding: 0 2px;
    }
    
    .histogram-bar {
        width: 80%;
        transition: background-color 0.2s ease;
        border-radius: 3px 3px 0 0;
    }
    
    .histogram-bar:hover {
        background-color: #a5a5ff !important;
    }
    
    .histogram-label {
        margin-top: 5px;
        font-size: 11px;
        text-align: center;
    }
    
    .histogram-stats {
        margin-top: 10px;
        text-align: center;
    }
    
    /* Light mode overrides for histograms */
    html.light-mode .histogram-bar {
        background-color: #6a6ae6 !important;
    }
    
    html.light-mode .histogram-bar:hover {
        background-color: #8a8aff !important;
    }

    /* Histogram Checkbox Styles */
    .histogram-export-checkbox {
        position: absolute;
        bottom: 8px;
        right: 8px;
        z-index: 2;
        opacity: 0.6;
        transform: translateY(0);
        transition: opacity 0.2s ease, transform 0.2s ease;
    }
    
    .histogram-export-checkbox:hover {
        opacity: 1;
        transform: translateY(-2px);
    }
    
    .histogram-export-checkbox input[type="checkbox"] {
        margin-right: 4px;
        cursor: pointer;
        accent-color: var(--card-bg); /* Match card background for subtlety */
        opacity: 0.5;
        transition: opacity 0.2s;
    }
    
    .histogram-export-checkbox input[type="checkbox"]:hover,
    .histogram-export-checkbox input[type="checkbox"]:focus {
        opacity: 0.85;
    }
    
    .histogram-export-checkbox label {
        font-size: 0.75rem;
        cursor: pointer;
        margin: 0;
        color: var(--muted-text-color);
    }
    
    /* Make the card position relative so absolute positioned checkbox works */
    .card.thread-card .card-body {
        position: relative;
    }
    
    /* Highlight the checkbox when checked */
    .histogram-export-checkbox input[type="checkbox"]:checked + label {
        color: var(--primary-color);
        font-weight: 500;
    }

    .card.thread-card .card-header {
      background-color: #070113 !important;
    }
</style>
  <style>
    /* Global color fixes */
    body, html {
      min-height: 100vh;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      background-color: #000000; /* Default to black for dark mode */
    }
    
    /* Override for light mode */
    html.light-mode, 
    body.light-mode {
      background-color: white;
    }
    
    /* Ensure all content containers have proper width */
    .container, 
    .container-fluid, 
    .row {
      max-width: 100%;
    }
    
    /* Eliminate any unwanted margins on containers */
    .row {
      margin-left: 0;
      margin-right: 0;
    }
    
    .full-width-page {
      width: 100%;
      max-width: 100vw;
      overflow-x: hidden;
      box-sizing: border-box;
    }
    
    /* Apple-inspired font styling */
    body, button, input, select, textarea {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    h1, h2, h3, h4, h5, h6, .section-title, .generated-title {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-weight: 600;
      letter-spacing: +0.005em;
    }
    
    /* Custom styles for floating thread items */
    .card.no-hover:hover {
      transform: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .thread-list {
      margin-top: 15px;
      position: relative;
      display: block;
      clear: both;
      margin-bottom: 10px;
    }
    
    /* Masonry layout using columns */
    .masonry-grid {
      column-count: 2;
      column-gap: 1.5rem;
      width: 100%;
      margin-bottom: 8px;
    }
    
    @media (max-width: 767px) {
      .masonry-grid {
        column-count: 1;
      }
    }
    
    .masonry-item {
      break-inside: avoid;
      margin-bottom: 1.5rem;
      display: block;
    }
    
    /* Items in the masonry grid */
    .masonry-grid .masonry-item {
      break-inside: avoid;
      margin-bottom: 1.5rem;
      display: block;
    }
    
    /* Make sure thread cards in masonry layout have required styles */
    .masonry-grid .card.thread-card, .card.thread-card {
      background: none !important;
      border: 1px solid var(--thread-card-border, #313131) !important;
      border-radius: 12px !important;
      box-shadow: none !important;
      transition: border-color 0.2s;
    }
    
    /* Dark mode border override */
    body.dark-mode .masonry-grid .card.thread-card,
    body.dark-mode .card.thread-card {
      border-color: #23263a !important;
    }
    
    /* Override any position:relative that may be applied to .card-body elsewhere */
    .masonry-grid .card.thread-card .card-body {
      position: static;
    }
    
    .masonry-grid .card.thread-card:hover {
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }
    
    .masonry-item.hidden-thread {
      visibility: hidden !important;
      opacity: 0 !important;
      height: 0 !important;
      padding-top: 0 !important;
      padding-bottom: 0 !important;
      margin-top: 0 !important;
      margin-bottom: 0 !important;
      border-top-width: 0 !important;
      border-bottom-width: 0 !important;
      overflow: hidden !important;
      pointer-events: none !important;
    }
    
    .show-toggle-btn {
      display: block;
      margin: 30px auto 10px auto;
      min-width: 220px;
      font-weight: 500;
      transition: background 0.2s, color 0.2s;
    }
    .show-toggle-btn i {
      margin-left: 8px;
      transition: transform 0.2s;
    }
    .show-toggle-btn.expanded i {
      transform: rotate(180deg);
    }
    .collapsible-section {
      transition: max-height 0.4s cubic-bezier(0.4,0,0.2,1), opacity 0.4s;
      overflow: hidden;
      opacity: 1;
      max-height: 2000px; /* Large enough for most content */
    }
    .collapsible-section.collapsed {
      max-height: 0 !important;
      opacity: 0;
      pointer-events: none;
    }
    /* Premium title styling with maximum specificity to override any other styles */
    html body .generated-title,
    html[class] body .generated-title,
    body .generated-title.text-info,
    .full-width-page .generated-title,
    .generated-title {
      font-size: 2.5rem !important;
      line-height: 1.2 !important;
      margin-top: 2.5rem !important;
      margin-bottom: 1rem !important;
      font-weight: 600;
      color: white !important;
      text-shadow: 0 1px 3px rgba(0,0,0,0.15);
      letter-spacing: -0.0025em;
      display: block;
      position: relative;
      max-width: 94%;
      padding-bottom: 0.5rem;
      font-style: normal !important; /* Force normal style, no italics */
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif !important;
    }
    
    .generated-title::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 8rem;
      height: 3px;
      background: white;
      opacity: 0.7;
      border-radius: 2px;
    }
    
    /* Enhanced styling for better title visibility */
    .dark-mode .generated-title {
      text-shadow: 0 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(0,0,0,0.1);
    }
    
    /* Light mode title styling */
    .light-mode .generated-title {
      color: #4750c5 !important;
      text-shadow: none;
    }
    
    /* Adjust underline color in light mode */
    .light-mode .generated-title::after {
      background: #4750c5;
      opacity: 0.5;
    }
    
    /* Fix for pure black background in dark mode - only targeting page containers */
    body.dark-mode,
    html.dark-mode,
    .dark-mode .full-width-page {
      background-color: #000000 !important;
    }
    
    /* Explicitly exempt chart elements from background override */
    .dark-mode .progress,
    .dark-mode .progress-bar,
    .dark-mode .bg-success,
    .dark-mode .bg-info,
    .dark-mode .bg-warning,
    .dark-mode .bg-danger,
    .dark-mode .bg-secondary,
    .dark-mode .chart-container,
    .dark-mode [class*="histogram-"] {
      background-color: initial !important; /* Preserve original background colors */
    }
    
    /* Ensure the page fills the viewport */
    html, body {
      min-height: 100% !important;
      height: 100% !important;
    }
    
    .dark-mode.shared-page {
      background-color: #000000 !important;
    }
    
    /* For longer titles, ensure they wrap properly */
    @media (max-width: 992px) {
      .generated-title {
        font-size: 2.4rem !important;
        max-width: 100%;
      }
    }
    
    @media (max-width: 576px) {
      .generated-title {
        font-size: 2rem !important;
        margin-top: 2rem !important;
        margin-bottom: 1.2rem !important;
      }
    }
    .section-title {
      font-size: 1.7rem !important;
      font-weight: 600;
      margin-bottom: 1.2rem;
      letter-spacing: -0.01em;
    }
    /* Remove background from thread card headers */
    .card.thread-card .card-header {
      background: none !important;
      border-bottom: none !important;
    }
    .small {
      font-size: 1em !important;
    }
    /* Show More/Fewer Threads button custom color */
    .btn-thread-toggle {
      color: #3498DB !important;
      border-color: #3498DB !important;
      background: transparent !important;
    }
    .btn-thread-toggle:hover, .btn-thread-toggle:focus {
      background: #eaf6fb !important;
      color: #217dbb !important;
      border-color: #217dbb !important;
    }
    /* Prevent button flash in dark mode */
    .dark-mode .btn-thread-toggle,
    .dark-mode .btn-thread-toggle:active,
    .dark-mode .btn-thread-toggle:focus,
    .dark-mode .btn-thread-toggle:hover {
      background: transparent !important;
      border-color: #99aaff !important;
      color: #99aaff !important;
      box-shadow: none !important;
    }
    /* Ensure info text under section headings aligns with the heading text */
    .section-info-align {
      margin-left: 2.2rem; /* matches the icon+text indent of .section-title .title-text */
    }
    .hidden-histogram {
      display: none !important;
    }
    /* Add extra margin above Continue Reading button in Instructor Report */
    #report-content + .show-toggle-btn {
      margin-top: 2.5rem !important;
    }
    .collapsible-section + .show-toggle-btn {
      margin-top: 2.5rem !important;
    }

    /* ===== Stylish Share Banner ===== */
    .share-banner {
      margin: 0 -1.5rem 2rem -1.5rem;
      background: rgba(24, 26, 45, 0.95);
      backdrop-filter: blur(10px);
      padding: 1.5rem 0;
      position: relative;
      z-index: 10;
    }
    .light-mode .share-banner {
      background: rgba(46, 87, 170, 0.9);
    }
    .share-container {
      display: flex;
      justify-content: center;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    .share-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1.2rem;
    }
    .share-text {
      font-size: 1.1rem;
      color: white;
      opacity: 0.95;
      font-weight: 500;
      letter-spacing: -0.01em;
    }
    .share-buttons {
      display: flex;
      gap: 1.2rem;
      justify-content: center;
    }
    .share-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      color: white;
      text-decoration: none;
      transition: all 0.2s ease;
      background: rgba(255, 255, 255, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transform: translateY(-2px);
    }
    .share-button i {
      font-size: 1.1rem;
    }
    .share-button:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.3);
    }
    .share-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: all 0.1s ease;
    }
    .twitter-share {
      background: #000000; /* X logo has a black background */
    }
    .facebook-share {
      background: #4267B2;
    }
    .linkedin-share {
      background: #0077B5;
    }
    .instagram-share {
      background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
    }
    @media (max-width: 576px) {
      .share-text {
        font-size: 0.95rem;
      }
      .share-button {
        width: 2.6rem;
        height: 2.6rem;
      }
    }
    /* ===== End Share Header Styles ===== */

    /* ===== Additional Layout Adjustments for Share Header ===== */
    .shared-page {
      padding-top: 0 !important;
    }
    
    .shared-page .generated-title {
      margin-top: 3.2rem !important;
      animation: title-fade-in 1s ease-out;
    }
    
    /* Add spacing between share banner and content */
    .share-banner + .row {
      margin-top: 2.5rem;
    }
    
    /* Subtle animation for title appearance */
    @keyframes title-fade-in {
      0% {
        opacity: 0;
        transform: translateY(10px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    /* ===== End Layout Adjustments ===== */

    /* Add improved line spacing for content */
    .markdown-content {
      line-height: 1.6;
    }
    
    .markdown-content p, 
    .markdown-content li,
    .thread-summary p, 
    .thread-summary li {
      line-height: 1.65;
      margin-bottom: 0.9em;
    }
    
    .markdown-content h3, 
    .markdown-content h4 {
      margin-top: 1.7em;
      margin-bottom: 0.7em;
      line-height: 1.4;
    }
    
    /* Improve readability of thread cards */
    .thread-card .card-body,
    .thread-summary {
      line-height: 1.65;
    }
    
    /* Increase spacing between list items */
    .markdown-content ul, 
    .markdown-content ol,
    .thread-summary ul,
    .thread-summary ol {
      padding-left: 1.6em;
      margin-bottom: 1.2em;
    }

    /* Final fixes to ensure proper layout */
    @media (max-width: 767px) {
      body.dark-mode .px-md-3 {
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
      }
    }
  </style>
</head>
<body class="dark-mode" style="background-color: #000000 !important; margin: 0; padding: 0; max-width: 100vw; overflow-x: hidden;">
  <div class="full-width-page shared-page px-md-4 py-4 px-2" style="max-width: 100vw; overflow-x: hidden; background-color: #000000;">
    <div class="content-wrapper" style="max-width: 1400px; margin: 0 auto;">
      
      
      <div class="row mb-5">
        <div class="col-12 px-2 px-md-4">
          <h1 class="generated-title">
            Enhancing Boundaries: Athletic Doping, Idiopathic Short Stature Hormones, and Pet Cosmetic Surgery
          </h1>
        </div>
      </div>
      <div class="row mb-4">
        <div class="col-md-6 mb-4 mb-md-0">
          <div class="py-4 h-100">
            
<h5 class="section-title">
  <div class="title-text"><i class="fas fa-calendar-alt"></i> Timelines</div>
</h5>

  <div id="timelines-container" class="card-body">
    
      <div class="row mb-2">
        <div class="col-5 col-label">Completion deadline:</div>
        <div class="col-7 col-value">
          <span class="utc-time" data-utc-time="2025-04-02 22:00:00+00:00">2025-04-02 22:00:00+00:00</span>
          <span class="local-time"></span>
        </div>
      </div>
    
      <div class="row mb-2">
        <div class="col-5 col-label">Opinion deadline:</div>
        <div class="col-7 col-value">
          <span class="utc-time" data-utc-time="2025-03-24 22:00:00+00:00">2025-03-24 22:00:00+00:00</span>
          <span class="local-time"></span>
        </div>
      </div>
    
  </div>


<h5 class="section-title mt-4">
  <div class="title-text"><i class="fas fa-info-circle"></i> Info</div>
</h5>
<div id="info-container" class="card-body">
  <div class="row mb-3">
    <div class="col-5 col-label">Instructor:</div>
    <div class="col-7 col-value">[Redacted]</div>
  </div>
  <div class="row mb-3">
    <div class="col-5 col-label">Min. chat time:</div>
    <div class="col-7 col-value">
      
        25 minutes
      
    </div>
  </div>
  <div class="row mb-3">
    <div class="col-5 col-label">Created on:</div>
    <div class="col-7 col-value">
      <span class="utc-time" data-utc-time="2025-03-10 15:33:34.064205+00:00">2025-03-10 15:33:34.064205+00:00</span>
      <span class="local-time"></span>
    </div>
  </div>
  
  
  <div class="row mb-3">
    <div class="col-5 col-label">Chat threads:</div>
    <div class="col-7 col-value">8</div>
  </div>
</div> 
          </div>
        </div>
        <div class="col-md-6">
          <div class="py-4 h-100">
            <!-- Topics Section Partial -->


<h5 class="section-title">
  <div class="title-text"><i class="fas fa-bookmark"></i> Topics</div>
</h5>

  <div id="topics-container" class="card-body">
    
      <div class="mb-3">
        <div class="text-info mb-1 font-weight-bold">Cosmetic Surgery on pets</div>
        <div>Cosmetic surgery on companion animals/pets is morally permissible, e.g., ear cropping and tail docking (Doberman Pinschers, Boxers, Great Danes), testicular prosthesis for neutered dogs, cosmetic eyes (for animals that have a damaged eye removed). Assume that there is no established medical benefit to having purely cosmetic procedures.</div>
      </div>
      <hr class="my-3" style="border-color: #2d2d43;">
    
      <div class="mb-3">
        <div class="text-info mb-1 font-weight-bold">Growth Hormones for Shortness</div>
        <div>Given that being short is a social disadvantage, is it morally permissible for parents to gain access to recombinant human growth hormone (rHGH), a drug administered by injection, and administer it to their children for idiopathic short stature (ISS), irrespective of their consent? *Note that the only children who would qualify for the drug would be the 1.2% of children who are among the shortest of the short (2.25 or more standard deviations below the average). Note also that the drug is not effective in adults with ISS.</div>
      </div>
      <hr class="my-3" style="border-color: #2d2d43;">
    
      <div class="mb-3">
        <div class="text-info mb-1 font-weight-bold">Sports Supplementation</div>
        <div>Supplementation aimed at giving athletes a competitive advantage should be allowed. Note that supplementation may take the form of so-called &#34;blood doping,&#34; use of anabolic steroids, use of human growth hormone (HGH), as well as external supplementation, such as using custom-made, performance enhancing equipment, such as an ultra-light bicycle frame for racers or high-accuracy scopes for competitive shooters.</div>
      </div>
      
    
  </div>
 
          </div>
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-12">
          <h5 class="section-title">
            <div class="title-text"><i class="fas fa-chart-bar mr-1"></i> Opinion Distribution</div>
            
          </h5>
        </div>
        <div class="pt-0 pb-2">
          <div class="text-muted small mb-0 section-info-align">
            <i class="fas fa-info-circle mr-1"></i>Opinion scale: 1 = Strongly Disagree, 7 = Strongly Agree. Mean and 95% CI shown below each chart.
          </div>
          <!-- DEBUG: Show if histogram_html or topic_labels are missing -->
          
          
        </div>
      </div>

      <!-- Separate row for histogram charts floating on background -->
      <div class="row mb-4">
        <div class="col-12">
          
            <div class="row" id="opinion-histogram-row">
              
              
                
                  <div class="col-md-6 col-lg-4 mb-4 opinion-histogram-card" data-index="0">
                    <!-- Individual Opinion Histogram Card -->
<div class="card histogram-card">
  <div class="card-body p-0 px-1 position-relative">
    <div class="histogram-content">
      
        <div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:25px;">
            <div style="font-size:1.25rem; font-weight:500; margin-bottom:15px;">Sports Supplementation</div>
            <div style="position:relative; height:175px; width:100%; margin-bottom:10px;">
                <!-- Y-axis -->
                <div style="position:absolute; top:0; left:0; bottom:25px; width:40px; display:flex; flex-direction:column; justify-content:space-between;">
        
                    <div style="position:absolute; top:0.0%; right:10px; color:#a9adc1; font-size:14px;">15</div>
            
                    <div style="position:absolute; top:33.33333333333333%; right:10px; color:#a9adc1; font-size:14px;">10</div>
            
                    <div style="position:absolute; top:66.66666666666666%; right:10px; color:#a9adc1; font-size:14px;">5</div>
            
                    <div style="position:absolute; top:100.0%; right:10px; color:#a9adc1; font-size:14px;">0</div>
            
                    <div style="position:absolute; top:0; bottom:0; right:0; width:1px; background:rgba(169,173,193,0.3);"></div>
                </div>
                
                <!-- Horizontal grid lines -->
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px;">
        
                    <div style="position:absolute; top:0.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:33.33333333333333%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:66.66666666666666%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:100.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                </div>
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px; display:flex; align-items:flex-end; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:86.66666666666667%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:73.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:80.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:26.666666666666668%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:26.666666666666668%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:13.333333333333334%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:13.333333333333334%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                </div>
                <div style="position:absolute; left:40px; right:0; bottom:0; height:25px; display:flex; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-3</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">0</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">3</div>
            
                </div>
            </div>
        
            <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:6px; letter-spacing:0.01em;">
                mean = -1.23 <span style="opacity:0.7;">(95% confidence interval: -1.71–-0.75)</span>
            </div>
            
        </div>
        
    </div>
  </div>
</div> 
                  </div>
                  
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4 opinion-histogram-card" data-index="0">
                    <!-- Individual Opinion Histogram Card -->
<div class="card histogram-card">
  <div class="card-body p-0 px-1 position-relative">
    <div class="histogram-content">
      
        <div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:25px;">
            <div style="font-size:1.25rem; font-weight:500; margin-bottom:15px;">Growth Hormones for Shortness</div>
            <div style="position:relative; height:175px; width:100%; margin-bottom:10px;">
                <!-- Y-axis -->
                <div style="position:absolute; top:0; left:0; bottom:25px; width:40px; display:flex; flex-direction:column; justify-content:space-between;">
        
                    <div style="position:absolute; top:0.0%; right:10px; color:#a9adc1; font-size:14px;">15</div>
            
                    <div style="position:absolute; top:33.33333333333333%; right:10px; color:#a9adc1; font-size:14px;">10</div>
            
                    <div style="position:absolute; top:66.66666666666666%; right:10px; color:#a9adc1; font-size:14px;">5</div>
            
                    <div style="position:absolute; top:100.0%; right:10px; color:#a9adc1; font-size:14px;">0</div>
            
                    <div style="position:absolute; top:0; bottom:0; right:0; width:1px; background:rgba(169,173,193,0.3);"></div>
                </div>
                
                <!-- Horizontal grid lines -->
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px;">
        
                    <div style="position:absolute; top:0.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:33.33333333333333%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:66.66666666666666%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:100.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                </div>
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px; display:flex; align-items:flex-end; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:66.66666666666666%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:80.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:40.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:53.333333333333336%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:40.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:40.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:0.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                </div>
                <div style="position:absolute; left:40px; right:0; bottom:0; height:25px; display:flex; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-3</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">0</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">3</div>
            
                </div>
            </div>
        
            <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:6px; letter-spacing:0.01em;">
                mean = -0.88 <span style="opacity:0.7;">(95% confidence interval: -1.37–-0.38)</span>
            </div>
            
        </div>
        
    </div>
  </div>
</div> 
                  </div>
                  
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4 opinion-histogram-card" data-index="0">
                    <!-- Individual Opinion Histogram Card -->
<div class="card histogram-card">
  <div class="card-body p-0 px-1 position-relative">
    <div class="histogram-content">
      
        <div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:25px;">
            <div style="font-size:1.25rem; font-weight:500; margin-bottom:15px;">Cosmetic Surgery on Pets</div>
            <div style="position:relative; height:175px; width:100%; margin-bottom:10px;">
                <!-- Y-axis -->
                <div style="position:absolute; top:0; left:0; bottom:25px; width:40px; display:flex; flex-direction:column; justify-content:space-between;">
        
                    <div style="position:absolute; top:0.0%; right:10px; color:#a9adc1; font-size:14px;">30</div>
            
                    <div style="position:absolute; top:33.33333333333333%; right:10px; color:#a9adc1; font-size:14px;">20</div>
            
                    <div style="position:absolute; top:66.66666666666666%; right:10px; color:#a9adc1; font-size:14px;">10</div>
            
                    <div style="position:absolute; top:100.0%; right:10px; color:#a9adc1; font-size:14px;">0</div>
            
                    <div style="position:absolute; top:0; bottom:0; right:0; width:1px; background:rgba(169,173,193,0.3);"></div>
                </div>
                
                <!-- Horizontal grid lines -->
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px;">
        
                    <div style="position:absolute; top:0.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:33.33333333333333%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:66.66666666666666%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:100.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                </div>
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px; display:flex; align-items:flex-end; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:73.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:33.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:33.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:6.666666666666667%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:6.666666666666667%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:6.666666666666667%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:0.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                </div>
                <div style="position:absolute; left:40px; right:0; bottom:0; height:25px; display:flex; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-3</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">0</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">3</div>
            
                </div>
            </div>
        
            <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:6px; letter-spacing:0.01em;">
                mean = -1.88 <span style="opacity:0.7;">(95% confidence interval: -2.28–-1.47)</span>
            </div>
            
        </div>
        
    </div>
  </div>
</div> 
                  </div>
                  
                
              
            </div>
            <div class="text-center">
              <button id="show-more-histograms-btn" class="btn btn-thread-toggle show-toggle-btn" style="display:none;">Show More Figures</button>
              <button id="show-fewer-histograms-btn" class="btn btn-thread-toggle show-toggle-btn" style="display:none;">Show Fewer Figures</button>
            </div>
          
        </div>
      </div>
      <div class="row mb-4">
        <div class="col-12">
          <div class="py-4">
            <!-- Report Section Partial -->

<h5 class="section-title">
  <div class="title-text">
    <i class="fas fa-file-alt mr-1"></i> Instructor Report
  </div>
  
</h5>

<!-- DEBUG: Show if report or has_saved_summaries are missing -->



<div class="card-body" id="report-section">
  
    
    <div id="report-content" class="markdown-content">
      <p>The assignment asked students to analyze ethical questions around bodily modifications and enhancements in three contexts: cosmetic surgeries for pets, performance supplements in sports, and growth hormone therapy for children with idiopathic short stature.  They weighed harms versus benefits, consent and autonomy, fairness and naturalness, and the influence of societal biases.  Across all threads, Guide prompted deeper thinking by challenging assumptions, requesting evidence, and guiding students toward more structured reasoning.</p>
<h3>Themes</h3>
<ul>
<li><strong>Ethical trade-offs between harm and benefit were central across all topics.</strong> For example, one student noted “this is unnecessary pain for no real benefit,” capturing strong opposition to purely cosmetic procedures for pets, which parallels concerns about athlete health risks and children’s discomfort versus long-term social gains.</li>
<li><strong>Questions of consent and autonomy repeatedly emerged.</strong> Debates over animals’ inability to consent, children’s developmental capacity, and the scope of parental authority highlighted tensions between protecting bodily integrity and pursuing perceived benefits.</li>
<li><strong>Fairness and naturalness framed discussions on enhancements.</strong> Whether in pet shows, sports leagues, or society’s height biases, students grappled with what constitutes a permissible intervention and when technology or training crosses an ethical line.</li>
</ul>
<h3>Guide’s role</h3>
<ul>
<li><strong>Guide consistently used probing questions to expose assumptions and demand justification.</strong> It pressed students to clarify what “purely cosmetic” means, compare interventions across different domains, and cite evidence on pain perception, fairness criteria, and social harms.</li>
<li><strong>Guide maintained focus and provided structured support without dominating conclusions.</strong> After refocusing digressions, Guide offered a concise pro–con framework that helped students organize their arguments before stepping back and letting them synthesize their views.</li>
</ul>
<h3>Common ground</h3>
<ul>
<li><strong>Most students agreed that purely cosmetic procedures lack sufficient benefit to justify animal or child harm.</strong> Participants in both pet surgery and pediatric threads conceded that aesthetic alterations without clear health purposes undermine welfare and autonomy.</li>
<li><strong>There was consensus on requiring demonstrable long-term benefits and manageable side effects for any medical or performance intervention.</strong> Whether discussing rHGH or athletic supplements, students stressed the need for robust evidence and risk mitigation before adoption.</li>
<li><strong>Participants recognized that sports enhancements and resource advantages operate on a continuum.</strong> This led some groups to explore league separation or universal allowance of supplements as potential ways to level the playing field.</li>
</ul>
<h3>Persistent disagreements</h3>
<ul>
<li><strong>Students remained split on performance-oriented surgeries for working animals.</strong> Some argued that hunting or service dogs might genuinely benefit from targeted interventions, while others held that any cosmetic change without direct health necessity is unjustifiable.</li>
<li><strong>Debates over parental authority versus child autonomy in growth hormone therapy persisted.</strong> Opinions diverged on whether parents should override a young child’s refusal because of potential future discrimination or respect the child’s immediate wish.</li>
<li><strong>Fairness in sports enhancements fueled tension around drawing a clear line between acceptable supplements and banned substances.</strong> Disagreements centered on whether health-risk criteria or notions of naturalness can consistently differentiate permissible aids from illicit performance-enhancing drugs.</li>
</ul>
    </div>
    <!-- Hidden raw markdown for test compatibility -->
    <div style="display:none;" id="report-raw-markdown">The assignment asked students to analyze ethical questions around bodily modifications and enhancements in three contexts: cosmetic surgeries for pets, performance supplements in sports, and growth hormone therapy for children with idiopathic short stature.  They weighed harms versus benefits, consent and autonomy, fairness and naturalness, and the influence of societal biases.  Across all threads, Guide prompted deeper thinking by challenging assumptions, requesting evidence, and guiding students toward more structured reasoning.

### Themes
- **Ethical trade-offs between harm and benefit were central across all topics.** For example, one student noted “this is unnecessary pain for no real benefit,” capturing strong opposition to purely cosmetic procedures for pets, which parallels concerns about athlete health risks and children’s discomfort versus long-term social gains.
- **Questions of consent and autonomy repeatedly emerged.** Debates over animals’ inability to consent, children’s developmental capacity, and the scope of parental authority highlighted tensions between protecting bodily integrity and pursuing perceived benefits.
- **Fairness and naturalness framed discussions on enhancements.** Whether in pet shows, sports leagues, or society’s height biases, students grappled with what constitutes a permissible intervention and when technology or training crosses an ethical line.

### Guide’s role
- **Guide consistently used probing questions to expose assumptions and demand justification.** It pressed students to clarify what “purely cosmetic” means, compare interventions across different domains, and cite evidence on pain perception, fairness criteria, and social harms.
- **Guide maintained focus and provided structured support without dominating conclusions.** After refocusing digressions, Guide offered a concise pro–con framework that helped students organize their arguments before stepping back and letting them synthesize their views.

### Common ground
- **Most students agreed that purely cosmetic procedures lack sufficient benefit to justify animal or child harm.** Participants in both pet surgery and pediatric threads conceded that aesthetic alterations without clear health purposes undermine welfare and autonomy.
- **There was consensus on requiring demonstrable long-term benefits and manageable side effects for any medical or performance intervention.** Whether discussing rHGH or athletic supplements, students stressed the need for robust evidence and risk mitigation before adoption.
- **Participants recognized that sports enhancements and resource advantages operate on a continuum.** This led some groups to explore league separation or universal allowance of supplements as potential ways to level the playing field.

### Persistent disagreements
- **Students remained split on performance-oriented surgeries for working animals.** Some argued that hunting or service dogs might genuinely benefit from targeted interventions, while others held that any cosmetic change without direct health necessity is unjustifiable.
- **Debates over parental authority versus child autonomy in growth hormone therapy persisted.** Opinions diverged on whether parents should override a young child’s refusal because of potential future discrimination or respect the child’s immediate wish.
- **Fairness in sports enhancements fueled tension around drawing a clear line between acceptable supplements and banned substances.** Disagreements centered on whether health-risk criteria or notions of naturalness can consistently differentiate permissible aids from illicit performance-enhancing drugs.</div>
    <!-- RAW REPORT CONTENT FOR TESTING: The assignment asked -->
    <span style="display:none;" id="report-prefix">The assignment asked</span>
    <div class="text-muted mt-2 d-flex justify-content-end align-items-center">
      <span class="text-right" style="flex:1; text-align:right;">Generated on: 
        <script>
          document.write(new Date("2025-05-06T15:00:34.462087").toLocaleDateString('en-US', {
            month: 'short', 
            day: 'numeric', 
            year: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
          }));
        </script>
        <noscript>2025-05-06T15:00:34.462087</noscript>
      </span>
      
    </div>
    <div id="report-editor-container" style="display: none;">
      <div class="alert alert-info">
        <i class="fas fa-info-circle mr-2"></i> Edit the report in markdown format.
      </div>
      <textarea id="report-markdown-editor" class="form-control">The assignment asked students to analyze ethical questions around bodily modifications and enhancements in three contexts: cosmetic surgeries for pets, performance supplements in sports, and growth hormone therapy for children with idiopathic short stature.  They weighed harms versus benefits, consent and autonomy, fairness and naturalness, and the influence of societal biases.  Across all threads, Guide prompted deeper thinking by challenging assumptions, requesting evidence, and guiding students toward more structured reasoning.

### Themes
- **Ethical trade-offs between harm and benefit were central across all topics.** For example, one student noted “this is unnecessary pain for no real benefit,” capturing strong opposition to purely cosmetic procedures for pets, which parallels concerns about athlete health risks and children’s discomfort versus long-term social gains.
- **Questions of consent and autonomy repeatedly emerged.** Debates over animals’ inability to consent, children’s developmental capacity, and the scope of parental authority highlighted tensions between protecting bodily integrity and pursuing perceived benefits.
- **Fairness and naturalness framed discussions on enhancements.** Whether in pet shows, sports leagues, or society’s height biases, students grappled with what constitutes a permissible intervention and when technology or training crosses an ethical line.

### Guide’s role
- **Guide consistently used probing questions to expose assumptions and demand justification.** It pressed students to clarify what “purely cosmetic” means, compare interventions across different domains, and cite evidence on pain perception, fairness criteria, and social harms.
- **Guide maintained focus and provided structured support without dominating conclusions.** After refocusing digressions, Guide offered a concise pro–con framework that helped students organize their arguments before stepping back and letting them synthesize their views.

### Common ground
- **Most students agreed that purely cosmetic procedures lack sufficient benefit to justify animal or child harm.** Participants in both pet surgery and pediatric threads conceded that aesthetic alterations without clear health purposes undermine welfare and autonomy.
- **There was consensus on requiring demonstrable long-term benefits and manageable side effects for any medical or performance intervention.** Whether discussing rHGH or athletic supplements, students stressed the need for robust evidence and risk mitigation before adoption.
- **Participants recognized that sports enhancements and resource advantages operate on a continuum.** This led some groups to explore league separation or universal allowance of supplements as potential ways to level the playing field.

### Persistent disagreements
- **Students remained split on performance-oriented surgeries for working animals.** Some argued that hunting or service dogs might genuinely benefit from targeted interventions, while others held that any cosmetic change without direct health necessity is unjustifiable.
- **Debates over parental authority versus child autonomy in growth hormone therapy persisted.** Opinions diverged on whether parents should override a young child’s refusal because of potential future discrimination or respect the child’s immediate wish.
- **Fairness in sports enhancements fueled tension around drawing a clear line between acceptable supplements and banned substances.** Disagreements centered on whether health-risk criteria or notions of naturalness can consistently differentiate permissible aids from illicit performance-enhancing drugs.</textarea>
      <div class="mt-3">
        <button id="save-report-btn" class="btn btn-primary">
          <i class="fas fa-save mr-1"></i> Save Changes
        </button>
        <button id="cancel-report-edit-btn" class="btn btn-secondary ml-2">
          <i class="fas fa-times mr-1"></i> Cancel
        </button>
        <span id="editor-spinner" class="spinner-border spinner-border-sm ml-2" role="status" style="display: none;"></span>
      </div>
      <div id="editor-status-message" class="status-message mt-3" style="display: none;"></div>
    </div>
  
</div> 
          </div>
        </div>
      </div>

      <div class="row mb-2">
        <div class="col-12">
          <h5 class="section-title">
            <div class="title-text"><i class="fas fa-comments mr-1"></i> Chat Threads</div>
            
          </h5>
        </div>
        <div class="pt-0 pb-2">
          <!-- DEBUG: Show if threads is missing or empty -->
          
          <div class="text-muted small mb-0 section-info-align">
            <i class="fas fa-info-circle mr-1"></i> Only threads with 10 or more messages are shown and processed for summaries. Student names are redacted for privacy.
          </div>
        </div>
      </div>

      <!-- Separate row for thread items floating on background -->
      <div class="row mb-5">
        <div class="col-12">
          <div class="thread-list" id="thread-list">
            
              <div class="masonry-grid">
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-c3r1zgvudhmudxdmlmvkdq==9bb14546fe::student-c3r1zgvudhmudxdmlmvkdq==d4a33fd808::5ac5c860c5::d313ce12b7">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Growth Hormones for Shortness
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-c3r1zgvudhmudxdmlmvkdq==9bb14546fe::student-c3r1zgvudhmudxdmlmvkdq==d4a33fd808::5ac5c860c5::d313ce12b7">
                                  <ul>
<li><strong>Students debated whether parents should administer rHGH to very short children without consent, weighing social disadvantages like bullying and isolation against bodily autonomy.</strong> Student 2 argued that severe social harms justify medical intervention in the child's best interest, while Student 1 cautioned that non‐consensual, cosmetic procedures risk reinforcing harmful beauty standards and overlooking self‐confidence building.  </li>
<li><strong>The conversation evolved to tackle long‐term risks, side effects, and fairness in access.</strong> Student 1 raised concerns about withdrawal symptoms, permanent body alteration, insurance coverage, and a potential superiority complex among treated children, prompting both to concede that psychological support and self‐esteem work should precede irreversible choices.  </li>
<li><strong>Guide steered the group toward deeper ethical and policy questions, persistently challenging them to define when social disadvantages cross into medical necessity and to consider limits on parental authority.</strong> Its questions about socioeconomic equity, insurance coverage, and the threshold for overriding a child's autonomy pushed students to refine their positions and acknowledge complexities they had initially overlooked.  </li>
</ul>
<blockquote>
<p><strong>Student 1, you've raised an important socioeconomic dimension to this debate. How would you respond to someone who argues that if the treatment offers genuine benefits, we should focus on expanding access rather than restricting it altogether?</strong></p>
<p><strong>Student 2, you've emphasized parental rights to make decisions for their child's social future. This raises a question about limits: At what point should a child's autonomy begin to override parental decision‐making, especially for interventions that are primarily addressing social rather than medical concerns?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-c3r1zgvudhmudxdmlmvkdq==9bb14546fe::student-c3r1zgvudhmudxdmlmvkdq==d4a33fd808::5ac5c860c5::d313ce12b7" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-c3r1zgvudhmudxdmlmvkdq==9bb14546fe::student-c3r1zgvudhmudxdmlmvkdq==d4a33fd808::5ac5c860c5::d313ce12b7" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-c3r1zgvudhmudxdmlmvkdq==9bb14546fe::student-c3r1zgvudhmudxdmlmvkdq==d4a33fd808::5ac5c860c5::d313ce12b7" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-c3r1zgvudhmudxdmlmvkdq==9bb14546fe::student-c3r1zgvudhmudxdmlmvkdq==d4a33fd808::5ac5c860c5::d313ce12b7" class="form-control summary-markdown-editor">- **Students debated whether parents should administer rHGH to very short children without consent, weighing social disadvantages like bullying and isolation against bodily autonomy.** Student 2 argued that severe social harms justify medical intervention in the child&#39;s best interest, while Student 1 cautioned that non‐consensual, cosmetic procedures risk reinforcing harmful beauty standards and overlooking self‐confidence building.  
- **The conversation evolved to tackle long‐term risks, side effects, and fairness in access.** Student 1 raised concerns about withdrawal symptoms, permanent body alteration, insurance coverage, and a potential superiority complex among treated children, prompting both to concede that psychological support and self‐esteem work should precede irreversible choices.  
- **Guide steered the group toward deeper ethical and policy questions, persistently challenging them to define when social disadvantages cross into medical necessity and to consider limits on parental authority.** Its questions about socioeconomic equity, insurance coverage, and the threshold for overriding a child&#39;s autonomy pushed students to refine their positions and acknowledge complexities they had initially overlooked.  


&gt; **Student 1, you&#39;ve raised an important socioeconomic dimension to this debate. How would you respond to someone who argues that if the treatment offers genuine benefits, we should focus on expanding access rather than restricting it altogether?**
&gt;
&gt; **Student 2, you&#39;ve emphasized parental rights to make decisions for their child&#39;s social future. This raises a question about limits: At what point should a child&#39;s autonomy begin to override parental decision‐making, especially for interventions that are primarily addressing social rather than medical concerns?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==9bb14546fe::student-c3r1zgvudhmudxdmlmvkdq==d4a33fd808::5ac5c860c5::d313ce12b7">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==9bb14546fe::student-c3r1zgvudhmudxdmlmvkdq==d4a33fd808::5ac5c860c5::d313ce12b7">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-c3r1zgvudhmudxdmlmvkdq==9bb14546fe::student-c3r1zgvudhmudxdmlmvkdq==d4a33fd808::5ac5c860c5::d313ce12b7" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-c3r1zgvudhmudxdmlmvkdq==9bb14546fe::student-c3r1zgvudhmudxdmlmvkdq==d4a33fd808::5ac5c860c5::d313ce12b7" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-c3r1zgvudhmudxdmlmvkdq==38762c3c08::student-c3r1zgvudhmudxdmlmvkdq==6db62e3c08::c8f1c90f1c::d313ce12b7">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Cosmetic Surgery on Pets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-c3r1zgvudhmudxdmlmvkdq==38762c3c08::student-c3r1zgvudhmudxdmlmvkdq==6db62e3c08::c8f1c90f1c::d313ce12b7">
                                  <ul>
<li><strong>Students rigorously examined the ethics of cosmetic pet surgery by contrasting risks of pain and social impairment with potential performance enhancements.</strong> Student 1 consistently highlighted the absence of health benefits, possible suffering, and social communication disruption, while Student 2 shifted from a flawed health argument to a more nuanced performance justification for hunting dogs but rejected purely aesthetic procedures.  </li>
<li><strong>Guide actively steered the debate through pointed questions that exposed contradictions and demanded principled reasoning.</strong> It clarified the premise of “purely cosmetic,” asked for evidence on pain perception, challenged naturalness equating to morality, and pressed both participants to specify who truly benefits from such surgeries.  </li>
</ul>
<blockquote>
<p><strong>Student 1, you've mentioned 'benefit of the future' several times. But what specific benefits justify purely cosmetic procedures? And who receives these benefits - the animal or the human? Student 2, if we reject the 'natural = moral' argument, what principle should determine when altering an animal's body is acceptable?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-c3r1zgvudhmudxdmlmvkdq==38762c3c08::student-c3r1zgvudhmudxdmlmvkdq==6db62e3c08::c8f1c90f1c::d313ce12b7" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-c3r1zgvudhmudxdmlmvkdq==38762c3c08::student-c3r1zgvudhmudxdmlmvkdq==6db62e3c08::c8f1c90f1c::d313ce12b7" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-c3r1zgvudhmudxdmlmvkdq==38762c3c08::student-c3r1zgvudhmudxdmlmvkdq==6db62e3c08::c8f1c90f1c::d313ce12b7" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-c3r1zgvudhmudxdmlmvkdq==38762c3c08::student-c3r1zgvudhmudxdmlmvkdq==6db62e3c08::c8f1c90f1c::d313ce12b7" class="form-control summary-markdown-editor">- **Students rigorously examined the ethics of cosmetic pet surgery by contrasting risks of pain and social impairment with potential performance enhancements.** Student 1 consistently highlighted the absence of health benefits, possible suffering, and social communication disruption, while Student 2 shifted from a flawed health argument to a more nuanced performance justification for hunting dogs but rejected purely aesthetic procedures.  
- **Guide actively steered the debate through pointed questions that exposed contradictions and demanded principled reasoning.** It clarified the premise of “purely cosmetic,” asked for evidence on pain perception, challenged naturalness equating to morality, and pressed both participants to specify who truly benefits from such surgeries.  



&gt; **Student 1, you&#39;ve mentioned &#39;benefit of the future&#39; several times. But what specific benefits justify purely cosmetic procedures? And who receives these benefits - the animal or the human? Student 2, if we reject the &#39;natural = moral&#39; argument, what principle should determine when altering an animal&#39;s body is acceptable?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==38762c3c08::student-c3r1zgvudhmudxdmlmvkdq==6db62e3c08::c8f1c90f1c::d313ce12b7">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==38762c3c08::student-c3r1zgvudhmudxdmlmvkdq==6db62e3c08::c8f1c90f1c::d313ce12b7">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-c3r1zgvudhmudxdmlmvkdq==38762c3c08::student-c3r1zgvudhmudxdmlmvkdq==6db62e3c08::c8f1c90f1c::d313ce12b7" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-c3r1zgvudhmudxdmlmvkdq==38762c3c08::student-c3r1zgvudhmudxdmlmvkdq==6db62e3c08::c8f1c90f1c::d313ce12b7" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-c3r1zgvudhmudxdmlmvkdq==31ece5b008::student-c3r1zgvudhmudxdmlmvkdq==d757c6e8fd::41676e6aed::d313ce12b7">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Sports Supplementation
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-c3r1zgvudhmudxdmlmvkdq==31ece5b008::student-c3r1zgvudhmudxdmlmvkdq==d757c6e8fd::41676e6aed::d313ce12b7">
                                  <ul>
<li>
<p><strong>Students debated the fairness and limits of performance-enhancing supplementation.</strong> Student 1 supported allowances for supplementation as a means to level natural differences, while Student 2 questioned whether biological enhancements differ meaningfully from high-tech equipment and whether such interventions truly promote fairness in sports.</p>
</li>
<li>
<p><strong>Students explored potential solutions and challenges in regulating supplements.</strong> They discussed ideas like separating competitions into different leagues, weighing concerns about health risks and long-term effects against the reality that athletes already benefit from unequal resources like advanced training facilities and nutrition.</p>
</li>
<li>
<p><strong>Guide repeatedly challenged the assumptions about fairness and safety in supplementation.</strong> Guide pushed students to rethink the boundaries between natural ability and technological enhancement by posing deep, probing questions that forced a critical look at current practices and potential reforms.  </p>
</li>
</ul>
<blockquote>
<p><strong>How is that fundamentally different from EPO, which directly increases red blood cells? Both high-tech training facilities and performance-enhancing drugs are artificial interventions that aim to boost athletic performance, challenging our notions of natural ability. If fairness is your concern, wouldn't allowing all supplements create a more level playing field than our current system? What criteria truly separate acceptable enhancements from those that cross the line?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-c3r1zgvudhmudxdmlmvkdq==31ece5b008::student-c3r1zgvudhmudxdmlmvkdq==d757c6e8fd::41676e6aed::d313ce12b7" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-c3r1zgvudhmudxdmlmvkdq==31ece5b008::student-c3r1zgvudhmudxdmlmvkdq==d757c6e8fd::41676e6aed::d313ce12b7" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-c3r1zgvudhmudxdmlmvkdq==31ece5b008::student-c3r1zgvudhmudxdmlmvkdq==d757c6e8fd::41676e6aed::d313ce12b7" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-c3r1zgvudhmudxdmlmvkdq==31ece5b008::student-c3r1zgvudhmudxdmlmvkdq==d757c6e8fd::41676e6aed::d313ce12b7" class="form-control summary-markdown-editor">- **Students debated the fairness and limits of performance-enhancing supplementation.** Student 1 supported allowances for supplementation as a means to level natural differences, while Student 2 questioned whether biological enhancements differ meaningfully from high-tech equipment and whether such interventions truly promote fairness in sports.

- **Students explored potential solutions and challenges in regulating supplements.** They discussed ideas like separating competitions into different leagues, weighing concerns about health risks and long-term effects against the reality that athletes already benefit from unequal resources like advanced training facilities and nutrition.

- **Guide repeatedly challenged the assumptions about fairness and safety in supplementation.** Guide pushed students to rethink the boundaries between natural ability and technological enhancement by posing deep, probing questions that forced a critical look at current practices and potential reforms.  

  
&gt; **How is that fundamentally different from EPO, which directly increases red blood cells? Both high-tech training facilities and performance-enhancing drugs are artificial interventions that aim to boost athletic performance, challenging our notions of natural ability. If fairness is your concern, wouldn&#39;t allowing all supplements create a more level playing field than our current system? What criteria truly separate acceptable enhancements from those that cross the line?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==31ece5b008::student-c3r1zgvudhmudxdmlmvkdq==d757c6e8fd::41676e6aed::d313ce12b7">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==31ece5b008::student-c3r1zgvudhmudxdmlmvkdq==d757c6e8fd::41676e6aed::d313ce12b7">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-c3r1zgvudhmudxdmlmvkdq==31ece5b008::student-c3r1zgvudhmudxdmlmvkdq==d757c6e8fd::41676e6aed::d313ce12b7" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-c3r1zgvudhmudxdmlmvkdq==31ece5b008::student-c3r1zgvudhmudxdmlmvkdq==d757c6e8fd::41676e6aed::d313ce12b7" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-c3r1zgvudhmudxdmlmvkdq==0288ebc208::student-c3r1zgvudhmudxdmlmvkdq==084a484408::student-c3r1zgvudhmudxdmlmvkdq==9354531808::c8f1c90f1c::d313ce12b7">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Cosmetic Surgery on Pets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-c3r1zgvudhmudxdmlmvkdq==0288ebc208::student-c3r1zgvudhmudxdmlmvkdq==084a484408::student-c3r1zgvudhmudxdmlmvkdq==9354531808::c8f1c90f1c::d313ce12b7">
                                  <ul>
<li><strong>Students vehemently opposed purely cosmetic pet surgeries, highlighting unnecessary cruelty, lack of consent, and breed standard exploitation.</strong> They opened with comparisons to ear piercing, enumerated harms from tail docking and declawing, and built a shared stance that aesthetic show alterations undermine animal welfare.  </li>
<li><strong>Student 3, acting as devil’s advocate, proposed cosmetic procedures might boost adoption rates but ultimately conceded the high costs and pain outweigh superficial benefits.</strong> Student 3 shifted from suggesting life-enhancement to acknowledging that medical expenses and recovery hassles still render the procedures unjustifiable for animals lacking true benefit.  </li>
<li><strong>Guide kept the discussion on target by refocusing student comments on pets instead of children, probing for concrete harms and benefits, and later offering a structured pro–con list of talking points.</strong> Its early clarifications and questions helped students deepen their reasoning, though after providing the bullet-pointed framework, Guide’s silence allowed the group to self-synthesize their final conclusions.</li>
</ul>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-c3r1zgvudhmudxdmlmvkdq==0288ebc208::student-c3r1zgvudhmudxdmlmvkdq==084a484408::student-c3r1zgvudhmudxdmlmvkdq==9354531808::c8f1c90f1c::d313ce12b7" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-c3r1zgvudhmudxdmlmvkdq==0288ebc208::student-c3r1zgvudhmudxdmlmvkdq==084a484408::student-c3r1zgvudhmudxdmlmvkdq==9354531808::c8f1c90f1c::d313ce12b7" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-c3r1zgvudhmudxdmlmvkdq==0288ebc208::student-c3r1zgvudhmudxdmlmvkdq==084a484408::student-c3r1zgvudhmudxdmlmvkdq==9354531808::c8f1c90f1c::d313ce12b7" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-c3r1zgvudhmudxdmlmvkdq==0288ebc208::student-c3r1zgvudhmudxdmlmvkdq==084a484408::student-c3r1zgvudhmudxdmlmvkdq==9354531808::c8f1c90f1c::d313ce12b7" class="form-control summary-markdown-editor">- **Students vehemently opposed purely cosmetic pet surgeries, highlighting unnecessary cruelty, lack of consent, and breed standard exploitation.** They opened with comparisons to ear piercing, enumerated harms from tail docking and declawing, and built a shared stance that aesthetic show alterations undermine animal welfare.  
- **Student 3, acting as devil’s advocate, proposed cosmetic procedures might boost adoption rates but ultimately conceded the high costs and pain outweigh superficial benefits.** Student 3 shifted from suggesting life-enhancement to acknowledging that medical expenses and recovery hassles still render the procedures unjustifiable for animals lacking true benefit.  
- **Guide kept the discussion on target by refocusing student comments on pets instead of children, probing for concrete harms and benefits, and later offering a structured pro–con list of talking points.** Its early clarifications and questions helped students deepen their reasoning, though after providing the bullet-pointed framework, Guide’s silence allowed the group to self-synthesize their final conclusions.</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==0288ebc208::student-c3r1zgvudhmudxdmlmvkdq==084a484408::student-c3r1zgvudhmudxdmlmvkdq==9354531808::c8f1c90f1c::d313ce12b7">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==0288ebc208::student-c3r1zgvudhmudxdmlmvkdq==084a484408::student-c3r1zgvudhmudxdmlmvkdq==9354531808::c8f1c90f1c::d313ce12b7">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-c3r1zgvudhmudxdmlmvkdq==0288ebc208::student-c3r1zgvudhmudxdmlmvkdq==084a484408::student-c3r1zgvudhmudxdmlmvkdq==9354531808::c8f1c90f1c::d313ce12b7" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-c3r1zgvudhmudxdmlmvkdq==0288ebc208::student-c3r1zgvudhmudxdmlmvkdq==084a484408::student-c3r1zgvudhmudxdmlmvkdq==9354531808::c8f1c90f1c::d313ce12b7" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-c3r1zgvudhmudxdmlmvkdq==7e8db58a07::student-c3r1zgvudhmudxdmlmvkdq==a5ba073008::5ac5c860c5::d313ce12b7">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Growth Hormones for Shortness
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-c3r1zgvudhmudxdmlmvkdq==7e8db58a07::student-c3r1zgvudhmudxdmlmvkdq==a5ba073008::5ac5c860c5::d313ce12b7">
                                  <ul>
<li><strong>Students discussed the ethics of administering rHGH to address short stature, debating whether immediate discomfort should outweigh potential long-term social disadvantages.</strong> One argued that children might later regret refusing the treatment despite the pain, while the other insisted that children are capable of understanding such concepts, sparking a sustained debate about developmental capacity and parental authority.  </li>
<li><strong>Guide actively challenged students by questioning assumptions about a child's ability to grasp future consequences and underscored the ethical complexity of overriding a child's immediate wishes.</strong> Guide pressed for evidence and highlighted research on height bias, urging students to weigh documented lifelong disadvantages against the temporary discomfort of treatment.</li>
</ul>
<blockquote>
<p><strong>I'm not undermining children's intelligence, but acknowledging developmental psychology. Children under 12 typically have limited future time perspective, struggle with abstract hypotheticals, and can't fully weigh long-term consequences against immediate discomfort. This isn't controversial - it's why we have age-of-consent laws and parental decision-making for medical care.</strong></p>
<p><strong>If a child refuses treatment but later faces discrimination as an adult, who bears responsibility for that outcome? The parents who respected their choice, or the child who couldn't fully understand the implications?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-c3r1zgvudhmudxdmlmvkdq==7e8db58a07::student-c3r1zgvudhmudxdmlmvkdq==a5ba073008::5ac5c860c5::d313ce12b7" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-c3r1zgvudhmudxdmlmvkdq==7e8db58a07::student-c3r1zgvudhmudxdmlmvkdq==a5ba073008::5ac5c860c5::d313ce12b7" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-c3r1zgvudhmudxdmlmvkdq==7e8db58a07::student-c3r1zgvudhmudxdmlmvkdq==a5ba073008::5ac5c860c5::d313ce12b7" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-c3r1zgvudhmudxdmlmvkdq==7e8db58a07::student-c3r1zgvudhmudxdmlmvkdq==a5ba073008::5ac5c860c5::d313ce12b7" class="form-control summary-markdown-editor">- **Students discussed the ethics of administering rHGH to address short stature, debating whether immediate discomfort should outweigh potential long-term social disadvantages.** One argued that children might later regret refusing the treatment despite the pain, while the other insisted that children are capable of understanding such concepts, sparking a sustained debate about developmental capacity and parental authority.  
- **Guide actively challenged students by questioning assumptions about a child&#39;s ability to grasp future consequences and underscored the ethical complexity of overriding a child&#39;s immediate wishes.** Guide pressed for evidence and highlighted research on height bias, urging students to weigh documented lifelong disadvantages against the temporary discomfort of treatment.

  
&gt; **I&#39;m not undermining children&#39;s intelligence, but acknowledging developmental psychology. Children under 12 typically have limited future time perspective, struggle with abstract hypotheticals, and can&#39;t fully weigh long-term consequences against immediate discomfort. This isn&#39;t controversial - it&#39;s why we have age-of-consent laws and parental decision-making for medical care.**
&gt;
&gt; **If a child refuses treatment but later faces discrimination as an adult, who bears responsibility for that outcome? The parents who respected their choice, or the child who couldn&#39;t fully understand the implications?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==7e8db58a07::student-c3r1zgvudhmudxdmlmvkdq==a5ba073008::5ac5c860c5::d313ce12b7">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==7e8db58a07::student-c3r1zgvudhmudxdmlmvkdq==a5ba073008::5ac5c860c5::d313ce12b7">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-c3r1zgvudhmudxdmlmvkdq==7e8db58a07::student-c3r1zgvudhmudxdmlmvkdq==a5ba073008::5ac5c860c5::d313ce12b7" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-c3r1zgvudhmudxdmlmvkdq==7e8db58a07::student-c3r1zgvudhmudxdmlmvkdq==a5ba073008::5ac5c860c5::d313ce12b7" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-c3r1zgvudhmudxdmlmvkdq==573bb88608::student-c3r1zgvudhmudxdmlmvkdq==e6c5194607::5ac5c860c5::d313ce12b7">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Growth Hormones for Shortness
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-c3r1zgvudhmudxdmlmvkdq==573bb88608::student-c3r1zgvudhmudxdmlmvkdq==e6c5194607::5ac5c860c5::d313ce12b7">
                                  <ul>
<li><strong>Students debated whether the benefits of rHGH for idiopathic short stature outweigh its known risks.</strong> One participant argued that rHGH can mimic natural growth processes and potentially benefit a child’s life if the side effects are manageable, while the other stressed the artificial nature of injections and the possible harm they might cause.</li>
<li><strong>Students probed ethical dilemmas around parental consent and societal pressures on physical appearance.</strong> They examined if parental decision-making in this context is any different from other interventions, with Guide prompting them to weigh medical risks against ingrained social biases.</li>
</ul>
<blockquote>
<p><strong>It seems you've both found some common ground on parental decision-making. Student 2, you've shifted to acknowledging parents' authority while Student 1 emphasizes the importance of medical guidance. What about the societal aspect? Should we focus on changing height biases rather than changing children's bodies? Or is that unrealistic given how deeply ingrained height preferences are in society?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-c3r1zgvudhmudxdmlmvkdq==573bb88608::student-c3r1zgvudhmudxdmlmvkdq==e6c5194607::5ac5c860c5::d313ce12b7" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-c3r1zgvudhmudxdmlmvkdq==573bb88608::student-c3r1zgvudhmudxdmlmvkdq==e6c5194607::5ac5c860c5::d313ce12b7" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-c3r1zgvudhmudxdmlmvkdq==573bb88608::student-c3r1zgvudhmudxdmlmvkdq==e6c5194607::5ac5c860c5::d313ce12b7" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-c3r1zgvudhmudxdmlmvkdq==573bb88608::student-c3r1zgvudhmudxdmlmvkdq==e6c5194607::5ac5c860c5::d313ce12b7" class="form-control summary-markdown-editor">- **Students debated whether the benefits of rHGH for idiopathic short stature outweigh its known risks.** One participant argued that rHGH can mimic natural growth processes and potentially benefit a child’s life if the side effects are manageable, while the other stressed the artificial nature of injections and the possible harm they might cause.
- **Students probed ethical dilemmas around parental consent and societal pressures on physical appearance.** They examined if parental decision-making in this context is any different from other interventions, with Guide prompting them to weigh medical risks against ingrained social biases.

&gt; **It seems you&#39;ve both found some common ground on parental decision-making. Student 2, you&#39;ve shifted to acknowledging parents&#39; authority while Student 1 emphasizes the importance of medical guidance. What about the societal aspect? Should we focus on changing height biases rather than changing children&#39;s bodies? Or is that unrealistic given how deeply ingrained height preferences are in society?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==573bb88608::student-c3r1zgvudhmudxdmlmvkdq==e6c5194607::5ac5c860c5::d313ce12b7">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-c3r1zgvudhmudxdmlmvkdq==573bb88608::student-c3r1zgvudhmudxdmlmvkdq==e6c5194607::5ac5c860c5::d313ce12b7">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-c3r1zgvudhmudxdmlmvkdq==573bb88608::student-c3r1zgvudhmudxdmlmvkdq==e6c5194607::5ac5c860c5::d313ce12b7" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-c3r1zgvudhmudxdmlmvkdq==573bb88608::student-c3r1zgvudhmudxdmlmvkdq==e6c5194607::5ac5c860c5::d313ce12b7" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
              </div>
            
          </div>
        </div>
      </div>
      
      <div style="clear:both; height:20px;"></div>
      
      <!-- Add Qualtrics Survey Data Card - if data exists -->
      
      <div class="row mb-4">
        <div class="col-12">
          <div class="py-4 mb-4">
            <h5 class="section-title">
              <div class="title-text"><i class="fas fa-chart-bar mr-1"></i> Post-Chat Survey Data</div>
            </h5>
            <div class="card-body pt-0">
              <div class="row">
                <div class="col-md-4 d-flex flex-column align-items-center justify-content-center py-3">
                  <h3>7</h3>
                  <p class="text-muted">Total Survey Responses</p>
                </div>
                <div class="col-md-4 d-flex flex-column align-items-center justify-content-center py-3">
                  <h3>5</h3>
                  <p class="text-muted">Threads With Surveys</p>
                </div>
                <div class="col-md-4 d-flex flex-column align-items-center justify-content-center py-3">
                  <h3>83.3%</h3>
                  <p class="text-muted">Response Rate</p>
                </div>
              </div>
              <div class="d-flex justify-content-between align-items-center text-muted small mb-0" style="gap: 1rem;">
                <span class="ml-auto text-right" style="flex:1; text-align:right;">Last updated: 2025-05-06 22:32:49.771352</span>
                
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Separate row for survey histogram charts floating on background -->
      <div class="row mb-4">
        <div class="col-12">
          
            <!-- Overall Rating and Guide Feedback -->
            <div class="row">
              
              <div class="col-md-6 mb-4">
                <div class="card h-100 thread-card">
                  <div class="card-body p-0">
                    
                    
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">How was your chat?</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">🔥 Awesome</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">4 (66.7%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:66.66666666666666%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">👍 Good</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">2 (33.3%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:33.33333333333333%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">😐 It's OK</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">👎 Not a fan</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">💩 Hated it</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.33 <span style="opacity:0.7;">(95% confidence interval: 0.79–1.88)</span></div>
    </div>
</div>
                  </div>
                </div>
              </div>
              
              
              
              <div class="col-md-6 mb-4">
                <div class="card h-100 thread-card">
                  <div class="card-body p-0">
                    
                    
                      
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">Guide contributed the right amount</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">6 (100.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:100.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.00 <span style="opacity:0.7;">(95% confidence interval: 1.00–1.00)</span></div>
    </div>
</div>
                    
                  </div>
                </div>
              </div>
              
            </div>
            
            <div style="height: 2rem;"></div>
            <div class="row">
              
              
                
              
                
              
                
              
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 thread-card">
                      <div class="card-body p-0">
                        
                        
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">I felt comfortable sharing my honest opinions with my partner</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">1 (50.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:50.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">1 (50.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:50.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.50 <span style="opacity:0.7;">(95% confidence interval: -4.85–7.85)</span></div>
    </div>
</div>
                      </div>
                    </div>
                  </div>
                
              
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 thread-card">
                      <div class="card-body p-0">
                        
                        
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">I was not offended by my partner's perspective</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">2 (100.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:100.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 2.00 <span style="opacity:0.7;">(95% confidence interval: 2.00–2.00)</span></div>
    </div>
</div>
                      </div>
                    </div>
                  </div>
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 thread-card">
                      <div class="card-body p-0">
                        
                        
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">It was valuable to chat with a student who did not share my perspective</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">3 (75.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:75.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">1 (25.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:25.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.75 <span style="opacity:0.7;">(95% confidence interval: 0.95–2.55)</span></div>
    </div>
</div>
                      </div>
                    </div>
                  </div>
                
              
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 thread-card">
                      <div class="card-body p-0">
                        
                        
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">It would be good if more students and classes used Sway</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">4 (80.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:80.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">1 (20.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:20.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.80 <span style="opacity:0.7;">(95% confidence interval: 1.24–2.36)</span></div>
    </div>
</div>
                      </div>
                    </div>
                  </div>
                
              
            </div>
            
            <!-- Opinion Changes Section -->
            
          
        </div>
      </div>
      
      <!-- End Qualtrics Survey Data Section -->
    </div>
  </div>
  
<!-- Modal containers will be dynamically injected here by JS if needed -->
<div id="modal-container"></div> 
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
  

<!-- =====================
     Core Utilities
     ===================== -->
<script>
  // Debug logging utility
  function debug_log(message, level, details = null) {
    if (details) {
      console.log(`DEBUG[${level}]:`, message, details);
    } else {
      console.log(`DEBUG[${level}]:`, message);
    }
  }

  // Convert UTC timestamps to local timezone
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('[data-utc-time]').forEach(function(element) {
      const utcTime = element.getAttribute('data-utc-time');
      try {
        const localDate = new Date(utcTime);
        if (!isNaN(localDate)) {
          const options = {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
          };
          const localTimeStr = localDate.toLocaleString(undefined, options);
          const localTimeElement = element.nextElementSibling;
          if (localTimeElement && localTimeElement.classList.contains('local-time')) {
            localTimeElement.textContent = localTimeStr;
            element.style.display = 'none';
            localTimeElement.style.display = 'inline';
          }
        }
      } catch (e) {
        console.error('Error converting time:', e);
      }
    });
  });
</script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- =====================
     Theme Toggle
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.getElementById('theme-toggle-input'); // Fixed id to match the input in _header.html
    if (!themeToggle) return;
    // Determine initial theme from localStorage or template variable
    let initialTheme = localStorage.getItem('theme');
    if (!initialTheme) {
      initialTheme = 'dark-mode' === 'light-mode' ? 'light' : 'dark';
    }
    // Set initial toggle state and class
    themeToggle.checked = initialTheme === 'light';
    document.documentElement.className = initialTheme === 'light' ? 'light-mode' : 'dark-mode';
    // Add event listener for theme toggle
    themeToggle.addEventListener('change', function() {
      if (this.checked) {
        document.documentElement.classList.remove('dark-mode');
        document.documentElement.classList.add('light-mode');
        localStorage.setItem('theme', 'light');
      } else {
        document.documentElement.classList.remove('light-mode');
        document.documentElement.classList.add('dark-mode');
        localStorage.setItem('theme', 'dark');
      }
    });
  });
</script>

<!-- =====================
     Summary/Report Generation & Polling
     ===================== -->
<script>
  let pollingInterval = null;
  let cancelRequested = false;
  document.addEventListener('DOMContentLoaded', function() {
    const generateBtn = document.getElementById('generate-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const reportBtn = document.getElementById('report-btn');
    let hasSavedSummaries = "true" === "true";
    
    // Check directly if there are any thread summaries actually present on the page
    const allThreadSummaries = document.querySelectorAll('.thread-summary.markdown-content');
    const hasVisibleSummaries = Array.from(allThreadSummaries).some(el => 
      el.innerHTML.trim() !== '' && el.style.display !== 'none'
    );
    
    // If we have visible summaries on the page, allow generating the report regardless of server-side flag
    if (hasVisibleSummaries) {
      hasSavedSummaries = true;
      debug_log("Enabling report button because visible summaries were found on page", 1);
    }
    
    if (reportBtn && hasSavedSummaries) {
      reportBtn.disabled = false;
      debug_log("Enabling report button because saved summaries exist", 1);
    }
    // Check if any thread is currently in 'generating' status
    const hasGeneratingThreads = Array.from(document.querySelectorAll('.thread-status'))
      .some(el => el.textContent === 'Generating summary...');
    if (hasGeneratingThreads) {
      startPolling();
      if (generateBtn) generateBtn.style.display = 'none';
      if (cancelBtn) cancelBtn.style.display = 'inline-block';
    }
    // Generate summaries
    if (generateBtn) {
      generateBtn.addEventListener('click', function() {
        document.querySelectorAll('.thread-status').forEach(status => {
          status.textContent = 'Queued for generation...';
          status.style.display = 'block';
          status.className = 'thread-status text-info';
        });
        generateBtn.style.display = 'none';
        if (cancelBtn) cancelBtn.style.display = 'inline-block';
        fetch('/assignment/d313ce12b7/generate_summaries', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        })
        .then(response => {
          if (response.ok) {
            debug_log("Summaries queued successfully", 1);
            startPolling();
            if (reportBtn) reportBtn.disabled = false;
          } else {
            debug_log("Error queueing summaries", 1);
          }
        })
        .catch(error => debug_log("Network error:", error, 1));
      });
      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          cancelRequested = true;
          fetch('/assignment/d313ce12b7/cancel_generation', { method: 'POST' })
            .then(response => {
              if (response.ok) {
                stopPolling();
                document.querySelectorAll('.thread-status').forEach(status => {
                  if (status.textContent === 'Queued for generation...') status.style.display = 'none';
                });
                document.querySelectorAll('.spinner-border').forEach(spinner => spinner.style.display = 'none');
                generateBtn.style.display = 'inline-block';
                cancelBtn.style.display = 'none';
              }
            });
        });
      }
    }
    // Report button
    if (reportBtn) {
      // Show/hide advanced thinking controls based on model selection
      const modelToggleGroup = document.getElementById('report-model-toggle-group');
      const advancedThinkingControls = document.getElementById('advanced-thinking-controls');
      function updateThinkingControlsVisibility() {
        const checked = modelToggleGroup.querySelector('input[type=radio]:checked');
        if (checked && checked.value === 'anthropic') {
          advancedThinkingControls.style.display = 'flex';
        } else {
          advancedThinkingControls.style.display = 'none';
        }
      }
      if (modelToggleGroup && advancedThinkingControls) {
        modelToggleGroup.addEventListener('change', updateThinkingControlsVisibility);
        updateThinkingControlsVisibility();
      }
      reportBtn.addEventListener('click', function() {
        const reportSpinner = document.getElementById('report-spinner');
        if (reportSpinner) reportSpinner.style.display = 'inline-block';
        reportBtn.disabled = true;
        const noReportMsg = document.getElementById('no-report-msg');
        if (noReportMsg) {
          noReportMsg.textContent = 'Generating instructor report...';
          noReportMsg.className = 'text-info mb-0';
        }
        // Collect all visible summaries from the UI
        const summaries = {};
        document.querySelectorAll('.thread-card').forEach(card => {
          const threadId = card.id.replace('thread-', '');
          const summaryEl = card.querySelector('.thread-summary');
          if (summaryEl && summaryEl.innerHTML.trim() !== '' && summaryEl.style.display !== 'none') {
            // Try to get the raw markdown if available
            let summaryContent = '';
            const editorEl = card.querySelector('.summary-markdown-editor');
            if (editorEl && editorEl.value.trim() !== '') {
              summaryContent = editorEl.value.trim();
            } else {
              // Otherwise use the HTML content
              summaryContent = summaryEl.innerHTML;
            }
            summaries[threadId] = {
              thread_id: threadId,
              assignment_id: 'd313ce12b7',
              summary: summaryContent,
              content: summaryContent,
              status: 'completed'
            };
          }
        });
        debug_log(`Collected ${Object.keys(summaries).length} visible summaries from UI`, 1);
        // Get selected model provider
        let modelProvider = 'openai';
        const checked = document.querySelector('#report-model-toggle-group input[type=radio]:checked');
        if (checked) modelProvider = checked.value;
        // Get advanced thinking mode and budget if Anthropic
        let enableThinking = false;
        let thinkingBudgetTokens = 4096;
        if (modelProvider === 'anthropic') {
          const enableThinkingCheckbox = document.getElementById('enable-thinking-checkbox');
          const thinkingBudgetInput = document.getElementById('thinking-budget-input');
          if (enableThinkingCheckbox && enableThinkingCheckbox.checked) {
            enableThinking = true;
          }
          if (thinkingBudgetInput && thinkingBudgetInput.value) {
            thinkingBudgetTokens = parseInt(thinkingBudgetInput.value) || 4096;
          }
        }
        fetch('/assignment/d313ce12b7/generate_report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            summaries: summaries,
            model_provider: modelProvider,
            enable_thinking: enableThinking,
            thinking_budget_tokens: thinkingBudgetTokens
          })
        })
        .then(response => response.json())
        .then(data => {
          debug_log("Report generation initiated:", data, 1);
          checkReportStatus();
        })
        .catch(error => {
          debug_log("Error generating report:", error, 1);
          reportBtn.disabled = false;
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (noReportMsg) {
            noReportMsg.textContent = 'Error generating report. Please try again.';
            noReportMsg.className = 'text-danger mb-0';
          }
        });
      });
    }
    // Refresh data
    const refreshDataBtn = document.getElementById('refresh-data-btn');
    if (refreshDataBtn) {
      refreshDataBtn.addEventListener('click', function() {
        const refreshSpinner = document.getElementById('refresh-spinner');
        if (refreshSpinner) refreshSpinner.style.display = 'inline-block';
        refreshDataBtn.disabled = true;
        fetch('/assignment/d313ce12b7/refresh_data', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
          debug_log("Data refresh initiated:", data, 1);
          window.location.reload();
        })
        .catch(error => {
          debug_log("Error refreshing data:", error, 1);
          if (refreshSpinner) refreshSpinner.style.display = 'none';
          refreshDataBtn.disabled = false;
          alert('Error refreshing data. Please try again.');
        });
      });
    }
    // Regenerate title
    const regenerateTitleBtn = document.getElementById('regenerate-title-btn');
    if (regenerateTitleBtn) {
      regenerateTitleBtn.addEventListener('click', function() {
        regenerateTitleBtn.disabled = true;
        const icon = regenerateTitleBtn.querySelector('i');
        const originalIcon = icon.className;
        icon.className = 'fas fa-spinner fa-spin';
        fetch('/assignment/d313ce12b7/regenerate_title', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const titleEl = document.querySelector('.generated-title');
            if (titleEl) titleEl.textContent = data.title;
            console.log("Title regenerated:", data.title);
          } else {
            console.error("Error regenerating title:", data.message);
            alert("Error regenerating title: " + data.message);
          }
          regenerateTitleBtn.disabled = false;
          icon.className = originalIcon;
        })
        .catch(error => {
          console.error("Error:", error);
          alert("Error regenerating title. Please try again.");
          regenerateTitleBtn.disabled = false;
          icon.className = originalIcon;
        });
      });
    }
    
    // Final check to ensure report button is enabled if summaries exist
    setTimeout(function() {
      const reportBtn = document.getElementById('report-btn');
      if (reportBtn && reportBtn.disabled) {
        const visibleSummaries = document.querySelectorAll('.thread-summary.markdown-content');
        const hasContent = Array.from(visibleSummaries).some(el => 
          el.innerHTML.trim() !== '' && el.style.display !== 'none'
        );
        
        if (hasContent) {
          reportBtn.disabled = false;
          debug_log("Enabling report button in final check - summaries exist", 1);
        }
      }
    }, 500); // Short delay to ensure all content is processed
  });
  function startPolling() {
    if (pollingInterval) clearInterval(pollingInterval);
    pollingInterval = setInterval(checkSummaryStatus, 2000);
    checkSummaryStatus();
  }
  function stopPolling() {
    if (pollingInterval) {
      clearInterval(pollingInterval);
      pollingInterval = null;
    }
  }
  function checkSummaryStatus() {
    fetch('/assignment/d313ce12b7/summary_status')
      .then(response => response.json())
      .then(data => {
        let activeGeneration = false;
        Object.entries(data).forEach(([sessionId, threadInfo]) => {
          const statusEl = document.getElementById(`status-${sessionId}`);
          const summaryEl = document.getElementById(`summary-${sessionId}`);
          const spinnerEl = document.getElementById(`spinner-${sessionId}`);
          if (threadInfo.status === 'generating') {
            activeGeneration = true;
            if (statusEl) {
              statusEl.textContent = 'Generating summary...';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-warning';
            }
            if (spinnerEl) spinnerEl.style.display = 'inline-block';
          } else if (threadInfo.status === 'completed') {
            if (statusEl) statusEl.style.display = 'none';
            if (spinnerEl) spinnerEl.style.display = 'none';
            if (summaryEl && threadInfo.render_html) {
              summaryEl.innerHTML = threadInfo.render_html;
              summaryEl.style.display = 'block';
              // Update the markdown textarea value for this thread
              var textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
              if (textarea) {
                // If threadInfo has markdown, use it; otherwise, fallback to extracting from HTML
                if (threadInfo.markdown) {
                  textarea.value = threadInfo.markdown;
                } else if (threadInfo.render_html) {
                  // Optionally, convert HTML back to markdown if needed (or leave blank)
                  textarea.value = '';
                }
                // If CodeMirror is open for this thread, update its value too
                if (window.summaryEditors && window.summaryEditors[sessionId]) {
                  window.summaryEditors[sessionId].setValue(textarea.value);
                  window.summaryEditors[sessionId].refresh();
                }
              }
              // If a summary was successfully displayed, enable the report button
              const reportBtn = document.getElementById('report-btn');
              if (reportBtn) {
                reportBtn.disabled = false;
                debug_log("Enabling report button because a summary was loaded", 1);
              }
            }
          } else if (threadInfo.status === 'queued') {
            activeGeneration = true;
            if (statusEl) {
              statusEl.textContent = 'Queued for generation...';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-info';
            }
            if (spinnerEl) spinnerEl.style.display = 'none';
          } else if (threadInfo.status === 'error') {
            if (statusEl) {
              statusEl.textContent = 'Error generating summary';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-danger';
            }
            if (spinnerEl) spinnerEl.style.display = 'none';
          } else if (threadInfo.status === 'skipped') {
            if (statusEl) {
              statusEl.textContent = threadInfo.message || 'Skipped due to insufficient messages';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-warning';
            }
            if (spinnerEl) spinnerEl.style.display = 'none';
          }
        });
        if (!activeGeneration) {
          stopPolling();
          const generateBtn = document.getElementById('generate-btn');
          const cancelBtn = document.getElementById('cancel-btn');
          if (generateBtn) generateBtn.style.display = 'inline-block';
          if (cancelBtn) cancelBtn.style.display = 'none';
          const reportBtn = document.getElementById('report-btn');
          if (reportBtn) reportBtn.disabled = false;
        }
      })
      .catch(error => debug_log('Error checking summary status:', error, 1));
  }
  function checkReportStatus() {
    fetch('/assignment/d313ce12b7/report_status')
      .then(response => response.json())
      .then(data => {
        const reportBtn = document.getElementById('report-btn');
        const reportSpinner = document.getElementById('report-spinner');
        const noReportMsg = document.getElementById('no-report-msg');
        const reportSection = document.getElementById('report-section');
        
        debug_log("Report status update:", data, 1);
        
        if (data.status === 'completed') {
          // Report generation completed
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (reportBtn) {
            reportBtn.disabled = false;
            reportBtn.textContent = 'Regenerate report';
          }
          
          // Only update the UI if we have content
          if (data.content && reportSection) {
            const reportContent = document.createElement('div');
            reportContent.id = 'report-content';
            reportContent.className = 'markdown-content';
            const styleTag = document.createElement('style');
            styleTag.textContent = `#report-content ul ul {margin-top:0.5em;margin-bottom:0.5em;padding-left:2em;}#report-content li > ul {margin-left:1em;}`;
            reportContent.appendChild(styleTag);
            
            // Check if render_html is available first, otherwise use content
            if (data.render_html) {
              reportContent.innerHTML += data.render_html;
            } else {
              reportContent.innerHTML += data.content;
            }
            
            const generatedText = document.createElement('div');
            generatedText.className = 'text-muted mt-2 d-flex justify-content-end align-items-center';
            
            // Create formatted date display
            const formattedDate = new Date(data.generated_at).toLocaleDateString('en-US', {
              month: 'short', 
              day: 'numeric', 
              year: 'numeric',
              hour: 'numeric',
              minute: '2-digit',
              hour12: true
            });
            
            generatedText.innerHTML = `
              <span class="text-right" style="flex:1; text-align:right;">Generated on: ${formattedDate}</span>
              ${!exportMode ? `
                <button type="button" class="btn btn-link btn-sm text-muted p-0 ml-2" id="edit-report-btn" title="Edit report" style="vertical-align: baseline;">
                  <i class="fas fa-pencil-alt"></i>
                </button>
              ` : ''}
            `;
            
            // Clear existing content and append new content
            reportSection.innerHTML = '';
            reportSection.appendChild(reportContent);
            reportSection.appendChild(generatedText);
            
            // Convert UTC timestamps to local
            const utcTimeElements = reportSection.querySelectorAll('[data-utc-time]');
            utcTimeElements.forEach(function(element) {
              const utcTime = element.getAttribute('data-utc-time');
              try {
                const localDate = new Date(utcTime);
                if (!isNaN(localDate)) {
                  const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true };
                  const localTimeStr = localDate.toLocaleString(undefined, options);
                  const localTimeElement = element.nextElementSibling;
                  if (localTimeElement && localTimeElement.classList.contains('local-time')) {
                    localTimeElement.textContent = localTimeStr;
                    element.style.display = 'none';
                    localTimeElement.style.display = 'inline';
                  }
                }
              } catch (e) { console.error('Error converting time:', e); }
            });
            
            debug_log("Updated report UI with new content", 1);
          } else {
            debug_log("Report completed but no content received", 2);
          }
        } else if (data.status === 'generating' || data.status === 'running') {
          // Report is still being generated
          if (noReportMsg) {
            noReportMsg.textContent = 'Generating instructor report...';
            noReportMsg.className = 'text-info mb-0';
          }
          
          // Show elapsed time if available
          if (data.elapsed_seconds) {
            const elapsed = Math.round(data.elapsed_seconds);
            if (noReportMsg) {
              noReportMsg.textContent = `Generating instructor report... (${elapsed}s)`;
            }
          }
          
          // Continue polling
          setTimeout(checkReportStatus, 2000);
        } else if (data.status === 'error') {
          // Error generating report
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (reportBtn) reportBtn.disabled = false;
          if (noReportMsg) {
            noReportMsg.textContent = `Error generating report: ${data.error || 'Unknown error'}`;
            noReportMsg.className = 'text-danger mb-0';
          }
        } else {
          // Unknown or not_started status
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (reportBtn) reportBtn.disabled = false;
          if (data.report_exists && reportSection) {
            // If report exists but no status, try refreshing the page after a timeout
            debug_log("Report exists but status not provided - will try to reload content", 2);
            setTimeout(checkReportStatus, 2000);
          }
        }
      })
      .catch(error => {
        debug_log("Error checking report status:", error, 2);
        const reportSpinner = document.getElementById('report-spinner');
        const reportBtn = document.getElementById('report-btn');
        const noReportMsg = document.getElementById('no-report-msg');
        if (reportSpinner) reportSpinner.style.display = 'none';
        if (reportBtn) reportBtn.disabled = false;
        if (noReportMsg) {
          noReportMsg.textContent = 'Error checking report status. Please try again.';
          noReportMsg.className = 'text-danger mb-0';
        }
      });
  }
</script>

<!-- =====================
     CodeMirror for Editing
     ===================== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/markdown/markdown.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/material-darker.min.css">
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Report editing
    const editReportBtn = document.getElementById('edit-report-btn');
    const reportContent = document.getElementById('report-content');
    const reportEditorContainer = document.getElementById('report-editor-container');
    const saveReportBtn = document.getElementById('save-report-btn');
    const cancelReportEditBtn = document.getElementById('cancel-report-edit-btn');
    const editorSpinner = document.getElementById('editor-spinner');
    const statusMessage = document.getElementById('editor-status-message');
    let reportEditor;
    const reportMarkdownEditor = document.getElementById('report-markdown-editor');
    if (reportMarkdownEditor) {
      reportEditor = CodeMirror.fromTextArea(reportMarkdownEditor, {
        lineNumbers: true,
        theme: 'material-darker',
        mode: 'markdown',
        lineWrapping: true
      });
    }
    if (editReportBtn) {
      editReportBtn.addEventListener('click', function() {
        reportContent.style.display = 'none';
        reportEditorContainer.style.display = 'block';
        if (reportEditor) reportEditor.refresh();
      });
    }
    if (cancelReportEditBtn) {
      cancelReportEditBtn.addEventListener('click', function() {
        reportContent.style.display = 'block';
        reportEditorContainer.style.display = 'none';
        statusMessage.style.display = 'none';
      });
    }
    if (saveReportBtn) {
      saveReportBtn.addEventListener('click', function() {
        const markdown = reportEditor.getValue();
        if (!markdown.trim()) {
          showEditorStatus('Report content cannot be empty', 'error');
          return;
        }
        editorSpinner.style.display = 'inline-block';
        fetch('/assignment/d313ce12b7/edit_report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ markdown: markdown })
        })
        .then(response => response.json())
        .then(data => {
          editorSpinner.style.display = 'none';
          if (data.success) {
            reportContent.innerHTML = data.content;
            showEditorStatus(data.message, 'success');
            setTimeout(() => {
              reportContent.style.display = 'block';
              reportEditorContainer.style.display = 'none';
              statusMessage.style.display = 'none';
            }, 1500);
          } else {
            showEditorStatus(data.message, 'error');
          }
        })
        .catch(error => {
          editorSpinner.style.display = 'none';
          showEditorStatus('Error saving report: ' + error, 'error');
        });
      });
    }
    function showEditorStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = `status-message ${type}`;
      statusMessage.style.display = 'block';
      if (type === 'success') {
        setTimeout(() => { statusMessage.style.display = 'none'; }, 3000);
      }
    }
  });
</script>

<!-- =====================
     Summary Editing (CodeMirror)
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const editSummaryBtns = document.querySelectorAll('.edit-summary-btn');
    const regenerateSummaryBtns = document.querySelectorAll('.regenerate-summary-btn');
    const summaryEditors = {};
    editSummaryBtns.forEach(btn => {
      const sessionId = btn.getAttribute('data-session-id');
      const summaryElement = document.getElementById(`summary-${sessionId}`);
      const editorContainer = document.getElementById(`summary-editor-container-${sessionId}`);
      btn.addEventListener('click', function() {
        summaryElement.style.display = 'none';
        editorContainer.style.display = 'block';
        if (!summaryEditors[sessionId]) {
          const textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
          let markdownContent = textarea.value;
          if (!markdownContent) {
            markdownContent = summaryElement.innerHTML.replace(/<button.*?<\/button>/g, '');
          }
          summaryEditors[sessionId] = CodeMirror.fromTextArea(textarea, {
            lineNumbers: true,
            theme: 'material-darker',
            mode: 'markdown',
            lineWrapping: true
          });
          summaryEditors[sessionId].setValue(markdownContent);
          summaryEditors[sessionId].refresh();
        } else {
          summaryEditors[sessionId].refresh();
        }
      });
      const cancelBtn = document.querySelector(`.cancel-summary-edit-btn[data-session-id="${sessionId}"]`);
      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          summaryElement.style.display = 'block';
          editorContainer.style.display = 'none';
          document.getElementById(`summary-editor-status-${sessionId}`).style.display = 'none';
        });
      }
      const saveBtn = document.querySelector(`.save-summary-btn[data-session-id="${sessionId}"]`);
      if (saveBtn) {
        saveBtn.addEventListener('click', function() {
          const markdown = summaryEditors[sessionId].getValue();
          if (!markdown.trim()) {
            showSummaryStatus(sessionId, 'Summary content cannot be empty', 'error');
            return;
          }
          const spinner = document.getElementById(`summary-editor-spinner-${sessionId}`);
          spinner.style.display = 'inline-block';
          fetch('/assignment/d313ce12b7/edit_summary', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ session_id: sessionId, markdown: markdown })
          })
          .then(response => response.json())
          .then(data => {
            spinner.style.display = 'none';
            if (data.success) {
              summaryElement.innerHTML = data.render_html || data.content;
              summaryElement.style.display = 'block';
              // Update the markdown textarea value
              var textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
              if (textarea) {
                textarea.value = markdown;
                if (window.summaryEditors && window.summaryEditors[sessionId]) {
                  window.summaryEditors[sessionId].setValue(markdown);
                  window.summaryEditors[sessionId].refresh();
                }
              }
              showSummaryStatus(sessionId, data.message, 'success');
              setTimeout(() => {
                editorContainer.style.display = 'none';
                document.getElementById(`summary-editor-status-${sessionId}`).style.display = 'none';
                attachButtonListeners(sessionId);
              }, 1500);
            } else {
              showSummaryStatus(sessionId, data.message || 'Error saving summary', 'error');
            }
          })
          .catch(error => {
            spinner.style.display = 'none';
            showSummaryStatus(sessionId, 'Error saving summary: ' + error, 'error');
          });
        });
      }
    });
    regenerateSummaryBtns.forEach(btn => {
      const sessionId = btn.getAttribute('data-session-id');
      const summaryElement = document.getElementById(`summary-${sessionId}`);
      btn.addEventListener('click', function() {
        // Removed confirmation dialog for immediate regeneration
        const statusElement = document.getElementById(`status-${sessionId}`);
        const spinnerElement = document.getElementById(`spinner-${sessionId}`);
        if (statusElement && spinnerElement) {
          statusElement.textContent = 'Regenerating summary...';
          statusElement.className = 'status-message thread-status text-info';
          statusElement.style.display = 'block';
          spinnerElement.style.display = 'inline-block';
          summaryElement.style.opacity = '0.5';
          fetch('/assignment/d313ce12b7/regenerate_summary', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ session_id: sessionId })
          })
          .then(response => response.json())
          .then(data => {
            spinnerElement.style.display = 'none';
            if (data.success) {
              summaryElement.innerHTML = data.content;
              summaryElement.style.opacity = '1';
              statusElement.textContent = data.message;
              statusElement.className = 'status-message thread-status success';
              attachButtonListeners(sessionId);
              setTimeout(() => { statusElement.style.display = 'none'; }, 3000);
            } else {
              summaryElement.style.opacity = '1';
              statusElement.textContent = data.message || 'Error regenerating summary';
              statusElement.className = 'status-message thread-status error';
              setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
            }
          })
          .catch(error => {
            spinnerElement.style.display = 'none';
            summaryElement.style.opacity = '1';
            statusElement.textContent = 'Error regenerating summary: ' + error;
            statusElement.className = 'status-message thread-status error';
            setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
          });
        }
      });
    });
    function attachButtonListeners(sessionId) {
      const newEditBtn = document.querySelector(`.edit-summary-btn[data-session-id="${sessionId}"]`);
      const newRegenerateBtn = document.querySelector(`.regenerate-summary-btn[data-session-id="${sessionId}"]`);
      if (newEditBtn) {
        const summaryElement = document.getElementById(`summary-${sessionId}`);
        const editorContainer = document.getElementById(`summary-editor-container-${sessionId}`);
        newEditBtn.addEventListener('click', function() {
          summaryElement.style.display = 'none';
          editorContainer.style.display = 'block';
          if (!summaryEditors[sessionId]) {
            const textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
            let markdownContent = textarea.value;
            if (!markdownContent) {
              markdownContent = summaryElement.innerHTML.replace(/<button.*?<\/button>/g, '');
            }
            summaryEditors[sessionId] = CodeMirror.fromTextArea(textarea, {
              lineNumbers: true,
              theme: 'material-darker',
              mode: 'markdown',
              lineWrapping: true
            });
            summaryEditors[sessionId].setValue(markdownContent);
            summaryEditors[sessionId].refresh();
          } else {
            summaryEditors[sessionId].refresh();
          }
        });
      }
      if (newRegenerateBtn) {
        newRegenerateBtn.addEventListener('click', function() {
          // Removed confirmation dialog for immediate regeneration
          const summaryElement = document.getElementById(`summary-${sessionId}`);
          const statusElement = document.getElementById(`status-${sessionId}`);
          const spinnerElement = document.getElementById(`spinner-${sessionId}`);
          if (statusElement && spinnerElement) {
            statusElement.textContent = 'Regenerating summary...';
            statusElement.className = 'status-message thread-status text-info';
            statusElement.style.display = 'block';
            spinnerElement.style.display = 'inline-block';
            summaryElement.style.opacity = '0.5';
            fetch('/assignment/d313ce12b7/regenerate_summary', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ session_id: sessionId })
            })
            .then(response => response.json())
            .then(data => {
              spinnerElement.style.display = 'none';
              if (data.success) {
                summaryElement.innerHTML = data.content;
                summaryElement.style.opacity = '1';
                statusElement.textContent = data.message;
                statusElement.className = 'status-message thread-status success';
                attachButtonListeners(sessionId);
                setTimeout(() => { statusElement.style.display = 'none'; }, 3000);
              } else {
                summaryElement.style.opacity = '1';
                statusElement.textContent = data.message || 'Error regenerating summary';
                statusElement.className = 'status-message thread-status error';
                setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
              }
            })
            .catch(error => {
              spinnerElement.style.display = 'none';
              summaryElement.style.opacity = '1';
              statusElement.textContent = 'Error regenerating summary: ' + error;
              statusElement.className = 'status-message thread-status error';
              setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
            });
          }
        });
      }
    }
    function showSummaryStatus(sessionId, message, type) {
      const statusEl = document.getElementById(`summary-editor-status-${sessionId}`);
      statusEl.textContent = message;
      statusEl.className = `status-message ${type}`;
      statusEl.style.display = 'block';
      if (type === 'success') {
        setTimeout(() => { statusEl.style.display = 'none'; }, 3000);
      }
    }
  });
</script>

<!-- =====================
     Export/Share Functionality
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Export button
    const exportBtn = document.querySelector('a[href*="/export"]');
    if (exportBtn) {
      exportBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const currentTheme = localStorage.getItem('theme') === 'light' ? 'light-mode' : 'dark-mode';
        const exportUrl = new URL(this.href, window.location.origin);
        
        // Add selected histogram fields to export URL
        const selectedHistograms = getSelectedHistograms();
        if (selectedHistograms.length > 0) {
          exportUrl.searchParams.set('histograms', selectedHistograms.join(','));
        }
        
        exportUrl.searchParams.set('theme', currentTheme);
        window.location.href = exportUrl.toString();
      });
    }
    // Set theme class on HTML element for export mode
    if ('True' === 'True' && 'dark-mode') {
      document.documentElement.className = 'dark-mode';
    }
    // Share export button
    const shareExportBtn = document.getElementById('share-export-btn');
    if (shareExportBtn) {
      shareExportBtn.addEventListener('click', function(e) {
        e.preventDefault();
        shareExportBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
        shareExportBtn.disabled = true;
        const currentTheme = localStorage.getItem('theme') === 'light' ? 'light-mode' : 'dark-mode';
        
        // Add selected histogram fields to share request
        const selectedHistograms = getSelectedHistograms();
        
        fetch('/assignment/d313ce12b7/share_export', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            theme: currentTheme,
            selected_histograms: selectedHistograms
          })
        })
        .then(response => response.json())
        .then(data => {
          shareExportBtn.innerHTML = '<i class="fas fa-share-alt"></i> Share';
          shareExportBtn.disabled = false;
          if (data.success) {
            const modalHtml = `
              <div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content" style="background-color: var(--card-bg); color: var(--text-color);">
                    <div class="modal-header" style="border-color: var(--border-color);">
                      <h5 class="modal-title" id="shareModalLabel">Share Export</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: var(--text-color);">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <p>Your export has been saved. Share this link:</p>
                      <div class="input-group mb-3">
                        <input type="text" id="share-link" class="form-control" value="${data.share_url}" readonly style="background-color: var(--input-bg); color: var(--text-color); border-color: var(--border-color);">
                        <div class="input-group-append">
                          <button class="btn btn-primary" type="button" id="copy-link-btn">
                            <i class="fas fa-copy"></i> Copy
                          </button>
                        </div>
                      </div>
                      <div id="copy-feedback" class="text-success" style="display: none;">Link copied to clipboard!</div>
                    </div>
                    <div class="modal-footer" style="border-color: var(--border-color);">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <a href="${data.share_url}" target="_blank" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> Open
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            `;
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);
            $('#shareModal').modal('show');
            document.getElementById('copy-link-btn').addEventListener('click', function() {
              const shareLink = document.getElementById('share-link');
              shareLink.select();
              document.execCommand('copy');
              const copyFeedback = document.getElementById('copy-feedback');
              copyFeedback.style.display = 'block';
              setTimeout(() => { copyFeedback.style.display = 'none'; }, 3000);
            });
            $('#shareModal').on('hidden.bs.modal', function() {
              modalContainer.remove();
            });
          } else {
            alert('Error: ' + (data.message || 'Could not generate shared export'));
          }
        })
        .catch(error => {
          shareExportBtn.innerHTML = '<i class="fas fa-share-alt"></i> Share';
          shareExportBtn.disabled = false;
          alert('Error: Could not generate shared export');
          console.error('Error:', error);
        });
      });
    }
    
    // Helper function to get selected histograms
    function getSelectedHistograms() {
      const checkboxes = document.querySelectorAll('.export-histogram-checkbox:checked');
      return Array.from(checkboxes).map(cb => cb.getAttribute('data-field')).filter(Boolean);
    }
  });
</script>

<!-- =====================
     Histogram Selection for Export
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Handle the select/deselect all buttons
    const selectAllBtn = document.getElementById('select-all-histograms');
    const deselectAllBtn = document.getElementById('deselect-all-histograms');
    
    if (selectAllBtn) {
      selectAllBtn.addEventListener('click', function() {
        document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
          checkbox.checked = true;
          // Add a small animation to show the change
          const label = checkbox.nextElementSibling;
          if (label) {
            label.style.transition = 'color 0.3s ease';
            label.style.color = '#8a8aff';
            setTimeout(() => {
              label.style.color = '';
            }, 500);
          }
        });
        // Show visual feedback
        const originalText = selectAllBtn.innerHTML;
        selectAllBtn.innerHTML = '<i class="fas fa-check mr-1"></i> All Selected';
        setTimeout(() => {
          selectAllBtn.innerHTML = originalText;
        }, 1000);
        // Save selections to localStorage
        saveHistogramSelections();
      });
    }
    
    if (deselectAllBtn) {
      deselectAllBtn.addEventListener('click', function() {
        document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
          checkbox.checked = false;
          // Add a small animation to show the change
          const label = checkbox.nextElementSibling;
          if (label) {
            label.style.transition = 'color 0.3s ease';
            label.style.opacity = '0.7';
            setTimeout(() => {
              label.style.opacity = '';
            }, 500);
          }
        });
        // Show visual feedback
        const originalText = deselectAllBtn.innerHTML;
        deselectAllBtn.innerHTML = '<i class="fas fa-times mr-1"></i> All Deselected';
        setTimeout(() => {
          deselectAllBtn.innerHTML = originalText;
        }, 1000);
        // Save selections to localStorage
        saveHistogramSelections();
      });
    }
    
    // Initialize checkboxes from localStorage if available
    const savedSelections = localStorage.getItem('selected_histograms');
    if (savedSelections) {
      try {
        const selections = JSON.parse(savedSelections);
        document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
          const field = checkbox.getAttribute('data-field');
          if (field && selections.includes(field)) {
            checkbox.checked = true;
          }
        });
      } catch (e) {
        console.error('Error loading saved histogram selections:', e);
      }
    } else {
      // If no saved selections, select all by default
      document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
        checkbox.checked = true;
      });
      saveHistogramSelections();
    }
    
    // Save selections to localStorage when changed
    document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', saveHistogramSelections);
    });
    
    function saveHistogramSelections() {
      const selectedFields = Array.from(document.querySelectorAll('.export-histogram-checkbox:checked'))
        .map(cb => cb.getAttribute('data-field'))
        .filter(Boolean);
      
      localStorage.setItem('selected_histograms', JSON.stringify(selectedFields));
    }
  });
</script>

<!-- =====================
     Social Sharing Buttons
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('twitter-share')) {
      const pageUrl = encodeURIComponent(window.location.href);
      const shareMessage = encodeURIComponent("Check out the assignments my students just finished on Sway! The AI Guide killed it! 🤯");
      
      // X (formerly Twitter) sharing
      const xBtn = document.getElementById('twitter-share');
      xBtn.href = `https://x.com/intent/tweet?text=${shareMessage}&url=${pageUrl}`;
      xBtn.target = '_blank';
      xBtn.rel = 'noopener noreferrer';
      
      // Facebook sharing
      const facebookBtn = document.getElementById('facebook-share');
      facebookBtn.href = `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}&quote=${shareMessage}`;
      facebookBtn.target = '_blank';
      facebookBtn.rel = 'noopener noreferrer';
      
      // LinkedIn sharing
      const linkedinBtn = document.getElementById('linkedin-share');
      linkedinBtn.href = `https://www.linkedin.com/sharing/share-offsite/?url=${pageUrl}`;
      linkedinBtn.target = '_blank';
      linkedinBtn.rel = 'noopener noreferrer';
      
      // Instagram sharing (requires copy to clipboard)
      const instagramBtn = document.getElementById('instagram-share');
      instagramBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const textarea = document.createElement('textarea');
        textarea.value = `${shareMessage}\n\n${window.location.href}`;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('Link and message copied to clipboard. Paste this into Instagram to share!');
      });
    }
  });
</script>

<!-- =====================
     CSS for Status Messages and CodeMirror
     ===================== -->
<style>
  .status-message {
    margin-top: 15px;
    padding: 10px;
    border-radius: 6px;
  }
  .success {
    background-color: rgba(40, 167, 69, 0.2);
    border: 1px solid #28a745;
    color: #28a745;
  }
  .error {
    background-color: rgba(220, 53, 69, 0.2);
    border: 1px solid #dc3545;
    color: #dc3545;
  }
  .CodeMirror {
    height: auto;
    min-height: 300px;
    border-radius: 6px;
    font-family: 'Fira Code', 'Courier New', monospace;
    font-size: 14px;
    padding: 10px 0;
    margin-bottom: 20px;
  }
</style>
  <script src="/static/js/histogram-title-fixer.js"></script>
  
  <!-- Script for polished Show More/Fewer functionality in all modes -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Instructor Report Show More
      const setupReportShowMore = function() {
        const reportContent = document.getElementById('report-content');
        if (reportContent) {
          const headings = reportContent.querySelectorAll('h3');
          if (headings.length > 2) {
            const secondHeading = headings[1];
            const hiddenContentWrapper = document.createElement('div');
            hiddenContentWrapper.id = 'hidden-report-content';
            hiddenContentWrapper.className = 'collapsible-section collapsed';
            let currentNode = secondHeading.nextElementSibling;
            let nodesToMove = [];
            while (currentNode) {
              if (currentNode.tagName === 'H3' && currentNode !== secondHeading) {
                nodesToMove.push(currentNode);
              } else if (nodesToMove.length > 0) {
                nodesToMove.push(currentNode);
              }
              currentNode = currentNode.nextElementSibling;
            }
            nodesToMove.forEach(node => { hiddenContentWrapper.appendChild(node); });
            reportContent.appendChild(hiddenContentWrapper);
            
            const showMoreBtn = document.createElement('button');
            showMoreBtn.className = 'btn btn-thread-toggle show-toggle-btn';
            showMoreBtn.innerHTML = 'Continue Reading <i class="fas fa-chevron-down"></i>';
            showMoreBtn.style.marginTop = '1.5rem';
            reportContent.insertBefore(showMoreBtn, hiddenContentWrapper);
            
            // Add a spacer div ABOVE the Continue Reading button for extra spacing
            const spacerDiv = document.createElement('div');
            spacerDiv.style.height = '1rem';
            spacerDiv.style.clear = 'both';
            reportContent.insertBefore(spacerDiv, showMoreBtn);
            
            showMoreBtn.addEventListener('click', function() {
              const expanded = hiddenContentWrapper.classList.contains('collapsed');
              if (expanded) {
                hiddenContentWrapper.classList.remove('collapsed');
                showMoreBtn.classList.add('expanded');
                showMoreBtn.innerHTML = 'Show Less <i class="fas fa-chevron-up"></i>';
              } else {
                hiddenContentWrapper.classList.add('collapsed');
                showMoreBtn.classList.remove('expanded');
                showMoreBtn.innerHTML = 'Continue Reading <i class="fas fa-chevron-down"></i>';
              }
            });
          }
        }
      };
      // Threads Masonry Show More
      const setupThreadsShowMore = function() {
        const masonryGrid = document.querySelector('.masonry-grid');
        if (!masonryGrid || masonryGrid.children.length <= 2) {
          return; // Do nothing if 2 or fewer items
        }

        const masonryItems = Array.from(masonryGrid.querySelectorAll('.masonry-item'));
        const itemsToShowInitially = 2;

        const performHideAndSetupButtons = () => {
          // Hide items beyond the initial set
          for (let i = itemsToShowInitially; i < masonryItems.length; i++) {
            if (masonryItems[i]) { // Ensure item exists
              masonryItems[i].classList.add('hidden-thread');
            }
          }

          const hiddenItemCount = masonryGrid.querySelectorAll('.masonry-item.hidden-thread').length;
          if (hiddenItemCount === 0 && masonryItems.length > itemsToShowInitially) {
            // Fallback or logging if hiding didn't work as expected but should have
            console.warn("Masonry items were expected to be hidden but were not.");
            // Potentially, if itemsToShowInitially is high, this might be normal if total items < itemsToShowInitially
          }
          
          // Only proceed with buttons if there are actually items to unhide
          if (masonryItems.length <= itemsToShowInitially) {
            return;
          }

          const showMoreThreadsBtn = document.createElement('button');
          showMoreThreadsBtn.className = 'btn btn-thread-toggle show-toggle-btn';

          const updateShowMoreText = () => {
            const currentHiddenCount = masonryGrid.querySelectorAll('.masonry-item.hidden-thread').length;
            showMoreThreadsBtn.innerHTML = `Show ${currentHiddenCount} More Threads`;
            // Show button only if there are hidden threads
            showMoreThreadsBtn.style.display = currentHiddenCount > 0 ? 'block' : 'none';
          };
          
          const showFewerThreadsBtn = document.createElement('button');
          showFewerThreadsBtn.className = 'btn btn-thread-toggle show-toggle-btn';
          showFewerThreadsBtn.innerHTML = 'Show Fewer Threads';
          showFewerThreadsBtn.style.display = 'none'; // Initially hidden

          const threadListSection = document.querySelector('.thread-list');
          let spacerDiv;
          if (threadListSection) {
            spacerDiv = document.createElement('div');
            spacerDiv.style.height = '4px';
            spacerDiv.style.clear = 'both';
            spacerDiv.style.display = 'none';
            threadListSection.appendChild(spacerDiv);
            threadListSection.appendChild(showFewerThreadsBtn);
          }
          
          // Insert Show More button only if there's a chance it will be displayed
          if (masonryItems.length > itemsToShowInitially) {
             masonryGrid.parentNode.insertBefore(showMoreThreadsBtn, masonryGrid.nextSibling);
             updateShowMoreText(); // Set initial text and visibility
          }


          showMoreThreadsBtn.addEventListener('click', function() {
            masonryItems.forEach(item => item.classList.remove('hidden-thread'));
            updateShowMoreText(); // Button should hide itself
            showFewerThreadsBtn.style.display = 'block';
            if (spacerDiv) spacerDiv.style.display = 'block';
          });

          showFewerThreadsBtn.addEventListener('click', function() {
            for (let i = itemsToShowInitially; i < masonryItems.length; i++) {
              if (masonryItems[i]) {
                masonryItems[i].classList.add('hidden-thread');
              }
            }
            updateShowMoreText(); // Button should reappear and update count
            showFewerThreadsBtn.style.display = 'none';
            if (spacerDiv) spacerDiv.style.display = 'none';
            
            const chatThreadsSectionTitle = document.querySelector('h5.section-title .fa-comments');
            if (chatThreadsSectionTitle && chatThreadsSectionTitle.closest('h5.section-title')) {
              chatThreadsSectionTitle.closest('h5.section-title').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
              masonryGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          });
        };

        if (window.requestAnimationFrame) {
          window.requestAnimationFrame(() => {
            setTimeout(performHideAndSetupButtons, 75); // Delay to allow layout to settle
          });
        } else {
          setTimeout(performHideAndSetupButtons, 75); // Fallback
        }
      };

      setupReportShowMore();
      setupThreadsShowMore();

      // Opinion Distribution Show More/Less
      const histogramCards = document.querySelectorAll('.opinion-histogram-card');
      const showMoreBtn = document.getElementById('show-more-histograms-btn');
      const showFewerBtn = document.getElementById('show-fewer-histograms-btn');
      const maxVisible = 6;
      if (histogramCards.length > maxVisible) {
        for (let i = maxVisible; i < histogramCards.length; i++) {
          histogramCards[i].classList.add('hidden-histogram');
        }
        showMoreBtn.style.display = 'inline-block';
      }
      if (showMoreBtn && showFewerBtn) {
        showMoreBtn.addEventListener('click', function() {
          for (let i = maxVisible; i < histogramCards.length; i++) {
            histogramCards[i].classList.remove('hidden-histogram');
          }
          showMoreBtn.style.display = 'none';
          showFewerBtn.style.display = 'inline-block';
        });
        showFewerBtn.addEventListener('click', function() {
          for (let i = maxVisible; i < histogramCards.length; i++) {
            histogramCards[i].classList.add('hidden-histogram');
          }
          showMoreBtn.style.display = 'inline-block';
          showFewerBtn.style.display = 'none';
          // Scroll to the top of the histogram section
          const sectionTitle = document.querySelector('.section-title .fa-chart-bar');
          if (sectionTitle && sectionTitle.closest('.section-title')) {
            sectionTitle.closest('.section-title').scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      }
    });
  </script>
  
  <!-- Script to disable hover animations -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Create a style element
      var style = document.createElement('style');
      
      // Add CSS rules to disable hover animations
      style.innerHTML = `
        .card:hover, 
        .thread-item:hover, 
        .histogram-container:hover, 
        .histogram-bar:hover, 
        .histogram-card:hover {
          transform: none !important;
        }
      `;
      
      // Append the style element to the head
      document.head.appendChild(style);
    });
  </script>
  </div> <!-- Close content-wrapper -->
</body>
</html>