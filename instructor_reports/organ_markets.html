<!doctype html>
<html lang="en" class="dark-mode">
<head>
  <script>
    // Set the correct Bootswatch theme based on theme_mode immediately
    window.themeMode = 'dark-mode';
    if (window.themeMode === 'light-mode') {
      document.write('<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/flatly/bootstrap.min.css" id="theme-css">');
    } else {
      document.write('<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/darkly/bootstrap.min.css" id="theme-css">');
    }
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Legalizing Kidney Markets Versus Prohibiting Heart Sales and Protecting Weak Agents</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  
<style>
    :root {
      /* Darkened dark mode theme */
      --bg-color: #050505;          /* Near-black background */
      --card-bg: #0e0e1a;           /* Deeper navy card */
      --card-header-bg: #141422;     /* Darker header */
      --text-color: #e4e6eb;
      --muted-text-color: #a9adc1;
      --border-color: #1f1f2d;
      --button-bg: #252538;
      --button-hover-bg: #3a3a59; 
      --primary-color: #8a8aff;
      --input-bg: #252538;
      --message-left-bg: #141422;
      --message-right-bg: #0e0e1a;
    }

    /* Light mode theme variables */
    html.light-mode {
      /* Base colors */
      --bg-color: #f5f7fa;
      --card-bg: #ffffff;
      --card-header-bg: #f0f5fc;
      --text-color: #2c3e50;
      --muted-text-color: #5a6a7e;
      --border-color: #d1d9e6;
      
      /* UI elements - using purple Sway theme colors */
      --button-bg: #eef2f7; /* keeping grey for basic buttons */
      --button-hover-bg: #d9e2ec; /* keeping grey hover for basic buttons */
      --primary-color: #23004D; /* new purple theme color */
      --input-bg: #ffffff;
      
      /* Message colors */
      --message-left-bg: #eef2f7;
      --message-right-bg: #e6f0ff;
    }

    /* Additional light mode specific overrides for purple theme */
    html.light-mode .card {
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    html.light-mode .card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    html.light-mode .card-header {
      border-bottom: 1px solid var(--border-color);
    }

    /* Purple theme for headings and section titles */
    html.light-mode .section-title {
      border-bottom: 1px solid #23004D;
      color: #23004D;
    }

    html.light-mode .section-title i {
      color: #23004D;
    }

    html.light-mode .markdown-content h1,
    html.light-mode .markdown-content h2,
    html.light-mode .markdown-content h3,
    html.light-mode .markdown-content h4,
    html.light-mode .markdown-content h5,
    html.light-mode .markdown-content h6 {
      color: #23004D;
    }

    /* Purple theme for icons */
    html.light-mode .fas,
    html.light-mode .far,
    html.light-mode .fab {
      color: #23004D;
    }

    /* Keep header buttons grey */
    html.light-mode .header-actions .back-btn i,
    html.light-mode .header-actions .nav-btn i {
      color: inherit;
    }

    /* Thread items */
    html.light-mode .thread-item {
      background-color: #ffffff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }

    html.light-mode .thread-item:hover {
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      border: 2px solid #23004D;
    }

    html.light-mode .thread-item a {
      color: #23004D;
    }

    /* Badges and info elements */
    html.light-mode .badge-info {
      background-color: #e6e0f0;
      color: #23004D;
    }

    html.light-mode .text-info {
      color: #23004D !important;
    }

    /* Buttons with purple theme */
    html.light-mode .btn-primary {
      background-color: #23004D;
      border-color: #23004D;
    }

    html.light-mode .btn-primary:hover {
      background-color: #380080;
      border-color: #380080;
    }

    /* Content elements */
    html.light-mode .markdown-content code,
    html.light-mode .markdown-content pre {
      background-color: #f0f3f8;
      border: 1px solid #e0e5ee;
    }

    html.light-mode .markdown-content blockquote {
      background-color: #f0f3f8;
      border-left: 4px solid #23004D;
    }

    html.light-mode .markdown-content a {
      color: #23004D;
    }

    /* Info boxes and containers */
    html.light-mode .info-box {
      background-color: #f8fafd;
      border: 1px solid var(--border-color);
    }

    /* Topic labels and special text */
    html.light-mode .text-info {
      color: #23004D !important;
    }

    html.light-mode .col-label {
      color: #23004D;
    }

    /* Thread summary section styling */
    html.light-mode .thread-summary strong {
      color: #23004D;
    }

    /* Keep the orange buttons distinct */
    html.light-mode .btn-orange {
      background-color: #ff7200;
      border-color: #ff7200;
    }

    html.light-mode .btn-orange:hover {
      background-color: #e66800;
      border-color: #e66800;
    }

    /* Theme toggle styling */
    html.light-mode .theme-toggle-slider {
      background-color: #d9e2ec;
    }

    html.light-mode .theme-toggle-slider:before {
      background-color: #ffffff;
    }

    html.light-mode input:checked + .theme-toggle-slider {
      background-color: #23004D;
    }

    /* Pagination with purple theme */
    html.light-mode .page-item.active .page-link {
      background-color: #23004D;
      border-color: #23004D;
    }

    html.light-mode .page-link:hover {
      color: #23004D;
    }

    /* Apply theme variables to elements */
    html {
      margin: 0;
      padding: 0;
      border: none;
      outline: none;
    }
    
    body { 
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      transition: background-color 0.3s ease;
      border: none; /* Remove any borders */
      outline: none; /* Remove any outlines */
    }
    .dashboard-container {
      padding: 10px;
      max-width: 100%;
      margin: 0 auto;
      border: none;
      outline: none;
    }
    @media (min-width: 576px) {
      .dashboard-container {
        padding: 15px;
      }
    }
    @media (min-width: 768px) {
      .dashboard-container {
        padding: 25px;
        margin-left: 0;
        margin-right: 0;
      }
    }
    @media (min-width: 1200px) {
      .dashboard-container {
        margin-left: 0;
        margin-right: 0;
      }
    }
    .card {
      background-color: var(--card-bg);
      border: none;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      margin-bottom: 25px;
      transition: background-color 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    /* No hover effect for section title cards */
    .card.no-hover:hover {
      transform: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .card-header {
      font-size: 1.2rem;
      font-weight: 500;
      background-color: var(--card-header-bg);
      border-bottom: 1px solid var(--border-color);
      border-radius: 10px 10px 0 0 !important;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      transition: background-color 0.3s ease;
    }
    @media (min-width: 576px) {
      .card-header {
        font-size: 1.4rem;
        padding: 15px 20px;
      }
    }
    .card-title {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 10px;
      width: 100%;
    }
    
    .card-title .title-text {
      display: flex;
      align-items: center;
    }
    
    .card-title .badge {
      margin-left: 10px;
    }
    
    .generated-title {
      font-size: 1.68rem;
      font-weight: 600;
      margin-top: 5px;
      font-style: italic;
      margin-bottom: 5px;
      color: var(--primary-color) !important;
    }
    
    @media (min-width: 768px) {
      .card-title {
        margin-bottom: 0;
        width: auto;
      }
    }
    .card-body {
      padding: 15px;
      transition: background-color 0.3s ease;
    }
    @media (min-width: 576px) {
      .card-body {
        padding: 20px 25px;
      }
    }
    .section-title {
      padding-left: 15px;
      margin-top: 20px;
      font-size: 1.2rem;
      font-weight: 500;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      flex-wrap: wrap;
      transition: border-color 0.3s ease, color 0.3s ease;
    }
    .section-title i {
      margin-right: 10px;
    }
    .section-title .title-text {
      display: flex;
      align-items: center;
    }
    .section-title .actions {
      margin-left: auto;
      margin-top: 10px;
      width: 100%;
      text-align: right;
    }
    @media (min-width: 768px) {
      .section-title .actions {
        margin-top: 0;
        width: auto;
      }
    }
    .detail-item {
      margin-bottom: 15px;
      padding: 10px 15px;
      background-color: var(--card-header-bg);
      border-radius: 6px;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      transition: background-color 0.3s ease;
    }
    .detail-item strong {
      min-width: 140px;
      color: var(--muted-text-color);
    }
    .list-group-item {
      background-color: var(--card-header-bg);
      color: var(--text-color);
      border: none;
      border-radius: 6px;
      margin-bottom: 8px;
      transition: background-color 0.2s, color 0.3s ease;
    }
    .list-group-item:hover {
      background-color: var(--button-hover-bg);
    }
    .badge {
      font-size: 0.7em;
      padding: 6px 8px;
      border-radius: 50px;
      font-weight: 500;
      margin-left: 10px;
    }
    .badge-available {
      background-color: #28a745;
      color: #fff;
    }
    .badge-active {
      background-color: #007bff;
      color: #fff;
    }
    .badge-completed {
      background-color: #6c757d;
      color: #fff;
    }
    .badge-cancelled {
      background-color: #dc3545;
      color: #fff;
    }
    .back-btn {
      background-color: var(--button-bg);
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      transition: background-color 0.2s, color 0.3s ease;
      color: var(--text-color);
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }
    @media (min-width: 768px) {
      .back-btn {
        margin-bottom: 0;
      }
    }
    .back-btn i {
      margin-right: 8px;
    }
    .back-btn:hover {
      background-color: var(--button-hover-bg);
      color: var(--text-color);
      text-decoration: none;
    }
    .header-actions {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
      width: 100%;
    }
    @media (min-width: 768px) {
      .header-actions {
        width: auto;
      }
    }
    .refresh-button {
      margin-right: 16px;
      display: flex;
      align-items: center;
    }
    .icon-btn {
      background: none;
      border: none;
      color: #8a8aff;
      font-size: 1.2rem;
      cursor: pointer;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
    }
    .icon-btn:hover {
      background-color: rgba(138, 138, 255, 0.1);
    }
    .icon-btn:focus {
      outline: none;
    }
    .icon-btn:active {
      transform: scale(0.9);
    }
    .info-box {
      padding: 15px;
      background-color: var(--card-header-bg);
      border-radius: 8px;
      margin-bottom: 20px;
      transition: background-color 0.3s ease;
    }
    .col-label {
      color: var(--muted-text-color);
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .col-value {
      font-weight: 400;
    }
    .utc-time {
      opacity: 0;
      transition: opacity 0.3s;
    }
    .local-time {
      opacity: 1;
    }
    /* New Chat Threads Section Styling */
    .thread-list {
      margin-top: 15px;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 15px;
    }
    @media (min-width: 768px) {
      .thread-list {
        flex-wrap: nowrap;
      }
      .thread-list-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: calc(50% - 8px);
      }
    }
    .thread-card {
      margin-bottom: 0 !important;
    }
    .thread-item {
      display: flex;
      flex-direction: column;
      width: 100%;
      opacity: 1; /* Ensure visibility */
      padding: 15px;
      background-color: var(--card-bg);
      border-radius: 12px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      border: 2px solid transparent;
    }
    .thread-item:hover {
      background-color: var(--card-bg);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      border: 2px solid transparent; /* Remove orange border */
    }
    .thread-item.visible {
      opacity: 1;
    }
    .thread-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .thread-header .thread-actions {
      display: flex;
      gap: 6px;
      white-space: nowrap;
    }
    .thread-item a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
      display: inline-block;
      margin-bottom: 5px;
      transition: color 0.3s ease;
    }
    .thread-item a:hover {
      text-decoration: underline;
    }
    .thread-summary {
      font-size: 0.9em;
      color: var(--muted-text-color);
      margin-top: 5px;
      margin-left: 10px;
      line-height: 1.5;
      transition: color 0.3s ease;
    }
    .thread-summary p {
      margin-bottom: 0.5em;
    }
    .thread-summary ul,
    .thread-summary ol {
      margin-top: 0.5em;
      margin-bottom: 0.5em;
      padding-left: 1.5em;
    }
    .thread-summary li {
      margin-bottom: 0.3em;
    }
    .thread-summary a {
      color: var(--primary-color);
    }
    .thread-summary code {
      background-color: var(--card-header-bg);
      border-radius: 3px;
      padding: 2px 5px;
      font-family: monospace;
      transition: background-color 0.3s ease;
    }
    .thread-status {
      font-size: 0.8em;
      margin-top: 3px;
      margin-left: 10px;
    }
    /* Markdown content styling */
    .markdown-content {
      line-height: 1.6;
      overflow-wrap: break-word;
      word-wrap: break-word;
    }
    .markdown-content h1,
    .markdown-content h2,
    .markdown-content h3,
    .markdown-content h4,
    .markdown-content h5,
    .markdown-content h6 {
      margin-top: 1.5em;
      margin-bottom: 0.75em;
      color: var(--primary-color);
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .markdown-content h1 {
      font-size: 1.7em;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 0.3em;
      transition: border-color 0.3s ease;
    }
    .markdown-content h2 {
      font-size: 1.5em;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 0.3em;
      transition: border-color 0.3s ease;
    }
    .markdown-content h3 {
      font-size: 1.3em;
    }
    .markdown-content h4 {
      font-size: 1.1em;
    }
    .markdown-content p {
      margin-bottom: 1em;
    }
    .markdown-content ul, 
    .markdown-content ol {
      margin-bottom: 1em;
      padding-left: 2em;
    }
    .markdown-content li {
      margin-bottom: 0.5em;
    }
    /* Proper nested list styling */
    .markdown-content ul ul,
    .markdown-content ul ol,
    .markdown-content ol ul,
    .markdown-content ol ol {
      margin-top: 0.5em;
      margin-bottom: 0.5em;
    }
    .markdown-content li > ul,
    .markdown-content li > ol {
      margin-left: 1em;
    }
    .markdown-content blockquote {
      padding: 0.5em 1em;
      margin-left: 0;
      margin-right: 0;
      background-color: var(--card-header-bg);
      border-left: 4px solid var(--primary-color);
      margin-bottom: 1em;
      transition: background-color 0.3s ease, border-left-color 0.3s ease;
    }
    .markdown-content code {
      background-color: var(--card-header-bg);
      border-radius: 3px;
      padding: 2px 5px;
      font-family: monospace;
      transition: background-color 0.3s ease;
    }
    .markdown-content pre {
      background-color: var(--card-header-bg);
      border-radius: 5px;
      padding: 1em;
      overflow-x: auto;
      margin-bottom: 1em;
      transition: background-color 0.3s ease;
    }
    .markdown-content table {
      border-collapse: collapse;
      margin-bottom: 1em;
      width: 100%;
    }
    .markdown-content table th,
    .markdown-content table td {
      border: 1px solid var(--border-color);
      padding: 0.5em;
      transition: border-color 0.3s ease;
    }
    .markdown-content table th {
      background-color: var(--card-header-bg);
      text-align: left;
      transition: background-color 0.3s ease;
    }
    .markdown-content strong {
      font-weight: 600;
      color: var(--text-color);
      transition: color 0.3s ease;
    }
    .markdown-content em {
      font-style: italic;
    }
    /* Mobile-specific styles */
    @media (max-width: 767.98px) {
      .row:not(.mb-3) {
        margin-right: -5px;
        margin-left: -5px;
      }
      .row:not(.mb-3) > .col, 
      .row:not(.mb-3) > [class*="col-"] {
        padding-right: 5px;
        padding-left: 5px;
      }
      .btn {
        padding: 0.375rem 0.5rem;
      }
      .btn-orange {
        width: 100%;
        margin-bottom: 10px;
      }
      #report-btn, #generate-btn, #cancel-btn {
        width: 100%;
      }
      /* Hide theme toggle and edit prompts in mobile */
      .theme-toggle {
        display: none !important;
      }
      a.back-btn[href*="edit_prompts"] {
        display: none !important;
      }
      #share-export-btn {
        margin-right: 0 !important;
      }
    }
    /* End markdown styling */

    /* Limit Topics container height to match the Info card */
    #topics-container {
      max-height: 420px;
      min-height: 420px;
      overflow-y: auto;
    }
    /* Smaller height for export mode */
    html.export-mode #topics-container {
      max-height: 345px;
      min-height: 345px;
    }

    /* New Opinion Histograms styling */
    .histogram-container {
      background-color: #090118 !important;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .histogram-container:hover {
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .histogram-container img {
      max-width: 100%;
      border-radius: 6px;
      display: block;
      margin: 0 auto;
    }
    
    .histogram-bar {
      background: linear-gradient(180deg, #a9a9ff 0%, #8a8aff 100%);
      border-radius: 4px 4px 6px 6px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      box-shadow: 0 2px 6px rgba(138,138,255,0.2);
    }
    .histogram-bar:hover {
      box-shadow: 0 4px 8px rgba(138,138,255,0.4);
    }
    .histogram-axis-line {
      background: rgba(169,173,193,0.4);
      width: 2px;
    }
    .histogram-grid-line {
      background: rgba(169,173,193,0.13);
      height: 1px;
    }
    .histogram-container .axis-label {
      color: #a9adc1;
      font-size: 0.95rem;
      opacity: 0.85;
    }
    .histogram-container .x-label {
      color: #a9adc1;
      font-size: 1.1rem;
      font-weight: 500;
      margin-top: 0.35rem;
    }
    .histogram-container .card-body {
      padding: 1.25rem;
    }
    
    @media (max-width: 767.98px) {
      .col-md-6.col-lg-4.mb-4 {
        padding-left: 10px;
        padding-right: 10px;
      }
      .histogram-container {
        padding: 10px;
      }
    }

    /* Theme toggle switch styling */
    .theme-toggle {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    .theme-toggle-switch {
      position: relative;
      display: inline-block;
      width: 52px;
      height: 26px;
    }
    
    .theme-toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .theme-toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #2d2d43;
      transition: .4s;
      border-radius: 34px;
    }
    
    .theme-toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .theme-toggle-slider {
      background-color: #4a4a69;
    }
    
    input:checked + .theme-toggle-slider:before {
      transform: translateX(26px);
    }
    
    .theme-toggle-icon {
      color: var(--text-color);
      font-size: 16px;
    }

    /* Add social sharing buttons styling */
    .social-share-container {
      background-color: var(--card-header-bg);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
    }
    .social-share-title {
      font-size: 1.1rem;
      margin-bottom: 12px;
      color: var(--primary-color);
    }
    .social-share-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
    }
    .social-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      border-radius: 5px;
      color: white;
      font-weight: 500;
      text-decoration: none;
      transition: opacity 0.2s;
      font-size: 0.9rem;
    }
    .social-btn:hover {
      opacity: 0.85;
      text-decoration: none;
      color: white;
    }
    .social-btn i {
      margin-right: 6px;
      font-size: 0.9rem;
    }
    .btn-twitter {
      background-color: #1DA1F2;
    }
    .btn-facebook {
      background-color: #4267B2;
    }
    .btn-linkedin {
      background-color: #0077B5;
    }
    .btn-instagram {
      background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
    }
    @media (max-width: 576px) {
      .social-btn {
        padding: 4px 9px;
        font-size: 0.8rem;
      }
      .social-btn i {
        margin-right: 4px;
      }
    }

    .full-width-page {
      width: 100%;
      max-width: 1420px;
      margin: 0 auto;
      padding-left: 24px;
      padding-right: 24px;
    }
    @media (min-width: 576px) {
      .full-width-page {
        padding-left: 50px;
        padding-right: 50px;
      }
    }
    @media (min-width: 992px) {
      .full-width-page {
        padding-left: 64px;
        padding-right: 64px;
      }
    }

    /* Histogram card styling - more aggressive fixes */
    .histogram-card {
      background-color: #070113 !important;
      border: none; 
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      margin-bottom: 0;
      overflow: hidden;
    }

    .histogram-card:hover {
      box-shadow: 0 7px 15px rgba(0,0,0,0.25);
    }

    .histogram-card .card-body {
      padding: 8px 0 !important;
    }

    /* Target histogram SVG elements directly */
    .histogram-card svg {
      max-width: 100% !important;
      margin-left: -20px !important; /* Pull SVG to the left */
      width: calc(100% + 20px) !important; /* Compensate for negative margin */
    }

    /* More aggressive targeting for histogram titles */
    .histogram-card h3,
    .histogram-card .x-label,
    .histogram-card text.title,
    .histogram-card [class*="title"],
    .histogram-card text[font-size="14px"],
    .histogram-card text[font-weight="bold"] {
      text-transform: capitalize !important;
      font-size: 1.15rem !important;
      font-weight: 600 !important;
      color: var(--primary-color) !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      max-width: 95% !important;
      display: block !important;
    }

    /* Add text truncation to histogram title element specifically */
    .histogram-card .histogram-content svg text[y="30"],
    .histogram-card .histogram-content svg text.title {
      text-overflow: ellipsis !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      max-width: 250px !important;
    }

    /* Target mean text specifically */
    .histogram-card .mean-text,
    .histogram-card text[y="300"],
    .histogram-card text:last-of-type,
    .histogram-card text[font-size="12px"] {
      font-size: 0.9rem !important;
    }

    /* Add italicized m= to mean values with several selectors to catch them */
    .histogram-card .mean-text::before,
    .histogram-card text[y="300"]::before,
    .histogram-card text:last-of-type::before {
      content: "m = ";
      font-style: italic;
    }

    @media (max-width: 767.98px) {
      .histogram-card .card-body {
        padding: 8px 0 !important;
      }
    }

    /* Card with no hover effects */
    .no-hover {
      transition: background-color 0.3s ease !important;
    }

    .no-hover:hover {
      transform: none !important;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2) !important;
    }

    .thread-heading {
      color: var(--primary-color) !important;
      font-weight: 600;
    }

    /* Truncate long histogram HTML titles with ellipsis */
    .histogram-title,
    .histogram-card [style*="font-size:1.25rem"] {
      font-size: 1rem !important;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: block;
      max-width: 95%;
    }

    /* Hide histogram cards that only contain "No data" text */
    .histogram-card .histogram-content:only-child:has(> div.text-muted:only-child:contains("No data")),
    .card-body .histogram-content:only-child:has(> div.text-muted:only-child:contains("No data")),
    .histogram-content:has(> div.text-muted:only-child:contains("No data")) {
      display: none !important;
    }
    
    /* Also hide the parent cards when they only contain "No data" content */
    .histogram-card:has(.histogram-content:only-child > div.text-muted:only-child:contains("No data")),
    .card-body:has(.histogram-content:only-child > div.text-muted:only-child:contains("No data")) {
      display: none !important;
    }
    
    /* Hide the entire column if it only contains a "No data" card */
    .col-md-6:has(.card.histogram-card:only-child:has(.histogram-content > div.text-muted:only-child:contains("No data"))),
    .col-lg-4:has(.card.histogram-card:only-child:has(.histogram-content > div.text-muted:only-child:contains("No data"))) {
      display: none !important;
    }

    /* Bootstrap Histogram Styles */
    .histogram-container {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        width: 100%;
        height: 100%;
        position: relative;
    }
    
    .histogram-bar-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100%;
        padding: 0 2px;
    }
    
    .histogram-bar {
        width: 80%;
        transition: background-color 0.2s ease;
        border-radius: 3px 3px 0 0;
    }
    
    .histogram-bar:hover {
        background-color: #a5a5ff !important;
    }
    
    .histogram-label {
        margin-top: 5px;
        font-size: 11px;
        text-align: center;
    }
    
    .histogram-stats {
        margin-top: 10px;
        text-align: center;
    }
    
    /* Light mode overrides for histograms */
    html.light-mode .histogram-bar {
        background-color: #6a6ae6 !important;
    }
    
    html.light-mode .histogram-bar:hover {
        background-color: #8a8aff !important;
    }

    /* Histogram Checkbox Styles */
    .histogram-export-checkbox {
        position: absolute;
        bottom: 8px;
        right: 8px;
        z-index: 2;
        opacity: 0.6;
        transform: translateY(0);
        transition: opacity 0.2s ease, transform 0.2s ease;
    }
    
    .histogram-export-checkbox:hover {
        opacity: 1;
        transform: translateY(-2px);
    }
    
    .histogram-export-checkbox input[type="checkbox"] {
        margin-right: 4px;
        cursor: pointer;
        accent-color: var(--card-bg); /* Match card background for subtlety */
        opacity: 0.5;
        transition: opacity 0.2s;
    }
    
    .histogram-export-checkbox input[type="checkbox"]:hover,
    .histogram-export-checkbox input[type="checkbox"]:focus {
        opacity: 0.85;
    }
    
    .histogram-export-checkbox label {
        font-size: 0.75rem;
        cursor: pointer;
        margin: 0;
        color: var(--muted-text-color);
    }
    
    /* Make the card position relative so absolute positioned checkbox works */
    .card.thread-card .card-body {
        position: relative;
    }
    
    /* Highlight the checkbox when checked */
    .histogram-export-checkbox input[type="checkbox"]:checked + label {
        color: var(--primary-color);
        font-weight: 500;
    }

    .card.thread-card .card-header {
      background-color: #070113 !important;
    }
</style>
  <style>
    /* Global color fixes */
    body, html {
      min-height: 100vh;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      background-color: #000000; /* Default to black for dark mode */
    }
    
    /* Override for light mode */
    html.light-mode, 
    body.light-mode {
      background-color: white;
    }
    
    /* Ensure all content containers have proper width */
    .container, 
    .container-fluid, 
    .row {
      max-width: 100%;
    }
    
    /* Eliminate any unwanted margins on containers */
    .row {
      margin-left: 0;
      margin-right: 0;
    }
    
    .full-width-page {
      width: 100%;
      max-width: 100vw;
      overflow-x: hidden;
      box-sizing: border-box;
    }
    
    /* Apple-inspired font styling */
    body, button, input, select, textarea {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    h1, h2, h3, h4, h5, h6, .section-title, .generated-title {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-weight: 600;
      letter-spacing: +0.005em;
    }
    
    /* Custom styles for floating thread items */
    .card.no-hover:hover {
      transform: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .thread-list {
      margin-top: 15px;
      position: relative;
      display: block;
      clear: both;
      margin-bottom: 10px;
    }
    
    /* Masonry layout using columns */
    .masonry-grid {
      column-count: 2;
      column-gap: 1.5rem;
      width: 100%;
      margin-bottom: 8px;
    }
    
    @media (max-width: 767px) {
      .masonry-grid {
        column-count: 1;
      }
    }
    
    .masonry-item {
      break-inside: avoid;
      margin-bottom: 1.5rem;
      display: block;
    }
    
    /* Items in the masonry grid */
    .masonry-grid .masonry-item {
      break-inside: avoid;
      margin-bottom: 1.5rem;
      display: block;
    }
    
    /* Make sure thread cards in masonry layout have required styles */
    .masonry-grid .card.thread-card, .card.thread-card {
      background: none !important;
      border: 1px solid var(--thread-card-border, #313131) !important;
      border-radius: 12px !important;
      box-shadow: none !important;
      transition: border-color 0.2s;
    }
    
    /* Dark mode border override */
    body.dark-mode .masonry-grid .card.thread-card,
    body.dark-mode .card.thread-card {
      border-color: #23263a !important;
    }
    
    /* Override any position:relative that may be applied to .card-body elsewhere */
    .masonry-grid .card.thread-card .card-body {
      position: static;
    }
    
    .masonry-grid .card.thread-card:hover {
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }
    
    .masonry-item.hidden-thread {
      visibility: hidden !important;
      opacity: 0 !important;
      height: 0 !important;
      padding-top: 0 !important;
      padding-bottom: 0 !important;
      margin-top: 0 !important;
      margin-bottom: 0 !important;
      border-top-width: 0 !important;
      border-bottom-width: 0 !important;
      overflow: hidden !important;
      pointer-events: none !important;
    }
    
    .show-toggle-btn {
      display: block;
      margin: 30px auto 10px auto;
      min-width: 220px;
      font-weight: 500;
      transition: background 0.2s, color 0.2s;
    }
    .show-toggle-btn i {
      margin-left: 8px;
      transition: transform 0.2s;
    }
    .show-toggle-btn.expanded i {
      transform: rotate(180deg);
    }
    .collapsible-section {
      transition: max-height 0.4s cubic-bezier(0.4,0,0.2,1), opacity 0.4s;
      overflow: hidden;
      opacity: 1;
      max-height: 2000px; /* Large enough for most content */
    }
    .collapsible-section.collapsed {
      max-height: 0 !important;
      opacity: 0;
      pointer-events: none;
    }
    /* Premium title styling with maximum specificity to override any other styles */
    html body .generated-title,
    html[class] body .generated-title,
    body .generated-title.text-info,
    .full-width-page .generated-title,
    .generated-title {
      font-size: 2.5rem !important;
      line-height: 1.2 !important;
      margin-top: 2.5rem !important;
      margin-bottom: 1rem !important;
      font-weight: 600;
      color: white !important;
      text-shadow: 0 1px 3px rgba(0,0,0,0.15);
      letter-spacing: -0.0025em;
      display: block;
      position: relative;
      max-width: 94%;
      padding-bottom: 0.5rem;
      font-style: normal !important; /* Force normal style, no italics */
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif !important;
    }
    
    .generated-title::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 8rem;
      height: 3px;
      background: white;
      opacity: 0.7;
      border-radius: 2px;
    }
    
    /* Enhanced styling for better title visibility */
    .dark-mode .generated-title {
      text-shadow: 0 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(0,0,0,0.1);
    }
    
    /* Light mode title styling */
    .light-mode .generated-title {
      color: #4750c5 !important;
      text-shadow: none;
    }
    
    /* Adjust underline color in light mode */
    .light-mode .generated-title::after {
      background: #4750c5;
      opacity: 0.5;
    }
    
    /* Fix for pure black background in dark mode - only targeting page containers */
    body.dark-mode,
    html.dark-mode,
    .dark-mode .full-width-page {
      background-color: #000000 !important;
    }
    
    /* Explicitly exempt chart elements from background override */
    .dark-mode .progress,
    .dark-mode .progress-bar,
    .dark-mode .bg-success,
    .dark-mode .bg-info,
    .dark-mode .bg-warning,
    .dark-mode .bg-danger,
    .dark-mode .bg-secondary,
    .dark-mode .chart-container,
    .dark-mode [class*="histogram-"] {
      background-color: initial !important; /* Preserve original background colors */
    }
    
    /* Ensure the page fills the viewport */
    html, body {
      min-height: 100% !important;
      height: 100% !important;
    }
    
    .dark-mode.shared-page {
      background-color: #000000 !important;
    }
    
    /* For longer titles, ensure they wrap properly */
    @media (max-width: 992px) {
      .generated-title {
        font-size: 2.4rem !important;
        max-width: 100%;
      }
    }
    
    @media (max-width: 576px) {
      .generated-title {
        font-size: 2rem !important;
        margin-top: 2rem !important;
        margin-bottom: 1.2rem !important;
      }
    }
    .section-title {
      font-size: 1.7rem !important;
      font-weight: 600;
      margin-bottom: 1.2rem;
      letter-spacing: -0.01em;
    }
    /* Remove background from thread card headers */
    .card.thread-card .card-header {
      background: none !important;
      border-bottom: none !important;
    }
    .small {
      font-size: 1em !important;
    }
    /* Show More/Fewer Threads button custom color */
    .btn-thread-toggle {
      color: #3498DB !important;
      border-color: #3498DB !important;
      background: transparent !important;
    }
    .btn-thread-toggle:hover, .btn-thread-toggle:focus {
      background: #eaf6fb !important;
      color: #217dbb !important;
      border-color: #217dbb !important;
    }
    /* Prevent button flash in dark mode */
    .dark-mode .btn-thread-toggle,
    .dark-mode .btn-thread-toggle:active,
    .dark-mode .btn-thread-toggle:focus,
    .dark-mode .btn-thread-toggle:hover {
      background: transparent !important;
      border-color: #99aaff !important;
      color: #99aaff !important;
      box-shadow: none !important;
    }
    /* Ensure info text under section headings aligns with the heading text */
    .section-info-align {
      margin-left: 2.2rem; /* matches the icon+text indent of .section-title .title-text */
    }
    .hidden-histogram {
      display: none !important;
    }
    /* Add extra margin above Continue Reading button in Instructor Report */
    #report-content + .show-toggle-btn {
      margin-top: 2.5rem !important;
    }
    .collapsible-section + .show-toggle-btn {
      margin-top: 2.5rem !important;
    }

    /* ===== Stylish Share Banner ===== */
    .share-banner {
      margin: 0 -1.5rem 2rem -1.5rem;
      background: rgba(24, 26, 45, 0.95);
      backdrop-filter: blur(10px);
      padding: 1.5rem 0;
      position: relative;
      z-index: 10;
    }
    .light-mode .share-banner {
      background: rgba(46, 87, 170, 0.9);
    }
    .share-container {
      display: flex;
      justify-content: center;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    .share-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1.2rem;
    }
    .share-text {
      font-size: 1.1rem;
      color: white;
      opacity: 0.95;
      font-weight: 500;
      letter-spacing: -0.01em;
    }
    .share-buttons {
      display: flex;
      gap: 1.2rem;
      justify-content: center;
    }
    .share-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      color: white;
      text-decoration: none;
      transition: all 0.2s ease;
      background: rgba(255, 255, 255, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transform: translateY(-2px);
    }
    .share-button i {
      font-size: 1.1rem;
    }
    .share-button:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.3);
    }
    .share-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: all 0.1s ease;
    }
    .twitter-share {
      background: #000000; /* X logo has a black background */
    }
    .facebook-share {
      background: #4267B2;
    }
    .linkedin-share {
      background: #0077B5;
    }
    .instagram-share {
      background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
    }
    @media (max-width: 576px) {
      .share-text {
        font-size: 0.95rem;
      }
      .share-button {
        width: 2.6rem;
        height: 2.6rem;
      }
    }
    /* ===== End Share Header Styles ===== */

    /* ===== Additional Layout Adjustments for Share Header ===== */
    .shared-page {
      padding-top: 0 !important;
    }
    
    .shared-page .generated-title {
      margin-top: 3.2rem !important;
      animation: title-fade-in 1s ease-out;
    }
    
    /* Add spacing between share banner and content */
    .share-banner + .row {
      margin-top: 2.5rem;
    }
    
    /* Subtle animation for title appearance */
    @keyframes title-fade-in {
      0% {
        opacity: 0;
        transform: translateY(10px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    /* ===== End Layout Adjustments ===== */

    /* Add improved line spacing for content */
    .markdown-content {
      line-height: 1.6;
    }
    
    .markdown-content p, 
    .markdown-content li,
    .thread-summary p, 
    .thread-summary li {
      line-height: 1.65;
      margin-bottom: 0.9em;
    }
    
    .markdown-content h3, 
    .markdown-content h4 {
      margin-top: 1.7em;
      margin-bottom: 0.7em;
      line-height: 1.4;
    }
    
    /* Improve readability of thread cards */
    .thread-card .card-body,
    .thread-summary {
      line-height: 1.65;
    }
    
    /* Increase spacing between list items */
    .markdown-content ul, 
    .markdown-content ol,
    .thread-summary ul,
    .thread-summary ol {
      padding-left: 1.6em;
      margin-bottom: 1.2em;
    }

    /* Final fixes to ensure proper layout */
    @media (max-width: 767px) {
      body.dark-mode .px-md-3 {
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
      }
    }
  </style>
</head>
<body class="dark-mode" style="background-color: #000000 !important; margin: 0; padding: 0; max-width: 100vw; overflow-x: hidden;">
  <div class="full-width-page shared-page px-md-4 py-4 px-2" style="max-width: 100vw; overflow-x: hidden; background-color: #000000;">
    <div class="content-wrapper" style="max-width: 1400px; margin: 0 auto;">
      
      <div class="row mb-5">
        <div class="col-12 px-2 px-md-4">
          <h1 class="generated-title">
            Legalizing Kidney Markets Versus Prohibiting Heart Sales and Protecting Weak Agents
          </h1>
        </div>
      </div>
      <div class="row mb-4">
        <div class="col-md-6 mb-4 mb-md-0">
          <div class="py-4 h-100">
            
<h5 class="section-title">
  <div class="title-text"><i class="fas fa-calendar-alt"></i> Timelines</div>
</h5>

  <div id="timelines-container" class="card-body">
    
      <div class="row mb-2">
        <div class="col-5 col-label">Completion deadline:</div>
        <div class="col-7 col-value">
          <span class="utc-time" data-utc-time="2025-04-02 04:59:00+00:00">2025-04-02 04:59:00+00:00</span>
          <span class="local-time"></span>
        </div>
      </div>
    
      <div class="row mb-2">
        <div class="col-5 col-label">Opinion deadline:</div>
        <div class="col-7 col-value">
          <span class="utc-time" data-utc-time="2025-03-30 04:59:00+00:00">2025-03-30 04:59:00+00:00</span>
          <span class="local-time"></span>
        </div>
      </div>
    
  </div>


<h5 class="section-title mt-4">
  <div class="title-text"><i class="fas fa-info-circle"></i> Info</div>
</h5>
<div id="info-container" class="card-body">
  <div class="row mb-3">
    <div class="col-5 col-label">Instructor:</div>
    <div class="col-7 col-value">[Redacted]</div>
  </div>
  <div class="row mb-3">
    <div class="col-5 col-label">Min. chat time:</div>
    <div class="col-7 col-value">
      
        25 minutes
      
    </div>
  </div>
  <div class="row mb-3">
    <div class="col-5 col-label">Created on:</div>
    <div class="col-7 col-value">
      <span class="utc-time" data-utc-time="2025-03-28 13:58:00.908731+00:00">2025-03-28 13:58:00.908731+00:00</span>
      <span class="local-time"></span>
    </div>
  </div>
  
  
  <div class="row mb-3">
    <div class="col-5 col-label">Chat threads:</div>
    <div class="col-7 col-value">14</div>
  </div>
</div> 
          </div>
        </div>
        <div class="col-md-6">
          <div class="py-4 h-100">
            <!-- Topics Section Partial -->


<h5 class="section-title">
  <div class="title-text"><i class="fas fa-bookmark"></i> Topics</div>
</h5>

  <div id="topics-container" class="card-body">
    
      <div class="mb-3">
        <div class="text-info mb-1 font-weight-bold">Heart Markets</div>
        <div>People should be permitted to sell not just organs that they can live without but also organs that they can’t live without, like their hearts.</div>
      </div>
      <hr class="my-3" style="border-color: #2d2d43;">
    
      <div class="mb-3">
        <div class="text-info mb-1 font-weight-bold">Kidney Markets</div>
        <div>We should legalize kidney markets.</div>
      </div>
      <hr class="my-3" style="border-color: #2d2d43;">
    
      <div class="mb-3">
        <div class="text-info mb-1 font-weight-bold">Weak Agency</div>
        <div>Markets that exploit weak agency should be illegal.</div>
      </div>
      
    
  </div>
 
          </div>
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-12">
          <h5 class="section-title">
            <div class="title-text"><i class="fas fa-chart-bar mr-1"></i> Opinion Distribution</div>
            
          </h5>
        </div>
        <div class="pt-0 pb-2">
          <div class="text-muted small mb-0 section-info-align">
            <i class="fas fa-info-circle mr-1"></i>Opinion scale: –3 = Strongly disagree, 0 = No idea, +3 = Strongly agree. Mean and 95% confidence interval shown below each chart.
          </div>
          <!-- DEBUG: Show if histogram_html or topic_labels are missing -->
          
          
        </div>
      </div>

      <!-- Separate row for histogram charts floating on background -->
      <div class="row mb-4">
        <div class="col-12">
          
            <div class="row" id="opinion-histogram-row">
              
              
                
                  <div class="col-md-6 col-lg-4 mb-4 opinion-histogram-card" data-index="0">
                    <!-- Individual Opinion Histogram Card -->
<div class="card histogram-card">
  <div class="card-body p-0 px-1 position-relative">
    <div class="histogram-content">
      
        <div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:25px;">
            <div style="font-size:1.25rem; font-weight:500; margin-bottom:15px;">Kidney Markets</div>
            <div style="position:relative; height:175px; width:100%; margin-bottom:10px;">
                <!-- Y-axis -->
                <div style="position:absolute; top:0; left:0; bottom:25px; width:40px; display:flex; flex-direction:column; justify-content:space-between;">
        
                    <div style="position:absolute; top:0.0%; right:10px; color:#a9adc1; font-size:14px;">15</div>
            
                    <div style="position:absolute; top:33.33333333333333%; right:10px; color:#a9adc1; font-size:14px;">10</div>
            
                    <div style="position:absolute; top:66.66666666666666%; right:10px; color:#a9adc1; font-size:14px;">5</div>
            
                    <div style="position:absolute; top:100.0%; right:10px; color:#a9adc1; font-size:14px;">0</div>
            
                    <div style="position:absolute; top:0; bottom:0; right:0; width:1px; background:rgba(169,173,193,0.3);"></div>
                </div>
                
                <!-- Horizontal grid lines -->
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px;">
        
                    <div style="position:absolute; top:0.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:33.33333333333333%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:66.66666666666666%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:100.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                </div>
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px; display:flex; align-items:flex-end; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:20.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:40.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:33.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:20.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:73.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:26.666666666666668%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:6.666666666666667%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                </div>
                <div style="position:absolute; left:40px; right:0; bottom:0; height:25px; display:flex; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-3</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">0</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">3</div>
            
                </div>
            </div>
        
            <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:6px; letter-spacing:0.01em;">
                mean = -0.12 <span style="opacity:0.7;">(95% confidence interval: -0.72–0.48)</span>
            </div>
            
        </div>
        
    </div>
  </div>
</div> 
                  </div>
                  
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4 opinion-histogram-card" data-index="0">
                    <!-- Individual Opinion Histogram Card -->
<div class="card histogram-card">
  <div class="card-body p-0 px-1 position-relative">
    <div class="histogram-content">
      
        <div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:25px;">
            <div style="font-size:1.25rem; font-weight:500; margin-bottom:15px;">Heart Markets</div>
            <div style="position:relative; height:175px; width:100%; margin-bottom:10px;">
                <!-- Y-axis -->
                <div style="position:absolute; top:0; left:0; bottom:25px; width:40px; display:flex; flex-direction:column; justify-content:space-between;">
        
                    <div style="position:absolute; top:0.0%; right:10px; color:#a9adc1; font-size:14px;">10</div>
            
                    <div style="position:absolute; top:50.0%; right:10px; color:#a9adc1; font-size:14px;">5</div>
            
                    <div style="position:absolute; top:100.0%; right:10px; color:#a9adc1; font-size:14px;">0</div>
            
                    <div style="position:absolute; top:0; bottom:0; right:0; width:1px; background:rgba(169,173,193,0.3);"></div>
                </div>
                
                <!-- Horizontal grid lines -->
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px;">
        
                    <div style="position:absolute; top:0.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:50.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:100.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                </div>
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px; display:flex; align-items:flex-end; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:90.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:100.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:50.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:50.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:40.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:0.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:0.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                </div>
                <div style="position:absolute; left:40px; right:0; bottom:0; height:25px; display:flex; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-3</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">0</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">3</div>
            
                </div>
            </div>
        
            <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:6px; letter-spacing:0.01em;">
                mean = -1.45 <span style="opacity:0.7;">(95% confidence interval: -1.94–-0.97)</span>
            </div>
            
        </div>
        
    </div>
  </div>
</div> 
                  </div>
                  
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4 opinion-histogram-card" data-index="0">
                    <!-- Individual Opinion Histogram Card -->
<div class="card histogram-card">
  <div class="card-body p-0 px-1 position-relative">
    <div class="histogram-content">
      
        <div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:25px;">
            <div style="font-size:1.25rem; font-weight:500; margin-bottom:15px;">Weak Agency</div>
            <div style="position:relative; height:175px; width:100%; margin-bottom:10px;">
                <!-- Y-axis -->
                <div style="position:absolute; top:0; left:0; bottom:25px; width:40px; display:flex; flex-direction:column; justify-content:space-between;">
        
                    <div style="position:absolute; top:0.0%; right:10px; color:#a9adc1; font-size:14px;">15</div>
            
                    <div style="position:absolute; top:33.33333333333333%; right:10px; color:#a9adc1; font-size:14px;">10</div>
            
                    <div style="position:absolute; top:66.66666666666666%; right:10px; color:#a9adc1; font-size:14px;">5</div>
            
                    <div style="position:absolute; top:100.0%; right:10px; color:#a9adc1; font-size:14px;">0</div>
            
                    <div style="position:absolute; top:0; bottom:0; right:0; width:1px; background:rgba(169,173,193,0.3);"></div>
                </div>
                
                <!-- Horizontal grid lines -->
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px;">
        
                    <div style="position:absolute; top:0.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:33.33333333333333%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:66.66666666666666%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                    <div style="position:absolute; top:100.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
            
                </div>
                <div style="position:absolute; top:0; left:40px; right:0; bottom:25px; display:flex; align-items:flex-end; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:0.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:13.333333333333334%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:13.333333333333334%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:73.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:20.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:46.666666666666664%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                    <div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
                        <div style="width:70%; height:53.333333333333336%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
                    </div>
            
                </div>
                <div style="position:absolute; left:40px; right:0; bottom:0; height:25px; display:flex; justify-content:space-between; padding:0 2px;">
        
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-3</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">0</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">1</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">2</div>
            
                    <div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">3</div>
            
                </div>
            </div>
        
            <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:6px; letter-spacing:0.01em;">
                mean = 1.06 <span style="opacity:0.7;">(95% confidence interval: 0.51–1.61)</span>
            </div>
            
        </div>
        
    </div>
  </div>
</div> 
                  </div>
                  
                
              
            </div>
            <div class="text-center">
              <button id="show-more-histograms-btn" class="btn btn-thread-toggle show-toggle-btn" style="display:none;">Show More Figures</button>
              <button id="show-fewer-histograms-btn" class="btn btn-thread-toggle show-toggle-btn" style="display:none;">Show Fewer Figures</button>
            </div>
          
        </div>
      </div>
      <div class="row mb-4">
        <div class="col-12">
          <div class="py-4">
            <!-- Report Section Partial -->

<h5 class="section-title">
  <div class="title-text">
    <i class="fas fa-file-alt mr-1"></i> Instructor Report
  </div>
  
</h5>

<!-- DEBUG: Show if report or has_saved_summaries are missing -->



<div class="card-body" id="report-section">
  
    
    <div id="report-content" class="markdown-content">
      <p>The assignment engaged students in debating the ethical and practical viability of organ markets, primarily focusing on kidney markets with some exploration of heart/vital organ markets. Students were asked to analyze the complex balance between addressing organ shortages and preventing exploitation, considering various regulatory frameworks, alternatives to market solutions, and the broader ethical implications of commercializing human body parts.</p>
<h3>Themes</h3>
<ul>
<li><strong>The tension between autonomy and exploitation dominated nearly every discussion.</strong> Students repeatedly grappled with whether regulated organ markets would genuinely empower individuals through choice or inevitably exploit vulnerable populations through economic coercion, with one student noting that "it cannot be a free choice when someone's desperate financial situation compels them to sell an organ."</li>
<li><strong>Students explored specific regulatory frameworks that might prevent exploitation while maintaining functional markets.</strong> These included income thresholds to exclude the most vulnerable, health screening requirements, fixed pricing mechanisms, government oversight, and third-party matching organizations, though many remained skeptical that regulations could fully prevent exploitation.</li>
<li><strong>The discussion naturally evolved from absolute positions toward more nuanced harm-benefit analyses.</strong> Many students initially took hardline stances but gradually moved toward frameworks that weighed potential benefits (addressing organ shortages, providing financial opportunities) against risks (exploitation, class divides, commodification of human life).</li>
</ul>
<h3>Guide's Role</h3>
<ul>
<li><strong>Guide consistently pushed students to move beyond abstract principles toward concrete mechanisms and safeguards.</strong> When students made broad claims about regulation or exploitation, Guide asked pointed questions like "What specific regulatory failures do you anticipate?" and "Could you explain the mechanism you see connecting a regulated kidney market to human trafficking?"</li>
<li><strong>Guide prompted students to recognize inconsistencies in their own reasoning and to critically examine their assumptions.</strong> This was particularly effective when Guide highlighted tensions between values, asking questions like "Doesn't your proposed vetting process contradict your earlier argument that people should have free choice?" and "Why do you think society draws this ethical line between donation and sale?"</li>
<li><strong>Guide steered students toward parallel cases to deepen their analysis.</strong> By encouraging comparisons with other complex markets (surrogacy, clinical trials, risky jobs) and related ethical domains (physician-assisted suicide), Guide helped students refine their positions on bodily autonomy and exploitation.</li>
</ul>
<h3>Common Ground</h3>
<ul>
<li><strong>Most students acknowledged both the life-saving benefits and exploitation risks of organ markets.</strong> Even those initially opposed to legalization recognized the potential to address critical organ shortages, while market proponents generally conceded the need for robust safeguards against exploitation.</li>
<li><strong>Students broadly agreed that posthumous organ markets raised fewer ethical concerns than living donor markets.</strong> Several discussions found common ground in supporting compensation for families after death, viewing this as less ethically problematic than markets for organs from living donors.</li>
<li><strong>Many discussions converged on the importance of exploring non-market alternatives to increase organ supply.</strong> Students frequently found common ground in supporting opt-out donation systems, paired exchanges, covered donor expenses, and investments in artificial organ research as potential compromises.</li>
</ul>
<h3>Persistent Disagreements</h3>
<ul>
<li><strong>Students remained divided on whether economic pressure fundamentally undermines free choice in organ markets.</strong> Market proponents argued that regulated systems preserve autonomy while providing financial benefits, while critics maintained that economic desperation makes truly free choice impossible for vulnerable populations, creating what one student called a "two-tiered system where the poor become suppliers for the wealthy."</li>
<li><strong>Discussions revealed persistent disagreement about the appropriate role of government in regulating bodily autonomy.</strong> Some students prioritized individual freedom to make risky choices about one's own body, while others emphasized the government's responsibility to protect vulnerable people from exploitation, even at the cost of restricting certain choices.</li>
<li><strong>Students disagreed about whether any safeguards could adequately prevent exploitation in practice.</strong> While some believed careful regulation could create ethical markets, others maintained that the inherent power imbalances and economic pressures would inevitably corrupt any market-based system.</li>
</ul>
<h3>Insights</h3>
<ul>
<li><strong>Several students demonstrated meaningful perspective shifts during their discussions.</strong> The format encouraged intellectual growth, with multiple instances of students modifying their initial positions after considering counterarguments or arriving at more nuanced stances that balanced competing values.</li>
<li><strong>Comparisons with other regulated markets provided a fresh analytical lens.</strong> Students who drew parallels with surrogacy, clinical trials, dangerous occupations, and military recruitment often developed more sophisticated positions on when market regulation is preferable to prohibition.</li>
<li><strong>The discussions naturally progressed from theoretical arguments to practical implementation challenges.</strong> Many conversations evolved from abstract ethical principles to concrete considerations about regulatory oversight, enforcement mechanisms, pricing structures, and unintended consequences.</li>
</ul>
<h3>Possible Misconceptions</h3>
<ul>
<li><strong>Some students may have conflated heart sales (fatal to the donor) with kidney sales (non-fatal).</strong> This confusion occasionally undermined their arguments, suggesting that clearer distinctions between vital and non-vital organ markets could sharpen the ethical analysis.</li>
<li><strong>There appeared to be limited understanding of existing organ donation systems and their limitations.</strong> Few discussions demonstrated deep knowledge of current transplant waiting lists, paired donation programs, or the complex medical infrastructure required, which suggests that additional background information might enhance future discussions.</li>
</ul>
    </div>
    <!-- Hidden raw markdown for test compatibility -->
    <div style="display:none;" id="report-raw-markdown">The assignment engaged students in debating the ethical and practical viability of organ markets, primarily focusing on kidney markets with some exploration of heart/vital organ markets. Students were asked to analyze the complex balance between addressing organ shortages and preventing exploitation, considering various regulatory frameworks, alternatives to market solutions, and the broader ethical implications of commercializing human body parts.

### Themes
- **The tension between autonomy and exploitation dominated nearly every discussion.** Students repeatedly grappled with whether regulated organ markets would genuinely empower individuals through choice or inevitably exploit vulnerable populations through economic coercion, with one student noting that "it cannot be a free choice when someone's desperate financial situation compels them to sell an organ."
- **Students explored specific regulatory frameworks that might prevent exploitation while maintaining functional markets.** These included income thresholds to exclude the most vulnerable, health screening requirements, fixed pricing mechanisms, government oversight, and third-party matching organizations, though many remained skeptical that regulations could fully prevent exploitation.
- **The discussion naturally evolved from absolute positions toward more nuanced harm-benefit analyses.** Many students initially took hardline stances but gradually moved toward frameworks that weighed potential benefits (addressing organ shortages, providing financial opportunities) against risks (exploitation, class divides, commodification of human life).

### Guide's Role
- **Guide consistently pushed students to move beyond abstract principles toward concrete mechanisms and safeguards.** When students made broad claims about regulation or exploitation, Guide asked pointed questions like "What specific regulatory failures do you anticipate?" and "Could you explain the mechanism you see connecting a regulated kidney market to human trafficking?"
- **Guide prompted students to recognize inconsistencies in their own reasoning and to critically examine their assumptions.** This was particularly effective when Guide highlighted tensions between values, asking questions like "Doesn't your proposed vetting process contradict your earlier argument that people should have free choice?" and "Why do you think society draws this ethical line between donation and sale?"
- **Guide steered students toward parallel cases to deepen their analysis.** By encouraging comparisons with other complex markets (surrogacy, clinical trials, risky jobs) and related ethical domains (physician-assisted suicide), Guide helped students refine their positions on bodily autonomy and exploitation.

### Common Ground
- **Most students acknowledged both the life-saving benefits and exploitation risks of organ markets.** Even those initially opposed to legalization recognized the potential to address critical organ shortages, while market proponents generally conceded the need for robust safeguards against exploitation.
- **Students broadly agreed that posthumous organ markets raised fewer ethical concerns than living donor markets.** Several discussions found common ground in supporting compensation for families after death, viewing this as less ethically problematic than markets for organs from living donors.
- **Many discussions converged on the importance of exploring non-market alternatives to increase organ supply.** Students frequently found common ground in supporting opt-out donation systems, paired exchanges, covered donor expenses, and investments in artificial organ research as potential compromises.

### Persistent Disagreements
- **Students remained divided on whether economic pressure fundamentally undermines free choice in organ markets.** Market proponents argued that regulated systems preserve autonomy while providing financial benefits, while critics maintained that economic desperation makes truly free choice impossible for vulnerable populations, creating what one student called a "two-tiered system where the poor become suppliers for the wealthy."
- **Discussions revealed persistent disagreement about the appropriate role of government in regulating bodily autonomy.** Some students prioritized individual freedom to make risky choices about one's own body, while others emphasized the government's responsibility to protect vulnerable people from exploitation, even at the cost of restricting certain choices.
- **Students disagreed about whether any safeguards could adequately prevent exploitation in practice.** While some believed careful regulation could create ethical markets, others maintained that the inherent power imbalances and economic pressures would inevitably corrupt any market-based system.

### Insights
- **Several students demonstrated meaningful perspective shifts during their discussions.** The format encouraged intellectual growth, with multiple instances of students modifying their initial positions after considering counterarguments or arriving at more nuanced stances that balanced competing values.
- **Comparisons with other regulated markets provided a fresh analytical lens.** Students who drew parallels with surrogacy, clinical trials, dangerous occupations, and military recruitment often developed more sophisticated positions on when market regulation is preferable to prohibition.
- **The discussions naturally progressed from theoretical arguments to practical implementation challenges.** Many conversations evolved from abstract ethical principles to concrete considerations about regulatory oversight, enforcement mechanisms, pricing structures, and unintended consequences.

### Possible Misconceptions
- **Some students may have conflated heart sales (fatal to the donor) with kidney sales (non-fatal).** This confusion occasionally undermined their arguments, suggesting that clearer distinctions between vital and non-vital organ markets could sharpen the ethical analysis.
- **There appeared to be limited understanding of existing organ donation systems and their limitations.** Few discussions demonstrated deep knowledge of current transplant waiting lists, paired donation programs, or the complex medical infrastructure required, which suggests that additional background information might enhance future discussions.</div>
    <!-- RAW REPORT CONTENT FOR TESTING: The assignment engag -->
    <span style="display:none;" id="report-prefix">The assignment engag</span>
    <div class="text-muted mt-2 d-flex justify-content-end align-items-center">
      <span class="text-right" style="flex:1; text-align:right;">Generated on: 
        <script>
          document.write(new Date("2025-05-06T15:23:44.092307").toLocaleDateString('en-US', {
            month: 'short', 
            day: 'numeric', 
            year: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
          }));
        </script>
        <noscript>2025-05-06T15:23:44.092307</noscript>
      </span>
      
    </div>
    <div id="report-editor-container" style="display: none;">
      <div class="alert alert-info">
        <i class="fas fa-info-circle mr-2"></i> Edit the report in markdown format.
      </div>
      <textarea id="report-markdown-editor" class="form-control">The assignment engaged students in debating the ethical and practical viability of organ markets, primarily focusing on kidney markets with some exploration of heart/vital organ markets. Students were asked to analyze the complex balance between addressing organ shortages and preventing exploitation, considering various regulatory frameworks, alternatives to market solutions, and the broader ethical implications of commercializing human body parts.

### Themes
- **The tension between autonomy and exploitation dominated nearly every discussion.** Students repeatedly grappled with whether regulated organ markets would genuinely empower individuals through choice or inevitably exploit vulnerable populations through economic coercion, with one student noting that &#34;it cannot be a free choice when someone&#39;s desperate financial situation compels them to sell an organ.&#34;
- **Students explored specific regulatory frameworks that might prevent exploitation while maintaining functional markets.** These included income thresholds to exclude the most vulnerable, health screening requirements, fixed pricing mechanisms, government oversight, and third-party matching organizations, though many remained skeptical that regulations could fully prevent exploitation.
- **The discussion naturally evolved from absolute positions toward more nuanced harm-benefit analyses.** Many students initially took hardline stances but gradually moved toward frameworks that weighed potential benefits (addressing organ shortages, providing financial opportunities) against risks (exploitation, class divides, commodification of human life).

### Guide&#39;s Role
- **Guide consistently pushed students to move beyond abstract principles toward concrete mechanisms and safeguards.** When students made broad claims about regulation or exploitation, Guide asked pointed questions like &#34;What specific regulatory failures do you anticipate?&#34; and &#34;Could you explain the mechanism you see connecting a regulated kidney market to human trafficking?&#34;
- **Guide prompted students to recognize inconsistencies in their own reasoning and to critically examine their assumptions.** This was particularly effective when Guide highlighted tensions between values, asking questions like &#34;Doesn&#39;t your proposed vetting process contradict your earlier argument that people should have free choice?&#34; and &#34;Why do you think society draws this ethical line between donation and sale?&#34;
- **Guide steered students toward parallel cases to deepen their analysis.** By encouraging comparisons with other complex markets (surrogacy, clinical trials, risky jobs) and related ethical domains (physician-assisted suicide), Guide helped students refine their positions on bodily autonomy and exploitation.

### Common Ground
- **Most students acknowledged both the life-saving benefits and exploitation risks of organ markets.** Even those initially opposed to legalization recognized the potential to address critical organ shortages, while market proponents generally conceded the need for robust safeguards against exploitation.
- **Students broadly agreed that posthumous organ markets raised fewer ethical concerns than living donor markets.** Several discussions found common ground in supporting compensation for families after death, viewing this as less ethically problematic than markets for organs from living donors.
- **Many discussions converged on the importance of exploring non-market alternatives to increase organ supply.** Students frequently found common ground in supporting opt-out donation systems, paired exchanges, covered donor expenses, and investments in artificial organ research as potential compromises.

### Persistent Disagreements
- **Students remained divided on whether economic pressure fundamentally undermines free choice in organ markets.** Market proponents argued that regulated systems preserve autonomy while providing financial benefits, while critics maintained that economic desperation makes truly free choice impossible for vulnerable populations, creating what one student called a &#34;two-tiered system where the poor become suppliers for the wealthy.&#34;
- **Discussions revealed persistent disagreement about the appropriate role of government in regulating bodily autonomy.** Some students prioritized individual freedom to make risky choices about one&#39;s own body, while others emphasized the government&#39;s responsibility to protect vulnerable people from exploitation, even at the cost of restricting certain choices.
- **Students disagreed about whether any safeguards could adequately prevent exploitation in practice.** While some believed careful regulation could create ethical markets, others maintained that the inherent power imbalances and economic pressures would inevitably corrupt any market-based system.

### Insights
- **Several students demonstrated meaningful perspective shifts during their discussions.** The format encouraged intellectual growth, with multiple instances of students modifying their initial positions after considering counterarguments or arriving at more nuanced stances that balanced competing values.
- **Comparisons with other regulated markets provided a fresh analytical lens.** Students who drew parallels with surrogacy, clinical trials, dangerous occupations, and military recruitment often developed more sophisticated positions on when market regulation is preferable to prohibition.
- **The discussions naturally progressed from theoretical arguments to practical implementation challenges.** Many conversations evolved from abstract ethical principles to concrete considerations about regulatory oversight, enforcement mechanisms, pricing structures, and unintended consequences.

### Possible Misconceptions
- **Some students may have conflated heart sales (fatal to the donor) with kidney sales (non-fatal).** This confusion occasionally undermined their arguments, suggesting that clearer distinctions between vital and non-vital organ markets could sharpen the ethical analysis.
- **There appeared to be limited understanding of existing organ donation systems and their limitations.** Few discussions demonstrated deep knowledge of current transplant waiting lists, paired donation programs, or the complex medical infrastructure required, which suggests that additional background information might enhance future discussions.</textarea>
      <div class="mt-3">
        <button id="save-report-btn" class="btn btn-primary">
          <i class="fas fa-save mr-1"></i> Save Changes
        </button>
        <button id="cancel-report-edit-btn" class="btn btn-secondary ml-2">
          <i class="fas fa-times mr-1"></i> Cancel
        </button>
        <span id="editor-spinner" class="spinner-border spinner-border-sm ml-2" role="status" style="display: none;"></span>
      </div>
      <div id="editor-status-message" class="status-message mt-3" style="display: none;"></div>
    </div>
  
</div> 
          </div>
        </div>
      </div>

      <div class="row mb-2">
        <div class="col-12">
          <h5 class="section-title">
            <div class="title-text"><i class="fas fa-comments mr-1"></i> Chat Threads</div>
            
          </h5>
        </div>
        <div class="pt-0 pb-2">
          <!-- DEBUG: Show if threads is missing or empty -->
          
          <div class="text-muted small mb-0 section-info-align">
            <i class="fas fa-info-circle mr-1"></i> Only threads with 10 or more messages are shown and processed for summaries. Student names are redacted for privacy.
          </div>
        </div>
      </div>

      <!-- Separate row for thread items floating on background -->
      <div class="row mb-5">
        <div class="col-12">
          <div class="thread-list" id="thread-list">
            
              <div class="masonry-grid">
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==a15461fcdf::student-dwfilmvkdq==ed832820df::6d73187980::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Kidney Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==a15461fcdf::student-dwfilmvkdq==ed832820df::6d73187980::55405271b4">
                                  <ul>
<li>
<p><strong>Students began by weighing regulation and autonomy against health risks.</strong> Student 1 argued legalization would ensure safer, hospital-regulated transactions and provide financial support akin to egg or plasma donation, while Student 2 countered that kidneys are non-renewable and donors may lack the agency to consent fully, though it conceded that informed sellers could make responsible choices. Over the discussion they found common ground on the importance of robust consent processes and acknowledging that illegal markets would persist without oversight.</p>
</li>
<li>
<p><strong>Guide steered the group with targeted challenges and policy prompts to deepen the debate.</strong> It questioned assumptions about bodily autonomy versus risk perception, highlighted parallels between non-renewable biological materials, and pressed students to propose alternatives to legalization and concrete enforcement strategies for shutting down illicit organ trades. These interventions pushed Student 1 to consider viable solutions and Student 2 to articulate enforcement mechanisms, even as Student 1 struggled to name alternative organ-shortage strategies.</p>
</li>
</ul>
<blockquote>
<p><strong>Student 2, shutting down illegal markets is challenging. What specific enforcement approaches do you think would be effective, and how would you address the underlying demand for organs?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==a15461fcdf::student-dwfilmvkdq==ed832820df::6d73187980::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==a15461fcdf::student-dwfilmvkdq==ed832820df::6d73187980::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==a15461fcdf::student-dwfilmvkdq==ed832820df::6d73187980::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==a15461fcdf::student-dwfilmvkdq==ed832820df::6d73187980::55405271b4" class="form-control summary-markdown-editor">- **Students began by weighing regulation and autonomy against health risks.** Student 1 argued legalization would ensure safer, hospital-regulated transactions and provide financial support akin to egg or plasma donation, while Student 2 countered that kidneys are non-renewable and donors may lack the agency to consent fully, though it conceded that informed sellers could make responsible choices. Over the discussion they found common ground on the importance of robust consent processes and acknowledging that illegal markets would persist without oversight.

- **Guide steered the group with targeted challenges and policy prompts to deepen the debate.** It questioned assumptions about bodily autonomy versus risk perception, highlighted parallels between non-renewable biological materials, and pressed students to propose alternatives to legalization and concrete enforcement strategies for shutting down illicit organ trades. These interventions pushed Student 1 to consider viable solutions and Student 2 to articulate enforcement mechanisms, even as Student 1 struggled to name alternative organ-shortage strategies.



&gt; **Student 2, shutting down illegal markets is challenging. What specific enforcement approaches do you think would be effective, and how would you address the underlying demand for organs?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==a15461fcdf::student-dwfilmvkdq==ed832820df::6d73187980::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==a15461fcdf::student-dwfilmvkdq==ed832820df::6d73187980::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==a15461fcdf::student-dwfilmvkdq==ed832820df::6d73187980::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==a15461fcdf::student-dwfilmvkdq==ed832820df::6d73187980::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==612b4322df::student-dwfilmvkdq==8793533cdd::6d73187980::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Kidney Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==612b4322df::student-dwfilmvkdq==8793533cdd::6d73187980::55405271b4">
                                  <ul>
<li><strong>They debated the merits of legalizing kidney markets as a trial option.</strong> Student 1 argued for controlled trials with safeguards to test the idea in practice, while Student 2 warned that any market—even a trial—could exploit vulnerable populations and erode true freedom of choice.  </li>
<li><strong>They examined alternatives to market-based approaches by discussing opt-out organ donation policies.</strong> Student 2 presented opt-out systems as a more ethical means to boost donation rates, and both participants gradually acknowledged the need for compromise and careful regulatory measures.  </li>
<li><strong>Guide played a pivotal role by challenging the students' assumptions and deepening the ethical debate.</strong> Guide’s probing questions pushed the students to clarify and reassess their positions, especially regarding the balance between individual choice and protection against exploitation.  </li>
</ul>
<blockquote>
<p><strong>Student 1, doesn't your proposed vetting process contradict your earlier argument that people should have free choice? Your suggestion to screen out financially-motivated sellers raises questions about whether limiting options truly preserves freedom of choice, suggesting that the market mechanism may be inherently conflicted.</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==612b4322df::student-dwfilmvkdq==8793533cdd::6d73187980::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==612b4322df::student-dwfilmvkdq==8793533cdd::6d73187980::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==612b4322df::student-dwfilmvkdq==8793533cdd::6d73187980::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==612b4322df::student-dwfilmvkdq==8793533cdd::6d73187980::55405271b4" class="form-control summary-markdown-editor">- **They debated the merits of legalizing kidney markets as a trial option.** Student 1 argued for controlled trials with safeguards to test the idea in practice, while Student 2 warned that any market—even a trial—could exploit vulnerable populations and erode true freedom of choice.  
- **They examined alternatives to market-based approaches by discussing opt-out organ donation policies.** Student 2 presented opt-out systems as a more ethical means to boost donation rates, and both participants gradually acknowledged the need for compromise and careful regulatory measures.  
- **Guide played a pivotal role by challenging the students&#39; assumptions and deepening the ethical debate.** Guide’s probing questions pushed the students to clarify and reassess their positions, especially regarding the balance between individual choice and protection against exploitation.  

  
&gt; **Student 1, doesn&#39;t your proposed vetting process contradict your earlier argument that people should have free choice? Your suggestion to screen out financially-motivated sellers raises questions about whether limiting options truly preserves freedom of choice, suggesting that the market mechanism may be inherently conflicted.**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==612b4322df::student-dwfilmvkdq==8793533cdd::6d73187980::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==612b4322df::student-dwfilmvkdq==8793533cdd::6d73187980::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==612b4322df::student-dwfilmvkdq==8793533cdd::6d73187980::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==612b4322df::student-dwfilmvkdq==8793533cdd::6d73187980::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==c0f33c0ade::student-dwfilmvkdq==f0dad5d2dd::6d73187980::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Kidney Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==c0f33c0ade::student-dwfilmvkdq==f0dad5d2dd::6d73187980::55405271b4">
                                  <ul>
<li><strong>Students grappled with the ethics and practical risks of legalizing kidney markets, largely fearing exploitation, inequality, and potential human trafficking.</strong> Student 1 and Student 2 remained opposed, proposing education, presumed consent, and healthy lifestyles as alternative ways to boost donations, while Student 3 argued that a regulated market, despite its flaws, could best address chronic shortages.  </li>
<li><strong>A surprising tension emerged when Student 3 dismissed controls over “evil” in markets, prompting peers to warn such a system could guarantee business for slave traders.</strong> This debate pushed the group to explore middle-ground solutions like presumed consent policies, paired exchanges, xenotransplantation, and bioartificial kidneys, though no consensus was reached.  </li>
<li><strong>Guide consistently challenged students to justify key claims and suggest specific safeguards or alternatives, steering them from broad assertions to detailed reasoning.</strong> By repeatedly asking for mechanisms linking kidney markets to trafficking and for concrete regulatory proposals, Guide kept the discussion analytic and solution-focused.  </li>
</ul>
<blockquote>
<p><strong>Could you explain the mechanism you see connecting a regulated kidney market to human trafficking? Many regulated markets exist without necessarily fueling criminal enterprises, so I'm interested in why you see this particular connection as inevitable.</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==c0f33c0ade::student-dwfilmvkdq==f0dad5d2dd::6d73187980::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==c0f33c0ade::student-dwfilmvkdq==f0dad5d2dd::6d73187980::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==c0f33c0ade::student-dwfilmvkdq==f0dad5d2dd::6d73187980::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==c0f33c0ade::student-dwfilmvkdq==f0dad5d2dd::6d73187980::55405271b4" class="form-control summary-markdown-editor">- **Students grappled with the ethics and practical risks of legalizing kidney markets, largely fearing exploitation, inequality, and potential human trafficking.** Student 1 and Student 2 remained opposed, proposing education, presumed consent, and healthy lifestyles as alternative ways to boost donations, while Student 3 argued that a regulated market, despite its flaws, could best address chronic shortages.  
- **A surprising tension emerged when Student 3 dismissed controls over “evil” in markets, prompting peers to warn such a system could guarantee business for slave traders.** This debate pushed the group to explore middle-ground solutions like presumed consent policies, paired exchanges, xenotransplantation, and bioartificial kidneys, though no consensus was reached.  
- **Guide consistently challenged students to justify key claims and suggest specific safeguards or alternatives, steering them from broad assertions to detailed reasoning.** By repeatedly asking for mechanisms linking kidney markets to trafficking and for concrete regulatory proposals, Guide kept the discussion analytic and solution-focused.  



&gt; **Could you explain the mechanism you see connecting a regulated kidney market to human trafficking? Many regulated markets exist without necessarily fueling criminal enterprises, so I&#39;m interested in why you see this particular connection as inevitable.**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==c0f33c0ade::student-dwfilmvkdq==f0dad5d2dd::6d73187980::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==c0f33c0ade::student-dwfilmvkdq==f0dad5d2dd::6d73187980::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==c0f33c0ade::student-dwfilmvkdq==f0dad5d2dd::6d73187980::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==c0f33c0ade::student-dwfilmvkdq==f0dad5d2dd::6d73187980::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==349f5f32df::6d73187980::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Kidney Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==349f5f32df::6d73187980::55405271b4">
                                  <ul>
<li><strong>Students debated the ethical viability of legalizing kidney markets.</strong> Student 1 argued that a regulated market could reduce black market exploitation and promote financial mobility, while Student 2 initially opposed the idea but shifted toward cautious support when considering life-saving benefits and potential pitfalls.  </li>
<li><strong>Students examined the role of government regulation in managing potential exploitation and ensuring fairness.</strong> They discussed the challenges of enforcing safeguards such as mental health screening, preventing price gouging, and avoiding unintended class divides in access to kidneys.  </li>
<li><strong>Guide propelled the discussion by challenging students to detail practical regulatory failures and ethical trade-offs.</strong> Guide’s questions pushed the students to move from abstract moral positions to concrete considerations of implementation and economic coercion.  </li>
</ul>
<blockquote>
<p><strong>What specific regulatory failures do you anticipate that would lead to exploitation? And if these regulatory challenges exist, why wouldn't they also apply to other complex markets we currently allow (like surrogacy, clinical trials, or risky jobs)?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==349f5f32df::6d73187980::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==349f5f32df::6d73187980::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==349f5f32df::6d73187980::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==349f5f32df::6d73187980::55405271b4" class="form-control summary-markdown-editor">- **Students debated the ethical viability of legalizing kidney markets.** Student 1 argued that a regulated market could reduce black market exploitation and promote financial mobility, while Student 2 initially opposed the idea but shifted toward cautious support when considering life-saving benefits and potential pitfalls.  
- **Students examined the role of government regulation in managing potential exploitation and ensuring fairness.** They discussed the challenges of enforcing safeguards such as mental health screening, preventing price gouging, and avoiding unintended class divides in access to kidneys.  
- **Guide propelled the discussion by challenging students to detail practical regulatory failures and ethical trade-offs.** Guide’s questions pushed the students to move from abstract moral positions to concrete considerations of implementation and economic coercion.  

&gt; **What specific regulatory failures do you anticipate that would lead to exploitation? And if these regulatory challenges exist, why wouldn&#39;t they also apply to other complex markets we currently allow (like surrogacy, clinical trials, or risky jobs)?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==349f5f32df::6d73187980::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==349f5f32df::6d73187980::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==349f5f32df::6d73187980::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==349f5f32df::6d73187980::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==7c87150edd::student-z21hawwuy29t727419eee7::6d73187980::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Kidney Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==7c87150edd::student-z21hawwuy29t727419eee7::6d73187980::55405271b4">
                                  <ul>
<li><strong>Students began sharply divided over kidney markets, with Student 1 warning of exploitation and Student 2 trusting informed consent and regulations.</strong> Student 1 repeatedly pressed the risks of financial duress on vulnerable sellers, while Student 2 proposed safeguards like payment caps and health‐status requirements. Over time, Student 1 softened slightly, acknowledging that a regulated market could alleviate organ shortages despite persistent exploitation worries.  </li>
<li><strong>They probed the fairness implications of restricting sellers versus opening markets to all, and explored non-commercial alternatives to boost donations.</strong> The pair debated whether requirements (e.g., health, financial stability) would reduce coercion or simply create an exclusive pay-to-sell system, then shifted to opt-out donor registries, non-monetary incentives, and covering donor expenses as potential compromises.  </li>
<li><strong>Guide consistently deepened the debate by challenging assumptions on coercion, fairness, and supply shortages, steering students to weigh both ethical risks and practical benefits.</strong> Its pointed questions—on economic pressures, unequal access, and alternative solutions—ensured the discussion stayed focused on both sides of the legalization issue.</li>
</ul>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==7c87150edd::student-z21hawwuy29t727419eee7::6d73187980::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==7c87150edd::student-z21hawwuy29t727419eee7::6d73187980::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==7c87150edd::student-z21hawwuy29t727419eee7::6d73187980::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==7c87150edd::student-z21hawwuy29t727419eee7::6d73187980::55405271b4" class="form-control summary-markdown-editor">- **Students began sharply divided over kidney markets, with Student 1 warning of exploitation and Student 2 trusting informed consent and regulations.** Student 1 repeatedly pressed the risks of financial duress on vulnerable sellers, while Student 2 proposed safeguards like payment caps and health‐status requirements. Over time, Student 1 softened slightly, acknowledging that a regulated market could alleviate organ shortages despite persistent exploitation worries.  
- **They probed the fairness implications of restricting sellers versus opening markets to all, and explored non-commercial alternatives to boost donations.** The pair debated whether requirements (e.g., health, financial stability) would reduce coercion or simply create an exclusive pay-to-sell system, then shifted to opt-out donor registries, non-monetary incentives, and covering donor expenses as potential compromises.  
- **Guide consistently deepened the debate by challenging assumptions on coercion, fairness, and supply shortages, steering students to weigh both ethical risks and practical benefits.** Its pointed questions—on economic pressures, unequal access, and alternative solutions—ensured the discussion stayed focused on both sides of the legalization issue.</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==7c87150edd::student-z21hawwuy29t727419eee7::6d73187980::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==7c87150edd::student-z21hawwuy29t727419eee7::6d73187980::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==7c87150edd::student-z21hawwuy29t727419eee7::6d73187980::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==7c87150edd::student-z21hawwuy29t727419eee7::6d73187980::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==b62c9cfcef::student-z21hawwuy29t344c4094df::4f561be66e::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Heart Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==b62c9cfcef::student-z21hawwuy29t344c4094df::4f561be66e::55405271b4">
                                  <ul>
<li><strong>Students navigated arguments for and against heart markets, initially citing autonomy and the shortage of transplantable organs before shifting to concerns about commodification and exploitation.</strong> Student 1 mistakenly presented pro-market arguments multiple times before embracing the anti-market stance, while Student 2 began by championing personal choice but then acknowledged the devaluation of human life and medical ethics objections.  </li>
<li><strong>Their perspectives converged around the ethical problems of treating human life as a commodity, with autonomy acknowledged but outweighed by exploitation and “do no harm” principles.</strong> The conversation evolved from abstract rights claims to concrete worries about vulnerable populations, altruistic motivations for selling organs, and the contradiction of sacrificing one life for another.  </li>
<li><strong>Guide played a central role by correcting role inconsistencies, challenging students to justify their shifts, and probing the limits of autonomy, altruism, and medical ethics.</strong> It repeatedly refocused the discussion on exploitation safeguards and the principle of non-maleficence, prompting the students to reflect on whether any circumstances could ethically justify vital organ sales.  </li>
</ul>
<blockquote>
<p><strong>It seems you both agree on the ethical problems with heart markets, though you have a more flexible view on the 'do no harm' principle. As we wrap up, I'm curious: Student 1, has this discussion changed your thinking about organ markets in any way? Are there any distinctions you'd make between selling vital versus non-vital organs?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==b62c9cfcef::student-z21hawwuy29t344c4094df::4f561be66e::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==b62c9cfcef::student-z21hawwuy29t344c4094df::4f561be66e::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==b62c9cfcef::student-z21hawwuy29t344c4094df::4f561be66e::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==b62c9cfcef::student-z21hawwuy29t344c4094df::4f561be66e::55405271b4" class="form-control summary-markdown-editor">- **Students navigated arguments for and against heart markets, initially citing autonomy and the shortage of transplantable organs before shifting to concerns about commodification and exploitation.** Student 1 mistakenly presented pro-market arguments multiple times before embracing the anti-market stance, while Student 2 began by championing personal choice but then acknowledged the devaluation of human life and medical ethics objections.  
- **Their perspectives converged around the ethical problems of treating human life as a commodity, with autonomy acknowledged but outweighed by exploitation and “do no harm” principles.** The conversation evolved from abstract rights claims to concrete worries about vulnerable populations, altruistic motivations for selling organs, and the contradiction of sacrificing one life for another.  
- **Guide played a central role by correcting role inconsistencies, challenging students to justify their shifts, and probing the limits of autonomy, altruism, and medical ethics.** It repeatedly refocused the discussion on exploitation safeguards and the principle of non-maleficence, prompting the students to reflect on whether any circumstances could ethically justify vital organ sales.  


&gt; **It seems you both agree on the ethical problems with heart markets, though you have a more flexible view on the &#39;do no harm&#39; principle. As we wrap up, I&#39;m curious: Student 1, has this discussion changed your thinking about organ markets in any way? Are there any distinctions you&#39;d make between selling vital versus non-vital organs?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==b62c9cfcef::student-z21hawwuy29t344c4094df::4f561be66e::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==b62c9cfcef::student-z21hawwuy29t344c4094df::4f561be66e::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==b62c9cfcef::student-z21hawwuy29t344c4094df::4f561be66e::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==b62c9cfcef::student-z21hawwuy29t344c4094df::4f561be66e::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==be8e2cdede::6d73187980::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Kidney Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==be8e2cdede::6d73187980::55405271b4">
                                  <ul>
<li>
<p><strong>Students debated the ethical viability of kidney markets.</strong> Student 1 maintained that a regulated system—with rigorous health checks and government oversight—could reliably save lives, while Student 2 argued that such a market risks commodifying human bodies and exploiting the vulnerable. Their exchange highlighted a deep-seated tension between practical solutions to kidney shortages and the potential for ethical abuse.</p>
</li>
<li>
<p><strong>Guide pushed students to critically examine regulatory safeguards.</strong> It pressed Student 1 to specify concrete rules that would prevent exploitation and challenged Student 2 to detail the risks of economic coercion, sharpening both their positions on how to best address kidney shortages.  </p>
</li>
</ul>
<blockquote>
<p><strong>Student 1, you mention 'strict rules' to prevent exploitation, but what specific regulations would effectively prevent exploitation while still maintaining a functioning market? Consider that economic pressure often falls hardest on the vulnerable. How would you ensure that financial desperation doesn't become the primary motivation for kidney sales, essentially creating a system where the poor sell organs to the wealthy?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==be8e2cdede::6d73187980::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==be8e2cdede::6d73187980::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==be8e2cdede::6d73187980::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==be8e2cdede::6d73187980::55405271b4" class="form-control summary-markdown-editor">- **Students debated the ethical viability of kidney markets.** Student 1 maintained that a regulated system—with rigorous health checks and government oversight—could reliably save lives, while Student 2 argued that such a market risks commodifying human bodies and exploiting the vulnerable. Their exchange highlighted a deep-seated tension between practical solutions to kidney shortages and the potential for ethical abuse.

- **Guide pushed students to critically examine regulatory safeguards.** It pressed Student 1 to specify concrete rules that would prevent exploitation and challenged Student 2 to detail the risks of economic coercion, sharpening both their positions on how to best address kidney shortages.  
   
&gt; **Student 1, you mention &#39;strict rules&#39; to prevent exploitation, but what specific regulations would effectively prevent exploitation while still maintaining a functioning market? Consider that economic pressure often falls hardest on the vulnerable. How would you ensure that financial desperation doesn&#39;t become the primary motivation for kidney sales, essentially creating a system where the poor sell organs to the wealthy?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==be8e2cdede::6d73187980::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==be8e2cdede::6d73187980::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==be8e2cdede::6d73187980::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==be8e2cdede::6d73187980::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==fa671a3cdf::6d73187980::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Kidney Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==fa671a3cdf::6d73187980::55405271b4">
                                  <ul>
<li>
<p><strong>Students debated the ethics and feasibility of kidney markets.</strong> They argued over whether fixed pricing and strict oversight could prevent exploitation, with one side warning that introducing money might undermine altruistic donation and favor the rich over the poor.</p>
</li>
<li>
<p><strong>Students examined the role of government and healthcare systems in regulating such markets.</strong> They discussed how regulation might work in the US compared to countries with universal healthcare, debating if government involvement would protect vulnerable populations or lead to further inequality.</p>
</li>
<li>
<p><strong>Guide pushed the conversation toward a sharper ethical focus.</strong> Guide repeatedly challenged the students to justify their assumptions about donation versus sale and the impact of financial incentives on moral choices.  </p>
</li>
</ul>
<p><strong>Student 1, you've raised an interesting point about the apparent inconsistency in allowing kidney donation but prohibiting sales. Why do you think society draws this ethical line? Is it possible that introducing financial incentives fundamentally changes the nature of the transaction in ways that matter morally?</strong></p>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==fa671a3cdf::6d73187980::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==fa671a3cdf::6d73187980::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==fa671a3cdf::6d73187980::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==fa671a3cdf::6d73187980::55405271b4" class="form-control summary-markdown-editor">- **Students debated the ethics and feasibility of kidney markets.** They argued over whether fixed pricing and strict oversight could prevent exploitation, with one side warning that introducing money might undermine altruistic donation and favor the rich over the poor.

- **Students examined the role of government and healthcare systems in regulating such markets.** They discussed how regulation might work in the US compared to countries with universal healthcare, debating if government involvement would protect vulnerable populations or lead to further inequality.

- **Guide pushed the conversation toward a sharper ethical focus.** Guide repeatedly challenged the students to justify their assumptions about donation versus sale and the impact of financial incentives on moral choices.  
  
**Student 1, you&#39;ve raised an interesting point about the apparent inconsistency in allowing kidney donation but prohibiting sales. Why do you think society draws this ethical line? Is it possible that introducing financial incentives fundamentally changes the nature of the transaction in ways that matter morally?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==fa671a3cdf::6d73187980::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==fa671a3cdf::6d73187980::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==fa671a3cdf::6d73187980::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==fa671a3cdf::6d73187980::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==3692c9d0df::6d73187980::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Kidney Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==3692c9d0df::6d73187980::55405271b4">
                                  <ul>
<li><strong>Students debated the ethics of kidney markets by weighing potential financial benefits against risks of exploitation.</strong> Initially favoring legalization for its monetary relief, one student shifted perspective after considering how economic coercion and health risks could disproportionately target the poor.</li>
<li><strong>Guide played a key role by challenging student assumptions and probing potential safeguards within the system.</strong> By asking pointed questions about income thresholds and health monitoring, Guide pushed for deeper analysis of whether such measures could mitigate exploitation and ethical concerns.</li>
</ul>
<blockquote>
<p><strong>Student 2, you've raised concerns about economic coercion. If kidney markets included strict income thresholds preventing the poorest from selling, would that address your concerns, or does that create new ethical problems by limiting someone's autonomy over their body?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==3692c9d0df::6d73187980::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==3692c9d0df::6d73187980::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==3692c9d0df::6d73187980::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==3692c9d0df::6d73187980::55405271b4" class="form-control summary-markdown-editor">- **Students debated the ethics of kidney markets by weighing potential financial benefits against risks of exploitation.** Initially favoring legalization for its monetary relief, one student shifted perspective after considering how economic coercion and health risks could disproportionately target the poor.
- **Guide played a key role by challenging student assumptions and probing potential safeguards within the system.** By asking pointed questions about income thresholds and health monitoring, Guide pushed for deeper analysis of whether such measures could mitigate exploitation and ethical concerns.

&gt; **Student 2, you&#39;ve raised concerns about economic coercion. If kidney markets included strict income thresholds preventing the poorest from selling, would that address your concerns, or does that create new ethical problems by limiting someone&#39;s autonomy over their body?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==3692c9d0df::6d73187980::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==3692c9d0df::6d73187980::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==3692c9d0df::6d73187980::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==3692c9d0df::6d73187980::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==93db5196ef::student-dwfilmvkdq==a8cfc07edd::4f561be66e::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Heart Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==93db5196ef::student-dwfilmvkdq==a8cfc07edd::4f561be66e::55405271b4">
                                  <ul>
<li><strong>Students initially clashed over selling vital organs but found common ground on posthumous sales.</strong> Student 2 argued that selling organs could financially benefit families after death, prompting Student 1 to shift from outright opposition to supporting only post-mortem donations. This reframing set the stage for a deeper debate on living sales versus donations after death.  </li>
<li><strong>The live-sale debate centered on compensation, coercion, and justice for the poor.</strong> Student 2 proposed a $100k price tag for a heart and emphasized autonomy, while Student 1 countered that no amount of money could truly compensate for diminished health and that economic desperation would exploit vulnerable populations. They also raised concerns about addictive patterns of organ selling similar to gambling.  </li>
<li><strong>Guide actively probed assumptions and guided students toward systemic and ethical considerations.</strong> It differentiated life insurance from active organ sale, asked how fair compensation could be ensured free from coercion, and invited exploration of alternative donation incentives like opt-out systems rather than a market that targets the poor.  </li>
</ul>
<blockquote>
<p><strong>Student 2, what would fair compensation look like for a vital organ like a heart, and how would we ensure the decision is truly free from economic coercion when someone is desperate enough to consider this option?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==93db5196ef::student-dwfilmvkdq==a8cfc07edd::4f561be66e::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==93db5196ef::student-dwfilmvkdq==a8cfc07edd::4f561be66e::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==93db5196ef::student-dwfilmvkdq==a8cfc07edd::4f561be66e::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==93db5196ef::student-dwfilmvkdq==a8cfc07edd::4f561be66e::55405271b4" class="form-control summary-markdown-editor">- **Students initially clashed over selling vital organs but found common ground on posthumous sales.** Student 2 argued that selling organs could financially benefit families after death, prompting Student 1 to shift from outright opposition to supporting only post-mortem donations. This reframing set the stage for a deeper debate on living sales versus donations after death.  
- **The live-sale debate centered on compensation, coercion, and justice for the poor.** Student 2 proposed a $100k price tag for a heart and emphasized autonomy, while Student 1 countered that no amount of money could truly compensate for diminished health and that economic desperation would exploit vulnerable populations. They also raised concerns about addictive patterns of organ selling similar to gambling.  
- **Guide actively probed assumptions and guided students toward systemic and ethical considerations.** It differentiated life insurance from active organ sale, asked how fair compensation could be ensured free from coercion, and invited exploration of alternative donation incentives like opt-out systems rather than a market that targets the poor.  


&gt; **Student 2, what would fair compensation look like for a vital organ like a heart, and how would we ensure the decision is truly free from economic coercion when someone is desperate enough to consider this option?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==93db5196ef::student-dwfilmvkdq==a8cfc07edd::4f561be66e::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==93db5196ef::student-dwfilmvkdq==a8cfc07edd::4f561be66e::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==93db5196ef::student-dwfilmvkdq==a8cfc07edd::4f561be66e::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==93db5196ef::student-dwfilmvkdq==a8cfc07edd::4f561be66e::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==2092d9aee9::student-dwfilmvkdq==b03ab1d0df::6d73187980::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Kidney Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==2092d9aee9::student-dwfilmvkdq==b03ab1d0df::6d73187980::55405271b4">
                                  <ul>
<li><strong>Students debated the merits of legalizing kidney markets.</strong> One participant argued that regulated markets could empower the poor by providing financial relief and increased access to organs, while the other raised persistent concerns about exploitation and fairness.  </li>
<li><strong>Students refined their positions by mapping out strict regulatory measures and safeguards.</strong> They discussed the roles of government oversight, neutral organizations in matching donors with recipients, and the potential psychological impacts on donors, highlighting the complexities of balancing autonomy and protection.  </li>
<li><strong>Guide challenged students to critically evaluate their assumptions and define concrete safeguards.</strong> It pressed them to consider whether genuine free choice exists in desperate financial situations and to articulate specific regulations that could mitigate exploitation.  </li>
</ul>
<blockquote>
<p><strong>Student 1, you frame kidney selling as empowering for those in poverty, but is it truly free choice when someone's desperate financial situation compels them to sell an organ? Consider whether this creates a two-tiered system where the poor become suppliers for the wealthy. What safeguards would prevent this dynamic?</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==2092d9aee9::student-dwfilmvkdq==b03ab1d0df::6d73187980::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==2092d9aee9::student-dwfilmvkdq==b03ab1d0df::6d73187980::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==2092d9aee9::student-dwfilmvkdq==b03ab1d0df::6d73187980::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==2092d9aee9::student-dwfilmvkdq==b03ab1d0df::6d73187980::55405271b4" class="form-control summary-markdown-editor">- **Students debated the merits of legalizing kidney markets.** One participant argued that regulated markets could empower the poor by providing financial relief and increased access to organs, while the other raised persistent concerns about exploitation and fairness.  
- **Students refined their positions by mapping out strict regulatory measures and safeguards.** They discussed the roles of government oversight, neutral organizations in matching donors with recipients, and the potential psychological impacts on donors, highlighting the complexities of balancing autonomy and protection.  
- **Guide challenged students to critically evaluate their assumptions and define concrete safeguards.** It pressed them to consider whether genuine free choice exists in desperate financial situations and to articulate specific regulations that could mitigate exploitation.  

  
&gt; **Student 1, you frame kidney selling as empowering for those in poverty, but is it truly free choice when someone&#39;s desperate financial situation compels them to sell an organ? Consider whether this creates a two-tiered system where the poor become suppliers for the wealthy. What safeguards would prevent this dynamic?**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==2092d9aee9::student-dwfilmvkdq==b03ab1d0df::6d73187980::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==2092d9aee9::student-dwfilmvkdq==b03ab1d0df::6d73187980::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==2092d9aee9::student-dwfilmvkdq==b03ab1d0df::6d73187980::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==2092d9aee9::student-dwfilmvkdq==b03ab1d0df::6d73187980::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==1329257edf::student-dwfilmvkdq==ed70a0f2dd::82d07d599f::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Weak Agency
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==1329257edf::student-dwfilmvkdq==ed70a0f2dd::82d07d599f::55405271b4">
                                  <ul>
<li><strong>Students debated the statement by contrasting bans and regulations for markets that exploit weak agency.</strong> They cited examples like addictive drugs, military recruitment, kidney donation, gambling, and predatory lending, and evolved from absolutist positions to a harm–benefit framework balancing prohibition and safeguards.  </li>
<li><strong>Student 1 argued that clear net harm should trigger prohibition, while Student 2 favored regulation to preserve autonomy.</strong> Initially skeptical of government bans, Student 1 insisted markets causing more harm than good—drugs, gambling, high-interest loans—should be illegal, whereas Student 2 pressed for targeted safeguards that allow harmless participation without catastrophic losses.  </li>
<li><strong>Guide steered the conversation with targeted questions on defining weak agency, measuring harm versus benefit, and balancing autonomy with protection.</strong> Its prompts on informed consent, the role of lawmakers, and differentiating exploitation types deepened analysis and helped students sharpen their positions.</li>
</ul>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==1329257edf::student-dwfilmvkdq==ed70a0f2dd::82d07d599f::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==1329257edf::student-dwfilmvkdq==ed70a0f2dd::82d07d599f::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==1329257edf::student-dwfilmvkdq==ed70a0f2dd::82d07d599f::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==1329257edf::student-dwfilmvkdq==ed70a0f2dd::82d07d599f::55405271b4" class="form-control summary-markdown-editor">- **Students debated the statement by contrasting bans and regulations for markets that exploit weak agency.** They cited examples like addictive drugs, military recruitment, kidney donation, gambling, and predatory lending, and evolved from absolutist positions to a harm–benefit framework balancing prohibition and safeguards.  
- **Student 1 argued that clear net harm should trigger prohibition, while Student 2 favored regulation to preserve autonomy.** Initially skeptical of government bans, Student 1 insisted markets causing more harm than good—drugs, gambling, high-interest loans—should be illegal, whereas Student 2 pressed for targeted safeguards that allow harmless participation without catastrophic losses.  
- **Guide steered the conversation with targeted questions on defining weak agency, measuring harm versus benefit, and balancing autonomy with protection.** Its prompts on informed consent, the role of lawmakers, and differentiating exploitation types deepened analysis and helped students sharpen their positions.</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==1329257edf::student-dwfilmvkdq==ed70a0f2dd::82d07d599f::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==1329257edf::student-dwfilmvkdq==ed70a0f2dd::82d07d599f::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==1329257edf::student-dwfilmvkdq==ed70a0f2dd::82d07d599f::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==1329257edf::student-dwfilmvkdq==ed70a0f2dd::82d07d599f::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f340be7edd::4f561be66e::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Heart Markets
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f340be7edd::4f561be66e::55405271b4">
                                  <ul>
<li><strong>Students debated the ethics of allowing heart sales.</strong> They weighed personal autonomy against severe risks such as exploitation, inadequate screening, and the potential misuse of the system by vulnerable populations while drawing parallels with physician-assisted suicide.  </li>
<li><strong>Guide pushed the discussion deeper with incisive questions.</strong> It challenged the students to consider how effective safeguards could be implemented and probed the practical difficulties of verifying true intentions and preventing coercion in an ethically charged marketplace.</li>
</ul>
<blockquote>
<p><strong>Student 1, what safeguards do you think would need to be in place to prevent exploitation if people were allowed to sell vital organs like hearts? I see you've raised some interesting points about personal autonomy and the potential for black markets. Student 2 has expressed concerns about the harm this could cause. Let's dig deeper into how such a system might work in practice.</strong></p>
</blockquote>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f340be7edd::4f561be66e::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f340be7edd::4f561be66e::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f340be7edd::4f561be66e::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f340be7edd::4f561be66e::55405271b4" class="form-control summary-markdown-editor">- **Students debated the ethics of allowing heart sales.** They weighed personal autonomy against severe risks such as exploitation, inadequate screening, and the potential misuse of the system by vulnerable populations while drawing parallels with physician-assisted suicide.  
- **Guide pushed the discussion deeper with incisive questions.** It challenged the students to consider how effective safeguards could be implemented and probed the practical difficulties of verifying true intentions and preventing coercion in an ethically charged marketplace.

  
&gt; **Student 1, what safeguards do you think would need to be in place to prevent exploitation if people were allowed to sell vital organs like hearts? I see you&#39;ve raised some interesting points about personal autonomy and the potential for black markets. Student 2 has expressed concerns about the harm this could cause. Let&#39;s dig deeper into how such a system might work in practice.**</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f340be7edd::4f561be66e::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f340be7edd::4f561be66e::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f340be7edd::4f561be66e::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f340be7edd::4f561be66e::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
                  <div class="masonry-item">
                    <div class="card thread-card" id="thread-student-dwfilmvkdq==7d6f80b8dd::student-z21hawwuy29t7abc1642dd::82d07d599f::55405271b4">
                      <div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
                          <h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Weak Agency
                              
                          </h6>
                          
                          
                      </div>
                      <div class="card-body">
                          
                              <div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==7d6f80b8dd::student-z21hawwuy29t7abc1642dd::82d07d599f::55405271b4">
                                  <ul>
<li><strong>Students pinpointed kidney sales and stockbroker-driven trading as prime examples of markets exploiting weak agency, emphasizing their disproportionate personal risks.</strong> Student 1 contrasted the irreversible stakes of selling a kidney with typical consumer trust in markets, and Student 2, playing devil’s advocate, suggested a legal kidney market could offer impoverished sellers a financial lifeline and curb black-market abuses.  </li>
<li><strong>Their debate shifted toward weighing prohibition against regulation, exploring how a compensated kidney market might function.</strong> Student 1 raised concerns about organs becoming tradable collateral and luck determining who can sell, while Student 2 argued that financial incentives could boost supply, enable early health screenings, and be tuned by government oversight to balance supply and demand.  </li>
<li><strong>Guide drove the conversation forward with targeted questions on trade-offs between banning versus regulating exploitative markets.</strong> Its prompts helped students clarify whether legalization could reduce illegal activity and design mechanisms—like a government-backed program—to ensure fairness and public safety.</li>
</ul>
                              </div>
                          
                          
                          <div class="status-message thread-status" id="status-student-dwfilmvkdq==7d6f80b8dd::student-z21hawwuy29t7abc1642dd::82d07d599f::55405271b4" style="display: none;"></div>
                          <div class="spinner-border spinner-border-sm text-orange" role="status" id="spinner-student-dwfilmvkdq==7d6f80b8dd::student-z21hawwuy29t7abc1642dd::82d07d599f::55405271b4" style="display: none;">
                              <span class="sr-only">Loading...</span>
                          </div>
                          
                          <!-- Edit Summary Modal Content -->
                          <div id="summary-editor-container-student-dwfilmvkdq==7d6f80b8dd::student-z21hawwuy29t7abc1642dd::82d07d599f::55405271b4" class="summary-editor-container" style="display: none;">
                              <div class="alert alert-info">
                                  <i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
                              <textarea id="summary-markdown-editor-student-dwfilmvkdq==7d6f80b8dd::student-z21hawwuy29t7abc1642dd::82d07d599f::55405271b4" class="form-control summary-markdown-editor">- **Students pinpointed kidney sales and stockbroker-driven trading as prime examples of markets exploiting weak agency, emphasizing their disproportionate personal risks.** Student 1 contrasted the irreversible stakes of selling a kidney with typical consumer trust in markets, and Student 2, playing devil’s advocate, suggested a legal kidney market could offer impoverished sellers a financial lifeline and curb black-market abuses.  
- **Their debate shifted toward weighing prohibition against regulation, exploring how a compensated kidney market might function.** Student 1 raised concerns about organs becoming tradable collateral and luck determining who can sell, while Student 2 argued that financial incentives could boost supply, enable early health screenings, and be tuned by government oversight to balance supply and demand.  
- **Guide drove the conversation forward with targeted questions on trade-offs between banning versus regulating exploitative markets.** Its prompts helped students clarify whether legalization could reduce illegal activity and design mechanisms—like a government-backed program—to ensure fairness and public safety.</textarea>
                              <div class="mt-3">
                                  <button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==7d6f80b8dd::student-z21hawwuy29t7abc1642dd::82d07d599f::55405271b4">
                                      <i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
                                  <button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==7d6f80b8dd::student-z21hawwuy29t7abc1642dd::82d07d599f::55405271b4">
                                      <i class="fas fa-times mr-1"></i> Cancel
                                  </button>
                                  <div class="spinner-border text-primary ml-2 summary-editor-spinner" role="status" id="summary-editor-spinner-student-dwfilmvkdq==7d6f80b8dd::student-z21hawwuy29t7abc1642dd::82d07d599f::55405271b4" style="display: none;">
                                      <span class="sr-only">Saving...</span>
                                  </div>
                              </div>
                              <div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==7d6f80b8dd::student-z21hawwuy29t7abc1642dd::82d07d599f::55405271b4" style="display: none;"></div>
                          </div>
                      </div>
                    </div>
                  </div>
                
              </div>
            
          </div>
        </div>
      </div>
      
      <div style="clear:both; height:20px;"></div>
      
      <!-- Add Qualtrics Survey Data Card - if data exists -->
      
      <div class="row mb-4">
        <div class="col-12">
          <div class="py-4 mb-4">
            <h5 class="section-title">
              <div class="title-text"><i class="fas fa-chart-bar mr-1"></i> Post-Chat Survey Data</div>
            </h5>
            <div class="card-body pt-0">
              <div class="row">
                <div class="col-md-4 d-flex flex-column align-items-center justify-content-center py-3">
                  <h3>25</h3>
                  <p class="text-muted">Total Survey Responses</p>
                </div>
                <div class="col-md-4 d-flex flex-column align-items-center justify-content-center py-3">
                  <h3>13</h3>
                  <p class="text-muted">Threads With Surveys</p>
                </div>
                <div class="col-md-4 d-flex flex-column align-items-center justify-content-center py-3">
                  <h3>92.9%</h3>
                  <p class="text-muted">Response Rate</p>
                </div>
              </div>
              <div class="d-flex justify-content-between align-items-center text-muted small mb-0" style="gap: 1rem;">
                <span class="ml-auto text-right" style="flex:1; text-align:right;">Last updated: May 7, 2025 12:15 AM</span>
                
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Separate row for survey histogram charts floating on background -->
      <div class="row mb-4">
        <div class="col-12">
          
            <!-- Overall Rating and Guide Feedback -->
            <div class="row">
              
              <div class="col-md-6 mb-4">
                <div class="card h-100 thread-card">
                  <div class="card-body p-0">
                    
                    
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">How was your chat?</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">🔥 Awesome</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">10 (40.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:40.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">👍 Good</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">8 (32.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:32.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">😐 It's OK</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">6 (24.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:24.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">👎 Not a fan</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">💩 Hated it</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">1 (4.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:4.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.96 <span style="opacity:0.7;">(95% confidence interval: 1.54–2.38)</span></div>
    </div>
</div>
                  </div>
                </div>
              </div>
              
              
              
              <div class="col-md-6 mb-4">
                <div class="card h-100 thread-card">
                  <div class="card-body p-0">
                    
                    
                      
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">Guide contributed the right amount</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">19 (76.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:76.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">6 (24.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:24.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 0.76 <span style="opacity:0.7;">(95% confidence interval: 0.58–0.94)</span></div>
    </div>
</div>
                    
                  </div>
                </div>
              </div>
              
            </div>
            
            <div style="height: 2rem;"></div>
            <div class="row">
              
              
                
              
                
              
                
              
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 thread-card">
                      <div class="card-body p-0">
                        
                        
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">I felt comfortable sharing my honest opinions with my partner</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">4 (36.4%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:36.36363636363637%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">6 (54.5%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:54.54545454545454%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">1 (9.1%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:9.090909090909092%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.27 <span style="opacity:0.7;">(95% confidence interval: 0.84–1.71)</span></div>
    </div>
</div>
                      </div>
                    </div>
                  </div>
                
              
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 thread-card">
                      <div class="card-body p-0">
                        
                        
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">I was not offended by my partner's perspective</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">9 (60.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:60.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">5 (33.3%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:33.33333333333333%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">1 (6.7%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:6.666666666666667%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.53 <span style="opacity:0.7;">(95% confidence interval: 1.18–1.89)</span></div>
    </div>
</div>
                      </div>
                    </div>
                  </div>
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 thread-card">
                      <div class="card-body p-0">
                        
                        
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">It was valuable to chat with a student who did not share my perspective</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">3 (23.1%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:23.076923076923077%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">8 (61.5%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:61.53846153846154%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">2 (15.4%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:15.384615384615385%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.08 <span style="opacity:0.7;">(95% confidence interval: 0.69–1.46)</span></div>
    </div>
</div>
                      </div>
                    </div>
                  </div>
                
              
                
              
                
                  <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 thread-card">
                      <div class="card-body p-0">
                        
                        
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
    <div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
        <div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">It would be good if more students and classes used Sway</div>
    </div>
    <div style="padding:25px;">
        <div style="position:relative; width:100%;">

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">9 (56.2%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:56.25%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">4 (25.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:25.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">2 (12.5%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:12.5%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">1 (6.2%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:6.25%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>

            <div style="margin-bottom:12px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                    <span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
                    <span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
                </div>
                <div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
                    <div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
                </div>
            </div>
        </div>
        <div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.31 <span style="opacity:0.7;">(95% confidence interval: 0.81–1.82)</span></div>
    </div>
</div>
                      </div>
                    </div>
                  </div>
                
              
            </div>
            
            <!-- Opinion Changes Section -->
            
          
        </div>
      </div>
      
      <!-- End Qualtrics Survey Data Section -->
    </div>
  </div>
  
<!-- Modal containers will be dynamically injected here by JS if needed -->
<div id="modal-container"></div> 
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
  

<!-- =====================
     Core Utilities
     ===================== -->
<script>
  // Debug logging utility
  function debug_log(message, level, details = null) {
    if (details) {
      console.log(`DEBUG[${level}]:`, message, details);
    } else {
      console.log(`DEBUG[${level}]:`, message);
    }
  }

  // Convert UTC timestamps to local timezone
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('[data-utc-time]').forEach(function(element) {
      const utcTime = element.getAttribute('data-utc-time');
      try {
        const localDate = new Date(utcTime);
        if (!isNaN(localDate)) {
          const options = {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
          };
          const localTimeStr = localDate.toLocaleString(undefined, options);
          const localTimeElement = element.nextElementSibling;
          if (localTimeElement && localTimeElement.classList.contains('local-time')) {
            localTimeElement.textContent = localTimeStr;
            element.style.display = 'none';
            localTimeElement.style.display = 'inline';
          }
        }
      } catch (e) {
        console.error('Error converting time:', e);
      }
    });
  });
</script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- =====================
     Theme Toggle
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.getElementById('theme-toggle-input'); // Fixed id to match the input in _header.html
    if (!themeToggle) return;
    // Determine initial theme from localStorage or template variable
    let initialTheme = localStorage.getItem('theme');
    if (!initialTheme) {
      initialTheme = 'dark-mode' === 'light-mode' ? 'light' : 'dark';
    }
    // Set initial toggle state and class
    themeToggle.checked = initialTheme === 'light';
    document.documentElement.className = initialTheme === 'light' ? 'light-mode' : 'dark-mode';
    // Add event listener for theme toggle
    themeToggle.addEventListener('change', function() {
      if (this.checked) {
        document.documentElement.classList.remove('dark-mode');
        document.documentElement.classList.add('light-mode');
        localStorage.setItem('theme', 'light');
      } else {
        document.documentElement.classList.remove('light-mode');
        document.documentElement.classList.add('dark-mode');
        localStorage.setItem('theme', 'dark');
      }
    });
  });
</script>

<!-- =====================
     Summary/Report Generation & Polling
     ===================== -->
<script>
  let pollingInterval = null;
  let cancelRequested = false;
  document.addEventListener('DOMContentLoaded', function() {
    const generateBtn = document.getElementById('generate-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const reportBtn = document.getElementById('report-btn');
    let hasSavedSummaries = "true" === "true";
    
    // Check directly if there are any thread summaries actually present on the page
    const allThreadSummaries = document.querySelectorAll('.thread-summary.markdown-content');
    const hasVisibleSummaries = Array.from(allThreadSummaries).some(el => 
      el.innerHTML.trim() !== '' && el.style.display !== 'none'
    );
    
    // If we have visible summaries on the page, allow generating the report regardless of server-side flag
    if (hasVisibleSummaries) {
      hasSavedSummaries = true;
      debug_log("Enabling report button because visible summaries were found on page", 1);
    }
    
    if (reportBtn && hasSavedSummaries) {
      reportBtn.disabled = false;
      debug_log("Enabling report button because saved summaries exist", 1);
    }
    // Check if any thread is currently in 'generating' status
    const hasGeneratingThreads = Array.from(document.querySelectorAll('.thread-status'))
      .some(el => el.textContent === 'Generating summary...');
    if (hasGeneratingThreads) {
      startPolling();
      if (generateBtn) generateBtn.style.display = 'none';
      if (cancelBtn) cancelBtn.style.display = 'inline-block';
    }
    // Generate summaries
    if (generateBtn) {
      generateBtn.addEventListener('click', function() {
        document.querySelectorAll('.thread-status').forEach(status => {
          status.textContent = 'Queued for generation...';
          status.style.display = 'block';
          status.className = 'thread-status text-info';
        });
        generateBtn.style.display = 'none';
        if (cancelBtn) cancelBtn.style.display = 'inline-block';
        fetch('/assignment/55405271b4/generate_summaries', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        })
        .then(response => {
          if (response.ok) {
            debug_log("Summaries queued successfully", 1);
            startPolling();
            if (reportBtn) reportBtn.disabled = false;
          } else {
            debug_log("Error queueing summaries", 1);
          }
        })
        .catch(error => debug_log("Network error:", error, 1));
      });
      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          cancelRequested = true;
          fetch('/assignment/55405271b4/cancel_generation', { method: 'POST' })
            .then(response => {
              if (response.ok) {
                stopPolling();
                document.querySelectorAll('.thread-status').forEach(status => {
                  if (status.textContent === 'Queued for generation...') status.style.display = 'none';
                });
                document.querySelectorAll('.spinner-border').forEach(spinner => spinner.style.display = 'none');
                generateBtn.style.display = 'inline-block';
                cancelBtn.style.display = 'none';
              }
            });
        });
      }
    }
    // Report button
    if (reportBtn) {
      // Show/hide advanced thinking controls based on model selection
      const modelToggleGroup = document.getElementById('report-model-toggle-group');
      const advancedThinkingControls = document.getElementById('advanced-thinking-controls');
      function updateThinkingControlsVisibility() {
        const checked = modelToggleGroup.querySelector('input[type=radio]:checked');
        if (checked && checked.value === 'anthropic') {
          advancedThinkingControls.style.display = 'flex';
        } else {
          advancedThinkingControls.style.display = 'none';
        }
      }
      if (modelToggleGroup && advancedThinkingControls) {
        modelToggleGroup.addEventListener('change', updateThinkingControlsVisibility);
        updateThinkingControlsVisibility();
      }
      reportBtn.addEventListener('click', function() {
        const reportSpinner = document.getElementById('report-spinner');
        if (reportSpinner) reportSpinner.style.display = 'inline-block';
        reportBtn.disabled = true;
        const noReportMsg = document.getElementById('no-report-msg');
        if (noReportMsg) {
          noReportMsg.textContent = 'Generating instructor report...';
          noReportMsg.className = 'text-info mb-0';
        }
        // Collect all visible summaries from the UI
        const summaries = {};
        document.querySelectorAll('.thread-card').forEach(card => {
          const threadId = card.id.replace('thread-', '');
          const summaryEl = card.querySelector('.thread-summary');
          if (summaryEl && summaryEl.innerHTML.trim() !== '' && summaryEl.style.display !== 'none') {
            // Try to get the raw markdown if available
            let summaryContent = '';
            const editorEl = card.querySelector('.summary-markdown-editor');
            if (editorEl && editorEl.value.trim() !== '') {
              summaryContent = editorEl.value.trim();
            } else {
              // Otherwise use the HTML content
              summaryContent = summaryEl.innerHTML;
            }
            summaries[threadId] = {
              thread_id: threadId,
              assignment_id: '55405271b4',
              summary: summaryContent,
              content: summaryContent,
              status: 'completed'
            };
          }
        });
        debug_log(`Collected ${Object.keys(summaries).length} visible summaries from UI`, 1);
        // Get selected model provider
        let modelProvider = 'openai';
        const checked = document.querySelector('#report-model-toggle-group input[type=radio]:checked');
        if (checked) modelProvider = checked.value;
        // Get advanced thinking mode and budget if Anthropic
        let enableThinking = false;
        let thinkingBudgetTokens = 4096;
        if (modelProvider === 'anthropic') {
          const enableThinkingCheckbox = document.getElementById('enable-thinking-checkbox');
          const thinkingBudgetInput = document.getElementById('thinking-budget-input');
          if (enableThinkingCheckbox && enableThinkingCheckbox.checked) {
            enableThinking = true;
          }
          if (thinkingBudgetInput && thinkingBudgetInput.value) {
            thinkingBudgetTokens = parseInt(thinkingBudgetInput.value) || 4096;
          }
        }
        fetch('/assignment/55405271b4/generate_report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            summaries: summaries,
            model_provider: modelProvider,
            enable_thinking: enableThinking,
            thinking_budget_tokens: thinkingBudgetTokens
          })
        })
        .then(response => response.json())
        .then(data => {
          debug_log("Report generation initiated:", data, 1);
          checkReportStatus();
        })
        .catch(error => {
          debug_log("Error generating report:", error, 1);
          reportBtn.disabled = false;
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (noReportMsg) {
            noReportMsg.textContent = 'Error generating report. Please try again.';
            noReportMsg.className = 'text-danger mb-0';
          }
        });
      });
    }
    // Refresh data
    const refreshDataBtn = document.getElementById('refresh-data-btn');
    if (refreshDataBtn) {
      refreshDataBtn.addEventListener('click', function() {
        const refreshSpinner = document.getElementById('refresh-spinner');
        if (refreshSpinner) refreshSpinner.style.display = 'inline-block';
        refreshDataBtn.disabled = true;
        fetch('/assignment/55405271b4/refresh_data', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
          debug_log("Data refresh initiated:", data, 1);
          window.location.reload();
        })
        .catch(error => {
          debug_log("Error refreshing data:", error, 1);
          if (refreshSpinner) refreshSpinner.style.display = 'none';
          refreshDataBtn.disabled = false;
          alert('Error refreshing data. Please try again.');
        });
      });
    }
    // Regenerate title
    const regenerateTitleBtn = document.getElementById('regenerate-title-btn');
    if (regenerateTitleBtn) {
      regenerateTitleBtn.addEventListener('click', function() {
        regenerateTitleBtn.disabled = true;
        const icon = regenerateTitleBtn.querySelector('i');
        const originalIcon = icon.className;
        icon.className = 'fas fa-spinner fa-spin';
        fetch('/assignment/55405271b4/regenerate_title', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const titleEl = document.querySelector('.generated-title');
            if (titleEl) titleEl.textContent = data.title;
            console.log("Title regenerated:", data.title);
          } else {
            console.error("Error regenerating title:", data.message);
            alert("Error regenerating title: " + data.message);
          }
          regenerateTitleBtn.disabled = false;
          icon.className = originalIcon;
        })
        .catch(error => {
          console.error("Error:", error);
          alert("Error regenerating title. Please try again.");
          regenerateTitleBtn.disabled = false;
          icon.className = originalIcon;
        });
      });
    }
    
    // Final check to ensure report button is enabled if summaries exist
    setTimeout(function() {
      const reportBtn = document.getElementById('report-btn');
      if (reportBtn && reportBtn.disabled) {
        const visibleSummaries = document.querySelectorAll('.thread-summary.markdown-content');
        const hasContent = Array.from(visibleSummaries).some(el => 
          el.innerHTML.trim() !== '' && el.style.display !== 'none'
        );
        
        if (hasContent) {
          reportBtn.disabled = false;
          debug_log("Enabling report button in final check - summaries exist", 1);
        }
      }
    }, 500); // Short delay to ensure all content is processed
  });
  function startPolling() {
    if (pollingInterval) clearInterval(pollingInterval);
    pollingInterval = setInterval(checkSummaryStatus, 2000);
    checkSummaryStatus();
  }
  function stopPolling() {
    if (pollingInterval) {
      clearInterval(pollingInterval);
      pollingInterval = null;
    }
  }
  function checkSummaryStatus() {
    fetch('/assignment/55405271b4/summary_status')
      .then(response => response.json())
      .then(data => {
        let activeGeneration = false;
        Object.entries(data).forEach(([sessionId, threadInfo]) => {
          const statusEl = document.getElementById(`status-${sessionId}`);
          const summaryEl = document.getElementById(`summary-${sessionId}`);
          const spinnerEl = document.getElementById(`spinner-${sessionId}`);
          if (threadInfo.status === 'generating') {
            activeGeneration = true;
            if (statusEl) {
              statusEl.textContent = 'Generating summary...';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-warning';
            }
            if (spinnerEl) spinnerEl.style.display = 'inline-block';
          } else if (threadInfo.status === 'completed') {
            if (statusEl) statusEl.style.display = 'none';
            if (spinnerEl) spinnerEl.style.display = 'none';
            if (summaryEl && threadInfo.render_html) {
              summaryEl.innerHTML = threadInfo.render_html;
              summaryEl.style.display = 'block';
              // Update the markdown textarea value for this thread
              var textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
              if (textarea) {
                // If threadInfo has markdown, use it; otherwise, fallback to extracting from HTML
                if (threadInfo.markdown) {
                  textarea.value = threadInfo.markdown;
                } else if (threadInfo.render_html) {
                  // Optionally, convert HTML back to markdown if needed (or leave blank)
                  textarea.value = '';
                }
                // If CodeMirror is open for this thread, update its value too
                if (window.summaryEditors && window.summaryEditors[sessionId]) {
                  window.summaryEditors[sessionId].setValue(textarea.value);
                  window.summaryEditors[sessionId].refresh();
                }
              }
              // If a summary was successfully displayed, enable the report button
              const reportBtn = document.getElementById('report-btn');
              if (reportBtn) {
                reportBtn.disabled = false;
                debug_log("Enabling report button because a summary was loaded", 1);
              }
            }
          } else if (threadInfo.status === 'queued') {
            activeGeneration = true;
            if (statusEl) {
              statusEl.textContent = 'Queued for generation...';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-info';
            }
            if (spinnerEl) spinnerEl.style.display = 'none';
          } else if (threadInfo.status === 'error') {
            if (statusEl) {
              statusEl.textContent = 'Error generating summary';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-danger';
            }
            if (spinnerEl) spinnerEl.style.display = 'none';
          } else if (threadInfo.status === 'skipped') {
            if (statusEl) {
              statusEl.textContent = threadInfo.message || 'Skipped due to insufficient messages';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-warning';
            }
            if (spinnerEl) spinnerEl.style.display = 'none';
          }
        });
        if (!activeGeneration) {
          stopPolling();
          const generateBtn = document.getElementById('generate-btn');
          const cancelBtn = document.getElementById('cancel-btn');
          if (generateBtn) generateBtn.style.display = 'inline-block';
          if (cancelBtn) cancelBtn.style.display = 'none';
          const reportBtn = document.getElementById('report-btn');
          if (reportBtn) reportBtn.disabled = false;
        }
      })
      .catch(error => debug_log('Error checking summary status:', error, 1));
  }
  function checkReportStatus() {
    fetch('/assignment/55405271b4/report_status')
      .then(response => response.json())
      .then(data => {
        const reportBtn = document.getElementById('report-btn');
        const reportSpinner = document.getElementById('report-spinner');
        const noReportMsg = document.getElementById('no-report-msg');
        const reportSection = document.getElementById('report-section');
        
        debug_log("Report status update:", data, 1);
        
        if (data.status === 'completed') {
          // Report generation completed
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (reportBtn) {
            reportBtn.disabled = false;
            reportBtn.textContent = 'Regenerate report';
          }
          
          // Only update the UI if we have content
          if (data.content && reportSection) {
            const reportContent = document.createElement('div');
            reportContent.id = 'report-content';
            reportContent.className = 'markdown-content';
            const styleTag = document.createElement('style');
            styleTag.textContent = `#report-content ul ul {margin-top:0.5em;margin-bottom:0.5em;padding-left:2em;}#report-content li > ul {margin-left:1em;}`;
            reportContent.appendChild(styleTag);
            
            // Check if render_html is available first, otherwise use content
            if (data.render_html) {
              reportContent.innerHTML += data.render_html;
            } else {
              reportContent.innerHTML += data.content;
            }
            
            const generatedText = document.createElement('div');
            generatedText.className = 'text-muted mt-2 d-flex justify-content-end align-items-center';
            
            // Create formatted date display
            const formattedDate = new Date(data.generated_at).toLocaleDateString('en-US', {
              month: 'short', 
              day: 'numeric', 
              year: 'numeric',
              hour: 'numeric',
              minute: '2-digit',
              hour12: true
            });
            
            generatedText.innerHTML = `
              <span class="text-right" style="flex:1; text-align:right;">Generated on: ${formattedDate}</span>
              ${!exportMode ? `
                <button type="button" class="btn btn-link btn-sm text-muted p-0 ml-2" id="edit-report-btn" title="Edit report" style="vertical-align: baseline;">
                  <i class="fas fa-pencil-alt"></i>
                </button>
              ` : ''}
            `;
            
            // Clear existing content and append new content
            reportSection.innerHTML = '';
            reportSection.appendChild(reportContent);
            reportSection.appendChild(generatedText);
            
            // Convert UTC timestamps to local
            const utcTimeElements = reportSection.querySelectorAll('[data-utc-time]');
            utcTimeElements.forEach(function(element) {
              const utcTime = element.getAttribute('data-utc-time');
              try {
                const localDate = new Date(utcTime);
                if (!isNaN(localDate)) {
                  const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true };
                  const localTimeStr = localDate.toLocaleString(undefined, options);
                  const localTimeElement = element.nextElementSibling;
                  if (localTimeElement && localTimeElement.classList.contains('local-time')) {
                    localTimeElement.textContent = localTimeStr;
                    element.style.display = 'none';
                    localTimeElement.style.display = 'inline';
                  }
                }
              } catch (e) { console.error('Error converting time:', e); }
            });
            
            debug_log("Updated report UI with new content", 1);
          } else {
            debug_log("Report completed but no content received", 2);
          }
        } else if (data.status === 'generating' || data.status === 'running') {
          // Report is still being generated
          if (noReportMsg) {
            noReportMsg.textContent = 'Generating instructor report...';
            noReportMsg.className = 'text-info mb-0';
          }
          
          // Show elapsed time if available
          if (data.elapsed_seconds) {
            const elapsed = Math.round(data.elapsed_seconds);
            if (noReportMsg) {
              noReportMsg.textContent = `Generating instructor report... (${elapsed}s)`;
            }
          }
          
          // Continue polling
          setTimeout(checkReportStatus, 2000);
        } else if (data.status === 'error') {
          // Error generating report
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (reportBtn) reportBtn.disabled = false;
          if (noReportMsg) {
            noReportMsg.textContent = `Error generating report: ${data.error || 'Unknown error'}`;
            noReportMsg.className = 'text-danger mb-0';
          }
        } else {
          // Unknown or not_started status
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (reportBtn) reportBtn.disabled = false;
          if (data.report_exists && reportSection) {
            // If report exists but no status, try refreshing the page after a timeout
            debug_log("Report exists but status not provided - will try to reload content", 2);
            setTimeout(checkReportStatus, 2000);
          }
        }
      })
      .catch(error => {
        debug_log("Error checking report status:", error, 2);
        const reportSpinner = document.getElementById('report-spinner');
        const reportBtn = document.getElementById('report-btn');
        const noReportMsg = document.getElementById('no-report-msg');
        if (reportSpinner) reportSpinner.style.display = 'none';
        if (reportBtn) reportBtn.disabled = false;
        if (noReportMsg) {
          noReportMsg.textContent = 'Error checking report status. Please try again.';
          noReportMsg.className = 'text-danger mb-0';
        }
      });
  }
</script>

<!-- =====================
     CodeMirror for Editing
     ===================== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/markdown/markdown.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/material-darker.min.css">
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Report editing
    const editReportBtn = document.getElementById('edit-report-btn');
    const reportContent = document.getElementById('report-content');
    const reportEditorContainer = document.getElementById('report-editor-container');
    const saveReportBtn = document.getElementById('save-report-btn');
    const cancelReportEditBtn = document.getElementById('cancel-report-edit-btn');
    const editorSpinner = document.getElementById('editor-spinner');
    const statusMessage = document.getElementById('editor-status-message');
    let reportEditor;
    const reportMarkdownEditor = document.getElementById('report-markdown-editor');
    if (reportMarkdownEditor) {
      reportEditor = CodeMirror.fromTextArea(reportMarkdownEditor, {
        lineNumbers: true,
        theme: 'material-darker',
        mode: 'markdown',
        lineWrapping: true
      });
    }
    if (editReportBtn) {
      editReportBtn.addEventListener('click', function() {
        reportContent.style.display = 'none';
        reportEditorContainer.style.display = 'block';
        if (reportEditor) reportEditor.refresh();
      });
    }
    if (cancelReportEditBtn) {
      cancelReportEditBtn.addEventListener('click', function() {
        reportContent.style.display = 'block';
        reportEditorContainer.style.display = 'none';
        statusMessage.style.display = 'none';
      });
    }
    if (saveReportBtn) {
      saveReportBtn.addEventListener('click', function() {
        const markdown = reportEditor.getValue();
        if (!markdown.trim()) {
          showEditorStatus('Report content cannot be empty', 'error');
          return;
        }
        editorSpinner.style.display = 'inline-block';
        fetch('/assignment/55405271b4/edit_report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ markdown: markdown })
        })
        .then(response => response.json())
        .then(data => {
          editorSpinner.style.display = 'none';
          if (data.success) {
            reportContent.innerHTML = data.content;
            showEditorStatus(data.message, 'success');
            setTimeout(() => {
              reportContent.style.display = 'block';
              reportEditorContainer.style.display = 'none';
              statusMessage.style.display = 'none';
            }, 1500);
          } else {
            showEditorStatus(data.message, 'error');
          }
        })
        .catch(error => {
          editorSpinner.style.display = 'none';
          showEditorStatus('Error saving report: ' + error, 'error');
        });
      });
    }
    function showEditorStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = `status-message ${type}`;
      statusMessage.style.display = 'block';
      if (type === 'success') {
        setTimeout(() => { statusMessage.style.display = 'none'; }, 3000);
      }
    }
  });
</script>

<!-- =====================
     Summary Editing (CodeMirror)
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const editSummaryBtns = document.querySelectorAll('.edit-summary-btn');
    const regenerateSummaryBtns = document.querySelectorAll('.regenerate-summary-btn');
    const summaryEditors = {};
    editSummaryBtns.forEach(btn => {
      const sessionId = btn.getAttribute('data-session-id');
      const summaryElement = document.getElementById(`summary-${sessionId}`);
      const editorContainer = document.getElementById(`summary-editor-container-${sessionId}`);
      btn.addEventListener('click', function() {
        summaryElement.style.display = 'none';
        editorContainer.style.display = 'block';
        if (!summaryEditors[sessionId]) {
          const textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
          let markdownContent = textarea.value;
          if (!markdownContent) {
            markdownContent = summaryElement.innerHTML.replace(/<button.*?<\/button>/g, '');
          }
          summaryEditors[sessionId] = CodeMirror.fromTextArea(textarea, {
            lineNumbers: true,
            theme: 'material-darker',
            mode: 'markdown',
            lineWrapping: true
          });
          summaryEditors[sessionId].setValue(markdownContent);
          summaryEditors[sessionId].refresh();
        } else {
          summaryEditors[sessionId].refresh();
        }
      });
      const cancelBtn = document.querySelector(`.cancel-summary-edit-btn[data-session-id="${sessionId}"]`);
      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          summaryElement.style.display = 'block';
          editorContainer.style.display = 'none';
          document.getElementById(`summary-editor-status-${sessionId}`).style.display = 'none';
        });
      }
      const saveBtn = document.querySelector(`.save-summary-btn[data-session-id="${sessionId}"]`);
      if (saveBtn) {
        saveBtn.addEventListener('click', function() {
          const markdown = summaryEditors[sessionId].getValue();
          if (!markdown.trim()) {
            showSummaryStatus(sessionId, 'Summary content cannot be empty', 'error');
            return;
          }
          const spinner = document.getElementById(`summary-editor-spinner-${sessionId}`);
          spinner.style.display = 'inline-block';
          fetch('/assignment/55405271b4/edit_summary', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ session_id: sessionId, markdown: markdown })
          })
          .then(response => response.json())
          .then(data => {
            spinner.style.display = 'none';
            if (data.success) {
              summaryElement.innerHTML = data.render_html || data.content;
              summaryElement.style.display = 'block';
              // Update the markdown textarea value
              var textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
              if (textarea) {
                textarea.value = markdown;
                if (window.summaryEditors && window.summaryEditors[sessionId]) {
                  window.summaryEditors[sessionId].setValue(markdown);
                  window.summaryEditors[sessionId].refresh();
                }
              }
              showSummaryStatus(sessionId, data.message, 'success');
              setTimeout(() => {
                editorContainer.style.display = 'none';
                document.getElementById(`summary-editor-status-${sessionId}`).style.display = 'none';
                attachButtonListeners(sessionId);
              }, 1500);
            } else {
              showSummaryStatus(sessionId, data.message || 'Error saving summary', 'error');
            }
          })
          .catch(error => {
            spinner.style.display = 'none';
            showSummaryStatus(sessionId, 'Error saving summary: ' + error, 'error');
          });
        });
      }
    });
    regenerateSummaryBtns.forEach(btn => {
      const sessionId = btn.getAttribute('data-session-id');
      const summaryElement = document.getElementById(`summary-${sessionId}`);
      btn.addEventListener('click', function() {
        // Removed confirmation dialog for immediate regeneration
        const statusElement = document.getElementById(`status-${sessionId}`);
        const spinnerElement = document.getElementById(`spinner-${sessionId}`);
        if (statusElement && spinnerElement) {
          statusElement.textContent = 'Regenerating summary...';
          statusElement.className = 'status-message thread-status text-info';
          statusElement.style.display = 'block';
          spinnerElement.style.display = 'inline-block';
          summaryElement.style.opacity = '0.5';
          fetch('/assignment/55405271b4/regenerate_summary', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ session_id: sessionId })
          })
          .then(response => response.json())
          .then(data => {
            spinnerElement.style.display = 'none';
            if (data.success) {
              summaryElement.innerHTML = data.content;
              summaryElement.style.opacity = '1';
              statusElement.textContent = data.message;
              statusElement.className = 'status-message thread-status success';
              attachButtonListeners(sessionId);
              setTimeout(() => { statusElement.style.display = 'none'; }, 3000);
            } else {
              summaryElement.style.opacity = '1';
              statusElement.textContent = data.message || 'Error regenerating summary';
              statusElement.className = 'status-message thread-status error';
              setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
            }
          })
          .catch(error => {
            spinnerElement.style.display = 'none';
            summaryElement.style.opacity = '1';
            statusElement.textContent = 'Error regenerating summary: ' + error;
            statusElement.className = 'status-message thread-status error';
            setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
          });
        }
      });
    });
    function attachButtonListeners(sessionId) {
      const newEditBtn = document.querySelector(`.edit-summary-btn[data-session-id="${sessionId}"]`);
      const newRegenerateBtn = document.querySelector(`.regenerate-summary-btn[data-session-id="${sessionId}"]`);
      if (newEditBtn) {
        const summaryElement = document.getElementById(`summary-${sessionId}`);
        const editorContainer = document.getElementById(`summary-editor-container-${sessionId}`);
        newEditBtn.addEventListener('click', function() {
          summaryElement.style.display = 'none';
          editorContainer.style.display = 'block';
          if (!summaryEditors[sessionId]) {
            const textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
            let markdownContent = textarea.value;
            if (!markdownContent) {
              markdownContent = summaryElement.innerHTML.replace(/<button.*?<\/button>/g, '');
            }
            summaryEditors[sessionId] = CodeMirror.fromTextArea(textarea, {
              lineNumbers: true,
              theme: 'material-darker',
              mode: 'markdown',
              lineWrapping: true
            });
            summaryEditors[sessionId].setValue(markdownContent);
            summaryEditors[sessionId].refresh();
          } else {
            summaryEditors[sessionId].refresh();
          }
        });
      }
      if (newRegenerateBtn) {
        newRegenerateBtn.addEventListener('click', function() {
          // Removed confirmation dialog for immediate regeneration
          const summaryElement = document.getElementById(`summary-${sessionId}`);
          const statusElement = document.getElementById(`status-${sessionId}`);
          const spinnerElement = document.getElementById(`spinner-${sessionId}`);
          if (statusElement && spinnerElement) {
            statusElement.textContent = 'Regenerating summary...';
            statusElement.className = 'status-message thread-status text-info';
            statusElement.style.display = 'block';
            spinnerElement.style.display = 'inline-block';
            summaryElement.style.opacity = '0.5';
            fetch('/assignment/55405271b4/regenerate_summary', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ session_id: sessionId })
            })
            .then(response => response.json())
            .then(data => {
              spinnerElement.style.display = 'none';
              if (data.success) {
                summaryElement.innerHTML = data.content;
                summaryElement.style.opacity = '1';
                statusElement.textContent = data.message;
                statusElement.className = 'status-message thread-status success';
                attachButtonListeners(sessionId);
                setTimeout(() => { statusElement.style.display = 'none'; }, 3000);
              } else {
                summaryElement.style.opacity = '1';
                statusElement.textContent = data.message || 'Error regenerating summary';
                statusElement.className = 'status-message thread-status error';
                setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
              }
            })
            .catch(error => {
              spinnerElement.style.display = 'none';
              summaryElement.style.opacity = '1';
              statusElement.textContent = 'Error regenerating summary: ' + error;
              statusElement.className = 'status-message thread-status error';
              setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
            });
          }
        });
      }
    }
    function showSummaryStatus(sessionId, message, type) {
      const statusEl = document.getElementById(`summary-editor-status-${sessionId}`);
      statusEl.textContent = message;
      statusEl.className = `status-message ${type}`;
      statusEl.style.display = 'block';
      if (type === 'success') {
        setTimeout(() => { statusEl.style.display = 'none'; }, 3000);
      }
    }
  });
</script>

<!-- =====================
     Export/Share Functionality
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Export button
    const exportBtn = document.querySelector('a[href*="/export"]');
    if (exportBtn) {
      exportBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const currentTheme = localStorage.getItem('theme') === 'light' ? 'light-mode' : 'dark-mode';
        const exportUrl = new URL(this.href, window.location.origin);
        
        // Add selected histogram fields to export URL
        const selectedHistograms = getSelectedHistograms();
        if (selectedHistograms.length > 0) {
          exportUrl.searchParams.set('histograms', selectedHistograms.join(','));
        }
        
        exportUrl.searchParams.set('theme', currentTheme);
        window.location.href = exportUrl.toString();
      });
    }
    // Set theme class on HTML element for export mode
    if ('True' === 'True' && 'dark-mode') {
      document.documentElement.className = 'dark-mode';
    }
    // Share export button
    const shareExportBtn = document.getElementById('share-export-btn');
    if (shareExportBtn) {
      shareExportBtn.addEventListener('click', function(e) {
        e.preventDefault();
        shareExportBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
        shareExportBtn.disabled = true;
        const currentTheme = localStorage.getItem('theme') === 'light' ? 'light-mode' : 'dark-mode';
        
        // Add selected histogram fields to share request
        const selectedHistograms = getSelectedHistograms();
        
        fetch('/assignment/55405271b4/share_export', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            theme: currentTheme,
            selected_histograms: selectedHistograms
          })
        })
        .then(response => response.json())
        .then(data => {
          shareExportBtn.innerHTML = '<i class="fas fa-share-alt"></i> Share';
          shareExportBtn.disabled = false;
          if (data.success) {
            const modalHtml = `
              <div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content" style="background-color: var(--card-bg); color: var(--text-color);">
                    <div class="modal-header" style="border-color: var(--border-color);">
                      <h5 class="modal-title" id="shareModalLabel">Share Export</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: var(--text-color);">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <p>Your export has been saved. Share this link:</p>
                      <div class="input-group mb-3">
                        <input type="text" id="share-link" class="form-control" value="${data.share_url}" readonly style="background-color: var(--input-bg); color: var(--text-color); border-color: var(--border-color);">
                        <div class="input-group-append">
                          <button class="btn btn-primary" type="button" id="copy-link-btn">
                            <i class="fas fa-copy"></i> Copy
                          </button>
                        </div>
                      </div>
                      <div id="copy-feedback" class="text-success" style="display: none;">Link copied to clipboard!</div>
                    </div>
                    <div class="modal-footer" style="border-color: var(--border-color);">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <a href="${data.share_url}" target="_blank" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> Open
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            `;
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);
            $('#shareModal').modal('show');
            document.getElementById('copy-link-btn').addEventListener('click', function() {
              const shareLink = document.getElementById('share-link');
              shareLink.select();
              document.execCommand('copy');
              const copyFeedback = document.getElementById('copy-feedback');
              copyFeedback.style.display = 'block';
              setTimeout(() => { copyFeedback.style.display = 'none'; }, 3000);
            });
            $('#shareModal').on('hidden.bs.modal', function() {
              modalContainer.remove();
            });
          } else {
            alert('Error: ' + (data.message || 'Could not generate shared export'));
          }
        })
        .catch(error => {
          shareExportBtn.innerHTML = '<i class="fas fa-share-alt"></i> Share';
          shareExportBtn.disabled = false;
          alert('Error: Could not generate shared export');
          console.error('Error:', error);
        });
      });
    }
    
    // Helper function to get selected histograms
    function getSelectedHistograms() {
      const checkboxes = document.querySelectorAll('.export-histogram-checkbox:checked');
      return Array.from(checkboxes).map(cb => cb.getAttribute('data-field')).filter(Boolean);
    }
  });
</script>

<!-- =====================
     Histogram Selection for Export
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Handle the select/deselect all buttons
    const selectAllBtn = document.getElementById('select-all-histograms');
    const deselectAllBtn = document.getElementById('deselect-all-histograms');
    
    if (selectAllBtn) {
      selectAllBtn.addEventListener('click', function() {
        document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
          checkbox.checked = true;
          // Add a small animation to show the change
          const label = checkbox.nextElementSibling;
          if (label) {
            label.style.transition = 'color 0.3s ease';
            label.style.color = '#8a8aff';
            setTimeout(() => {
              label.style.color = '';
            }, 500);
          }
        });
        // Show visual feedback
        const originalText = selectAllBtn.innerHTML;
        selectAllBtn.innerHTML = '<i class="fas fa-check mr-1"></i> All Selected';
        setTimeout(() => {
          selectAllBtn.innerHTML = originalText;
        }, 1000);
        // Save selections to localStorage
        saveHistogramSelections();
      });
    }
    
    if (deselectAllBtn) {
      deselectAllBtn.addEventListener('click', function() {
        document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
          checkbox.checked = false;
          // Add a small animation to show the change
          const label = checkbox.nextElementSibling;
          if (label) {
            label.style.transition = 'color 0.3s ease';
            label.style.opacity = '0.7';
            setTimeout(() => {
              label.style.opacity = '';
            }, 500);
          }
        });
        // Show visual feedback
        const originalText = deselectAllBtn.innerHTML;
        deselectAllBtn.innerHTML = '<i class="fas fa-times mr-1"></i> All Deselected';
        setTimeout(() => {
          deselectAllBtn.innerHTML = originalText;
        }, 1000);
        // Save selections to localStorage
        saveHistogramSelections();
      });
    }
    
    // Initialize checkboxes from localStorage if available
    const savedSelections = localStorage.getItem('selected_histograms');
    if (savedSelections) {
      try {
        const selections = JSON.parse(savedSelections);
        document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
          const field = checkbox.getAttribute('data-field');
          if (field && selections.includes(field)) {
            checkbox.checked = true;
          }
        });
      } catch (e) {
        console.error('Error loading saved histogram selections:', e);
      }
    } else {
      // If no saved selections, select all by default
      document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
        checkbox.checked = true;
      });
      saveHistogramSelections();
    }
    
    // Save selections to localStorage when changed
    document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', saveHistogramSelections);
    });
    
    function saveHistogramSelections() {
      const selectedFields = Array.from(document.querySelectorAll('.export-histogram-checkbox:checked'))
        .map(cb => cb.getAttribute('data-field'))
        .filter(Boolean);
      
      localStorage.setItem('selected_histograms', JSON.stringify(selectedFields));
    }
  });
</script>

<!-- =====================
     Social Sharing Buttons
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('twitter-share')) {
      const pageUrl = encodeURIComponent(window.location.href);
      const shareMessage = encodeURIComponent("Check out the assignments my students just finished on Sway! The AI Guide killed it! 🤯");
      
      // X (formerly Twitter) sharing
      const xBtn = document.getElementById('twitter-share');
      xBtn.href = `https://x.com/intent/tweet?text=${shareMessage}&url=${pageUrl}`;
      xBtn.target = '_blank';
      xBtn.rel = 'noopener noreferrer';
      
      // Facebook sharing
      const facebookBtn = document.getElementById('facebook-share');
      facebookBtn.href = `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}&quote=${shareMessage}`;
      facebookBtn.target = '_blank';
      facebookBtn.rel = 'noopener noreferrer';
      
      // LinkedIn sharing
      const linkedinBtn = document.getElementById('linkedin-share');
      linkedinBtn.href = `https://www.linkedin.com/sharing/share-offsite/?url=${pageUrl}`;
      linkedinBtn.target = '_blank';
      linkedinBtn.rel = 'noopener noreferrer';
      
      // Instagram sharing (requires copy to clipboard)
      const instagramBtn = document.getElementById('instagram-share');
      instagramBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const textarea = document.createElement('textarea');
        textarea.value = `${shareMessage}\n\n${window.location.href}`;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('Link and message copied to clipboard. Paste this into Instagram to share!');
      });
    }
  });
</script>

<!-- =====================
     CSS for Status Messages and CodeMirror
     ===================== -->
<style>
  .status-message {
    margin-top: 15px;
    padding: 10px;
    border-radius: 6px;
  }
  .success {
    background-color: rgba(40, 167, 69, 0.2);
    border: 1px solid #28a745;
    color: #28a745;
  }
  .error {
    background-color: rgba(220, 53, 69, 0.2);
    border: 1px solid #dc3545;
    color: #dc3545;
  }
  .CodeMirror {
    height: auto;
    min-height: 300px;
    border-radius: 6px;
    font-family: 'Fira Code', 'Courier New', monospace;
    font-size: 14px;
    padding: 10px 0;
    margin-bottom: 20px;
  }
</style>
  <script src="/static/js/histogram-title-fixer.js"></script>
  
  <!-- Script for polished Show More/Fewer functionality in all modes -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Instructor Report Show More
      const setupReportShowMore = function() {
        const reportContent = document.getElementById('report-content');
        if (reportContent) {
          const headings = reportContent.querySelectorAll('h3');
          if (headings.length > 2) {
            const secondHeading = headings[1];
            const hiddenContentWrapper = document.createElement('div');
            hiddenContentWrapper.id = 'hidden-report-content';
            hiddenContentWrapper.className = 'collapsible-section collapsed';
            let currentNode = secondHeading.nextElementSibling;
            let nodesToMove = [];
            while (currentNode) {
              if (currentNode.tagName === 'H3' && currentNode !== secondHeading) {
                nodesToMove.push(currentNode);
              } else if (nodesToMove.length > 0) {
                nodesToMove.push(currentNode);
              }
              currentNode = currentNode.nextElementSibling;
            }
            nodesToMove.forEach(node => { hiddenContentWrapper.appendChild(node); });
            reportContent.appendChild(hiddenContentWrapper);
            
            const showMoreBtn = document.createElement('button');
            showMoreBtn.className = 'btn btn-thread-toggle show-toggle-btn';
            showMoreBtn.innerHTML = 'Continue Reading <i class="fas fa-chevron-down"></i>';
            showMoreBtn.style.marginTop = '1.5rem';
            reportContent.insertBefore(showMoreBtn, hiddenContentWrapper);
            
            // Add a spacer div ABOVE the Continue Reading button for extra spacing
            const spacerDiv = document.createElement('div');
            spacerDiv.style.height = '1rem';
            spacerDiv.style.clear = 'both';
            reportContent.insertBefore(spacerDiv, showMoreBtn);
            
            showMoreBtn.addEventListener('click', function() {
              const expanded = hiddenContentWrapper.classList.contains('collapsed');
              if (expanded) {
                hiddenContentWrapper.classList.remove('collapsed');
                showMoreBtn.classList.add('expanded');
                showMoreBtn.innerHTML = 'Show Less <i class="fas fa-chevron-up"></i>';
              } else {
                hiddenContentWrapper.classList.add('collapsed');
                showMoreBtn.classList.remove('expanded');
                showMoreBtn.innerHTML = 'Continue Reading <i class="fas fa-chevron-down"></i>';
              }
            });
          }
        }
      };
      // Threads Masonry Show More
      const setupThreadsShowMore = function() {
        const masonryGrid = document.querySelector('.masonry-grid');
        if (!masonryGrid || masonryGrid.children.length <= 2) {
          return; // Do nothing if 2 or fewer items
        }

        const masonryItems = Array.from(masonryGrid.querySelectorAll('.masonry-item'));
        const itemsToShowInitially = 2;

        const performHideAndSetupButtons = () => {
          // Hide items beyond the initial set
          for (let i = itemsToShowInitially; i < masonryItems.length; i++) {
            if (masonryItems[i]) { // Ensure item exists
              masonryItems[i].classList.add('hidden-thread');
            }
          }

          const hiddenItemCount = masonryGrid.querySelectorAll('.masonry-item.hidden-thread').length;
          if (hiddenItemCount === 0 && masonryItems.length > itemsToShowInitially) {
            // Fallback or logging if hiding didn't work as expected but should have
            console.warn("Masonry items were expected to be hidden but were not.");
            // Potentially, if itemsToShowInitially is high, this might be normal if total items < itemsToShowInitially
          }
          
          // Only proceed with buttons if there are actually items to unhide
          if (masonryItems.length <= itemsToShowInitially) {
            return;
          }

          const showMoreThreadsBtn = document.createElement('button');
          showMoreThreadsBtn.className = 'btn btn-thread-toggle show-toggle-btn';

          const updateShowMoreText = () => {
            const currentHiddenCount = masonryGrid.querySelectorAll('.masonry-item.hidden-thread').length;
            showMoreThreadsBtn.innerHTML = `Show ${currentHiddenCount} More Threads`;
            // Show button only if there are hidden threads
            showMoreThreadsBtn.style.display = currentHiddenCount > 0 ? 'block' : 'none';
          };
          
          const showFewerThreadsBtn = document.createElement('button');
          showFewerThreadsBtn.className = 'btn btn-thread-toggle show-toggle-btn';
          showFewerThreadsBtn.innerHTML = 'Show Fewer Threads';
          showFewerThreadsBtn.style.display = 'none'; // Initially hidden

          const threadListSection = document.querySelector('.thread-list');
          let spacerDiv;
          if (threadListSection) {
            spacerDiv = document.createElement('div');
            spacerDiv.style.height = '4px';
            spacerDiv.style.clear = 'both';
            spacerDiv.style.display = 'none';
            threadListSection.appendChild(spacerDiv);
            threadListSection.appendChild(showFewerThreadsBtn);
          }
          
          // Insert Show More button only if there's a chance it will be displayed
          if (masonryItems.length > itemsToShowInitially) {
             masonryGrid.parentNode.insertBefore(showMoreThreadsBtn, masonryGrid.nextSibling);
             updateShowMoreText(); // Set initial text and visibility
          }


          showMoreThreadsBtn.addEventListener('click', function() {
            masonryItems.forEach(item => item.classList.remove('hidden-thread'));
            updateShowMoreText(); // Button should hide itself
            showFewerThreadsBtn.style.display = 'block';
            if (spacerDiv) spacerDiv.style.display = 'block';
          });

          showFewerThreadsBtn.addEventListener('click', function() {
            for (let i = itemsToShowInitially; i < masonryItems.length; i++) {
              if (masonryItems[i]) {
                masonryItems[i].classList.add('hidden-thread');
              }
            }
            updateShowMoreText(); // Button should reappear and update count
            showFewerThreadsBtn.style.display = 'none';
            if (spacerDiv) spacerDiv.style.display = 'none';
            
            const chatThreadsSectionTitle = document.querySelector('h5.section-title .fa-comments');
            if (chatThreadsSectionTitle && chatThreadsSectionTitle.closest('h5.section-title')) {
              chatThreadsSectionTitle.closest('h5.section-title').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
              masonryGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          });
        };

        if (window.requestAnimationFrame) {
          window.requestAnimationFrame(() => {
            setTimeout(performHideAndSetupButtons, 75); // Delay to allow layout to settle
          });
        } else {
          setTimeout(performHideAndSetupButtons, 75); // Fallback
        }
      };

      setupReportShowMore();
      setupThreadsShowMore();

      // Opinion Distribution Show More/Less
      const histogramCards = document.querySelectorAll('.opinion-histogram-card');
      const showMoreBtn = document.getElementById('show-more-histograms-btn');
      const showFewerBtn = document.getElementById('show-fewer-histograms-btn');
      const maxVisible = 6;
      if (histogramCards.length > maxVisible) {
        for (let i = maxVisible; i < histogramCards.length; i++) {
          histogramCards[i].classList.add('hidden-histogram');
        }
        showMoreBtn.style.display = 'inline-block';
      }
      if (showMoreBtn && showFewerBtn) {
        showMoreBtn.addEventListener('click', function() {
          for (let i = maxVisible; i < histogramCards.length; i++) {
            histogramCards[i].classList.remove('hidden-histogram');
          }
          showMoreBtn.style.display = 'none';
          showFewerBtn.style.display = 'inline-block';
        });
        showFewerBtn.addEventListener('click', function() {
          for (let i = maxVisible; i < histogramCards.length; i++) {
            histogramCards[i].classList.add('hidden-histogram');
          }
          showMoreBtn.style.display = 'inline-block';
          showFewerBtn.style.display = 'none';
          // Scroll to the top of the histogram section
          const sectionTitle = document.querySelector('.section-title .fa-chart-bar');
          if (sectionTitle && sectionTitle.closest('.section-title')) {
            sectionTitle.closest('.section-title').scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      }
    });
  </script>
  
  <!-- Script to disable hover animations -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Create a style element
      var style = document.createElement('style');
      
      // Add CSS rules to disable hover animations
      style.innerHTML = `
        .card:hover, 
        .thread-item:hover, 
        .histogram-container:hover, 
        .histogram-bar:hover, 
        .histogram-card:hover {
          transform: none !important;
        }
      `;
      
      // Append the style element to the head
      document.head.appendChild(style);
    });
  </script>
  </div> <!-- Close content-wrapper -->
</body>
</html>