<!DOCTYPE html>

<html class="dark-mode" lang="en">
<head>
<script>
    // Set the correct Bootswatch theme based on theme_mode immediately
    window.themeMode = 'dark-mode';
    if (window.themeMode === 'light-mode') {
      document.write('<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/flatly/bootstrap.min.css" id="theme-css">');
    } else {
      document.write('<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/darkly/bootstrap.min.css" id="theme-css">');
    }
  </script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<title>Ethical Triage: Alcoholics, Wealth, and Disability in Healthcare Resource Allocation</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/>
<style>
    :root {
      /* Darkened dark mode theme */
      --bg-color: #050505;          /* Near-black background */
      --card-bg: #0e0e1a;           /* Deeper navy card */
      --card-header-bg: #141422;     /* Darker header */
      --text-color: #e4e6eb;
      --muted-text-color: #a9adc1;
      --border-color: #1f1f2d;
      --button-bg: #252538;
      --button-hover-bg: #3a3a59; 
      --primary-color: #8a8aff;
      --input-bg: #252538;
      --message-left-bg: #141422;
      --message-right-bg: #0e0e1a;
    }

    /* Light mode theme variables */
    html.light-mode {
      /* Base colors */
      --bg-color: #f5f7fa;
      --card-bg: #ffffff;
      --card-header-bg: #f0f5fc;
      --text-color: #2c3e50;
      --muted-text-color: #5a6a7e;
      --border-color: #d1d9e6;
      
      /* UI elements - using purple Sway theme colors */
      --button-bg: #eef2f7; /* keeping grey for basic buttons */
      --button-hover-bg: #d9e2ec; /* keeping grey hover for basic buttons */
      --primary-color: #23004D; /* new purple theme color */
      --input-bg: #ffffff;
      
      /* Message colors */
      --message-left-bg: #eef2f7;
      --message-right-bg: #e6f0ff;
    }

    /* Additional light mode specific overrides for purple theme */
    html.light-mode .card {
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    html.light-mode .card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    html.light-mode .card-header {
      border-bottom: 1px solid var(--border-color);
    }

    /* Purple theme for headings and section titles */
    html.light-mode .section-title {
      border-bottom: 1px solid #23004D;
      color: #23004D;
    }

    html.light-mode .section-title i {
      color: #23004D;
    }

    html.light-mode .markdown-content h1,
    html.light-mode .markdown-content h2,
    html.light-mode .markdown-content h3,
    html.light-mode .markdown-content h4,
    html.light-mode .markdown-content h5,
    html.light-mode .markdown-content h6 {
      color: #23004D;
    }

    /* Purple theme for icons */
    html.light-mode .fas,
    html.light-mode .far,
    html.light-mode .fab {
      color: #23004D;
    }

    /* Keep header buttons grey */
    html.light-mode .header-actions .back-btn i,
    html.light-mode .header-actions .nav-btn i {
      color: inherit;
    }

    /* Thread items */
    html.light-mode .thread-item {
      background-color: #ffffff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }

    html.light-mode .thread-item:hover {
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      border: 2px solid #23004D;
    }

    html.light-mode .thread-item a {
      color: #23004D;
    }

    /* Badges and info elements */
    html.light-mode .badge-info {
      background-color: #e6e0f0;
      color: #23004D;
    }

    html.light-mode .text-info {
      color: #23004D !important;
    }

    /* Buttons with purple theme */
    html.light-mode .btn-primary {
      background-color: #23004D;
      border-color: #23004D;
    }

    html.light-mode .btn-primary:hover {
      background-color: #380080;
      border-color: #380080;
    }

    /* Content elements */
    html.light-mode .markdown-content code,
    html.light-mode .markdown-content pre {
      background-color: #f0f3f8;
      border: 1px solid #e0e5ee;
    }

    html.light-mode .markdown-content blockquote {
      background-color: #f0f3f8;
      border-left: 4px solid #23004D;
    }

    html.light-mode .markdown-content a {
      color: #23004D;
    }

    /* Info boxes and containers */
    html.light-mode .info-box {
      background-color: #f8fafd;
      border: 1px solid var(--border-color);
    }

    /* Topic labels and special text */
    html.light-mode .text-info {
      color: #23004D !important;
    }

    html.light-mode .col-label {
      color: #23004D;
    }

    /* Thread summary section styling */
    html.light-mode .thread-summary strong {
      color: #23004D;
    }

    /* Keep the orange buttons distinct */
    html.light-mode .btn-orange {
      background-color: #ff7200;
      border-color: #ff7200;
    }

    html.light-mode .btn-orange:hover {
      background-color: #e66800;
      border-color: #e66800;
    }

    /* Theme toggle styling */
    html.light-mode .theme-toggle-slider {
      background-color: #d9e2ec;
    }

    html.light-mode .theme-toggle-slider:before {
      background-color: #ffffff;
    }

    html.light-mode input:checked + .theme-toggle-slider {
      background-color: #23004D;
    }

    /* Pagination with purple theme */
    html.light-mode .page-item.active .page-link {
      background-color: #23004D;
      border-color: #23004D;
    }

    html.light-mode .page-link:hover {
      color: #23004D;
    }

    /* Apply theme variables to elements */
    html {
      margin: 0;
      padding: 0;
      border: none;
      outline: none;
    }
    
    body { 
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      transition: background-color 0.3s ease;
      border: none; /* Remove any borders */
      outline: none; /* Remove any outlines */
    }
    .dashboard-container {
      padding: 10px;
      max-width: 100%;
      margin: 0 auto;
      border: none;
      outline: none;
    }
    @media (min-width: 576px) {
      .dashboard-container {
        padding: 15px;
      }
    }
    @media (min-width: 768px) {
      .dashboard-container {
        padding: 25px;
        margin-left: 0;
        margin-right: 0;
      }
    }
    @media (min-width: 1200px) {
      .dashboard-container {
        margin-left: 0;
        margin-right: 0;
      }
    }
    .card {
      background-color: var(--card-bg);
      border: none;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      margin-bottom: 25px;
      transition: background-color 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    /* No hover effect for section title cards */
    .card.no-hover:hover {
      transform: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .card-header {
      font-size: 1.2rem;
      font-weight: 500;
      background-color: var(--card-header-bg);
      border-bottom: 1px solid var(--border-color);
      border-radius: 10px 10px 0 0 !important;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      transition: background-color 0.3s ease;
    }
    @media (min-width: 576px) {
      .card-header {
        font-size: 1.4rem;
        padding: 15px 20px;
      }
    }
    .card-title {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 10px;
      width: 100%;
    }
    
    .card-title .title-text {
      display: flex;
      align-items: center;
    }
    
    .card-title .badge {
      margin-left: 10px;
    }
    
    .generated-title {
      font-size: 1.68rem;
      font-weight: 600;
      margin-top: 5px;
      font-style: italic;
      margin-bottom: 5px;
      color: var(--primary-color) !important;
    }
    
    @media (min-width: 768px) {
      .card-title {
        margin-bottom: 0;
        width: auto;
      }
    }
    .card-body {
      padding: 15px;
      transition: background-color 0.3s ease;
    }
    @media (min-width: 576px) {
      .card-body {
        padding: 20px 25px;
      }
    }
    .section-title {
      padding-left: 15px;
      margin-top: 20px;
      font-size: 1.2rem;
      font-weight: 500;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      flex-wrap: wrap;
      transition: border-color 0.3s ease, color 0.3s ease;
    }
    .section-title i {
      margin-right: 10px;
    }
    .section-title .title-text {
      display: flex;
      align-items: center;
    }
    .section-title .actions {
      margin-left: auto;
      margin-top: 10px;
      width: 100%;
      text-align: right;
    }
    @media (min-width: 768px) {
      .section-title .actions {
        margin-top: 0;
        width: auto;
      }
    }
    .detail-item {
      margin-bottom: 15px;
      padding: 10px 15px;
      background-color: var(--card-header-bg);
      border-radius: 6px;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      transition: background-color 0.3s ease;
    }
    .detail-item strong {
      min-width: 140px;
      color: var(--muted-text-color);
    }
    .list-group-item {
      background-color: var(--card-header-bg);
      color: var(--text-color);
      border: none;
      border-radius: 6px;
      margin-bottom: 8px;
      transition: background-color 0.2s, color 0.3s ease;
    }
    .list-group-item:hover {
      background-color: var(--button-hover-bg);
    }
    .badge {
      font-size: 0.7em;
      padding: 6px 8px;
      border-radius: 50px;
      font-weight: 500;
      margin-left: 10px;
    }
    .badge-available {
      background-color: #28a745;
      color: #fff;
    }
    .badge-active {
      background-color: #007bff;
      color: #fff;
    }
    .badge-completed {
      background-color: #6c757d;
      color: #fff;
    }
    .badge-cancelled {
      background-color: #dc3545;
      color: #fff;
    }
    .back-btn {
      background-color: var(--button-bg);
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      transition: background-color 0.2s, color 0.3s ease;
      color: var(--text-color);
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }
    @media (min-width: 768px) {
      .back-btn {
        margin-bottom: 0;
      }
    }
    .back-btn i {
      margin-right: 8px;
    }
    .back-btn:hover {
      background-color: var(--button-hover-bg);
      color: var(--text-color);
      text-decoration: none;
    }
    .header-actions {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
      width: 100%;
    }
    @media (min-width: 768px) {
      .header-actions {
        width: auto;
      }
    }
    .refresh-button {
      margin-right: 16px;
      display: flex;
      align-items: center;
    }
    .icon-btn {
      background: none;
      border: none;
      color: #8a8aff;
      font-size: 1.2rem;
      cursor: pointer;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
    }
    .icon-btn:hover {
      background-color: rgba(138, 138, 255, 0.1);
    }
    .icon-btn:focus {
      outline: none;
    }
    .icon-btn:active {
      transform: scale(0.9);
    }
    .info-box {
      padding: 15px;
      background-color: var(--card-header-bg);
      border-radius: 8px;
      margin-bottom: 20px;
      transition: background-color 0.3s ease;
    }
    .col-label {
      color: var(--muted-text-color);
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .col-value {
      font-weight: 400;
    }
    .utc-time {
      opacity: 0;
      transition: opacity 0.3s;
    }
    .local-time {
      opacity: 1;
    }
    /* New Chat Threads Section Styling */
    .thread-list {
      margin-top: 15px;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 15px;
    }
    @media (min-width: 768px) {
      .thread-list {
        flex-wrap: nowrap;
      }
      .thread-list-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: calc(50% - 8px);
      }
    }
    .thread-card {
      margin-bottom: 0 !important;
    }
    .thread-item {
      display: flex;
      flex-direction: column;
      width: 100%;
      opacity: 1; /* Ensure visibility */
      padding: 15px;
      background-color: var(--card-bg);
      border-radius: 12px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      border: 2px solid transparent;
    }
    .thread-item:hover {
      background-color: var(--card-bg);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      border: 2px solid transparent; /* Remove orange border */
    }
    .thread-item.visible {
      opacity: 1;
    }
    .thread-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .thread-header .thread-actions {
      display: flex;
      gap: 6px;
      white-space: nowrap;
    }
    .thread-item a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
      display: inline-block;
      margin-bottom: 5px;
      transition: color 0.3s ease;
    }
    .thread-item a:hover {
      text-decoration: underline;
    }
    .thread-summary {
      font-size: 0.9em;
      color: var(--muted-text-color);
      margin-top: 5px;
      margin-left: 10px;
      line-height: 1.5;
      transition: color 0.3s ease;
    }
    .thread-summary p {
      margin-bottom: 0.5em;
    }
    .thread-summary ul,
    .thread-summary ol {
      margin-top: 0.5em;
      margin-bottom: 0.5em;
      padding-left: 1.5em;
    }
    .thread-summary li {
      margin-bottom: 0.3em;
    }
    .thread-summary a {
      color: var(--primary-color);
    }
    .thread-summary code {
      background-color: var(--card-header-bg);
      border-radius: 3px;
      padding: 2px 5px;
      font-family: monospace;
      transition: background-color 0.3s ease;
    }
    .thread-status {
      font-size: 0.8em;
      margin-top: 3px;
      margin-left: 10px;
    }
    /* Markdown content styling */
    .markdown-content {
      line-height: 1.6;
      overflow-wrap: break-word;
      word-wrap: break-word;
    }
    .markdown-content h1,
    .markdown-content h2,
    .markdown-content h3,
    .markdown-content h4,
    .markdown-content h5,
    .markdown-content h6 {
      margin-top: 1.5em;
      margin-bottom: 0.75em;
      color: var(--primary-color);
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .markdown-content h1 {
      font-size: 1.7em;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 0.3em;
      transition: border-color 0.3s ease;
    }
    .markdown-content h2 {
      font-size: 1.5em;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 0.3em;
      transition: border-color 0.3s ease;
    }
    .markdown-content h3 {
      font-size: 1.3em;
    }
    .markdown-content h4 {
      font-size: 1.1em;
    }
    .markdown-content p {
      margin-bottom: 1em;
    }
    .markdown-content ul, 
    .markdown-content ol {
      margin-bottom: 1em;
      padding-left: 2em;
    }
    .markdown-content li {
      margin-bottom: 0.5em;
    }
    /* Proper nested list styling */
    .markdown-content ul ul,
    .markdown-content ul ol,
    .markdown-content ol ul,
    .markdown-content ol ol {
      margin-top: 0.5em;
      margin-bottom: 0.5em;
    }
    .markdown-content li > ul,
    .markdown-content li > ol {
      margin-left: 1em;
    }
    .markdown-content blockquote {
      padding: 0.5em 1em;
      margin-left: 0;
      margin-right: 0;
      background-color: var(--card-header-bg);
      border-left: 4px solid var(--primary-color);
      margin-bottom: 1em;
      transition: background-color 0.3s ease, border-left-color 0.3s ease;
    }
    .markdown-content code {
      background-color: var(--card-header-bg);
      border-radius: 3px;
      padding: 2px 5px;
      font-family: monospace;
      transition: background-color 0.3s ease;
    }
    .markdown-content pre {
      background-color: var(--card-header-bg);
      border-radius: 5px;
      padding: 1em;
      overflow-x: auto;
      margin-bottom: 1em;
      transition: background-color 0.3s ease;
    }
    .markdown-content table {
      border-collapse: collapse;
      margin-bottom: 1em;
      width: 100%;
    }
    .markdown-content table th,
    .markdown-content table td {
      border: 1px solid var(--border-color);
      padding: 0.5em;
      transition: border-color 0.3s ease;
    }
    .markdown-content table th {
      background-color: var(--card-header-bg);
      text-align: left;
      transition: background-color 0.3s ease;
    }
    .markdown-content strong {
      font-weight: 600;
      color: var(--text-color);
      transition: color 0.3s ease;
    }
    .markdown-content em {
      font-style: italic;
    }
    /* Mobile-specific styles */
    @media (max-width: 767.98px) {
      .row:not(.mb-3) {
        margin-right: -5px;
        margin-left: -5px;
      }
      .row:not(.mb-3) > .col, 
      .row:not(.mb-3) > [class*="col-"] {
        padding-right: 5px;
        padding-left: 5px;
      }
      .btn {
        padding: 0.375rem 0.5rem;
      }
      .btn-orange {
        width: 100%;
        margin-bottom: 10px;
      }
      #report-btn, #generate-btn, #cancel-btn {
        width: 100%;
      }
      /* Hide theme toggle and edit prompts in mobile */
      .theme-toggle {
        display: none !important;
      }
      a.back-btn[href*="edit_prompts"] {
        display: none !important;
      }
      #share-export-btn {
        margin-right: 0 !important;
      }
    }
    /* End markdown styling */

    /* Limit Topics container height to match the Info card */
    #topics-container {
      max-height: 420px;
      min-height: 420px;
      overflow-y: auto;
    }
    /* Smaller height for export mode */
    html.export-mode #topics-container {
      max-height: 345px;
      min-height: 345px;
    }

    /* New Opinion Histograms styling */
    .histogram-container {
      background-color: #090118 !important;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .histogram-container:hover {
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .histogram-container img {
      max-width: 100%;
      border-radius: 6px;
      display: block;
      margin: 0 auto;
    }
    
    .histogram-bar {
      background: linear-gradient(180deg, #a9a9ff 0%, #8a8aff 100%);
      border-radius: 4px 4px 6px 6px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      box-shadow: 0 2px 6px rgba(138,138,255,0.2);
    }
    .histogram-bar:hover {
      box-shadow: 0 4px 8px rgba(138,138,255,0.4);
    }
    .histogram-axis-line {
      background: rgba(169,173,193,0.4);
      width: 2px;
    }
    .histogram-grid-line {
      background: rgba(169,173,193,0.13);
      height: 1px;
    }
    .histogram-container .axis-label {
      color: #a9adc1;
      font-size: 0.95rem;
      opacity: 0.85;
    }
    .histogram-container .x-label {
      color: #a9adc1;
      font-size: 1.1rem;
      font-weight: 500;
      margin-top: 0.35rem;
    }
    .histogram-container .card-body {
      padding: 1.25rem;
    }
    
    @media (max-width: 767.98px) {
      .col-md-6.col-lg-4.mb-4 {
        padding-left: 10px;
        padding-right: 10px;
      }
      .histogram-container {
        padding: 10px;
      }
    }

    /* Theme toggle switch styling */
    .theme-toggle {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    .theme-toggle-switch {
      position: relative;
      display: inline-block;
      width: 52px;
      height: 26px;
    }
    
    .theme-toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .theme-toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #2d2d43;
      transition: .4s;
      border-radius: 34px;
    }
    
    .theme-toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .theme-toggle-slider {
      background-color: #4a4a69;
    }
    
    input:checked + .theme-toggle-slider:before {
      transform: translateX(26px);
    }
    
    .theme-toggle-icon {
      color: var(--text-color);
      font-size: 16px;
    }

    /* Add social sharing buttons styling */
    .social-share-container {
      background-color: var(--card-header-bg);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
    }
    .social-share-title {
      font-size: 1.1rem;
      margin-bottom: 12px;
      color: var(--primary-color);
    }
    .social-share-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
    }
    .social-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      border-radius: 5px;
      color: white;
      font-weight: 500;
      text-decoration: none;
      transition: opacity 0.2s;
      font-size: 0.9rem;
    }
    .social-btn:hover {
      opacity: 0.85;
      text-decoration: none;
      color: white;
    }
    .social-btn i {
      margin-right: 6px;
      font-size: 0.9rem;
    }
    .btn-twitter {
      background-color: #1DA1F2;
    }
    .btn-facebook {
      background-color: #4267B2;
    }
    .btn-linkedin {
      background-color: #0077B5;
    }
    .btn-instagram {
      background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
    }
    @media (max-width: 576px) {
      .social-btn {
        padding: 4px 9px;
        font-size: 0.8rem;
      }
      .social-btn i {
        margin-right: 4px;
      }
    }

    .full-width-page {
      width: 100%;
      max-width: 1420px;
      margin: 0 auto;
      padding-left: 24px;
      padding-right: 24px;
    }
    @media (min-width: 576px) {
      .full-width-page {
        padding-left: 50px;
        padding-right: 50px;
      }
    }
    @media (min-width: 992px) {
      .full-width-page {
        padding-left: 64px;
        padding-right: 64px;
      }
    }

    /* Histogram card styling - more aggressive fixes */
    .histogram-card {
      background-color: #070113 !important;
      border: none; 
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      margin-bottom: 0;
      overflow: hidden;
    }

    .histogram-card:hover {
      box-shadow: 0 7px 15px rgba(0,0,0,0.25);
    }

    .histogram-card .card-body {
      padding: 8px 0 !important;
    }

    /* Target histogram SVG elements directly */
    .histogram-card svg {
      max-width: 100% !important;
      margin-left: -20px !important; /* Pull SVG to the left */
      width: calc(100% + 20px) !important; /* Compensate for negative margin */
    }

    /* More aggressive targeting for histogram titles */
    .histogram-card h3,
    .histogram-card .x-label,
    .histogram-card text.title,
    .histogram-card [class*="title"],
    .histogram-card text[font-size="14px"],
    .histogram-card text[font-weight="bold"] {
      text-transform: capitalize !important;
      font-size: 1.15rem !important;
      font-weight: 600 !important;
      color: var(--primary-color) !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      max-width: 95% !important;
      display: block !important;
    }

    /* Add text truncation to histogram title element specifically */
    .histogram-card .histogram-content svg text[y="30"],
    .histogram-card .histogram-content svg text.title {
      text-overflow: ellipsis !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      max-width: 250px !important;
    }

    /* Target mean text specifically */
    .histogram-card .mean-text,
    .histogram-card text[y="300"],
    .histogram-card text:last-of-type,
    .histogram-card text[font-size="12px"] {
      font-size: 0.9rem !important;
    }

    /* Add italicized m= to mean values with several selectors to catch them */
    .histogram-card .mean-text::before,
    .histogram-card text[y="300"]::before,
    .histogram-card text:last-of-type::before {
      content: "m = ";
      font-style: italic;
    }

    @media (max-width: 767.98px) {
      .histogram-card .card-body {
        padding: 8px 0 !important;
      }
    }

    /* Card with no hover effects */
    .no-hover {
      transition: background-color 0.3s ease !important;
    }

    .no-hover:hover {
      transform: none !important;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2) !important;
    }

    .thread-heading {
      color: var(--primary-color) !important;
      font-weight: 600;
    }

    /* Truncate long histogram HTML titles with ellipsis */
    .histogram-title,
    .histogram-card [style*="font-size:1.25rem"] {
      font-size: 1rem !important;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: block;
      max-width: 95%;
    }

    /* Hide histogram cards that only contain "No data" text */
    .histogram-card .histogram-content:only-child:has(> div.text-muted:only-child:contains("No data")),
    .card-body .histogram-content:only-child:has(> div.text-muted:only-child:contains("No data")),
    .histogram-content:has(> div.text-muted:only-child:contains("No data")) {
      display: none !important;
    }
    
    /* Also hide the parent cards when they only contain "No data" content */
    .histogram-card:has(.histogram-content:only-child > div.text-muted:only-child:contains("No data")),
    .card-body:has(.histogram-content:only-child > div.text-muted:only-child:contains("No data")) {
      display: none !important;
    }
    
    /* Hide the entire column if it only contains a "No data" card */
    .col-md-6:has(.card.histogram-card:only-child:has(.histogram-content > div.text-muted:only-child:contains("No data"))),
    .col-lg-4:has(.card.histogram-card:only-child:has(.histogram-content > div.text-muted:only-child:contains("No data"))) {
      display: none !important;
    }

    /* Bootstrap Histogram Styles */
    .histogram-container {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        width: 100%;
        height: 100%;
        position: relative;
    }
    
    .histogram-bar-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100%;
        padding: 0 2px;
    }
    
    .histogram-bar {
        width: 80%;
        transition: background-color 0.2s ease;
        border-radius: 3px 3px 0 0;
    }
    
    .histogram-bar:hover {
        background-color: #a5a5ff !important;
    }
    
    .histogram-label {
        margin-top: 5px;
        font-size: 11px;
        text-align: center;
    }
    
    .histogram-stats {
        margin-top: 10px;
        text-align: center;
    }
    
    /* Light mode overrides for histograms */
    html.light-mode .histogram-bar {
        background-color: #6a6ae6 !important;
    }
    
    html.light-mode .histogram-bar:hover {
        background-color: #8a8aff !important;
    }

    /* Histogram Checkbox Styles */
    .histogram-export-checkbox {
        position: absolute;
        bottom: 8px;
        right: 8px;
        z-index: 2;
        opacity: 0.6;
        transform: translateY(0);
        transition: opacity 0.2s ease, transform 0.2s ease;
    }
    
    .histogram-export-checkbox:hover {
        opacity: 1;
        transform: translateY(-2px);
    }
    
    .histogram-export-checkbox input[type="checkbox"] {
        margin-right: 4px;
        cursor: pointer;
        accent-color: var(--card-bg); /* Match card background for subtlety */
        opacity: 0.5;
        transition: opacity 0.2s;
    }
    
    .histogram-export-checkbox input[type="checkbox"]:hover,
    .histogram-export-checkbox input[type="checkbox"]:focus {
        opacity: 0.85;
    }
    
    .histogram-export-checkbox label {
        font-size: 0.75rem;
        cursor: pointer;
        margin: 0;
        color: var(--muted-text-color);
    }
    
    /* Make the card position relative so absolute positioned checkbox works */
    .card.thread-card .card-body {
        position: relative;
    }
    
    /* Highlight the checkbox when checked */
    .histogram-export-checkbox input[type="checkbox"]:checked + label {
        color: var(--primary-color);
        font-weight: 500;
    }

    .card.thread-card .card-header {
      background-color: #070113 !important;
    }
</style>
<style>
    /* Global color fixes */
    body, html {
      min-height: 100vh;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      background-color: #000000; /* Default to black for dark mode */
    }
    
    /* Override for light mode */
    html.light-mode, 
    body.light-mode {
      background-color: white;
    }
    
    /* Ensure all content containers have proper width */
    .container, 
    .container-fluid, 
    .row {
      max-width: 100%;
    }
    
    /* Eliminate any unwanted margins on containers */
    .row {
      margin-left: 0;
      margin-right: 0;
    }
    
    .full-width-page {
      width: 100%;
      max-width: 100vw;
      overflow-x: hidden;
      box-sizing: border-box;
    }
    
    /* Apple-inspired font styling */
    body, button, input, select, textarea {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    h1, h2, h3, h4, h5, h6, .section-title, .generated-title {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-weight: 600;
      letter-spacing: +0.005em;
    }
    
    /* Custom styles for floating thread items */
    .card.no-hover:hover {
      transform: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .thread-list {
      margin-top: 15px;
      position: relative;
      display: block;
      clear: both;
      margin-bottom: 10px;
    }
    
    /* Masonry layout using columns */
    .masonry-grid {
      column-count: 2;
      column-gap: 1.5rem;
      width: 100%;
      margin-bottom: 8px;
    }
    
    @media (max-width: 767px) {
      .masonry-grid {
        column-count: 1;
      }
    }
    
    .masonry-item {
      break-inside: avoid;
      margin-bottom: 1.5rem;
      display: block;
    }
    
    /* Items in the masonry grid */
    .masonry-grid .masonry-item {
      break-inside: avoid;
      margin-bottom: 1.5rem;
      display: block;
    }
    
    /* Make sure thread cards in masonry layout have required styles */
    .masonry-grid .card.thread-card, .card.thread-card {
      background: none !important;
      border: 1px solid var(--thread-card-border, #313131) !important;
      border-radius: 12px !important;
      box-shadow: none !important;
      transition: border-color 0.2s;
    }
    
    /* Dark mode border override */
    body.dark-mode .masonry-grid .card.thread-card,
    body.dark-mode .card.thread-card {
      border-color: #23263a !important;
    }
    
    /* Override any position:relative that may be applied to .card-body elsewhere */
    .masonry-grid .card.thread-card .card-body {
      position: static;
    }
    
    .masonry-grid .card.thread-card:hover {
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }
    
    .masonry-item.hidden-thread {
      visibility: hidden !important;
      opacity: 0 !important;
      height: 0 !important;
      padding-top: 0 !important;
      padding-bottom: 0 !important;
      margin-top: 0 !important;
      margin-bottom: 0 !important;
      border-top-width: 0 !important;
      border-bottom-width: 0 !important;
      overflow: hidden !important;
      pointer-events: none !important;
    }
    
    .show-toggle-btn {
      display: block;
      margin: 30px auto 10px auto;
      min-width: 220px;
      font-weight: 500;
      transition: background 0.2s, color 0.2s;
    }
    .show-toggle-btn i {
      margin-left: 8px;
      transition: transform 0.2s;
    }
    .show-toggle-btn.expanded i {
      transform: rotate(180deg);
    }
    .collapsible-section {
      transition: max-height 0.4s cubic-bezier(0.4,0,0.2,1), opacity 0.4s;
      overflow: hidden;
      opacity: 1;
      max-height: 2000px; /* Large enough for most content */
    }
    .collapsible-section.collapsed {
      max-height: 0 !important;
      opacity: 0;
      pointer-events: none;
    }
    /* Premium title styling with maximum specificity to override any other styles */
    html body .generated-title,
    html[class] body .generated-title,
    body .generated-title.text-info,
    .full-width-page .generated-title,
    .generated-title {
      font-size: 2.5rem !important;
      line-height: 1.2 !important;
      margin-top: 2.5rem !important;
      margin-bottom: 1rem !important;
      font-weight: 600;
      color: white !important;
      text-shadow: 0 1px 3px rgba(0,0,0,0.15);
      letter-spacing: -0.0025em;
      display: block;
      position: relative;
      max-width: 94%;
      padding-bottom: 0.5rem;
      font-style: normal !important; /* Force normal style, no italics */
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif !important;
    }
    
    .generated-title::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 8rem;
      height: 3px;
      background: white;
      opacity: 0.7;
      border-radius: 2px;
    }
    
    /* Enhanced styling for better title visibility */
    .dark-mode .generated-title {
      text-shadow: 0 2px 4px rgba(0,0,0,0.3), 0 0 10px rgba(0,0,0,0.1);
    }
    
    /* Light mode title styling */
    .light-mode .generated-title {
      color: #4750c5 !important;
      text-shadow: none;
    }
    
    /* Adjust underline color in light mode */
    .light-mode .generated-title::after {
      background: #4750c5;
      opacity: 0.5;
    }
    
    /* Fix for pure black background in dark mode - only targeting page containers */
    body.dark-mode,
    html.dark-mode,
    .dark-mode .full-width-page {
      background-color: #000000 !important;
    }
    
    /* Explicitly exempt chart elements from background override */
    .dark-mode .progress,
    .dark-mode .progress-bar,
    .dark-mode .bg-success,
    .dark-mode .bg-info,
    .dark-mode .bg-warning,
    .dark-mode .bg-danger,
    .dark-mode .bg-secondary,
    .dark-mode .chart-container,
    .dark-mode [class*="histogram-"] {
      background-color: initial !important; /* Preserve original background colors */
    }
    
    /* Ensure the page fills the viewport */
    html, body {
      min-height: 100% !important;
      height: 100% !important;
    }
    
    .dark-mode.shared-page {
      background-color: #000000 !important;
    }
    
    /* For longer titles, ensure they wrap properly */
    @media (max-width: 992px) {
      .generated-title {
        font-size: 2.4rem !important;
        max-width: 100%;
      }
    }
    
    @media (max-width: 576px) {
      .generated-title {
        font-size: 2rem !important;
        margin-top: 2rem !important;
        margin-bottom: 1.2rem !important;
      }
    }
    .section-title {
      font-size: 1.7rem !important;
      font-weight: 600;
      margin-bottom: 1.2rem;
      letter-spacing: -0.01em;
    }
    /* Remove background from thread card headers */
    .card.thread-card .card-header {
      background: none !important;
      border-bottom: none !important;
    }
    .small {
      font-size: 1em !important;
    }
    /* Show More/Fewer Threads button custom color */
    .btn-thread-toggle {
      color: #3498DB !important;
      border-color: #3498DB !important;
      background: transparent !important;
    }
    .btn-thread-toggle:hover, .btn-thread-toggle:focus {
      background: #eaf6fb !important;
      color: #217dbb !important;
      border-color: #217dbb !important;
    }
    /* Prevent button flash in dark mode */
    .dark-mode .btn-thread-toggle,
    .dark-mode .btn-thread-toggle:active,
    .dark-mode .btn-thread-toggle:focus,
    .dark-mode .btn-thread-toggle:hover {
      background: transparent !important;
      border-color: #99aaff !important;
      color: #99aaff !important;
      box-shadow: none !important;
    }
    /* Ensure info text under section headings aligns with the heading text */
    .section-info-align {
      margin-left: 2.2rem; /* matches the icon+text indent of .section-title .title-text */
    }
    .hidden-histogram {
      display: none !important;
    }
    /* Add extra margin above Continue Reading button in Instructor Report */
    #report-content + .show-toggle-btn {
      margin-top: 2.5rem !important;
    }
    .collapsible-section + .show-toggle-btn {
      margin-top: 2.5rem !important;
    }

    /* ===== Stylish Share Banner ===== */
    .share-banner {
      margin: 0 -1.5rem 2rem -1.5rem;
      background: rgba(24, 26, 45, 0.95);
      backdrop-filter: blur(10px);
      padding: 1.5rem 0;
      position: relative;
      z-index: 10;
    }
    .light-mode .share-banner {
      background: rgba(46, 87, 170, 0.9);
    }
    .share-container {
      display: flex;
      justify-content: center;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    .share-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1.2rem;
    }
    .share-text {
      font-size: 1.1rem;
      color: white;
      opacity: 0.95;
      font-weight: 500;
      letter-spacing: -0.01em;
    }
    .share-buttons {
      display: flex;
      gap: 1.2rem;
      justify-content: center;
    }
    .share-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      color: white;
      text-decoration: none;
      transition: all 0.2s ease;
      background: rgba(255, 255, 255, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transform: translateY(-2px);
    }
    .share-button i {
      font-size: 1.1rem;
    }
    .share-button:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.3);
    }
    .share-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: all 0.1s ease;
    }
    .twitter-share {
      background: #000000; /* X logo has a black background */
    }
    .facebook-share {
      background: #4267B2;
    }
    .linkedin-share {
      background: #0077B5;
    }
    .instagram-share {
      background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
    }
    @media (max-width: 576px) {
      .share-text {
        font-size: 0.95rem;
      }
      .share-button {
        width: 2.6rem;
        height: 2.6rem;
      }
    }
    /* ===== End Share Header Styles ===== */

    /* ===== Additional Layout Adjustments for Share Header ===== */
    .shared-page {
      padding-top: 0 !important;
    }
    
    .shared-page .generated-title {
      margin-top: 3.2rem !important;
      animation: title-fade-in 1s ease-out;
    }
    
    /* Add spacing between share banner and content */
    .share-banner + .row {
      margin-top: 2.5rem;
    }
    
    /* Subtle animation for title appearance */
    @keyframes title-fade-in {
      0% {
        opacity: 0;
        transform: translateY(10px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    /* ===== End Layout Adjustments ===== */

    /* Add improved line spacing for content */
    .markdown-content {
      line-height: 1.6;
    }
    
    .markdown-content p, 
    .markdown-content li,
    .thread-summary p, 
    .thread-summary li {
      line-height: 1.65;
      margin-bottom: 0.9em;
    }
    
    .markdown-content h3, 
    .markdown-content h4 {
      margin-top: 1.7em;
      margin-bottom: 0.7em;
      line-height: 1.4;
    }
    
    /* Improve readability of thread cards */
    .thread-card .card-body,
    .thread-summary {
      line-height: 1.65;
    }
    
    /* Increase spacing between list items */
    .markdown-content ul, 
    .markdown-content ol,
    .thread-summary ul,
    .thread-summary ol {
      padding-left: 1.6em;
      margin-bottom: 1.2em;
    }

    /* Final fixes to ensure proper layout */
    @media (max-width: 767px) {
      body.dark-mode .px-md-3 {
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
      }
    }
  </style>
</head>
<body <div="" class=""><div class="row mb-5">
<div class="col-12 px-2 px-md-4">
<h1 class="generated-title">
            Ethical Triage: Alcoholics, Wealth, and Disability in Healthcare Resource Allocation
          </h1>
</div>
</div>
<div class="row mb-4">
<div class="col-md-6 mb-4 mb-md-0">
<div class="py-4 h-100">
<h5 class="section-title">
<div class="title-text"><i class="fas fa-calendar-alt"></i> Timelines</div>
</h5>
<div class="card-body" id="timelines-container">
<div class="row mb-2">
<div class="col-5 col-label">Completion deadline:</div>
<div class="col-7 col-value">
<span class="utc-time" data-utc-time="2025-03-24 04:59:00+00:00">2025-03-24 04:59:00+00:00</span>
<span class="local-time"></span>
</div>
</div>
<div class="row mb-2">
<div class="col-5 col-label">Opinion deadline:</div>
<div class="col-7 col-value">
<span class="utc-time" data-utc-time="2025-03-20 04:59:00+00:00">2025-03-20 04:59:00+00:00</span>
<span class="local-time"></span>
</div>
</div>
</div>
<h5 class="section-title mt-4">
<div class="title-text"><i class="fas fa-info-circle"></i> Info</div>
</h5>
<div class="card-body" id="info-container">
<div class="row mb-3">
<div class="col-5 col-label">Instructor:</div>
<div class="col-7 col-value">[Redacted]</div>
</div>
<div class="row mb-3">
<div class="col-5 col-label">Min. chat time:</div>
<div class="col-7 col-value">
      
        25 minutes
      
    </div>
</div>
<div class="row mb-3">
<div class="col-5 col-label">Created on:</div>
<div class="col-7 col-value">
<span class="utc-time" data-utc-time="2025-03-18 16:09:26.233990+00:00">2025-03-18 16:09:26.233990+00:00</span>
<span class="local-time"></span>
</div>
</div>
<div class="row mb-3">
<div class="col-5 col-label">Chat threads:</div>
<div class="col-7 col-value">17</div>
</div>
</div>
</div>
</div>
<div class="col-md-6">
<div class="py-4 h-100">
<!-- Topics Section Partial -->
<h5 class="section-title">
<div class="title-text"><i class="fas fa-bookmark"></i> Topics</div>
</h5>
<div class="card-body" id="topics-container">
<div class="mb-3">
<div class="text-info mb-1 font-weight-bold">Alcoholism and Liver Transplanation</div>
<div>Alcoholics should not compete for livers on equal terms with non-alcoholics.</div>
</div>
<hr class="my-3" style="border-color: #2d2d43;"/>
<div class="mb-3">
<div class="text-info mb-1 font-weight-bold">Disability Discrimination</div>
<div>When a person with a disability and a person without a disability need identical medical treatment, and we can only provide treatment to one of them, we should provide treatment to the person without the disability.</div>
</div>
<hr class="my-3" style="border-color: #2d2d43;"/>
<div class="mb-3">
<div class="text-info mb-1 font-weight-bold">Distribution</div>
<div>The right way to distribute healthcare resources is ability to pay.  If you can pay, then you can get treatment.  If you can't, then you shouldn't get treatment.</div>
</div>
</div>
</div>
</div>
</div>
<div class="row mb-2">
<div class="col-12">
<h5 class="section-title">
<div class="title-text"><i class="fas fa-chart-bar mr-1"></i> Opinion Distribution</div>
</h5>
</div>
<div class="pt-0 pb-2">
<div class="text-muted small mb-0 section-info-align">
<i class="fas fa-info-circle mr-1"></i>Opinion scale: –3 = Strongly disagree, 0 = No idea, +3 = Strongly agree. Mean and 95% CI shown below each chart.
          </div>
<!-- DEBUG: Show if histogram_html or topic_labels are missing -->
</div>
</div>
<!-- Separate row for histogram charts floating on background -->
<div class="row mb-4">
<div class="col-12">
<div class="row" id="opinion-histogram-row">
<div class="col-md-6 col-lg-4 mb-4 opinion-histogram-card" data-index="0">
<!-- Individual Opinion Histogram Card -->
<div class="card histogram-card">
<div class="card-body p-0 px-1 position-relative">
<div class="histogram-content">
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:25px;">
<div style="font-size:1.25rem; font-weight:500; margin-bottom:15px;">Alcoholism and Liver Transplanation</div>
<div style="position:relative; height:175px; width:100%; margin-bottom:10px;">
<!-- Y-axis -->
<div style="position:absolute; top:0; left:0; bottom:25px; width:40px; display:flex; flex-direction:column; justify-content:space-between;">
<div style="position:absolute; top:0.0%; right:10px; color:#a9adc1; font-size:14px;">15</div>
<div style="position:absolute; top:33.33333333333333%; right:10px; color:#a9adc1; font-size:14px;">10</div>
<div style="position:absolute; top:66.66666666666666%; right:10px; color:#a9adc1; font-size:14px;">5</div>
<div style="position:absolute; top:100.0%; right:10px; color:#a9adc1; font-size:14px;">0</div>
<div style="position:absolute; top:0; bottom:0; right:0; width:1px; background:rgba(169,173,193,0.3);"></div>
</div>
<!-- Horizontal grid lines -->
<div style="position:absolute; top:0; left:40px; right:0; bottom:25px;">
<div style="position:absolute; top:0.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
<div style="position:absolute; top:33.33333333333333%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
<div style="position:absolute; top:66.66666666666666%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
<div style="position:absolute; top:100.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
</div>
<div style="position:absolute; top:0; left:40px; right:0; bottom:25px; display:flex; align-items:flex-end; justify-content:space-between; padding:0 2px;">
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:6.666666666666667%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:20.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:33.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:20.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:93.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:33.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:33.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
</div>
<div style="position:absolute; left:40px; right:0; bottom:0; height:25px; display:flex; justify-content:space-between; padding:0 2px;">
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-3</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-2</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-1</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">0</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">1</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">2</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">3</div>
</div>
</div>
<div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:6px; letter-spacing:0.01em;">
                mean = 0.69 <span style="opacity:0.7;">(95% confidence interval: 0.16–1.23)</span>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="col-md-6 col-lg-4 mb-4 opinion-histogram-card" data-index="0">
<!-- Individual Opinion Histogram Card -->
<div class="card histogram-card">
<div class="card-body p-0 px-1 position-relative">
<div class="histogram-content">
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:25px;">
<div style="font-size:1.25rem; font-weight:500; margin-bottom:15px;">Distribution</div>
<div style="position:relative; height:175px; width:100%; margin-bottom:10px;">
<!-- Y-axis -->
<div style="position:absolute; top:0; left:0; bottom:25px; width:40px; display:flex; flex-direction:column; justify-content:space-between;">
<div style="position:absolute; top:0.0%; right:10px; color:#a9adc1; font-size:14px;">20</div>
<div style="position:absolute; top:25.0%; right:10px; color:#a9adc1; font-size:14px;">15</div>
<div style="position:absolute; top:50.0%; right:10px; color:#a9adc1; font-size:14px;">10</div>
<div style="position:absolute; top:75.0%; right:10px; color:#a9adc1; font-size:14px;">5</div>
<div style="position:absolute; top:100.0%; right:10px; color:#a9adc1; font-size:14px;">0</div>
<div style="position:absolute; top:0; bottom:0; right:0; width:1px; background:rgba(169,173,193,0.3);"></div>
</div>
<!-- Horizontal grid lines -->
<div style="position:absolute; top:0; left:40px; right:0; bottom:25px;">
<div style="position:absolute; top:0.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
<div style="position:absolute; top:25.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
<div style="position:absolute; top:50.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
<div style="position:absolute; top:75.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
<div style="position:absolute; top:100.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
</div>
<div style="position:absolute; top:0; left:40px; right:0; bottom:25px; display:flex; align-items:flex-end; justify-content:space-between; padding:0 2px;">
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:85.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:40.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:25.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:10.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:15.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:0.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:5.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
</div>
<div style="position:absolute; left:40px; right:0; bottom:0; height:25px; display:flex; justify-content:space-between; padding:0 2px;">
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-3</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-2</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-1</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">0</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">1</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">2</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">3</div>
</div>
</div>
<div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:6px; letter-spacing:0.01em;">
                mean = -1.83 <span style="opacity:0.7;">(95% confidence interval: -2.35–-1.32)</span>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="col-md-6 col-lg-4 mb-4 opinion-histogram-card" data-index="0">
<!-- Individual Opinion Histogram Card -->
<div class="card histogram-card">
<div class="card-body p-0 px-1 position-relative">
<div class="histogram-content">
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:25px;">
<div style="font-size:1.25rem; font-weight:500; margin-bottom:15px;">Disability Discrimination</div>
<div style="position:relative; height:175px; width:100%; margin-bottom:10px;">
<!-- Y-axis -->
<div style="position:absolute; top:0; left:0; bottom:25px; width:40px; display:flex; flex-direction:column; justify-content:space-between;">
<div style="position:absolute; top:0.0%; right:10px; color:#a9adc1; font-size:14px;">15</div>
<div style="position:absolute; top:33.33333333333333%; right:10px; color:#a9adc1; font-size:14px;">10</div>
<div style="position:absolute; top:66.66666666666666%; right:10px; color:#a9adc1; font-size:14px;">5</div>
<div style="position:absolute; top:100.0%; right:10px; color:#a9adc1; font-size:14px;">0</div>
<div style="position:absolute; top:0; bottom:0; right:0; width:1px; background:rgba(169,173,193,0.3);"></div>
</div>
<!-- Horizontal grid lines -->
<div style="position:absolute; top:0; left:40px; right:0; bottom:25px;">
<div style="position:absolute; top:0.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
<div style="position:absolute; top:33.33333333333333%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
<div style="position:absolute; top:66.66666666666666%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
<div style="position:absolute; top:100.0%; left:0; right:0; height:1px; background:rgba(169,173,193,0.15);"></div>
</div>
<div style="position:absolute; top:0; left:40px; right:0; bottom:25px; display:flex; align-items:flex-end; justify-content:space-between; padding:0 2px;">
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:40.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:26.666666666666668%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:73.33333333333333%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:20.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:53.333333333333336%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:20.0%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
<div style="flex:1; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:flex-end;">
<div style="width:70%; height:6.666666666666667%; background:linear-gradient(180deg, #a5a5ff 0%, #8888ff 100%); 
                                    border-radius:4px 4px 0 0; box-shadow:0 0 10px rgba(138,138,255,0.2);"></div>
</div>
</div>
<div style="position:absolute; left:40px; right:0; bottom:0; height:25px; display:flex; justify-content:space-between; padding:0 2px;">
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-3</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-2</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">-1</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">0</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">1</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">2</div>
<div style="flex:1; text-align:center; color:#a9adc1; font-size:16px; font-weight:500;">3</div>
</div>
</div>
<div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:6px; letter-spacing:0.01em;">
                mean = -0.56 <span style="opacity:0.7;">(95% confidence interval: -1.12–0.01)</span>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="text-center">
<button class="btn btn-thread-toggle show-toggle-btn" id="show-more-histograms-btn" style="display:none;">Show More Figures</button>
<button class="btn btn-thread-toggle show-toggle-btn" id="show-fewer-histograms-btn" style="display:none;">Show Fewer Figures</button>
</div>
</div>
</div>
<div class="row mb-4">
<div class="col-12">
<div class="py-4">
<!-- Report Section Partial -->
<h5 class="section-title">
<div class="title-text">
<i class="fas fa-file-alt mr-1"></i> Instructor Report
  </div>
</h5>
<!-- DEBUG: Show if report or has_saved_summaries are missing -->
<div class="card-body" id="report-section">
<div class="markdown-content" id="report-content">
<p>The assignment posed the ethical challenge of allocating scarce medical resources in healthcare settings. Students were asked to debate difficult prioritization decisions, exploring whether certain patients deserve priority access to limited treatments or transplants based on criteria like disability status, personal responsibility in illness (particularly alcoholism and liver transplants), and ability to pay. Throughout these discussions, students confronted fundamental ethical tensions between utilitarian approaches (maximizing benefit) and egalitarian principles (ensuring equal access regardless of circumstance).</p>
<h3>Themes</h3>
<ul>
<li><strong>The tension between outcome-based allocation and equal moral worth dominated discussions.</strong> Students regularly oscillated between pragmatic utility calculations (maximizing lives saved or quality-adjusted life years) and principled commitments to equal treatment, with many gradually developing nuanced middle-ground positions incorporating both concerns.</li>
<li><strong>Personal responsibility emerged as a contentious factor, particularly in liver transplant scenarios.</strong> While some students initially argued that alcoholics should receive lower priority due to self-inflicted illness, many evolved to view addiction as a complex disease with social determinants rather than a simple choice, eventually favoring sobriety requirements over permanent exclusion.</li>
<li><strong>Students regularly identified potential systemic bias against disabled or disadvantaged populations.</strong> Many conversations evolved toward proposing concrete safeguards including ethics boards, transparent written criteria, blind second opinions, and patient advocates to ensure fair treatment regardless of disability status or financial resources.</li>
</ul>
<h3>Guide's role</h3>
<ul>
<li><strong>Guide consistently challenged students to scrutinize their assumptions and address inconsistencies in their reasoning.</strong> When students made simplistic claims about "objectivity" in medical decision-making or treating patients "equally," Guide pressed them to articulate specific criteria and confront how seemingly neutral metrics might embed bias.</li>
<li><strong>Guide reframed discussions by introducing key ethical distinctions and alternative perspectives.</strong> By introducing concepts like the difference between describing current practices versus proposing ideal systems, or highlighting addiction as a brain disease rather than purely a choice, Guide pushed students to develop more sophisticated analytical frameworks.</li>
<li><strong>Guide maintained focus on concrete policy implications rather than abstract principles.</strong> When discussions veered into generalities, Guide steered students back to practical questions about how their proposed frameworks would work in real-world scenarios involving mixed factors, edge cases, or implementation challenges.</li>
</ul>
<h3>Common ground</h3>
<ul>
<li><strong>Students largely agreed that individual medical assessment should replace categorical exclusions.</strong> Even when initially divided, most students eventually rejected automatic deprioritization based solely on disability status or alcoholism, instead favoring personalized evaluations of medical urgency, expected outcomes, and demonstrated commitment to recovery.</li>
<li><strong>There was broad consensus that safeguards against bias are essential in resource allocation systems.</strong> Students widely supported mechanisms like ethics committees, transparency in criteria, training to counter unconscious bias, and involving patient advocates to ensure fair treatment for vulnerable populations.</li>
<li><strong>Students generally acknowledged that both efficiency and fairness must factor into allocation decisions.</strong> While weighing these values differently, most students recognized the legitimate tension between maximizing lives saved with limited resources and ensuring equitable access regardless of characteristics beyond patients' control.</li>
</ul>
<h3>Persistent disagreements</h3>
<ul>
<li><strong>Students remained divided on whether statistical outcome differences justify different treatment protocols.</strong> Some maintained that maximizing overall benefit (through measures like QALYs) represents responsible stewardship of limited resources, while others argued that such approaches systematically devalue disabled lives and constitute discrimination regardless of intent.</li>
<li><strong>The proper weight of personal responsibility in medical prioritization remained contentious.</strong> While students often moved toward seeing addiction as a disease rather than a moral failing, they disagreed about whether and how much past behavior should influence current prioritization when resources are limited.</li>
<li><strong>The role of financial considerations sparked fundamental disagreements about healthcare's nature.</strong> Some students viewed healthcare primarily through market principles where ability to pay inevitably influences access, while others insisted healthcare is a fundamental human right that should be equally available regardless of financial means.</li>
</ul>
<h3>Insights</h3>
<ul>
<li><strong>Students often began with simplistic positions but developed more nuanced views when pressed.</strong> Many initially defaulted to categorical statements about treating everyone "the same" or making decisions "objectively," but gradually acknowledged the complexity of balancing competing values when Guide pressed for specific allocation criteria.</li>
<li><strong>Real-world examples and personal experiences profoundly shaped ethical reasoning.</strong> When students shared stories about family members with disabilities or described their understanding of addiction, these concrete examples often prompted more compassionate and nuanced positions than abstract principles alone.</li>
<li><strong>Students struggled to maintain consistent principles across different scarcity scenarios.</strong> Positions on disability, alcoholism, and financial ability sometimes revealed inconsistent underlying values, suggesting students were still developing coherent ethical frameworks rather than applying established principles.</li>
</ul>
<h3>Possible misconceptions</h3>
<ul>
<li><strong>Some students initially characterized alcoholism primarily as a choice rather than a medical condition.</strong> While perspectives evolved through discussion, early exchanges sometimes reflected a limited understanding of addiction as a brain disease with genetic, environmental, and psychological factors that complicate notions of personal responsibility.</li>
<li><strong>Students occasionally confused descriptive statements about current healthcare systems with normative claims about how care should be allocated.</strong> This confusion sometimes led to talking past each other when one student described existing practices while another advocated for ideal systems.</li>
<li><strong>The concept of "quality-adjusted life years" was sometimes invoked without full appreciation of its methodological limitations.</strong> Some students presented QALYs as purely objective measures without acknowledging the potentially problematic value judgments embedded in how quality of life is defined and measured.</li>
</ul>
<h3>Lessons</h3>
<ul>
<li><strong>The liver transplant for alcoholics scenario prompted especially productive ethical reasoning.</strong> This case effectively challenged students to balance competing values including personal responsibility, medical efficacy, compassion, and resource stewardship, leading to nuanced positions that evolved significantly through discussion.</li>
<li><strong>Discussions about disability and allocation sometimes suffered from vague definitions.</strong> The strongest conversations specified particular disabilities and treatment scenarios, while weaker exchanges remained abstract, suggesting future prompts might benefit from more concrete examples.</li>
<li><strong>Students were most engaged when asked to propose specific safeguards and criteria.</strong> Guide's requests for concrete allocation frameworks and policy details produced more thoughtful engagement than purely theoretical debates about abstract principles or values.</li>
</ul>
</div>
<!-- Hidden raw markdown for test compatibility -->
<div id="report-raw-markdown" style="display:none;">The assignment posed the ethical challenge of allocating scarce medical resources in healthcare settings. Students were asked to debate difficult prioritization decisions, exploring whether certain patients deserve priority access to limited treatments or transplants based on criteria like disability status, personal responsibility in illness (particularly alcoholism and liver transplants), and ability to pay. Throughout these discussions, students confronted fundamental ethical tensions between utilitarian approaches (maximizing benefit) and egalitarian principles (ensuring equal access regardless of circumstance).

### Themes
- **The tension between outcome-based allocation and equal moral worth dominated discussions.** Students regularly oscillated between pragmatic utility calculations (maximizing lives saved or quality-adjusted life years) and principled commitments to equal treatment, with many gradually developing nuanced middle-ground positions incorporating both concerns.
- **Personal responsibility emerged as a contentious factor, particularly in liver transplant scenarios.** While some students initially argued that alcoholics should receive lower priority due to self-inflicted illness, many evolved to view addiction as a complex disease with social determinants rather than a simple choice, eventually favoring sobriety requirements over permanent exclusion.
- **Students regularly identified potential systemic bias against disabled or disadvantaged populations.** Many conversations evolved toward proposing concrete safeguards including ethics boards, transparent written criteria, blind second opinions, and patient advocates to ensure fair treatment regardless of disability status or financial resources.

### Guide's role
- **Guide consistently challenged students to scrutinize their assumptions and address inconsistencies in their reasoning.** When students made simplistic claims about "objectivity" in medical decision-making or treating patients "equally," Guide pressed them to articulate specific criteria and confront how seemingly neutral metrics might embed bias.
- **Guide reframed discussions by introducing key ethical distinctions and alternative perspectives.** By introducing concepts like the difference between describing current practices versus proposing ideal systems, or highlighting addiction as a brain disease rather than purely a choice, Guide pushed students to develop more sophisticated analytical frameworks.
- **Guide maintained focus on concrete policy implications rather than abstract principles.** When discussions veered into generalities, Guide steered students back to practical questions about how their proposed frameworks would work in real-world scenarios involving mixed factors, edge cases, or implementation challenges.

### Common ground
- **Students largely agreed that individual medical assessment should replace categorical exclusions.** Even when initially divided, most students eventually rejected automatic deprioritization based solely on disability status or alcoholism, instead favoring personalized evaluations of medical urgency, expected outcomes, and demonstrated commitment to recovery.
- **There was broad consensus that safeguards against bias are essential in resource allocation systems.** Students widely supported mechanisms like ethics committees, transparency in criteria, training to counter unconscious bias, and involving patient advocates to ensure fair treatment for vulnerable populations.
- **Students generally acknowledged that both efficiency and fairness must factor into allocation decisions.** While weighing these values differently, most students recognized the legitimate tension between maximizing lives saved with limited resources and ensuring equitable access regardless of characteristics beyond patients' control.

### Persistent disagreements
- **Students remained divided on whether statistical outcome differences justify different treatment protocols.** Some maintained that maximizing overall benefit (through measures like QALYs) represents responsible stewardship of limited resources, while others argued that such approaches systematically devalue disabled lives and constitute discrimination regardless of intent.
- **The proper weight of personal responsibility in medical prioritization remained contentious.** While students often moved toward seeing addiction as a disease rather than a moral failing, they disagreed about whether and how much past behavior should influence current prioritization when resources are limited.
- **The role of financial considerations sparked fundamental disagreements about healthcare's nature.** Some students viewed healthcare primarily through market principles where ability to pay inevitably influences access, while others insisted healthcare is a fundamental human right that should be equally available regardless of financial means.

### Insights
- **Students often began with simplistic positions but developed more nuanced views when pressed.** Many initially defaulted to categorical statements about treating everyone "the same" or making decisions "objectively," but gradually acknowledged the complexity of balancing competing values when Guide pressed for specific allocation criteria.
- **Real-world examples and personal experiences profoundly shaped ethical reasoning.** When students shared stories about family members with disabilities or described their understanding of addiction, these concrete examples often prompted more compassionate and nuanced positions than abstract principles alone.
- **Students struggled to maintain consistent principles across different scarcity scenarios.** Positions on disability, alcoholism, and financial ability sometimes revealed inconsistent underlying values, suggesting students were still developing coherent ethical frameworks rather than applying established principles.

### Possible misconceptions
- **Some students initially characterized alcoholism primarily as a choice rather than a medical condition.** While perspectives evolved through discussion, early exchanges sometimes reflected a limited understanding of addiction as a brain disease with genetic, environmental, and psychological factors that complicate notions of personal responsibility.
- **Students occasionally confused descriptive statements about current healthcare systems with normative claims about how care should be allocated.** This confusion sometimes led to talking past each other when one student described existing practices while another advocated for ideal systems.
- **The concept of "quality-adjusted life years" was sometimes invoked without full appreciation of its methodological limitations.** Some students presented QALYs as purely objective measures without acknowledging the potentially problematic value judgments embedded in how quality of life is defined and measured.

### Lessons
- **The liver transplant for alcoholics scenario prompted especially productive ethical reasoning.** This case effectively challenged students to balance competing values including personal responsibility, medical efficacy, compassion, and resource stewardship, leading to nuanced positions that evolved significantly through discussion.
- **Discussions about disability and allocation sometimes suffered from vague definitions.** The strongest conversations specified particular disabilities and treatment scenarios, while weaker exchanges remained abstract, suggesting future prompts might benefit from more concrete examples.
- **Students were most engaged when asked to propose specific safeguards and criteria.** Guide's requests for concrete allocation frameworks and policy details produced more thoughtful engagement than purely theoretical debates about abstract principles or values.</div>
<!-- RAW REPORT CONTENT FOR TESTING: The assignment posed -->
<span id="report-prefix" style="display:none;">The assignment posed</span>
<div class="text-muted mt-2 d-flex justify-content-end align-items-center">
<span class="text-right" style="flex:1; text-align:right;">Generated on: 
        <script>
          document.write(new Date("2025-05-06T14:58:46.986202").toLocaleDateString('en-US', {
            month: 'short', 
            day: 'numeric', 
            year: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
          }));
        </script>
<noscript>2025-05-06T14:58:46.986202</noscript>
</span>
</div>
<div id="report-editor-container" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the report in markdown format.
      </div>
<textarea class="form-control" id="report-markdown-editor">The assignment posed the ethical challenge of allocating scarce medical resources in healthcare settings. Students were asked to debate difficult prioritization decisions, exploring whether certain patients deserve priority access to limited treatments or transplants based on criteria like disability status, personal responsibility in illness (particularly alcoholism and liver transplants), and ability to pay. Throughout these discussions, students confronted fundamental ethical tensions between utilitarian approaches (maximizing benefit) and egalitarian principles (ensuring equal access regardless of circumstance).

### Themes
- **The tension between outcome-based allocation and equal moral worth dominated discussions.** Students regularly oscillated between pragmatic utility calculations (maximizing lives saved or quality-adjusted life years) and principled commitments to equal treatment, with many gradually developing nuanced middle-ground positions incorporating both concerns.
- **Personal responsibility emerged as a contentious factor, particularly in liver transplant scenarios.** While some students initially argued that alcoholics should receive lower priority due to self-inflicted illness, many evolved to view addiction as a complex disease with social determinants rather than a simple choice, eventually favoring sobriety requirements over permanent exclusion.
- **Students regularly identified potential systemic bias against disabled or disadvantaged populations.** Many conversations evolved toward proposing concrete safeguards including ethics boards, transparent written criteria, blind second opinions, and patient advocates to ensure fair treatment regardless of disability status or financial resources.

### Guide's role
- **Guide consistently challenged students to scrutinize their assumptions and address inconsistencies in their reasoning.** When students made simplistic claims about "objectivity" in medical decision-making or treating patients "equally," Guide pressed them to articulate specific criteria and confront how seemingly neutral metrics might embed bias.
- **Guide reframed discussions by introducing key ethical distinctions and alternative perspectives.** By introducing concepts like the difference between describing current practices versus proposing ideal systems, or highlighting addiction as a brain disease rather than purely a choice, Guide pushed students to develop more sophisticated analytical frameworks.
- **Guide maintained focus on concrete policy implications rather than abstract principles.** When discussions veered into generalities, Guide steered students back to practical questions about how their proposed frameworks would work in real-world scenarios involving mixed factors, edge cases, or implementation challenges.

### Common ground
- **Students largely agreed that individual medical assessment should replace categorical exclusions.** Even when initially divided, most students eventually rejected automatic deprioritization based solely on disability status or alcoholism, instead favoring personalized evaluations of medical urgency, expected outcomes, and demonstrated commitment to recovery.
- **There was broad consensus that safeguards against bias are essential in resource allocation systems.** Students widely supported mechanisms like ethics committees, transparency in criteria, training to counter unconscious bias, and involving patient advocates to ensure fair treatment for vulnerable populations.
- **Students generally acknowledged that both efficiency and fairness must factor into allocation decisions.** While weighing these values differently, most students recognized the legitimate tension between maximizing lives saved with limited resources and ensuring equitable access regardless of characteristics beyond patients' control.

### Persistent disagreements
- **Students remained divided on whether statistical outcome differences justify different treatment protocols.** Some maintained that maximizing overall benefit (through measures like QALYs) represents responsible stewardship of limited resources, while others argued that such approaches systematically devalue disabled lives and constitute discrimination regardless of intent.
- **The proper weight of personal responsibility in medical prioritization remained contentious.** While students often moved toward seeing addiction as a disease rather than a moral failing, they disagreed about whether and how much past behavior should influence current prioritization when resources are limited.
- **The role of financial considerations sparked fundamental disagreements about healthcare's nature.** Some students viewed healthcare primarily through market principles where ability to pay inevitably influences access, while others insisted healthcare is a fundamental human right that should be equally available regardless of financial means.

### Insights
- **Students often began with simplistic positions but developed more nuanced views when pressed.** Many initially defaulted to categorical statements about treating everyone "the same" or making decisions "objectively," but gradually acknowledged the complexity of balancing competing values when Guide pressed for specific allocation criteria.
- **Real-world examples and personal experiences profoundly shaped ethical reasoning.** When students shared stories about family members with disabilities or described their understanding of addiction, these concrete examples often prompted more compassionate and nuanced positions than abstract principles alone.
- **Students struggled to maintain consistent principles across different scarcity scenarios.** Positions on disability, alcoholism, and financial ability sometimes revealed inconsistent underlying values, suggesting students were still developing coherent ethical frameworks rather than applying established principles.

### Possible misconceptions
- **Some students initially characterized alcoholism primarily as a choice rather than a medical condition.** While perspectives evolved through discussion, early exchanges sometimes reflected a limited understanding of addiction as a brain disease with genetic, environmental, and psychological factors that complicate notions of personal responsibility.
- **Students occasionally confused descriptive statements about current healthcare systems with normative claims about how care should be allocated.** This confusion sometimes led to talking past each other when one student described existing practices while another advocated for ideal systems.
- **The concept of "quality-adjusted life years" was sometimes invoked without full appreciation of its methodological limitations.** Some students presented QALYs as purely objective measures without acknowledging the potentially problematic value judgments embedded in how quality of life is defined and measured.

### Lessons
- **The liver transplant for alcoholics scenario prompted especially productive ethical reasoning.** This case effectively challenged students to balance competing values including personal responsibility, medical efficacy, compassion, and resource stewardship, leading to nuanced positions that evolved significantly through discussion.
- **Discussions about disability and allocation sometimes suffered from vague definitions.** The strongest conversations specified particular disabilities and treatment scenarios, while weaker exchanges remained abstract, suggesting future prompts might benefit from more concrete examples.
- **Students were most engaged when asked to propose specific safeguards and criteria.** Guide's requests for concrete allocation frameworks and policy details produced more thoughtful engagement than purely theoretical debates about abstract principles or values.</textarea>
<div class="mt-3">
<button class="btn btn-primary" id="save-report-btn">
<i class="fas fa-save mr-1"></i> Save Changes
        </button>
<button class="btn btn-secondary ml-2" id="cancel-report-edit-btn">
<i class="fas fa-times mr-1"></i> Cancel
        </button>
<span class="spinner-border spinner-border-sm ml-2" id="editor-spinner" role="status" style="display: none;"></span>
</div>
<div class="status-message mt-3" id="editor-status-message" style="display: none;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="row mb-2">
<div class="col-12">
<h5 class="section-title">
<div class="title-text"><i class="fas fa-comments mr-1"></i> Chat Threads</div>
</h5>
</div>
<div class="pt-0 pb-2">
<!-- DEBUG: Show if threads is missing or empty -->
<div class="text-muted small mb-0 section-info-align">
<i class="fas fa-info-circle mr-1"></i> Only threads with 10 or more messages are shown and processed for summaries. Student names are redacted for privacy.
          </div>
</div>
</div>
<!-- Separate row for thread items floating on background -->
<div class="row mb-5">
<div class="col-12">
<div class="thread-list" id="thread-list">
<div class="masonry-grid">
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==b47c4be4df::student-z21hawwuy29t727419eee7::94ade63a31::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Distribution
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==b47c4be4df::student-z21hawwuy29t727419eee7::94ade63a31::de0511837f">
<ul>
<li><strong>Initial positions clashed over whether ability to pay should determine care, with Student 1 acknowledging real-world practices and Student 2 emphasizing healthcare as a universal human right.</strong> Student 1 began by describing the status quo—those who pay get treated—and Student 2 countered by highlighting moral failings when the poor are denied lifesaving care.  </li>
<li><strong>Throughout the discussion, Student 1 shifted toward endorsing free healthcare but struggled with the tension between ideal access and practical financial priorities, while Student 2 remained steady in advocating equality but noted systemic barriers.</strong> The clash over whether emergency debt undermines medical ethics and how to prevent a two-tiered system surfaced recurring contradictions in Student 1’s stance and practical challenges enumerated by Student 2.  </li>
<li><strong>Guide consistently pushed students to distinguish describing versus endorsing, to propose concrete reforms, and to confront internal inconsistencies, culminating in a rigorous challenge to their core assumptions about healthcare as a market commodity.</strong> Its probing questions on debt-based emergency care, volunteer clinics, and the ethics of prioritizing paying patients kept the debate focused on both principles and implementation.  </li>
</ul>
<blockquote>
<p><strong>Is healthcare a consumer product like books, or a fundamental right? Books aren't essential to survival, but healthcare often is. Should life-saving care follow market principles?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==b47c4be4df::student-z21hawwuy29t727419eee7::94ade63a31::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==b47c4be4df::student-z21hawwuy29t727419eee7::94ade63a31::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==b47c4be4df::student-z21hawwuy29t727419eee7::94ade63a31::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==b47c4be4df::student-z21hawwuy29t727419eee7::94ade63a31::de0511837f">- **Initial positions clashed over whether ability to pay should determine care, with Student 1 acknowledging real-world practices and Student 2 emphasizing healthcare as a universal human right.** Student 1 began by describing the status quo—those who pay get treated—and Student 2 countered by highlighting moral failings when the poor are denied lifesaving care.  
- **Throughout the discussion, Student 1 shifted toward endorsing free healthcare but struggled with the tension between ideal access and practical financial priorities, while Student 2 remained steady in advocating equality but noted systemic barriers.** The clash over whether emergency debt undermines medical ethics and how to prevent a two-tiered system surfaced recurring contradictions in Student 1’s stance and practical challenges enumerated by Student 2.  
- **Guide consistently pushed students to distinguish describing versus endorsing, to propose concrete reforms, and to confront internal inconsistencies, culminating in a rigorous challenge to their core assumptions about healthcare as a market commodity.** Its probing questions on debt-based emergency care, volunteer clinics, and the ethics of prioritizing paying patients kept the debate focused on both principles and implementation.  


&gt; **Is healthcare a consumer product like books, or a fundamental right? Books aren't essential to survival, but healthcare often is. Should life-saving care follow market principles?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==b47c4be4df::student-z21hawwuy29t727419eee7::94ade63a31::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==b47c4be4df::student-z21hawwuy29t727419eee7::94ade63a31::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==b47c4be4df::student-z21hawwuy29t727419eee7::94ade63a31::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==b47c4be4df::student-z21hawwuy29t727419eee7::94ade63a31::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==2092d9aee9::student-z21hawwuy29t7abc1642dd::96694e6ccd::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Alcoholism and Liver Transplanation
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==2092d9aee9::student-z21hawwuy29t7abc1642dd::96694e6ccd::de0511837f">
<ul>
<li><strong>Students began sharply divided on whether alcoholics should compete equally for liver transplants, framing the issue as choice versus fairness.</strong> Student 2 held that untreated alcoholism is a personal decision disqualifying patients from equal priority, while Student 1 insisted on universal healthcare access regardless of lifestyle choices.  </li>
<li><strong>Their positions softened as they acknowledged treatment barriers and the complexity of addiction, arriving at a nuanced system weighing medical need, sobriety efforts, and socioeconomic factors.</strong> Student 2 admitted exceptions for those lacking access to care, and Student 1 supported individualized criteria and post‐transplant support to balance compassion with scarce organs.  </li>
<li><strong>Guide drove the discussion with probing questions about addiction as a brain disease, the impact of poverty on treatment access, and the risk of stigmatizing “deserving” patients.</strong> Its interventions systematically challenged assumptions and helped students refine criteria for responsibility, fairness, and practical safeguards.  </li>
</ul>
<blockquote>
<p><strong>Student 2, you've raised an important point about scarcity and personal responsibility. What would you say to those who argue that alcoholism is a disease rather than simply a choice? Many medical organizations classify addiction as a chronic brain disorder with genetic, environmental, and psychological factors.</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==2092d9aee9::student-z21hawwuy29t7abc1642dd::96694e6ccd::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==2092d9aee9::student-z21hawwuy29t7abc1642dd::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==2092d9aee9::student-z21hawwuy29t7abc1642dd::96694e6ccd::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==2092d9aee9::student-z21hawwuy29t7abc1642dd::96694e6ccd::de0511837f">- **Students began sharply divided on whether alcoholics should compete equally for liver transplants, framing the issue as choice versus fairness.** Student 2 held that untreated alcoholism is a personal decision disqualifying patients from equal priority, while Student 1 insisted on universal healthcare access regardless of lifestyle choices.  
- **Their positions softened as they acknowledged treatment barriers and the complexity of addiction, arriving at a nuanced system weighing medical need, sobriety efforts, and socioeconomic factors.** Student 2 admitted exceptions for those lacking access to care, and Student 1 supported individualized criteria and post‐transplant support to balance compassion with scarce organs.  
- **Guide drove the discussion with probing questions about addiction as a brain disease, the impact of poverty on treatment access, and the risk of stigmatizing “deserving” patients.** Its interventions systematically challenged assumptions and helped students refine criteria for responsibility, fairness, and practical safeguards.  


&gt; **Student 2, you've raised an important point about scarcity and personal responsibility. What would you say to those who argue that alcoholism is a disease rather than simply a choice? Many medical organizations classify addiction as a chronic brain disorder with genetic, environmental, and psychological factors.**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==2092d9aee9::student-z21hawwuy29t7abc1642dd::96694e6ccd::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==2092d9aee9::student-z21hawwuy29t7abc1642dd::96694e6ccd::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==2092d9aee9::student-z21hawwuy29t7abc1642dd::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==2092d9aee9::student-z21hawwuy29t7abc1642dd::96694e6ccd::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==c0f33c0ade::96694e6ccd::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Alcoholism and Liver Transplanation
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==c0f33c0ade::96694e6ccd::de0511837f">
<ul>
<li><strong>Students moved from initial uncertainty to a thoughtful consensus balancing fairness with resource stewardship.</strong> They agreed that addiction is a disease, not a moral failing, and endorsed criteria like documented sobriety, underlying health, and support systems, all while acknowledging the tension between patient autonomy and organ scarcity. Their repeated “Hey Guide, what do we do next?” revealed early passivity but gave way to deeper engagement as they weighed controllable versus uncontrollable factors and the value of second chances.</li>
<li><strong>Guide kept the discussion on track with pointed prompts that challenged assumptions about past behavior, justice, and decision-making authority.</strong> By asking who should make transplant decisions, how to weigh empathy against objective criteria, and what role ethical committees might play, Guide guided the students toward a nuanced framework for allocating livers fairly and effectively.</li>
</ul>
<blockquote>
<p><strong>Student 1, Student 2 suggests documented sobriety as a criterion. What other factors beyond sobriety might be relevant when deciding who gets priority for a liver transplant? Consider things like age, overall health, or support systems that might affect outcomes. How might these intersect with questions of justice and equity in organ allocation?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==c0f33c0ade::96694e6ccd::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==c0f33c0ade::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==c0f33c0ade::96694e6ccd::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==c0f33c0ade::96694e6ccd::de0511837f">- **Students moved from initial uncertainty to a thoughtful consensus balancing fairness with resource stewardship.** They agreed that addiction is a disease, not a moral failing, and endorsed criteria like documented sobriety, underlying health, and support systems, all while acknowledging the tension between patient autonomy and organ scarcity. Their repeated “Hey Guide, what do we do next?” revealed early passivity but gave way to deeper engagement as they weighed controllable versus uncontrollable factors and the value of second chances.
- **Guide kept the discussion on track with pointed prompts that challenged assumptions about past behavior, justice, and decision-making authority.** By asking who should make transplant decisions, how to weigh empathy against objective criteria, and what role ethical committees might play, Guide guided the students toward a nuanced framework for allocating livers fairly and effectively.


&gt; **Student 1, Student 2 suggests documented sobriety as a criterion. What other factors beyond sobriety might be relevant when deciding who gets priority for a liver transplant? Consider things like age, overall health, or support systems that might affect outcomes. How might these intersect with questions of justice and equity in organ allocation?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==c0f33c0ade::96694e6ccd::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==c0f33c0ade::96694e6ccd::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==c0f33c0ade::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==2f766320dd::student-dwfilmvkdq==c0f33c0ade::96694e6ccd::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==8793533cdd::96694e6ccd::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Alcoholism and Liver Transplanation
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==8793533cdd::96694e6ccd::de0511837f">
<ul>
<li><strong>Students initially split between moral fault and clinical outcomes in liver allocation.</strong> Student 1 argued for equal competition based on post-transplant prognosis, while Student 2 maintained that self-inflicted illness should warrant lower priority, though both later acknowledged the complexity of scarcity and scoring metrics.</li>
<li><strong>Guide persistently challenged simplistic views and steered the group toward core ethical trade-offs in organ allocation.</strong> By posing scenarios—acute alcoholic hepatitis, living donors, comparisons to smokers and athletes—it urged the students to weigh fairness, medical efficacy, and social support rather than defaulting to moral judgments.</li>
</ul>
<blockquote>
<p><strong>Student 1, where do we draw the line on fault? What about someone who develops liver disease after taking medication with known liver risks? Or someone who gets hepatitis from risky behavior? The scarcity argument is compelling, but is moral worthiness the best criterion for allocation, or should medical outcomes matter more?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==8793533cdd::96694e6ccd::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==8793533cdd::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==8793533cdd::96694e6ccd::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==8793533cdd::96694e6ccd::de0511837f">- **Students initially split between moral fault and clinical outcomes in liver allocation.** Student 1 argued for equal competition based on post-transplant prognosis, while Student 2 maintained that self-inflicted illness should warrant lower priority, though both later acknowledged the complexity of scarcity and scoring metrics.
- **Guide persistently challenged simplistic views and steered the group toward core ethical trade-offs in organ allocation.** By posing scenarios—acute alcoholic hepatitis, living donors, comparisons to smokers and athletes—it urged the students to weigh fairness, medical efficacy, and social support rather than defaulting to moral judgments.


&gt; **Student 1, where do we draw the line on fault? What about someone who develops liver disease after taking medication with known liver risks? Or someone who gets hepatitis from risky behavior? The scarcity argument is compelling, but is moral worthiness the best criterion for allocation, or should medical outcomes matter more?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==8793533cdd::96694e6ccd::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==8793533cdd::96694e6ccd::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==8793533cdd::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==209c3410dd::student-dwfilmvkdq==8793533cdd::96694e6ccd::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==349f5f32df::student-dwfilmvkdq==b03ab1d0df::4debf3e369::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Disability Discrimination
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==349f5f32df::student-dwfilmvkdq==b03ab1d0df::4debf3e369::de0511837f">
<ul>
<li><strong>Students questioned the fairness of deprioritizing disabled patients when medical resources are scarce, focusing on triage principles like severity of condition, treatment effectiveness, and chance of survival.</strong> They discussed existing triage protocols and contemplated using baseline health status to evaluate both disabled and non-disabled patients equally.  </li>
<li><strong>The discussion evolved from a pragmatic acceptance of reality to proactive solutions for preventing ableism, with both students agreeing on ethics boards, bias training, and disability advocates as safeguards.</strong> They wrestled over how to define "potential" consistently and fairly, noting that metrics like survival rates or treatment effectiveness could inadvertently disadvantage people with disabilities.  </li>
<li><strong>Guide consistently challenged the students to justify their criteria and exposed the tension between objective medical metrics and discrimination, pushing for deeper reflection on safeguards and individual assessments.</strong> Its interventions prompted students to reconsider whether seemingly neutral standards might still embed bias and how to address statistical disparities fairly.  </li>
</ul>
<blockquote>
<p><strong>If "chance of survival" becomes a key criterion, couldn't this systematically disadvantage people with certain disabilities who might have lower statistical survival rates?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==349f5f32df::student-dwfilmvkdq==b03ab1d0df::4debf3e369::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==349f5f32df::student-dwfilmvkdq==b03ab1d0df::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==349f5f32df::student-dwfilmvkdq==b03ab1d0df::4debf3e369::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==349f5f32df::student-dwfilmvkdq==b03ab1d0df::4debf3e369::de0511837f">- **Students questioned the fairness of deprioritizing disabled patients when medical resources are scarce, focusing on triage principles like severity of condition, treatment effectiveness, and chance of survival.** They discussed existing triage protocols and contemplated using baseline health status to evaluate both disabled and non-disabled patients equally.  
- **The discussion evolved from a pragmatic acceptance of reality to proactive solutions for preventing ableism, with both students agreeing on ethics boards, bias training, and disability advocates as safeguards.** They wrestled over how to define "potential" consistently and fairly, noting that metrics like survival rates or treatment effectiveness could inadvertently disadvantage people with disabilities.  
- **Guide consistently challenged the students to justify their criteria and exposed the tension between objective medical metrics and discrimination, pushing for deeper reflection on safeguards and individual assessments.** Its interventions prompted students to reconsider whether seemingly neutral standards might still embed bias and how to address statistical disparities fairly.  


&gt; **If "chance of survival" becomes a key criterion, couldn't this systematically disadvantage people with certain disabilities who might have lower statistical survival rates?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==349f5f32df::student-dwfilmvkdq==b03ab1d0df::4debf3e369::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==349f5f32df::student-dwfilmvkdq==b03ab1d0df::4debf3e369::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==349f5f32df::student-dwfilmvkdq==b03ab1d0df::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==349f5f32df::student-dwfilmvkdq==b03ab1d0df::4debf3e369::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==fa671a3cdf::4debf3e369::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Disability Discrimination
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==fa671a3cdf::4debf3e369::de0511837f">
<ul>
<li><strong>Students clashed over prioritizing lives by potential benefit versus enforcing strict equality.</strong> Student 1 maintained that allocating scarce treatments to those who would derive more years of life was a pragmatic necessity, while Student 2 insisted on a 50/50 or first-come–first-served approach to uphold equal moral worth.  </li>
<li><strong>As the debate unfolded, Student 1 refined their stance to apply only to critically scarce resources, whereas Student 2 remained unwavering that any deviation constitutes discrimination.</strong> They exchanged emotional appeals—Student 2 asking peers to imagine being denied care due to disability, and Student 1 countering with analogies about maximizing heart utility.  </li>
<li><strong>Guide persistently pressed both sides to scrutinize the ethical underpinnings of utility versus equality, highlighting how outcome-based rules could systematically disadvantage people with disabilities.</strong> Its probing questions led students to confront the conflict between intention and impact and consider whether optimizing years of life aligns with healthcare’s core purpose.  </li>
</ul>
<blockquote>
<p><strong>Student 1 what's the difference between making the most of resources and discrimination if the outcome systematically disadvantages people with disabilities? Intent matters but so do results. If your approach consistently denies care to certain groups based on characteristics they can't control, the impact resembles discrimination regardless of what we call it. How do you address this concern?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==fa671a3cdf::4debf3e369::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==fa671a3cdf::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==fa671a3cdf::4debf3e369::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==fa671a3cdf::4debf3e369::de0511837f">- **Students clashed over prioritizing lives by potential benefit versus enforcing strict equality.** Student 1 maintained that allocating scarce treatments to those who would derive more years of life was a pragmatic necessity, while Student 2 insisted on a 50/50 or first-come–first-served approach to uphold equal moral worth.  
- **As the debate unfolded, Student 1 refined their stance to apply only to critically scarce resources, whereas Student 2 remained unwavering that any deviation constitutes discrimination.** They exchanged emotional appeals—Student 2 asking peers to imagine being denied care due to disability, and Student 1 countering with analogies about maximizing heart utility.  
- **Guide persistently pressed both sides to scrutinize the ethical underpinnings of utility versus equality, highlighting how outcome-based rules could systematically disadvantage people with disabilities.** Its probing questions led students to confront the conflict between intention and impact and consider whether optimizing years of life aligns with healthcare’s core purpose.  


&gt; **Student 1 what's the difference between making the most of resources and discrimination if the outcome systematically disadvantages people with disabilities? Intent matters but so do results. If your approach consistently denies care to certain groups based on characteristics they can't control, the impact resembles discrimination regardless of what we call it. How do you address this concern?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==fa671a3cdf::4debf3e369::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==fa671a3cdf::4debf3e369::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==fa671a3cdf::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-awnsb3vklmnvbq==1ec9a7b4df::student-dwfilmvkdq==fa671a3cdf::4debf3e369::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==a8cfc07edd::student-dwfilmvkdq==be8e2cdede::96694e6ccd::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Alcoholism and Liver Transplanation
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==a8cfc07edd::student-dwfilmvkdq==be8e2cdede::96694e6ccd::de0511837f">
<ul>
<li><strong>Students began by debating whether alcoholics should be deprioritized because their liver failure is self-induced, with Student 1 arguing non-alcoholics deserve first consideration and Student 2 pivoting from the assigned “disagree” stance to suggest financial stability as a tiebreaker.</strong> Student 1 pushed back against using wealth to decide organ allocation, emphasizing human dignity over economic means. They gradually shifted toward a shared focus on medical urgency and the likelihood of successful transplant outcomes.  </li>
<li><strong>They wrestled with the ethics of personal responsibility versus systemic inequities, questioning if financial means or treatment options should influence eligibility.</strong> The discussion underscored tensions between ideal allocation principles and the reality of a capitalist healthcare system, with both acknowledging addiction as a complex disease needing pre-transplant support.  </li>
<li><strong>Guide consistently challenged assumptions and refocused the debate on core ethical principles and practical constraints.</strong> It flagged Student 2’s role confusion, pressed students to distinguish between descriptive realities and normative ideals, and introduced key questions on disease versus choice and timing of addiction treatment relative to transplant eligibility.  </li>
</ul>
<blockquote>
<p><strong>Student 1, given your observation about healthcare's current state, do you believe this is how the system should work, or are you describing reality? If we're discussing ideal organ allocation, should we consider factors like personal responsibility for liver damage (as Maia suggested) or focus on other criteria entirely?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==a8cfc07edd::student-dwfilmvkdq==be8e2cdede::96694e6ccd::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==a8cfc07edd::student-dwfilmvkdq==be8e2cdede::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==a8cfc07edd::student-dwfilmvkdq==be8e2cdede::96694e6ccd::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==a8cfc07edd::student-dwfilmvkdq==be8e2cdede::96694e6ccd::de0511837f">- **Students began by debating whether alcoholics should be deprioritized because their liver failure is self-induced, with Student 1 arguing non-alcoholics deserve first consideration and Student 2 pivoting from the assigned “disagree” stance to suggest financial stability as a tiebreaker.** Student 1 pushed back against using wealth to decide organ allocation, emphasizing human dignity over economic means. They gradually shifted toward a shared focus on medical urgency and the likelihood of successful transplant outcomes.  
- **They wrestled with the ethics of personal responsibility versus systemic inequities, questioning if financial means or treatment options should influence eligibility.** The discussion underscored tensions between ideal allocation principles and the reality of a capitalist healthcare system, with both acknowledging addiction as a complex disease needing pre-transplant support.  
- **Guide consistently challenged assumptions and refocused the debate on core ethical principles and practical constraints.** It flagged Student 2’s role confusion, pressed students to distinguish between descriptive realities and normative ideals, and introduced key questions on disease versus choice and timing of addiction treatment relative to transplant eligibility.  


&gt; **Student 1, given your observation about healthcare's current state, do you believe this is how the system should work, or are you describing reality? If we're discussing ideal organ allocation, should we consider factors like personal responsibility for liver damage (as Maia suggested) or focus on other criteria entirely?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==a8cfc07edd::student-dwfilmvkdq==be8e2cdede::96694e6ccd::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==a8cfc07edd::student-dwfilmvkdq==be8e2cdede::96694e6ccd::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==a8cfc07edd::student-dwfilmvkdq==be8e2cdede::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==a8cfc07edd::student-dwfilmvkdq==be8e2cdede::96694e6ccd::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==1043f13adf::student-z21hawwuy29t4a1dddeade::4debf3e369::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Disability Discrimination
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==1043f13adf::student-z21hawwuy29t4a1dddeade::4debf3e369::de0511837f">
<ul>
<li><strong>Students oscillated between utilitarian quality-of-life arguments and concerns about pain, workforce contribution, psychological harm, and age when deciding who should get scarce treatment.</strong> Initially Student 1 favored treating whoever had the best post-treatment prospects, then Student 2 argued for prioritizing the disabled due to greater pain and potential workforce inclusion, but both kept reverting to functional capacity as the main factor.  </li>
<li><strong>Guide persistently challenged assumptions by asking for specific criteria, probing ethical standards, and urging students to weigh psychological versus utilitarian factors.</strong> Its pointed questions pushed students to clarify what “major issues” justify prioritization, how standard medical ethics reconcile with need-based decisions, and whether non-functional values like mental health or age should outweigh prospective benefits.  </li>
</ul>
<blockquote>
<p><strong>You suggest that a person with a disability might be a higher priority for treatment due to potential major issues they face. What specific issues do you have in mind, and how do these issues justify prioritizing them over someone without a disability who needs the same treatment? This question gets to the heart of whether disability itself should be a factor in medical prioritization decisions, which is central to our topic.</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==1043f13adf::student-z21hawwuy29t4a1dddeade::4debf3e369::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==1043f13adf::student-z21hawwuy29t4a1dddeade::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==1043f13adf::student-z21hawwuy29t4a1dddeade::4debf3e369::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==1043f13adf::student-z21hawwuy29t4a1dddeade::4debf3e369::de0511837f">- **Students oscillated between utilitarian quality-of-life arguments and concerns about pain, workforce contribution, psychological harm, and age when deciding who should get scarce treatment.** Initially Student 1 favored treating whoever had the best post-treatment prospects, then Student 2 argued for prioritizing the disabled due to greater pain and potential workforce inclusion, but both kept reverting to functional capacity as the main factor.  
- **Guide persistently challenged assumptions by asking for specific criteria, probing ethical standards, and urging students to weigh psychological versus utilitarian factors.** Its pointed questions pushed students to clarify what “major issues” justify prioritization, how standard medical ethics reconcile with need-based decisions, and whether non-functional values like mental health or age should outweigh prospective benefits.  


&gt; **You suggest that a person with a disability might be a higher priority for treatment due to potential major issues they face. What specific issues do you have in mind, and how do these issues justify prioritizing them over someone without a disability who needs the same treatment? This question gets to the heart of whether disability itself should be a factor in medical prioritization decisions, which is central to our topic.**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==1043f13adf::student-z21hawwuy29t4a1dddeade::4debf3e369::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==1043f13adf::student-z21hawwuy29t4a1dddeade::4debf3e369::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==1043f13adf::student-z21hawwuy29t4a1dddeade::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==1043f13adf::student-z21hawwuy29t4a1dddeade::4debf3e369::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f0dad5d2dd::96694e6ccd::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Alcoholism and Liver Transplanation
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f0dad5d2dd::96694e6ccd::de0511837f">
<ul>
<li><strong>Students began with starkly opposing views but converged on a compromise balancing equal access with practical safeguards.</strong> Student 1 defended universal eligibility, while Student 2 highlighted organ scarcity and post‐transplant relapse risks; through the discussion, both came to endorse sobriety requirements, post‐transplant monitoring, and case‐by‐case evaluations to maximize outcomes.</li>
<li><strong>Guide’s Socratic questioning systematically unpacked ethical and practical dimensions—from resource allocation and fairness to extending behavior‐change prerequisites to other lifestyle factors.</strong> Its prompts on metrics for “maximizing benefit,” age considerations, and applying sobriety rules to smoking or drug‐related conditions pushed students toward a more nuanced, balanced policy stance.</li>
</ul>
<blockquote>
<p><strong>Student 1, beyond alcoholism, should other lifestyle factors affect transplant priority? You both seem to agree on sobriety requirements. Should this principle extend to other conditions influenced by personal choices?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f0dad5d2dd::96694e6ccd::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f0dad5d2dd::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f0dad5d2dd::96694e6ccd::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f0dad5d2dd::96694e6ccd::de0511837f">- **Students began with starkly opposing views but converged on a compromise balancing equal access with practical safeguards.** Student 1 defended universal eligibility, while Student 2 highlighted organ scarcity and post‐transplant relapse risks; through the discussion, both came to endorse sobriety requirements, post‐transplant monitoring, and case‐by‐case evaluations to maximize outcomes.
- **Guide’s Socratic questioning systematically unpacked ethical and practical dimensions—from resource allocation and fairness to extending behavior‐change prerequisites to other lifestyle factors.** Its prompts on metrics for “maximizing benefit,” age considerations, and applying sobriety rules to smoking or drug‐related conditions pushed students toward a more nuanced, balanced policy stance.


&gt; **Student 1, beyond alcoholism, should other lifestyle factors affect transplant priority? You both seem to agree on sobriety requirements. Should this principle extend to other conditions influenced by personal choices?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f0dad5d2dd::96694e6ccd::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f0dad5d2dd::96694e6ccd::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f0dad5d2dd::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==24cd2638dd::student-dwfilmvkdq==f0dad5d2dd::96694e6ccd::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==144d2402de::student-dwfilmvkdq==7c87150edd::4debf3e369::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Disability Discrimination
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==144d2402de::student-dwfilmvkdq==7c87150edd::4debf3e369::de0511837f">
<ul>
<li><strong>Students began divided over the priority question, with Student 1 opposing the idea of always treating non-disabled patients first and Student 2 tentatively suggesting disabled persons could get priority yet still aiming to treat both.</strong> Early confusion emerged when Student 2’s proposal to help both conflicted with the scenario’s one‐treatment limit, prompting Guide to press for clearer ethical criteria.  </li>
<li><strong>Guide persistently challenged assumptions and contradictions, guiding the group from simplistic positions toward core ethical principles like justice, benefit, and dignity.</strong> Its probing questions highlighted how outcome‐based justifications risk biasing against disabled patients and spurred students to articulate safeguards such as transparent, need‐based triage and providing advocates or communication aids.  </li>
<li><strong>By the discussion’s end, both students embraced an individualized framework focused on medical urgency and potential benefit rather than disability status alone.</strong> They acknowledged the challenge of balancing fairness and urgency in real healthcare settings and recommended clear inclusive policies to ensure equitable treatment allocation.  </li>
</ul>
<blockquote>
<p><strong>Student 2, you mentioned giving priority to disabled persons but ultimately treating both. This seems to contradict the scenario where we can only treat one person. Student 1, you initially disagreed with prioritizing non-disabled people, but now seem to agree with Student 2. Could you both clarify your positions on this difficult ethical dilemma? What criteria should determine who receives treatment when resources are limited?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==144d2402de::student-dwfilmvkdq==7c87150edd::4debf3e369::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==144d2402de::student-dwfilmvkdq==7c87150edd::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==144d2402de::student-dwfilmvkdq==7c87150edd::4debf3e369::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==144d2402de::student-dwfilmvkdq==7c87150edd::4debf3e369::de0511837f">- **Students began divided over the priority question, with Student 1 opposing the idea of always treating non-disabled patients first and Student 2 tentatively suggesting disabled persons could get priority yet still aiming to treat both.** Early confusion emerged when Student 2’s proposal to help both conflicted with the scenario’s one‐treatment limit, prompting Guide to press for clearer ethical criteria.  
- **Guide persistently challenged assumptions and contradictions, guiding the group from simplistic positions toward core ethical principles like justice, benefit, and dignity.** Its probing questions highlighted how outcome‐based justifications risk biasing against disabled patients and spurred students to articulate safeguards such as transparent, need‐based triage and providing advocates or communication aids.  
- **By the discussion’s end, both students embraced an individualized framework focused on medical urgency and potential benefit rather than disability status alone.** They acknowledged the challenge of balancing fairness and urgency in real healthcare settings and recommended clear inclusive policies to ensure equitable treatment allocation.  


&gt; **Student 2, you mentioned giving priority to disabled persons but ultimately treating both. This seems to contradict the scenario where we can only treat one person. Student 1, you initially disagreed with prioritizing non-disabled people, but now seem to agree with Student 2. Could you both clarify your positions on this difficult ethical dilemma? What criteria should determine who receives treatment when resources are limited?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==144d2402de::student-dwfilmvkdq==7c87150edd::4debf3e369::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==144d2402de::student-dwfilmvkdq==7c87150edd::4debf3e369::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==144d2402de::student-dwfilmvkdq==7c87150edd::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==144d2402de::student-dwfilmvkdq==7c87150edd::4debf3e369::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==988dab6ade::student-dwfilmvkdq==ed832820df::96694e6ccd::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Alcoholism and Liver Transplanation
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==988dab6ade::student-dwfilmvkdq==ed832820df::96694e6ccd::de0511837f">
<ul>
<li><strong>Students clashed over whether alcoholics should compete equally for liver transplants, with Student 1 defending first-come, first-served and Student 2 advocating for personal responsibility to factor into priority.</strong> Student 2 suggested enhancing the MELD scoring system to lower the priority of patients whose own behavior caused their liver failure, while Student 1 warned that causation-based criteria invite judgmental overreach and complex bureaucracy.  </li>
<li><strong>The discussion sharpened as Student 1 raised fears of sliding down a slippery slope once causation is introduced and questioned how any system could fairly assess individual life stories.</strong> Student 2 responded by narrowing the focus to measurable factors—citing a 20% relapse rate among alcohol-related transplant recipients—and insisted that wealth, social status, or broader personal history would remain irrelevant in their model.  </li>
<li><strong>Guide repeatedly pushed students to articulate both the ethical rationale and the practical mechanics of their proposals, probing the neutrality of medical systems and the legitimacy of personal responsibility as an allocation factor.</strong> These interventions drove the pair to confront mixed-causation cases, compare existing allocation criteria like urgency and compatibility, and clarify how their differing visions of fairness would operate in real-world transplant policy.  </li>
</ul>
<blockquote>
<p><strong>Student 1's response suggests their view isn't based on personal superiority but on a principle about responsibility. What makes first-come-first-served inherently more fair than systems that consider other factors? Many medical allocation systems already consider factors beyond waiting time (like compatibility and urgency) - is personal responsibility fundamentally different?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==988dab6ade::student-dwfilmvkdq==ed832820df::96694e6ccd::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==988dab6ade::student-dwfilmvkdq==ed832820df::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==988dab6ade::student-dwfilmvkdq==ed832820df::96694e6ccd::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==988dab6ade::student-dwfilmvkdq==ed832820df::96694e6ccd::de0511837f">- **Students clashed over whether alcoholics should compete equally for liver transplants, with Student 1 defending first-come, first-served and Student 2 advocating for personal responsibility to factor into priority.** Student 2 suggested enhancing the MELD scoring system to lower the priority of patients whose own behavior caused their liver failure, while Student 1 warned that causation-based criteria invite judgmental overreach and complex bureaucracy.  
- **The discussion sharpened as Student 1 raised fears of sliding down a slippery slope once causation is introduced and questioned how any system could fairly assess individual life stories.** Student 2 responded by narrowing the focus to measurable factors—citing a 20% relapse rate among alcohol-related transplant recipients—and insisted that wealth, social status, or broader personal history would remain irrelevant in their model.  
- **Guide repeatedly pushed students to articulate both the ethical rationale and the practical mechanics of their proposals, probing the neutrality of medical systems and the legitimacy of personal responsibility as an allocation factor.** These interventions drove the pair to confront mixed-causation cases, compare existing allocation criteria like urgency and compatibility, and clarify how their differing visions of fairness would operate in real-world transplant policy.  


&gt; **Student 1's response suggests their view isn't based on personal superiority but on a principle about responsibility. What makes first-come-first-served inherently more fair than systems that consider other factors? Many medical allocation systems already consider factors beyond waiting time (like compatibility and urgency) - is personal responsibility fundamentally different?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==988dab6ade::student-dwfilmvkdq==ed832820df::96694e6ccd::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==988dab6ade::student-dwfilmvkdq==ed832820df::96694e6ccd::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==988dab6ade::student-dwfilmvkdq==ed832820df::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==988dab6ade::student-dwfilmvkdq==ed832820df::96694e6ccd::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==23bacef2dd::4debf3e369::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Disability Discrimination
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==23bacef2dd::4debf3e369::de0511837f">
<ul>
<li><strong>Students grappled with whether to default scarce medical treatment to non-disabled patients or prioritize based on pain and life-quality impact.</strong> They moved from debating an even playing field and pain thresholds to a consensus that medical need and potential quality-of-life outcomes should guide who receives care, rather than disability status alone.  </li>
<li><strong>Guide consistently challenged their assumptions and pushed for concrete safeguards against bias.</strong> Through questions on systematic disadvantage and subjective value judgments, it prompted the students to propose written agreements, blind second opinions, and active patient involvement to ensure fair treatment.</li>
</ul>
<blockquote>
<p><strong>Student 2, you mentioned quality of life as a deciding factor. How would you respond to critics who might say this approach could systematically disadvantage people with disabilities?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==23bacef2dd::4debf3e369::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==23bacef2dd::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==23bacef2dd::4debf3e369::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==23bacef2dd::4debf3e369::de0511837f">- **Students grappled with whether to default scarce medical treatment to non-disabled patients or prioritize based on pain and life-quality impact.** They moved from debating an even playing field and pain thresholds to a consensus that medical need and potential quality-of-life outcomes should guide who receives care, rather than disability status alone.  
- **Guide consistently challenged their assumptions and pushed for concrete safeguards against bias.** Through questions on systematic disadvantage and subjective value judgments, it prompted the students to propose written agreements, blind second opinions, and active patient involvement to ensure fair treatment.


&gt; **Student 2, you mentioned quality of life as a deciding factor. How would you respond to critics who might say this approach could systematically disadvantage people with disabilities?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==23bacef2dd::4debf3e369::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==23bacef2dd::4debf3e369::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==23bacef2dd::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==1484d00edd::student-dwfilmvkdq==23bacef2dd::4debf3e369::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==3692c9d0df::student-dwfilmvkdq==a15461fcdf::94ade63a31::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Distribution
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==3692c9d0df::student-dwfilmvkdq==a15461fcdf::94ade63a31::de0511837f">
<ul>
<li><strong>Students grappled with whether the ability to pay should dictate healthcare access versus a universal right.</strong> Student 2 argued that necessary care must be guaranteed regardless of socioeconomic status, while Student 1 initially defended giving insured, middle-class patients priority due to resource constraints before acknowledging the moral weight of letting people die and systemic inequities.  </li>
<li><strong>Guide steered the conversation beyond simple pay-based allocation, pressing students to consider triage principles such as medical urgency, potential benefit, and age.</strong> Through targeted questions, Guide highlighted the unbearable tension between limited resources and basic human dignity, prompting both students to refine their views toward a needs-based framework in an ideal system.  </li>
</ul>
<blockquote>
<p><strong>Student 1, you've touched on a key moral dilemma - the tension between limited resources and letting people die seems unbearable. What principles beyond ability to pay might guide healthcare distribution when resources are scarce? Would factors like medical urgency, potential benefit, or age be more ethical considerations?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==3692c9d0df::student-dwfilmvkdq==a15461fcdf::94ade63a31::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==3692c9d0df::student-dwfilmvkdq==a15461fcdf::94ade63a31::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==3692c9d0df::student-dwfilmvkdq==a15461fcdf::94ade63a31::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==3692c9d0df::student-dwfilmvkdq==a15461fcdf::94ade63a31::de0511837f">- **Students grappled with whether the ability to pay should dictate healthcare access versus a universal right.** Student 2 argued that necessary care must be guaranteed regardless of socioeconomic status, while Student 1 initially defended giving insured, middle-class patients priority due to resource constraints before acknowledging the moral weight of letting people die and systemic inequities.  
- **Guide steered the conversation beyond simple pay-based allocation, pressing students to consider triage principles such as medical urgency, potential benefit, and age.** Through targeted questions, Guide highlighted the unbearable tension between limited resources and basic human dignity, prompting both students to refine their views toward a needs-based framework in an ideal system.  


&gt; **Student 1, you've touched on a key moral dilemma - the tension between limited resources and letting people die seems unbearable. What principles beyond ability to pay might guide healthcare distribution when resources are scarce? Would factors like medical urgency, potential benefit, or age be more ethical considerations?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==3692c9d0df::student-dwfilmvkdq==a15461fcdf::94ade63a31::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==3692c9d0df::student-dwfilmvkdq==a15461fcdf::94ade63a31::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==3692c9d0df::student-dwfilmvkdq==a15461fcdf::94ade63a31::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==3692c9d0df::student-dwfilmvkdq==a15461fcdf::94ade63a31::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==f340be7edd::4debf3e369::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Disability Discrimination
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==f340be7edd::4debf3e369::de0511837f">
<ul>
<li><strong>Students grappled with whether to prioritize able-bodied patients over disabled ones under scarce medical resources by debating the ethics and mechanics of the QALY system.</strong> Student 1 initially invoked QALYs as an objective triage tool but admitted it might devalue disabled lives, while Student 2 drew on her mother’s recovery to argue that the metric overlooks real potential and risks discrimination.  </li>
<li><strong>They explored alternative criteria like personal health baselines and health consciousness but worried about physicians’ biases and slippery slopes of judging patient value.</strong> Both agreed the current QALY approach is flawed and converged on ideas such as specialized QALY measures or enhanced clinician training to ensure each case is assessed equitably.  </li>
<li><strong>Guide persistently challenged their assumptions by probing definitions of objectivity, the danger of parallel systems, and core principles for allocating limited resources.</strong> It pressed Student 1 to specify triage criteria and asked Student 2 to consider how separate frameworks might inadvertently reinforce discrimination, while continually recentering the discussion on fairness under scarcity.  </li>
</ul>
<blockquote>
<p><strong>But doesn't creating separate systems risk reinforcing the very discrimination you're concerned about? The scarcity question is at the heart of this dilemma. When resources are truly limited and decisions must be made, what principle should guide those choices if not expected outcomes?</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==f340be7edd::4debf3e369::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==f340be7edd::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==f340be7edd::4debf3e369::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==f340be7edd::4debf3e369::de0511837f">- **Students grappled with whether to prioritize able-bodied patients over disabled ones under scarce medical resources by debating the ethics and mechanics of the QALY system.** Student 1 initially invoked QALYs as an objective triage tool but admitted it might devalue disabled lives, while Student 2 drew on her mother’s recovery to argue that the metric overlooks real potential and risks discrimination.  
- **They explored alternative criteria like personal health baselines and health consciousness but worried about physicians’ biases and slippery slopes of judging patient value.** Both agreed the current QALY approach is flawed and converged on ideas such as specialized QALY measures or enhanced clinician training to ensure each case is assessed equitably.  
- **Guide persistently challenged their assumptions by probing definitions of objectivity, the danger of parallel systems, and core principles for allocating limited resources.** It pressed Student 1 to specify triage criteria and asked Student 2 to consider how separate frameworks might inadvertently reinforce discrimination, while continually recentering the discussion on fairness under scarcity.  


&gt; **But doesn't creating separate systems risk reinforcing the very discrimination you're concerned about? The scarcity question is at the heart of this dilemma. When resources are truly limited and decisions must be made, what principle should guide those choices if not expected outcomes?**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==f340be7edd::4debf3e369::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==f340be7edd::4debf3e369::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==f340be7edd::4debf3e369::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==54f3bcccde::student-dwfilmvkdq==f340be7edd::4debf3e369::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
<div class="masonry-item">
<div class="card thread-card" id="thread-student-dwfilmvkdq==7208e4c4df::student-z21hawwuy29t344c4094df::96694e6ccd::de0511837f">
<div class="card-header d-flex justify-content-between align-items-center flex-nowrap">
<h6 class="mb-0 thread-heading" style="flex-shrink:1; min-width:0;">
                              
                                  Alcoholism and Liver Transplanation
                              
                          </h6>
</div>
<div class="card-body">
<div class="thread-summary markdown-content" id="summary-student-dwfilmvkdq==7208e4c4df::student-z21hawwuy29t344c4094df::96694e6ccd::de0511837f">
<ul>
<li><strong>Student 1 argued that limited liver supply demands prioritizing patients with the highest chance of long-term survival, effectively disadvantaging alcoholics.</strong> He underscored that alcoholism is voluntary, relapse risks jeopardize scarce resources, and transplants should go to those who “did nothing to harm their own liver.”  </li>
<li><strong>Student 2 countered that alcoholism often stems from complex life circumstances and called for sobriety and rehabilitation as gates to transplant eligibility.</strong> She warned against moral condemnation, proposing a multi-criteria system factoring in medical urgency, proven abstinence, and expected post-transplant outcomes.  </li>
<li><strong>Guide consistently probed underlying assumptions and steered students to clarify their ethical metrics and practical trade-offs.</strong> Its questions challenged students to articulate how personal responsibility, fairness, and scarcity intersect in transplant policy.</li>
</ul>
<blockquote>
<p><strong>Student 1 is framing this as a resource allocation issue rather than a moral judgment about who deserves to live. How would you propose balancing fairness to all patients with the practical reality of organ scarcity? This seems to be at the heart of your disagreement.</strong></p>
</blockquote>
</div>
<div class="status-message thread-status" id="status-student-dwfilmvkdq==7208e4c4df::student-z21hawwuy29t344c4094df::96694e6ccd::de0511837f" style="display: none;"></div>
<div class="spinner-border spinner-border-sm text-orange" id="spinner-student-dwfilmvkdq==7208e4c4df::student-z21hawwuy29t344c4094df::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Loading...</span>
</div>
<!-- Edit Summary Modal Content -->
<div class="summary-editor-container" id="summary-editor-container-student-dwfilmvkdq==7208e4c4df::student-z21hawwuy29t344c4094df::96694e6ccd::de0511837f" style="display: none;">
<div class="alert alert-info">
<i class="fas fa-info-circle mr-2"></i> Edit the summary in markdown format.
                              </div>
<textarea class="form-control summary-markdown-editor" id="summary-markdown-editor-student-dwfilmvkdq==7208e4c4df::student-z21hawwuy29t344c4094df::96694e6ccd::de0511837f">- **Student 1 argued that limited liver supply demands prioritizing patients with the highest chance of long-term survival, effectively disadvantaging alcoholics.** He underscored that alcoholism is voluntary, relapse risks jeopardize scarce resources, and transplants should go to those who “did nothing to harm their own liver.”  
- **Student 2 countered that alcoholism often stems from complex life circumstances and called for sobriety and rehabilitation as gates to transplant eligibility.** She warned against moral condemnation, proposing a multi-criteria system factoring in medical urgency, proven abstinence, and expected post-transplant outcomes.  
- **Guide consistently probed underlying assumptions and steered students to clarify their ethical metrics and practical trade-offs.** Its questions challenged students to articulate how personal responsibility, fairness, and scarcity intersect in transplant policy.

  

&gt; **Student 1 is framing this as a resource allocation issue rather than a moral judgment about who deserves to live. How would you propose balancing fairness to all patients with the practical reality of organ scarcity? This seems to be at the heart of your disagreement.**</textarea>
<div class="mt-3">
<button class="btn btn-primary save-summary-btn" data-session-id="student-dwfilmvkdq==7208e4c4df::student-z21hawwuy29t344c4094df::96694e6ccd::de0511837f">
<i class="fas fa-save mr-1"></i> Save Changes
                                  </button>
<button class="btn btn-secondary ml-2 cancel-summary-edit-btn" data-session-id="student-dwfilmvkdq==7208e4c4df::student-z21hawwuy29t344c4094df::96694e6ccd::de0511837f">
<i class="fas fa-times mr-1"></i> Cancel
                                  </button>
<div class="spinner-border text-primary ml-2 summary-editor-spinner" id="summary-editor-spinner-student-dwfilmvkdq==7208e4c4df::student-z21hawwuy29t344c4094df::96694e6ccd::de0511837f" role="status" style="display: none;">
<span class="sr-only">Saving...</span>
</div>
</div>
<div class="status-message summary-editor-status" id="summary-editor-status-student-dwfilmvkdq==7208e4c4df::student-z21hawwuy29t344c4094df::96694e6ccd::de0511837f" style="display: none;"></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div style="clear:both; height:20px;"></div>
<!-- Add Qualtrics Survey Data Card - if data exists -->
<div class="row mb-4">
<div class="col-12">
<div class="py-4 mb-4">
<h5 class="section-title">
<div class="title-text"><i class="fas fa-chart-bar mr-1"></i> Post-Chat Survey Data</div>
</h5>
<div class="card-body pt-0">
<div class="row">
<div class="col-md-4 d-flex flex-column align-items-center justify-content-center py-3">
<h3>28</h3>
<p class="text-muted">Total Survey Responses</p>
</div>
<div class="col-md-4 d-flex flex-column align-items-center justify-content-center py-3">
<h3>14</h3>
<p class="text-muted">Threads With Surveys</p>
</div>
<div class="col-md-4 d-flex flex-column align-items-center justify-content-center py-3">
<h3>93.3%</h3>
<p class="text-muted">Response Rate</p>
</div>
</div>
<div class="d-flex justify-content-between align-items-center text-muted small mb-0" style="gap: 1rem;">
<span class="ml-auto text-right" style="flex:1; text-align:right;">Last updated: 2025-05-06 22:34:13.249178</span>
</div>
</div>
</div>
</div>
</div>
<!-- Separate row for survey histogram charts floating on background -->
<div class="row mb-4">
<div class="col-12">
<!-- Overall Rating and Guide Feedback -->
<div class="row">
<div class="col-md-6 mb-4">
<div class="card h-100 thread-card">
<div class="card-body p-0">
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
<div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
<div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">How was your chat?</div>
</div>
<div style="padding:25px;">
<div style="position:relative; width:100%;">
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">🔥 Awesome</span>
<span style="font-size:0.9rem; color:#a9adc1;">11 (39.3%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:39.285714285714285%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">👍 Good</span>
<span style="font-size:0.9rem; color:#a9adc1;">14 (50.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:50.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">😐 It's OK</span>
<span style="font-size:0.9rem; color:#a9adc1;">3 (10.7%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:10.714285714285714%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">👎 Not a fan</span>
<span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">💩 Hated it</span>
<span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
</div>
<div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.71 <span style="opacity:0.7;">(95% confidence interval: 1.46–1.97)</span></div>
</div>
</div>
</div>
</div>
</div>
<div class="col-md-6 mb-4">
<div class="card h-100 thread-card">
<div class="card-body p-0">
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
<div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
<div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">Guide contributed the right amount</div>
</div>
<div style="padding:25px;">
<div style="position:relative; width:100%;">
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
<span style="font-size:0.9rem; color:#a9adc1;">25 (89.3%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:89.28571428571429%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
<span style="font-size:0.9rem; color:#a9adc1;">3 (10.7%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:10.714285714285714%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
<span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
</div>
<div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 0.89 <span style="opacity:0.7;">(95% confidence interval: 0.77–1.01)</span></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div style="height: 2rem;"></div>
<div class="row">
<div class="col-md-6 col-lg-4 mb-4">
<div class="card h-100 thread-card">
<div class="card-body p-0">
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
<div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
<div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">I felt comfortable sharing my honest opinions with my partner</div>
</div>
<div style="padding:25px;">
<div style="position:relative; width:100%;">
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
<span style="font-size:0.9rem; color:#a9adc1;">10 (66.7%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:66.66666666666666%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
<span style="font-size:0.9rem; color:#a9adc1;">5 (33.3%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:33.33333333333333%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
<span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
<span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
<span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
</div>
<div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.67 <span style="opacity:0.7;">(95% confidence interval: 1.40–1.94)</span></div>
</div>
</div>
</div>
</div>
</div>
<div class="col-md-6 col-lg-4 mb-4">
<div class="card h-100 thread-card">
<div class="card-body p-0">
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
<div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
<div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">I was not offended by my partner's perspective</div>
</div>
<div style="padding:25px;">
<div style="position:relative; width:100%;">
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
<span style="font-size:0.9rem; color:#a9adc1;">9 (52.9%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:52.94117647058824%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
<span style="font-size:0.9rem; color:#a9adc1;">5 (29.4%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:29.411764705882355%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
<span style="font-size:0.9rem; color:#a9adc1;">2 (11.8%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:11.76470588235294%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
<span style="font-size:0.9rem; color:#a9adc1;">1 (5.9%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:5.88235294117647%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
<span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
</div>
<div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.29 <span style="opacity:0.7;">(95% confidence interval: 0.82–1.77)</span></div>
</div>
</div>
</div>
</div>
</div>
<div class="col-md-6 col-lg-4 mb-4">
<div class="card h-100 thread-card">
<div class="card-body p-0">
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
<div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
<div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">It was valuable to chat with a student who did not share my perspective</div>
</div>
<div style="padding:25px;">
<div style="position:relative; width:100%;">
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
<span style="font-size:0.9rem; color:#a9adc1;">4 (23.5%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:23.52941176470588%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
<span style="font-size:0.9rem; color:#a9adc1;">9 (52.9%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:52.94117647058824%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
<span style="font-size:0.9rem; color:#a9adc1;">4 (23.5%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:23.52941176470588%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
<span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
<span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
</div>
<div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.00 <span style="opacity:0.7;">(95% confidence interval: 0.64–1.36)</span></div>
</div>
</div>
</div>
</div>
</div>
<div class="col-md-6 col-lg-4 mb-4">
<div class="card h-100 thread-card">
<div class="card-body p-0">
<div style="font-family:'Segoe UI',Roboto,Helvetica,Arial,sans-serif; background:#1e1e2d; color:#e4e6eb; border-radius:10px; overflow:hidden; padding:0; height:100%;">
<div style="background:#18182b; padding:20px 25px 10px 25px; border-bottom:1px solid #23233a;">
<div style="font-size:1.1rem; font-weight:500; line-height:1.3; height:2.6em; max-height:2.6em; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">It would be good if more students and classes used Sway</div>
</div>
<div style="padding:25px;">
<div style="position:relative; width:100%;">
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Strongly agree</span>
<span style="font-size:0.9rem; color:#a9adc1;">7 (43.8%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:43.75%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Agree</span>
<span style="font-size:0.9rem; color:#a9adc1;">5 (31.2%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:31.25%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Neutral</span>
<span style="font-size:0.9rem; color:#a9adc1;">3 (18.8%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:18.75%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Disagree</span>
<span style="font-size:0.9rem; color:#a9adc1;">0 (0.0%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:0.0%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
<div style="margin-bottom:12px;">
<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
<span style="font-size:0.9rem; color:#e4e6eb;">Strongly disagree</span>
<span style="font-size:0.9rem; color:#a9adc1;">1 (6.2%)</span>
</div>
<div style="height:20px; background:rgba(255,255,255,0.1); border-radius:4px; overflow:hidden;">
<div style="height:100%; width:6.25%; background-color:#8a8aff; border-radius:4px;"></div>
</div>
</div>
</div>
<div style="text-align:center; color:#b0b3c7; font-size:13px; margin-top:10px; letter-spacing:0.01em;">mean = 1.06 <span style="opacity:0.7;">(95% confidence interval: 0.46–1.66)</span></div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Opinion Changes Section -->
</div>
</div>
<!-- End Qualtrics Survey Data Section -->
<!-- Modal containers will be dynamically injected here by JS if needed -->
<div id="modal-container"></div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- =====================
     Core Utilities
     ===================== -->
<script>
  // Debug logging utility
  function debug_log(message, level, details = null) {
    if (details) {
      console.log(`DEBUG[${level}]:`, message, details);
    } else {
      console.log(`DEBUG[${level}]:`, message);
    }
  }

  // Convert UTC timestamps to local timezone
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('[data-utc-time]').forEach(function(element) {
      const utcTime = element.getAttribute('data-utc-time');
      try {
        const localDate = new Date(utcTime);
        if (!isNaN(localDate)) {
          const options = {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
          };
          const localTimeStr = localDate.toLocaleString(undefined, options);
          const localTimeElement = element.nextElementSibling;
          if (localTimeElement && localTimeElement.classList.contains('local-time')) {
            localTimeElement.textContent = localTimeStr;
            element.style.display = 'none';
            localTimeElement.style.display = 'inline';
          }
        }
      } catch (e) {
        console.error('Error converting time:', e);
      }
    });
  });
</script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- =====================
     Theme Toggle
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.getElementById('theme-toggle-input'); // Fixed id to match the input in _header.html
    if (!themeToggle) return;
    // Determine initial theme from localStorage or template variable
    let initialTheme = localStorage.getItem('theme');
    if (!initialTheme) {
      initialTheme = 'dark-mode' === 'light-mode' ? 'light' : 'dark';
    }
    // Set initial toggle state and class
    themeToggle.checked = initialTheme === 'light';
    document.documentElement.className = initialTheme === 'light' ? 'light-mode' : 'dark-mode';
    // Add event listener for theme toggle
    themeToggle.addEventListener('change', function() {
      if (this.checked) {
        document.documentElement.classList.remove('dark-mode');
        document.documentElement.classList.add('light-mode');
        localStorage.setItem('theme', 'light');
      } else {
        document.documentElement.classList.remove('light-mode');
        document.documentElement.classList.add('dark-mode');
        localStorage.setItem('theme', 'dark');
      }
    });
  });
</script>
<!-- =====================
     Summary/Report Generation & Polling
     ===================== -->
<script>
  let pollingInterval = null;
  let cancelRequested = false;
  document.addEventListener('DOMContentLoaded', function() {
    const generateBtn = document.getElementById('generate-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const reportBtn = document.getElementById('report-btn');
    let hasSavedSummaries = "true" === "true";
    
    // Check directly if there are any thread summaries actually present on the page
    const allThreadSummaries = document.querySelectorAll('.thread-summary.markdown-content');
    const hasVisibleSummaries = Array.from(allThreadSummaries).some(el => 
      el.innerHTML.trim() !== '' && el.style.display !== 'none'
    );
    
    // If we have visible summaries on the page, allow generating the report regardless of server-side flag
    if (hasVisibleSummaries) {
      hasSavedSummaries = true;
      debug_log("Enabling report button because visible summaries were found on page", 1);
    }
    
    if (reportBtn && hasSavedSummaries) {
      reportBtn.disabled = false;
      debug_log("Enabling report button because saved summaries exist", 1);
    }
    // Check if any thread is currently in 'generating' status
    const hasGeneratingThreads = Array.from(document.querySelectorAll('.thread-status'))
      .some(el => el.textContent === 'Generating summary...');
    if (hasGeneratingThreads) {
      startPolling();
      if (generateBtn) generateBtn.style.display = 'none';
      if (cancelBtn) cancelBtn.style.display = 'inline-block';
    }
    // Generate summaries
    if (generateBtn) {
      generateBtn.addEventListener('click', function() {
        document.querySelectorAll('.thread-status').forEach(status => {
          status.textContent = 'Queued for generation...';
          status.style.display = 'block';
          status.className = 'thread-status text-info';
        });
        generateBtn.style.display = 'none';
        if (cancelBtn) cancelBtn.style.display = 'inline-block';
        fetch('/assignment/de0511837f/generate_summaries', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        })
        .then(response => {
          if (response.ok) {
            debug_log("Summaries queued successfully", 1);
            startPolling();
            if (reportBtn) reportBtn.disabled = false;
          } else {
            debug_log("Error queueing summaries", 1);
          }
        })
        .catch(error => debug_log("Network error:", error, 1));
      });
      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          cancelRequested = true;
          fetch('/assignment/de0511837f/cancel_generation', { method: 'POST' })
            .then(response => {
              if (response.ok) {
                stopPolling();
                document.querySelectorAll('.thread-status').forEach(status => {
                  if (status.textContent === 'Queued for generation...') status.style.display = 'none';
                });
                document.querySelectorAll('.spinner-border').forEach(spinner => spinner.style.display = 'none');
                generateBtn.style.display = 'inline-block';
                cancelBtn.style.display = 'none';
              }
            });
        });
      }
    }
    // Report button
    if (reportBtn) {
      // Show/hide advanced thinking controls based on model selection
      const modelToggleGroup = document.getElementById('report-model-toggle-group');
      const advancedThinkingControls = document.getElementById('advanced-thinking-controls');
      function updateThinkingControlsVisibility() {
        const checked = modelToggleGroup.querySelector('input[type=radio]:checked');
        if (checked && checked.value === 'anthropic') {
          advancedThinkingControls.style.display = 'flex';
        } else {
          advancedThinkingControls.style.display = 'none';
        }
      }
      if (modelToggleGroup && advancedThinkingControls) {
        modelToggleGroup.addEventListener('change', updateThinkingControlsVisibility);
        updateThinkingControlsVisibility();
      }
      reportBtn.addEventListener('click', function() {
        const reportSpinner = document.getElementById('report-spinner');
        if (reportSpinner) reportSpinner.style.display = 'inline-block';
        reportBtn.disabled = true;
        const noReportMsg = document.getElementById('no-report-msg');
        if (noReportMsg) {
          noReportMsg.textContent = 'Generating instructor report...';
          noReportMsg.className = 'text-info mb-0';
        }
        // Collect all visible summaries from the UI
        const summaries = {};
        document.querySelectorAll('.thread-card').forEach(card => {
          const threadId = card.id.replace('thread-', '');
          const summaryEl = card.querySelector('.thread-summary');
          if (summaryEl && summaryEl.innerHTML.trim() !== '' && summaryEl.style.display !== 'none') {
            // Try to get the raw markdown if available
            let summaryContent = '';
            const editorEl = card.querySelector('.summary-markdown-editor');
            if (editorEl && editorEl.value.trim() !== '') {
              summaryContent = editorEl.value.trim();
            } else {
              // Otherwise use the HTML content
              summaryContent = summaryEl.innerHTML;
            }
            summaries[threadId] = {
              thread_id: threadId,
              assignment_id: 'de0511837f',
              summary: summaryContent,
              content: summaryContent,
              status: 'completed'
            };
          }
        });
        debug_log(`Collected ${Object.keys(summaries).length} visible summaries from UI`, 1);
        // Get selected model provider
        let modelProvider = 'openai';
        const checked = document.querySelector('#report-model-toggle-group input[type=radio]:checked');
        if (checked) modelProvider = checked.value;
        // Get advanced thinking mode and budget if Anthropic
        let enableThinking = false;
        let thinkingBudgetTokens = 4096;
        if (modelProvider === 'anthropic') {
          const enableThinkingCheckbox = document.getElementById('enable-thinking-checkbox');
          const thinkingBudgetInput = document.getElementById('thinking-budget-input');
          if (enableThinkingCheckbox && enableThinkingCheckbox.checked) {
            enableThinking = true;
          }
          if (thinkingBudgetInput && thinkingBudgetInput.value) {
            thinkingBudgetTokens = parseInt(thinkingBudgetInput.value) || 4096;
          }
        }
        fetch('/assignment/de0511837f/generate_report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            summaries: summaries,
            model_provider: modelProvider,
            enable_thinking: enableThinking,
            thinking_budget_tokens: thinkingBudgetTokens
          })
        })
        .then(response => response.json())
        .then(data => {
          debug_log("Report generation initiated:", data, 1);
          checkReportStatus();
        })
        .catch(error => {
          debug_log("Error generating report:", error, 1);
          reportBtn.disabled = false;
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (noReportMsg) {
            noReportMsg.textContent = 'Error generating report. Please try again.';
            noReportMsg.className = 'text-danger mb-0';
          }
        });
      });
    }
    // Refresh data
    const refreshDataBtn = document.getElementById('refresh-data-btn');
    if (refreshDataBtn) {
      refreshDataBtn.addEventListener('click', function() {
        const refreshSpinner = document.getElementById('refresh-spinner');
        if (refreshSpinner) refreshSpinner.style.display = 'inline-block';
        refreshDataBtn.disabled = true;
        fetch('/assignment/de0511837f/refresh_data', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
          debug_log("Data refresh initiated:", data, 1);
          window.location.reload();
        })
        .catch(error => {
          debug_log("Error refreshing data:", error, 1);
          if (refreshSpinner) refreshSpinner.style.display = 'none';
          refreshDataBtn.disabled = false;
          alert('Error refreshing data. Please try again.');
        });
      });
    }
    // Regenerate title
    const regenerateTitleBtn = document.getElementById('regenerate-title-btn');
    if (regenerateTitleBtn) {
      regenerateTitleBtn.addEventListener('click', function() {
        regenerateTitleBtn.disabled = true;
        const icon = regenerateTitleBtn.querySelector('i');
        const originalIcon = icon.className;
        icon.className = 'fas fa-spinner fa-spin';
        fetch('/assignment/de0511837f/regenerate_title', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const titleEl = document.querySelector('.generated-title');
            if (titleEl) titleEl.textContent = data.title;
            console.log("Title regenerated:", data.title);
          } else {
            console.error("Error regenerating title:", data.message);
            alert("Error regenerating title: " + data.message);
          }
          regenerateTitleBtn.disabled = false;
          icon.className = originalIcon;
        })
        .catch(error => {
          console.error("Error:", error);
          alert("Error regenerating title. Please try again.");
          regenerateTitleBtn.disabled = false;
          icon.className = originalIcon;
        });
      });
    }
    
    // Final check to ensure report button is enabled if summaries exist
    setTimeout(function() {
      const reportBtn = document.getElementById('report-btn');
      if (reportBtn && reportBtn.disabled) {
        const visibleSummaries = document.querySelectorAll('.thread-summary.markdown-content');
        const hasContent = Array.from(visibleSummaries).some(el => 
          el.innerHTML.trim() !== '' && el.style.display !== 'none'
        );
        
        if (hasContent) {
          reportBtn.disabled = false;
          debug_log("Enabling report button in final check - summaries exist", 1);
        }
      }
    }, 500); // Short delay to ensure all content is processed
  });
  function startPolling() {
    if (pollingInterval) clearInterval(pollingInterval);
    pollingInterval = setInterval(checkSummaryStatus, 2000);
    checkSummaryStatus();
  }
  function stopPolling() {
    if (pollingInterval) {
      clearInterval(pollingInterval);
      pollingInterval = null;
    }
  }
  function checkSummaryStatus() {
    fetch('/assignment/de0511837f/summary_status')
      .then(response => response.json())
      .then(data => {
        let activeGeneration = false;
        Object.entries(data).forEach(([sessionId, threadInfo]) => {
          const statusEl = document.getElementById(`status-${sessionId}`);
          const summaryEl = document.getElementById(`summary-${sessionId}`);
          const spinnerEl = document.getElementById(`spinner-${sessionId}`);
          if (threadInfo.status === 'generating') {
            activeGeneration = true;
            if (statusEl) {
              statusEl.textContent = 'Generating summary...';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-warning';
            }
            if (spinnerEl) spinnerEl.style.display = 'inline-block';
          } else if (threadInfo.status === 'completed') {
            if (statusEl) statusEl.style.display = 'none';
            if (spinnerEl) spinnerEl.style.display = 'none';
            if (summaryEl && threadInfo.render_html) {
              summaryEl.innerHTML = threadInfo.render_html;
              summaryEl.style.display = 'block';
              // Update the markdown textarea value for this thread
              var textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
              if (textarea) {
                // If threadInfo has markdown, use it; otherwise, fallback to extracting from HTML
                if (threadInfo.markdown) {
                  textarea.value = threadInfo.markdown;
                } else if (threadInfo.render_html) {
                  // Optionally, convert HTML back to markdown if needed (or leave blank)
                  textarea.value = '';
                }
                // If CodeMirror is open for this thread, update its value too
                if (window.summaryEditors && window.summaryEditors[sessionId]) {
                  window.summaryEditors[sessionId].setValue(textarea.value);
                  window.summaryEditors[sessionId].refresh();
                }
              }
              // If a summary was successfully displayed, enable the report button
              const reportBtn = document.getElementById('report-btn');
              if (reportBtn) {
                reportBtn.disabled = false;
                debug_log("Enabling report button because a summary was loaded", 1);
              }
            }
          } else if (threadInfo.status === 'queued') {
            activeGeneration = true;
            if (statusEl) {
              statusEl.textContent = 'Queued for generation...';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-info';
            }
            if (spinnerEl) spinnerEl.style.display = 'none';
          } else if (threadInfo.status === 'error') {
            if (statusEl) {
              statusEl.textContent = 'Error generating summary';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-danger';
            }
            if (spinnerEl) spinnerEl.style.display = 'none';
          } else if (threadInfo.status === 'skipped') {
            if (statusEl) {
              statusEl.textContent = threadInfo.message || 'Skipped due to insufficient messages';
              statusEl.style.display = 'block';
              statusEl.className = 'thread-status text-warning';
            }
            if (spinnerEl) spinnerEl.style.display = 'none';
          }
        });
        if (!activeGeneration) {
          stopPolling();
          const generateBtn = document.getElementById('generate-btn');
          const cancelBtn = document.getElementById('cancel-btn');
          if (generateBtn) generateBtn.style.display = 'inline-block';
          if (cancelBtn) cancelBtn.style.display = 'none';
          const reportBtn = document.getElementById('report-btn');
          if (reportBtn) reportBtn.disabled = false;
        }
      })
      .catch(error => debug_log('Error checking summary status:', error, 1));
  }
  function checkReportStatus() {
    fetch('/assignment/de0511837f/report_status')
      .then(response => response.json())
      .then(data => {
        const reportBtn = document.getElementById('report-btn');
        const reportSpinner = document.getElementById('report-spinner');
        const noReportMsg = document.getElementById('no-report-msg');
        const reportSection = document.getElementById('report-section');
        
        debug_log("Report status update:", data, 1);
        
        if (data.status === 'completed') {
          // Report generation completed
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (reportBtn) {
            reportBtn.disabled = false;
            reportBtn.textContent = 'Regenerate report';
          }
          
          // Only update the UI if we have content
          if (data.content && reportSection) {
            const reportContent = document.createElement('div');
            reportContent.id = 'report-content';
            reportContent.className = 'markdown-content';
            const styleTag = document.createElement('style');
            styleTag.textContent = `#report-content ul ul {margin-top:0.5em;margin-bottom:0.5em;padding-left:2em;}#report-content li > ul {margin-left:1em;}`;
            reportContent.appendChild(styleTag);
            
            // Check if render_html is available first, otherwise use content
            if (data.render_html) {
              reportContent.innerHTML += data.render_html;
            } else {
              reportContent.innerHTML += data.content;
            }
            
            const generatedText = document.createElement('div');
            generatedText.className = 'text-muted mt-2 d-flex justify-content-end align-items-center';
            
            // Create formatted date display
            const formattedDate = new Date(data.generated_at).toLocaleDateString('en-US', {
              month: 'short', 
              day: 'numeric', 
              year: 'numeric',
              hour: 'numeric',
              minute: '2-digit',
              hour12: true
            });
            
            generatedText.innerHTML = `
              <span class="text-right" style="flex:1; text-align:right;">Generated on: ${formattedDate}</span>
              ${!exportMode ? `
                <button type="button" class="btn btn-link btn-sm text-muted p-0 ml-2" id="edit-report-btn" title="Edit report" style="vertical-align: baseline;">
                  <i class="fas fa-pencil-alt"></i>
                </button>
              ` : ''}
            `;
            
            // Clear existing content and append new content
            reportSection.innerHTML = '';
            reportSection.appendChild(reportContent);
            reportSection.appendChild(generatedText);
            
            // Convert UTC timestamps to local
            const utcTimeElements = reportSection.querySelectorAll('[data-utc-time]');
            utcTimeElements.forEach(function(element) {
              const utcTime = element.getAttribute('data-utc-time');
              try {
                const localDate = new Date(utcTime);
                if (!isNaN(localDate)) {
                  const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true };
                  const localTimeStr = localDate.toLocaleString(undefined, options);
                  const localTimeElement = element.nextElementSibling;
                  if (localTimeElement && localTimeElement.classList.contains('local-time')) {
                    localTimeElement.textContent = localTimeStr;
                    element.style.display = 'none';
                    localTimeElement.style.display = 'inline';
                  }
                }
              } catch (e) { console.error('Error converting time:', e); }
            });
            
            debug_log("Updated report UI with new content", 1);
          } else {
            debug_log("Report completed but no content received", 2);
          }
        } else if (data.status === 'generating' || data.status === 'running') {
          // Report is still being generated
          if (noReportMsg) {
            noReportMsg.textContent = 'Generating instructor report...';
            noReportMsg.className = 'text-info mb-0';
          }
          
          // Show elapsed time if available
          if (data.elapsed_seconds) {
            const elapsed = Math.round(data.elapsed_seconds);
            if (noReportMsg) {
              noReportMsg.textContent = `Generating instructor report... (${elapsed}s)`;
            }
          }
          
          // Continue polling
          setTimeout(checkReportStatus, 2000);
        } else if (data.status === 'error') {
          // Error generating report
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (reportBtn) reportBtn.disabled = false;
          if (noReportMsg) {
            noReportMsg.textContent = `Error generating report: ${data.error || 'Unknown error'}`;
            noReportMsg.className = 'text-danger mb-0';
          }
        } else {
          // Unknown or not_started status
          if (reportSpinner) reportSpinner.style.display = 'none';
          if (reportBtn) reportBtn.disabled = false;
          if (data.report_exists && reportSection) {
            // If report exists but no status, try refreshing the page after a timeout
            debug_log("Report exists but status not provided - will try to reload content", 2);
            setTimeout(checkReportStatus, 2000);
          }
        }
      })
      .catch(error => {
        debug_log("Error checking report status:", error, 2);
        const reportSpinner = document.getElementById('report-spinner');
        const reportBtn = document.getElementById('report-btn');
        const noReportMsg = document.getElementById('no-report-msg');
        if (reportSpinner) reportSpinner.style.display = 'none';
        if (reportBtn) reportBtn.disabled = false;
        if (noReportMsg) {
          noReportMsg.textContent = 'Error checking report status. Please try again.';
          noReportMsg.className = 'text-danger mb-0';
        }
      });
  }
</script>
<!-- =====================
     CodeMirror for Editing
     ===================== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/markdown/markdown.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/material-darker.min.css" rel="stylesheet"/>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Report editing
    const editReportBtn = document.getElementById('edit-report-btn');
    const reportContent = document.getElementById('report-content');
    const reportEditorContainer = document.getElementById('report-editor-container');
    const saveReportBtn = document.getElementById('save-report-btn');
    const cancelReportEditBtn = document.getElementById('cancel-report-edit-btn');
    const editorSpinner = document.getElementById('editor-spinner');
    const statusMessage = document.getElementById('editor-status-message');
    let reportEditor;
    const reportMarkdownEditor = document.getElementById('report-markdown-editor');
    if (reportMarkdownEditor) {
      reportEditor = CodeMirror.fromTextArea(reportMarkdownEditor, {
        lineNumbers: true,
        theme: 'material-darker',
        mode: 'markdown',
        lineWrapping: true
      });
    }
    if (editReportBtn) {
      editReportBtn.addEventListener('click', function() {
        reportContent.style.display = 'none';
        reportEditorContainer.style.display = 'block';
        if (reportEditor) reportEditor.refresh();
      });
    }
    if (cancelReportEditBtn) {
      cancelReportEditBtn.addEventListener('click', function() {
        reportContent.style.display = 'block';
        reportEditorContainer.style.display = 'none';
        statusMessage.style.display = 'none';
      });
    }
    if (saveReportBtn) {
      saveReportBtn.addEventListener('click', function() {
        const markdown = reportEditor.getValue();
        if (!markdown.trim()) {
          showEditorStatus('Report content cannot be empty', 'error');
          return;
        }
        editorSpinner.style.display = 'inline-block';
        fetch('/assignment/de0511837f/edit_report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ markdown: markdown })
        })
        .then(response => response.json())
        .then(data => {
          editorSpinner.style.display = 'none';
          if (data.success) {
            reportContent.innerHTML = data.content;
            showEditorStatus(data.message, 'success');
            setTimeout(() => {
              reportContent.style.display = 'block';
              reportEditorContainer.style.display = 'none';
              statusMessage.style.display = 'none';
            }, 1500);
          } else {
            showEditorStatus(data.message, 'error');
          }
        })
        .catch(error => {
          editorSpinner.style.display = 'none';
          showEditorStatus('Error saving report: ' + error, 'error');
        });
      });
    }
    function showEditorStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = `status-message ${type}`;
      statusMessage.style.display = 'block';
      if (type === 'success') {
        setTimeout(() => { statusMessage.style.display = 'none'; }, 3000);
      }
    }
  });
</script>
<!-- =====================
     Summary Editing (CodeMirror)
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const editSummaryBtns = document.querySelectorAll('.edit-summary-btn');
    const regenerateSummaryBtns = document.querySelectorAll('.regenerate-summary-btn');
    const summaryEditors = {};
    editSummaryBtns.forEach(btn => {
      const sessionId = btn.getAttribute('data-session-id');
      const summaryElement = document.getElementById(`summary-${sessionId}`);
      const editorContainer = document.getElementById(`summary-editor-container-${sessionId}`);
      btn.addEventListener('click', function() {
        summaryElement.style.display = 'none';
        editorContainer.style.display = 'block';
        if (!summaryEditors[sessionId]) {
          const textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
          let markdownContent = textarea.value;
          if (!markdownContent) {
            markdownContent = summaryElement.innerHTML.replace(/<button.*?<\/button>/g, '');
          }
          summaryEditors[sessionId] = CodeMirror.fromTextArea(textarea, {
            lineNumbers: true,
            theme: 'material-darker',
            mode: 'markdown',
            lineWrapping: true
          });
          summaryEditors[sessionId].setValue(markdownContent);
          summaryEditors[sessionId].refresh();
        } else {
          summaryEditors[sessionId].refresh();
        }
      });
      const cancelBtn = document.querySelector(`.cancel-summary-edit-btn[data-session-id="${sessionId}"]`);
      if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
          summaryElement.style.display = 'block';
          editorContainer.style.display = 'none';
          document.getElementById(`summary-editor-status-${sessionId}`).style.display = 'none';
        });
      }
      const saveBtn = document.querySelector(`.save-summary-btn[data-session-id="${sessionId}"]`);
      if (saveBtn) {
        saveBtn.addEventListener('click', function() {
          const markdown = summaryEditors[sessionId].getValue();
          if (!markdown.trim()) {
            showSummaryStatus(sessionId, 'Summary content cannot be empty', 'error');
            return;
          }
          const spinner = document.getElementById(`summary-editor-spinner-${sessionId}`);
          spinner.style.display = 'inline-block';
          fetch('/assignment/de0511837f/edit_summary', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ session_id: sessionId, markdown: markdown })
          })
          .then(response => response.json())
          .then(data => {
            spinner.style.display = 'none';
            if (data.success) {
              summaryElement.innerHTML = data.render_html || data.content;
              summaryElement.style.display = 'block';
              // Update the markdown textarea value
              var textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
              if (textarea) {
                textarea.value = markdown;
                if (window.summaryEditors && window.summaryEditors[sessionId]) {
                  window.summaryEditors[sessionId].setValue(markdown);
                  window.summaryEditors[sessionId].refresh();
                }
              }
              showSummaryStatus(sessionId, data.message, 'success');
              setTimeout(() => {
                editorContainer.style.display = 'none';
                document.getElementById(`summary-editor-status-${sessionId}`).style.display = 'none';
                attachButtonListeners(sessionId);
              }, 1500);
            } else {
              showSummaryStatus(sessionId, data.message || 'Error saving summary', 'error');
            }
          })
          .catch(error => {
            spinner.style.display = 'none';
            showSummaryStatus(sessionId, 'Error saving summary: ' + error, 'error');
          });
        });
      }
    });
    regenerateSummaryBtns.forEach(btn => {
      const sessionId = btn.getAttribute('data-session-id');
      const summaryElement = document.getElementById(`summary-${sessionId}`);
      btn.addEventListener('click', function() {
        // Removed confirmation dialog for immediate regeneration
        const statusElement = document.getElementById(`status-${sessionId}`);
        const spinnerElement = document.getElementById(`spinner-${sessionId}`);
        if (statusElement && spinnerElement) {
          statusElement.textContent = 'Regenerating summary...';
          statusElement.className = 'status-message thread-status text-info';
          statusElement.style.display = 'block';
          spinnerElement.style.display = 'inline-block';
          summaryElement.style.opacity = '0.5';
          fetch('/assignment/de0511837f/regenerate_summary', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ session_id: sessionId })
          })
          .then(response => response.json())
          .then(data => {
            spinnerElement.style.display = 'none';
            if (data.success) {
              summaryElement.innerHTML = data.content;
              summaryElement.style.opacity = '1';
              statusElement.textContent = data.message;
              statusElement.className = 'status-message thread-status success';
              attachButtonListeners(sessionId);
              setTimeout(() => { statusElement.style.display = 'none'; }, 3000);
            } else {
              summaryElement.style.opacity = '1';
              statusElement.textContent = data.message || 'Error regenerating summary';
              statusElement.className = 'status-message thread-status error';
              setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
            }
          })
          .catch(error => {
            spinnerElement.style.display = 'none';
            summaryElement.style.opacity = '1';
            statusElement.textContent = 'Error regenerating summary: ' + error;
            statusElement.className = 'status-message thread-status error';
            setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
          });
        }
      });
    });
    function attachButtonListeners(sessionId) {
      const newEditBtn = document.querySelector(`.edit-summary-btn[data-session-id="${sessionId}"]`);
      const newRegenerateBtn = document.querySelector(`.regenerate-summary-btn[data-session-id="${sessionId}"]`);
      if (newEditBtn) {
        const summaryElement = document.getElementById(`summary-${sessionId}`);
        const editorContainer = document.getElementById(`summary-editor-container-${sessionId}`);
        newEditBtn.addEventListener('click', function() {
          summaryElement.style.display = 'none';
          editorContainer.style.display = 'block';
          if (!summaryEditors[sessionId]) {
            const textarea = document.getElementById(`summary-markdown-editor-${sessionId}`);
            let markdownContent = textarea.value;
            if (!markdownContent) {
              markdownContent = summaryElement.innerHTML.replace(/<button.*?<\/button>/g, '');
            }
            summaryEditors[sessionId] = CodeMirror.fromTextArea(textarea, {
              lineNumbers: true,
              theme: 'material-darker',
              mode: 'markdown',
              lineWrapping: true
            });
            summaryEditors[sessionId].setValue(markdownContent);
            summaryEditors[sessionId].refresh();
          } else {
            summaryEditors[sessionId].refresh();
          }
        });
      }
      if (newRegenerateBtn) {
        newRegenerateBtn.addEventListener('click', function() {
          // Removed confirmation dialog for immediate regeneration
          const summaryElement = document.getElementById(`summary-${sessionId}`);
          const statusElement = document.getElementById(`status-${sessionId}`);
          const spinnerElement = document.getElementById(`spinner-${sessionId}`);
          if (statusElement && spinnerElement) {
            statusElement.textContent = 'Regenerating summary...';
            statusElement.className = 'status-message thread-status text-info';
            statusElement.style.display = 'block';
            spinnerElement.style.display = 'inline-block';
            summaryElement.style.opacity = '0.5';
            fetch('/assignment/de0511837f/regenerate_summary', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ session_id: sessionId })
            })
            .then(response => response.json())
            .then(data => {
              spinnerElement.style.display = 'none';
              if (data.success) {
                summaryElement.innerHTML = data.content;
                summaryElement.style.opacity = '1';
                statusElement.textContent = data.message;
                statusElement.className = 'status-message thread-status success';
                attachButtonListeners(sessionId);
                setTimeout(() => { statusElement.style.display = 'none'; }, 3000);
              } else {
                summaryElement.style.opacity = '1';
                statusElement.textContent = data.message || 'Error regenerating summary';
                statusElement.className = 'status-message thread-status error';
                setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
              }
            })
            .catch(error => {
              spinnerElement.style.display = 'none';
              summaryElement.style.opacity = '1';
              statusElement.textContent = 'Error regenerating summary: ' + error;
              statusElement.className = 'status-message thread-status error';
              setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
            });
          }
        });
      }
    }
    function showSummaryStatus(sessionId, message, type) {
      const statusEl = document.getElementById(`summary-editor-status-${sessionId}`);
      statusEl.textContent = message;
      statusEl.className = `status-message ${type}`;
      statusEl.style.display = 'block';
      if (type === 'success') {
        setTimeout(() => { statusEl.style.display = 'none'; }, 3000);
      }
    }
  });
</script>
<!-- =====================
     Export/Share Functionality
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Export button
    const exportBtn = document.querySelector('a[href*="/export"]');
    if (exportBtn) {
      exportBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const currentTheme = localStorage.getItem('theme') === 'light' ? 'light-mode' : 'dark-mode';
        const exportUrl = new URL(this.href, window.location.origin);
        
        // Add selected histogram fields to export URL
        const selectedHistograms = getSelectedHistograms();
        if (selectedHistograms.length > 0) {
          exportUrl.searchParams.set('histograms', selectedHistograms.join(','));
        }
        
        exportUrl.searchParams.set('theme', currentTheme);
        window.location.href = exportUrl.toString();
      });
    }
    // Set theme class on HTML element for export mode
    if ('True' === 'True' && 'dark-mode') {
      document.documentElement.className = 'dark-mode';
    }
    // Share export button
    const shareExportBtn = document.getElementById('share-export-btn');
    if (shareExportBtn) {
      shareExportBtn.addEventListener('click', function(e) {
        e.preventDefault();
        shareExportBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
        shareExportBtn.disabled = true;
        const currentTheme = localStorage.getItem('theme') === 'light' ? 'light-mode' : 'dark-mode';
        
        // Add selected histogram fields to share request
        const selectedHistograms = getSelectedHistograms();
        
        fetch('/assignment/de0511837f/share_export', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            theme: currentTheme,
            selected_histograms: selectedHistograms
          })
        })
        .then(response => response.json())
        .then(data => {
          shareExportBtn.innerHTML = '<i class="fas fa-share-alt"></i> Share';
          shareExportBtn.disabled = false;
          if (data.success) {
            const modalHtml = `
              <div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content" style="background-color: var(--card-bg); color: var(--text-color);">
                    <div class="modal-header" style="border-color: var(--border-color);">
                      <h5 class="modal-title" id="shareModalLabel">Share Export</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: var(--text-color);">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <p>Your export has been saved. Share this link:</p>
                      <div class="input-group mb-3">
                        <input type="text" id="share-link" class="form-control" value="${data.share_url}" readonly style="background-color: var(--input-bg); color: var(--text-color); border-color: var(--border-color);">
                        <div class="input-group-append">
                          <button class="btn btn-primary" type="button" id="copy-link-btn">
                            <i class="fas fa-copy"></i> Copy
                          </button>
                        </div>
                      </div>
                      <div id="copy-feedback" class="text-success" style="display: none;">Link copied to clipboard!</div>
                    </div>
                    <div class="modal-footer" style="border-color: var(--border-color);">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <a href="${data.share_url}" target="_blank" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> Open
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            `;
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);
            $('#shareModal').modal('show');
            document.getElementById('copy-link-btn').addEventListener('click', function() {
              const shareLink = document.getElementById('share-link');
              shareLink.select();
              document.execCommand('copy');
              const copyFeedback = document.getElementById('copy-feedback');
              copyFeedback.style.display = 'block';
              setTimeout(() => { copyFeedback.style.display = 'none'; }, 3000);
            });
            $('#shareModal').on('hidden.bs.modal', function() {
              modalContainer.remove();
            });
          } else {
            alert('Error: ' + (data.message || 'Could not generate shared export'));
          }
        })
        .catch(error => {
          shareExportBtn.innerHTML = '<i class="fas fa-share-alt"></i> Share';
          shareExportBtn.disabled = false;
          alert('Error: Could not generate shared export');
          console.error('Error:', error);
        });
      });
    }
    
    // Helper function to get selected histograms
    function getSelectedHistograms() {
      const checkboxes = document.querySelectorAll('.export-histogram-checkbox:checked');
      return Array.from(checkboxes).map(cb => cb.getAttribute('data-field')).filter(Boolean);
    }
  });
</script>
<!-- =====================
     Histogram Selection for Export
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Handle the select/deselect all buttons
    const selectAllBtn = document.getElementById('select-all-histograms');
    const deselectAllBtn = document.getElementById('deselect-all-histograms');
    
    if (selectAllBtn) {
      selectAllBtn.addEventListener('click', function() {
        document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
          checkbox.checked = true;
          // Add a small animation to show the change
          const label = checkbox.nextElementSibling;
          if (label) {
            label.style.transition = 'color 0.3s ease';
            label.style.color = '#8a8aff';
            setTimeout(() => {
              label.style.color = '';
            }, 500);
          }
        });
        // Show visual feedback
        const originalText = selectAllBtn.innerHTML;
        selectAllBtn.innerHTML = '<i class="fas fa-check mr-1"></i> All Selected';
        setTimeout(() => {
          selectAllBtn.innerHTML = originalText;
        }, 1000);
        // Save selections to localStorage
        saveHistogramSelections();
      });
    }
    
    if (deselectAllBtn) {
      deselectAllBtn.addEventListener('click', function() {
        document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
          checkbox.checked = false;
          // Add a small animation to show the change
          const label = checkbox.nextElementSibling;
          if (label) {
            label.style.transition = 'color 0.3s ease';
            label.style.opacity = '0.7';
            setTimeout(() => {
              label.style.opacity = '';
            }, 500);
          }
        });
        // Show visual feedback
        const originalText = deselectAllBtn.innerHTML;
        deselectAllBtn.innerHTML = '<i class="fas fa-times mr-1"></i> All Deselected';
        setTimeout(() => {
          deselectAllBtn.innerHTML = originalText;
        }, 1000);
        // Save selections to localStorage
        saveHistogramSelections();
      });
    }
    
    // Initialize checkboxes from localStorage if available
    const savedSelections = localStorage.getItem('selected_histograms');
    if (savedSelections) {
      try {
        const selections = JSON.parse(savedSelections);
        document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
          const field = checkbox.getAttribute('data-field');
          if (field && selections.includes(field)) {
            checkbox.checked = true;
          }
        });
      } catch (e) {
        console.error('Error loading saved histogram selections:', e);
      }
    } else {
      // If no saved selections, select all by default
      document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
        checkbox.checked = true;
      });
      saveHistogramSelections();
    }
    
    // Save selections to localStorage when changed
    document.querySelectorAll('.export-histogram-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', saveHistogramSelections);
    });
    
    function saveHistogramSelections() {
      const selectedFields = Array.from(document.querySelectorAll('.export-histogram-checkbox:checked'))
        .map(cb => cb.getAttribute('data-field'))
        .filter(Boolean);
      
      localStorage.setItem('selected_histograms', JSON.stringify(selectedFields));
    }
  });
</script>
<!-- =====================
     Social Sharing Buttons
     ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('twitter-share')) {
      const pageUrl = encodeURIComponent(window.location.href);
      const shareMessage = encodeURIComponent("Check out the assignments my students just finished on Sway! The AI Guide killed it! 🤯");
      
      // X (formerly Twitter) sharing
      const xBtn = document.getElementById('twitter-share');
      xBtn.href = `https://x.com/intent/tweet?text=${shareMessage}&url=${pageUrl}`;
      xBtn.target = '_blank';
      xBtn.rel = 'noopener noreferrer';
      
      // Facebook sharing
      const facebookBtn = document.getElementById('facebook-share');
      facebookBtn.href = `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}&quote=${shareMessage}`;
      facebookBtn.target = '_blank';
      facebookBtn.rel = 'noopener noreferrer';
      
      // LinkedIn sharing
      const linkedinBtn = document.getElementById('linkedin-share');
      linkedinBtn.href = `https://www.linkedin.com/sharing/share-offsite/?url=${pageUrl}`;
      linkedinBtn.target = '_blank';
      linkedinBtn.rel = 'noopener noreferrer';
      
      // Instagram sharing (requires copy to clipboard)
      const instagramBtn = document.getElementById('instagram-share');
      instagramBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const textarea = document.createElement('textarea');
        textarea.value = `${shareMessage}\n\n${window.location.href}`;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('Link and message copied to clipboard. Paste this into Instagram to share!');
      });
    }
  });
</script>
<!-- =====================
     CSS for Status Messages and CodeMirror
     ===================== -->
<style>
  .status-message {
    margin-top: 15px;
    padding: 10px;
    border-radius: 6px;
  }
  .success {
    background-color: rgba(40, 167, 69, 0.2);
    border: 1px solid #28a745;
    color: #28a745;
  }
  .error {
    background-color: rgba(220, 53, 69, 0.2);
    border: 1px solid #dc3545;
    color: #dc3545;
  }
  .CodeMirror {
    height: auto;
    min-height: 300px;
    border-radius: 6px;
    font-family: 'Fira Code', 'Courier New', monospace;
    font-size: 14px;
    padding: 10px 0;
    margin-bottom: 20px;
  }
</style>
<script src="/static/js/histogram-title-fixer.js"></script>
<!-- Script for polished Show More/Fewer functionality in all modes -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
      // Instructor Report Show More
      const setupReportShowMore = function() {
        const reportContent = document.getElementById('report-content');
        if (reportContent) {
          const headings = reportContent.querySelectorAll('h3');
          if (headings.length > 2) {
            const secondHeading = headings[1];
            const hiddenContentWrapper = document.createElement('div');
            hiddenContentWrapper.id = 'hidden-report-content';
            hiddenContentWrapper.className = 'collapsible-section collapsed';
            let currentNode = secondHeading.nextElementSibling;
            let nodesToMove = [];
            while (currentNode) {
              if (currentNode.tagName === 'H3' && currentNode !== secondHeading) {
                nodesToMove.push(currentNode);
              } else if (nodesToMove.length > 0) {
                nodesToMove.push(currentNode);
              }
              currentNode = currentNode.nextElementSibling;
            }
            nodesToMove.forEach(node => { hiddenContentWrapper.appendChild(node); });
            reportContent.appendChild(hiddenContentWrapper);
            
            const showMoreBtn = document.createElement('button');
            showMoreBtn.className = 'btn btn-thread-toggle show-toggle-btn';
            showMoreBtn.innerHTML = 'Continue Reading <i class="fas fa-chevron-down"></i>';
            showMoreBtn.style.marginTop = '1.5rem';
            reportContent.insertBefore(showMoreBtn, hiddenContentWrapper);
            
            // Add a spacer div ABOVE the Continue Reading button for extra spacing
            const spacerDiv = document.createElement('div');
            spacerDiv.style.height = '1rem';
            spacerDiv.style.clear = 'both';
            reportContent.insertBefore(spacerDiv, showMoreBtn);
            
            showMoreBtn.addEventListener('click', function() {
              const expanded = hiddenContentWrapper.classList.contains('collapsed');
              if (expanded) {
                hiddenContentWrapper.classList.remove('collapsed');
                showMoreBtn.classList.add('expanded');
                showMoreBtn.innerHTML = 'Show Less <i class="fas fa-chevron-up"></i>';
              } else {
                hiddenContentWrapper.classList.add('collapsed');
                showMoreBtn.classList.remove('expanded');
                showMoreBtn.innerHTML = 'Continue Reading <i class="fas fa-chevron-down"></i>';
              }
            });
          }
        }
      };
      // Threads Masonry Show More
      const setupThreadsShowMore = function() {
        const masonryGrid = document.querySelector('.masonry-grid');
        if (!masonryGrid || masonryGrid.children.length <= 2) {
          return; // Do nothing if 2 or fewer items
        }

        const masonryItems = Array.from(masonryGrid.querySelectorAll('.masonry-item'));
        const itemsToShowInitially = 2;

        const performHideAndSetupButtons = () => {
          // Hide items beyond the initial set
          for (let i = itemsToShowInitially; i < masonryItems.length; i++) {
            if (masonryItems[i]) { // Ensure item exists
              masonryItems[i].classList.add('hidden-thread');
            }
          }

          const hiddenItemCount = masonryGrid.querySelectorAll('.masonry-item.hidden-thread').length;
          if (hiddenItemCount === 0 && masonryItems.length > itemsToShowInitially) {
            // Fallback or logging if hiding didn't work as expected but should have
            console.warn("Masonry items were expected to be hidden but were not.");
            // Potentially, if itemsToShowInitially is high, this might be normal if total items < itemsToShowInitially
          }
          
          // Only proceed with buttons if there are actually items to unhide
          if (masonryItems.length <= itemsToShowInitially) {
            return;
          }

          const showMoreThreadsBtn = document.createElement('button');
          showMoreThreadsBtn.className = 'btn btn-thread-toggle show-toggle-btn';

          const updateShowMoreText = () => {
            const currentHiddenCount = masonryGrid.querySelectorAll('.masonry-item.hidden-thread').length;
            showMoreThreadsBtn.innerHTML = `Show ${currentHiddenCount} More Threads`;
            // Show button only if there are hidden threads
            showMoreThreadsBtn.style.display = currentHiddenCount > 0 ? 'block' : 'none';
          };
          
          const showFewerThreadsBtn = document.createElement('button');
          showFewerThreadsBtn.className = 'btn btn-thread-toggle show-toggle-btn';
          showFewerThreadsBtn.innerHTML = 'Show Fewer Threads';
          showFewerThreadsBtn.style.display = 'none'; // Initially hidden

          const threadListSection = document.querySelector('.thread-list');
          let spacerDiv;
          if (threadListSection) {
            spacerDiv = document.createElement('div');
            spacerDiv.style.height = '4px';
            spacerDiv.style.clear = 'both';
            spacerDiv.style.display = 'none';
            threadListSection.appendChild(spacerDiv);
            threadListSection.appendChild(showFewerThreadsBtn);
          }
          
          // Insert Show More button only if there's a chance it will be displayed
          if (masonryItems.length > itemsToShowInitially) {
             masonryGrid.parentNode.insertBefore(showMoreThreadsBtn, masonryGrid.nextSibling);
             updateShowMoreText(); // Set initial text and visibility
          }


          showMoreThreadsBtn.addEventListener('click', function() {
            masonryItems.forEach(item => item.classList.remove('hidden-thread'));
            updateShowMoreText(); // Button should hide itself
            showFewerThreadsBtn.style.display = 'block';
            if (spacerDiv) spacerDiv.style.display = 'block';
          });

          showFewerThreadsBtn.addEventListener('click', function() {
            for (let i = itemsToShowInitially; i < masonryItems.length; i++) {
              if (masonryItems[i]) {
                masonryItems[i].classList.add('hidden-thread');
              }
            }
            updateShowMoreText(); // Button should reappear and update count
            showFewerThreadsBtn.style.display = 'none';
            if (spacerDiv) spacerDiv.style.display = 'none';
            
            const chatThreadsSectionTitle = document.querySelector('h5.section-title .fa-comments');
            if (chatThreadsSectionTitle && chatThreadsSectionTitle.closest('h5.section-title')) {
              chatThreadsSectionTitle.closest('h5.section-title').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
              masonryGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          });
        };

        if (window.requestAnimationFrame) {
          window.requestAnimationFrame(() => {
            setTimeout(performHideAndSetupButtons, 75); // Delay to allow layout to settle
          });
        } else {
          setTimeout(performHideAndSetupButtons, 75); // Fallback
        }
      };

      setupReportShowMore();
      setupThreadsShowMore();

      // Opinion Distribution Show More/Less
      const histogramCards = document.querySelectorAll('.opinion-histogram-card');
      const showMoreBtn = document.getElementById('show-more-histograms-btn');
      const showFewerBtn = document.getElementById('show-fewer-histograms-btn');
      const maxVisible = 6;
      if (histogramCards.length > maxVisible) {
        for (let i = maxVisible; i < histogramCards.length; i++) {
          histogramCards[i].classList.add('hidden-histogram');
        }
        showMoreBtn.style.display = 'inline-block';
      }
      if (showMoreBtn && showFewerBtn) {
        showMoreBtn.addEventListener('click', function() {
          for (let i = maxVisible; i < histogramCards.length; i++) {
            histogramCards[i].classList.remove('hidden-histogram');
          }
          showMoreBtn.style.display = 'none';
          showFewerBtn.style.display = 'inline-block';
        });
        showFewerBtn.addEventListener('click', function() {
          for (let i = maxVisible; i < histogramCards.length; i++) {
            histogramCards[i].classList.add('hidden-histogram');
          }
          showMoreBtn.style.display = 'inline-block';
          showFewerBtn.style.display = 'none';
          // Scroll to the top of the histogram section
          const sectionTitle = document.querySelector('.section-title .fa-chart-bar');
          if (sectionTitle && sectionTitle.closest('.section-title')) {
            sectionTitle.closest('.section-title').scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      }
    });
  </script>
<!-- Script to disable hover animations -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
      // Create a style element
      var style = document.createElement('style');
      
      // Add CSS rules to disable hover animations
      style.innerHTML = `
        .card:hover, 
        .thread-item:hover, 
        .histogram-container:hover, 
        .histogram-bar:hover, 
        .histogram-card:hover {
          transform: none !important;
        }
      `;
      
      // Append the style element to the head
      document.head.appendChild(style);
    });
  </script>
<!-- Close content-wrapper -->
</body>
</html>